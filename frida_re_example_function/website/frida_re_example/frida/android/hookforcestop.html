
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>hookForceStop · Frida逆向实例和工具函数</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 4.0.7">
        <meta name="author" content="Crifan Li <admin@crifan.com>">
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../frida_trace/" />
    
    
    <link rel="prev" href="single_class/single_func.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"repo":"frida_re_example_function","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://www.crifan.org" target="_blank" class="custom-link">主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../frida_overview/">
            
                <a href="../../../frida_overview/">
            
                    
                        <b>1.2.</b>
                    
                    概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.3.</b>
                    
                    Frida逆向实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../code_snippet/">
            
                <a href="../../code_snippet/">
            
                    
                        <b>1.3.1.</b>
                    
                    代码段
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../code_snippet/frida_official.html">
            
                <a href="../../code_snippet/frida_official.html">
            
                    
                        <b>1.3.1.1.</b>
                    
                    Frida官网
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../../code_snippet/online_others.html">
            
                <a href="../../code_snippet/online_others.html">
            
                    
                        <b>1.3.1.2.</b>
                    
                    网上别人的案例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.3.2.</b>
                    
                    frida
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../ios_objc/">
            
                <a href="../ios_objc/">
            
                    
                        <b>1.3.2.1.</b>
                    
                    iOS的ObjC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.1" data-path="../ios_objc/object/">
            
                <a href="../ios_objc/object/">
            
                    
                        <b>1.3.2.1.1.</b>
                    
                    ObjC的Object
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.1.1" data-path="../ios_objc/object/methods_ownMethods.html">
            
                <a href="../ios_objc/object/methods_ownMethods.html">
            
                    
                        <b>1.3.2.1.1.1.</b>
                    
                    $methods和$ownMethods
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.2" data-path="../ios_objc/hook_func/">
            
                <a href="../ios_objc/hook_func/">
            
                    
                        <b>1.3.2.1.2.</b>
                    
                    Interceptor=hook函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.2.1" data-path="../ios_objc/hook_func/single_cls_single_func.html">
            
                <a href="../ios_objc/hook_func/single_cls_single_func.html">
            
                    
                        <b>1.3.2.1.2.1.</b>
                    
                    单个类的单个函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.2.2" data-path="../ios_objc/hook_func/single_cls_all_func.html">
            
                <a href="../ios_objc/hook_func/single_cls_all_func.html">
            
                    
                        <b>1.3.2.1.2.2.</b>
                    
                    单个类的所有函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.2.3" data-path="../ios_objc/hook_func/cll_cls_all_func.html">
            
                <a href="../ios_objc/hook_func/cll_cls_all_func.html">
            
                    
                        <b>1.3.2.1.2.3.</b>
                    
                    所有类的所有函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.3" data-path="../ios_objc/apiresolver/">
            
                <a href="../ios_objc/apiresolver/">
            
                    
                        <b>1.3.2.1.3.</b>
                    
                    ApiResolver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.4" data-path="../ios_objc/stalker/">
            
                <a href="../ios_objc/stalker/">
            
                    
                        <b>1.3.2.1.4.</b>
                    
                    Stalker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.4.1" data-path="../ios_objc/stalker/akd_lldb_unnamed_symbol2575.html">
            
                <a href="../ios_objc/stalker/akd_lldb_unnamed_symbol2575.html">
            
                    
                        <b>1.3.2.1.4.1.</b>
                    
                    ___lldb_unnamed_symbol2575$$akd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.3.2.2.</b>
                    
                    Android
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.2.1" data-path="hook_demo.html">
            
                <a href="hook_demo.html">
            
                    
                        <b>1.3.2.2.1.</b>
                    
                    demo示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2.2" data-path="single_class/">
            
                <a href="single_class/">
            
                    
                        <b>1.3.2.2.2.</b>
                    
                    单个类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.2.2.1" data-path="single_class/single_func.html">
            
                <a href="single_class/single_func.html">
            
                    
                        <b>1.3.2.2.2.1.</b>
                    
                    单个类的单个函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.3.2.2.3" data-path="hookforcestop.html">
            
                <a href="hookforcestop.html">
            
                    
                        <b>1.3.2.2.3.</b>
                    
                    hookForceStop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../frida_trace/">
            
                <a href="../../frida_trace/">
            
                    
                        <b>1.3.3.</b>
                    
                    frida-trace
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../../frida_trace/ios_objc/">
            
                <a href="../../frida_trace/ios_objc/">
            
                    
                        <b>1.3.3.1.</b>
                    
                    iOS的ObjC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1.1" data-path="../../frida_trace/ios_objc/akd_apple_login.html">
            
                <a href="../../frida_trace/ios_objc/akd_apple_login.html">
            
                    
                        <b>1.3.3.1.1.</b>
                    
                    akd中Apple账号验证过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.1.2" data-path="../../frida_trace/ios_objc/preferences_full_apple_login.html">
            
                <a href="../../frida_trace/ios_objc/preferences_full_apple_login.html">
            
                    
                        <b>1.3.3.1.2.</b>
                    
                    Preferences中Apple账号登录全过程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../../frida_trace/android/">
            
                <a href="../../frida_trace/android/">
            
                    
                        <b>1.3.3.2.</b>
                    
                    Android
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.2.1" data-path="../../frida_trace/android/commands.html">
            
                <a href="../../frida_trace/android/commands.html">
            
                    
                        <b>1.3.3.2.1.</b>
                    
                    commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2.2" data-path="../../frida_trace/android/system_server.html">
            
                <a href="../../frida_trace/android/system_server.html">
            
                    
                        <b>1.3.3.2.2.</b>
                    
                    安卓进程system_server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../../frida_tool_func/">
            
                <a href="../../../frida_tool_func/">
            
                    
                        <b>1.4.</b>
                    
                    Frida工具函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../../frida_tool_func/common_js/">
            
                <a href="../../../frida_tool_func/common_js/">
            
                    
                        <b>1.4.1.</b>
                    
                    通用js函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../../../frida_tool_func/common_js/frida_common.html">
            
                <a href="../../../frida_tool_func/common_js/frida_common.html">
            
                    
                        <b>1.4.1.1.</b>
                    
                    Frida的js通用函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../../frida_tool_func/ios/">
            
                <a href="../../../frida_tool_func/ios/">
            
                    
                        <b>1.4.2.</b>
                    
                    iOS函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../../frida_tool_func/ios/callstack.html">
            
                <a href="../../../frida_tool_func/ios/callstack.html">
            
                    
                        <b>1.4.2.1.</b>
                    
                    iOS函数调用堆栈
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../../frida_tool_func/android/">
            
                <a href="../../../frida_tool_func/android/">
            
                    
                        <b>1.4.3.</b>
                    
                    Android函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../../../frida_tool_func/android/java_common/">
            
                <a href="../../../frida_tool_func/android/java_common/">
            
                    
                        <b>1.4.3.1.</b>
                    
                    Java通用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.1" data-path="../../../frida_tool_func/android/java_common/process_class.html">
            
                <a href="../../../frida_tool_func/android/java_common/process_class.html">
            
                    
                        <b>1.4.3.1.1.</b>
                    
                    类的处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2" data-path="../../../frida_tool_func/android/java_common/func_property.html">
            
                <a href="../../../frida_tool_func/android/java_common/func_property.html">
            
                    
                        <b>1.4.3.1.2.</b>
                    
                    函数和属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.3" data-path="../../../frida_tool_func/android/java_common/call_stack.html">
            
                <a href="../../../frida_tool_func/android/java_common/call_stack.html">
            
                    
                        <b>1.4.3.1.3.</b>
                    
                    函数调用堆栈
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../../../frida_tool_func/android/android_class.html">
            
                <a href="../../../frida_tool_func/android/android_class.html">
            
                    
                        <b>1.4.3.2.</b>
                    
                    Android类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="../../../frida_tool_func/android/c/">
            
                <a href="../../../frida_tool_func/android/c/">
            
                    
                        <b>1.4.3.3.</b>
                    
                    C
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.3.1" data-path="../../../frida_tool_func/android/c/native.html">
            
                <a href="../../../frida_tool_func/android/c/native.html">
            
                    
                        <b>1.4.3.3.1.</b>
                    
                    native C
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../../appendix/">
            
                <a href="../../../appendix/">
            
                    
                        <b>1.5.</b>
                    
                    附录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../../appendix/reference.html">
            
                <a href="../../../appendix/reference.html">
            
                    
                        <b>1.5.1.</b>
                    
                    参考资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >hookForceStop</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <html><head></head><body><h1 id="hookforcestop"><a name="hookforcestop" class="plugin-anchor" href="#hookforcestop"><i class="fa fa-link" aria-hidden="true"></i></a>hookForceStop</h1>
<p>调用：</p>
<pre class="language-"><code class="lang-bash">frida <span class="token parameter variable">-U</span> <span class="token parameter variable">-n</span> system_server <span class="token parameter variable">-l</span> hook_systemServer.js

frida <span class="token parameter variable">-U</span> <span class="token parameter variable">-f</span> com.android.settings <span class="token parameter variable">-l</span> hook_systemServer.js
</code></pre>
<p>对应脚本：</p>
<ul>
<li><code>hook_systemServer.js</code></li>
</ul>
<pre class="language-"><code class="lang-js"><span class="token comment">/**
 * Update: 20230920
 * Usage:
 *  frida -U -n system_server -l hook_systemServer.js
 * 
 *  frida -U -f com.android.settings -l hook_systemServer.js
*/</span>

<span class="token comment">/*******************************************************************************
 * Const &amp; Config
*******************************************************************************/</span>

<span class="token keyword">let</span> CurAppPkgName <span class="token operator">=</span> <span class="token string">&quot;com.wallpaper.hd.funny&quot;</span>

<span class="token comment">// Enable Not Call Filter</span>
<span class="token keyword">let</span> enableNotCallFilter_Binder_execTransact <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">let</span> enableNotCallFilter_AMS_startService <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> enableNotCallFilter_AMS_startProcessLocked <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">let</span> enableNotCallFilter_ActiveServices_bringUpServiceLocked <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// let enableNotCallFilter_ActiveServices_bringUpServiceLocked = false</span>

<span class="token keyword">let</span> enableNotCallFilter_ActiveServices_startServiceLocked <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> enableNotCallFilter_ActiveServices_startServiceInnerLocked <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">let</span> enableNotCallFilter_ProcessList_startProcessLocked <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> enableNotCallFilter_ProcessList_handleProcessStartedLocked <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">let</span> enableNotCallFilter_ContentProviderHelper_getContentProviderImpl <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// let enableNotCallFilter_ContentProviderHelper_getContentProviderImpl = false</span>

<span class="token comment">// let enableNotCallFilter_BroadcastQueue_processNextBroadcastLocked = false</span>

<span class="token keyword">let</span> enableNotCallFilter_Handler_dispatchMessage <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// let enableNotCallFilter_Handler_dispatchMessage = false</span>


<span class="token comment">/*******************************************************************************
 * Common Util
*******************************************************************************/</span>

<span class="token comment">// convert Object(dict/list/...) to JSON string</span>
<span class="token keyword">function</span> <span class="token function">toJsonStr</span><span class="token punctuation">(</span><span class="token parameter">curObj<span class="token punctuation">,</span> singleLine<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">,</span> space<span class="token operator">=</span><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;toJsonStr: singleLine=&quot; + singleLine)</span>
  <span class="token comment">// var jsonStr = JSON.stringify(curObj, null, 2)</span>
  <span class="token keyword">var</span> jsonStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>curObj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> space<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>singleLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// jsonStr = jsonStr.replace(/\\n/g, &apos;&apos;)</span>
    jsonStr <span class="token operator">=</span> jsonStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> jsonStr
  <span class="token comment">// return curObj.toString()</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">describeJavaClass</span><span class="token punctuation">(</span><span class="token parameter">className</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> jClass <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">_name</span><span class="token operator">:</span> className<span class="token punctuation">,</span>
    <span class="token literal-property property">_methods</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>jClass<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// _methods: Object.getOwnPropertyDescriptor(jClass.__proto__).filter(m =&gt; {</span>
    <span class="token comment">// _methods: Object.getOwnPropertySymbols(jClass.__proto__).filter(m =&gt; {</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>m<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&apos;$&apos;</span><span class="token punctuation">)</span> <span class="token comment">// filter out Frida related special properties</span>
         <span class="token operator">||</span> m <span class="token operator">==</span> <span class="token string">&apos;class&apos;</span> <span class="token operator">||</span> m <span class="token operator">==</span> <span class="token string">&apos;constructor&apos;</span> <span class="token comment">// optional</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">_fields</span><span class="token operator">:</span> jClass<span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// enumerate all methods declared in a Java class</span>
<span class="token keyword">function</span> <span class="token function">enumMethods</span><span class="token punctuation">(</span><span class="token parameter">targetClass</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> hook <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ownMethods <span class="token operator">=</span> hook<span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;use getDeclaredMethods&quot;</span><span class="token punctuation">)</span>

  <span class="token comment">// var ownMethods = hook.class.getMethods();</span>
  <span class="token comment">// console.log(&quot;use getMethods&quot;)</span>

  hook<span class="token punctuation">.</span>$dispose<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ownMethods<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// enumerate all property=field declared in a Java class</span>
<span class="token keyword">function</span> <span class="token function">enumProperties</span><span class="token punctuation">(</span><span class="token parameter">targetClass</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> hook <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// var ownMethods = hook.class.getFields();</span>
  <span class="token comment">// console.log(&quot;use getFields&quot;)</span>

  <span class="token keyword">var</span> ownFields <span class="token operator">=</span> hook<span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;use getDeclaredFields&quot;</span><span class="token punctuation">)</span>

  hook<span class="token punctuation">.</span>$dispose<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ownFields<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// print single java class all Functions=Methods and Fields=Properties</span>
<span class="token keyword">function</span> <span class="token function">printClassAllMethodsFields</span><span class="token punctuation">(</span><span class="token parameter">javaClassName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;==========&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;Class: &quot;</span> <span class="token operator">+</span> javaClassName <span class="token operator">+</span> <span class="token string">&quot; ==========&quot;</span><span class="token punctuation">)</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;-----&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;All Properties&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-----&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> allProperties <span class="token operator">=</span> <span class="token function">enumProperties</span><span class="token punctuation">(</span>javaClassName<span class="token punctuation">)</span>
  allProperties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">singleProperty</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>singleProperty<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;-----&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;All Methods&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-----&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// enumerate all methods in a class</span>
  <span class="token keyword">var</span> allMethods <span class="token operator">=</span> <span class="token function">enumMethods</span><span class="token punctuation">(</span>javaClassName<span class="token punctuation">)</span>
  allMethods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">singleMethod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>singleMethod<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// generate current stack trace string</span>
<span class="token keyword">function</span> <span class="token function">genStackStr</span><span class="token punctuation">(</span><span class="token parameter">ThrowableCls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newThrowable <span class="token operator">=</span> ThrowableCls<span class="token punctuation">.</span>$<span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(&quot;genStackStr: newThrowable=&quot; + newThrowable)</span>
  <span class="token keyword">var</span> stackElements <span class="token operator">=</span> newThrowable<span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(&quot;genStackStr: stackElements=&quot; + stackElements)</span>
  <span class="token keyword">var</span> stackStr <span class="token operator">=</span> <span class="token string">&quot;Stack: &quot;</span> <span class="token operator">+</span> stackElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//method//stackElements[0].getMethodName()</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stackElements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stackStr <span class="token operator">+=</span> <span class="token string">&quot;\n    at &quot;</span> <span class="token operator">+</span> stackElements<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// stackStr = &quot;\n\n&quot; + stackStr</span>
  stackStr <span class="token operator">=</span> stackStr <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span>
  <span class="token comment">// console.log(&quot;genStackStr: stackStr=&quot; + stackStr)</span>

  <span class="token keyword">return</span> stackStr
<span class="token punctuation">}</span>

<span class="token comment">// 打印当前调用堆栈信息 print call stack</span>
<span class="token keyword">function</span> <span class="token function">PrintStack</span><span class="token punctuation">(</span><span class="token parameter">ThrowableCls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> stackStr <span class="token operator">=</span> <span class="token function">genStackStr</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stackStr<span class="token punctuation">)</span>

  <span class="token comment">// let newThrowable = ThrowableCls.$new()</span>
  <span class="token comment">// let curLog = Java.use(&quot;android.util.Log&quot;)</span>
  <span class="token comment">// let stackStr = curLog.getStackTraceString(newThrowable)</span>
  <span class="token comment">// console.log(&quot;stackStr=&quot; + stackStr)</span>
<span class="token punctuation">}</span>

<span class="token comment">// generate Function call string</span>
<span class="token keyword">function</span> <span class="token function">genFunctionCallStr</span><span class="token punctuation">(</span><span class="token parameter">funcName<span class="token punctuation">,</span> funcParaDict</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> logStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>funcName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token template-punctuation string">`</span></span>
  <span class="token comment">// var logStr = funcName + &quot;:&quot;</span>
  <span class="token keyword">var</span> isFirst <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> curParaName <span class="token keyword">in</span> funcParaDict<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> curParaValue <span class="token operator">=</span> funcParaDict<span class="token punctuation">[</span>curParaName<span class="token punctuation">]</span>
    <span class="token keyword">var</span> prevStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isFirst<span class="token punctuation">)</span><span class="token punctuation">{</span>
      prevStr <span class="token operator">=</span> <span class="token string">&quot; &quot;</span>
      isFirst <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      prevStr <span class="token operator">=</span> <span class="token string">&quot;, &quot;</span>
    <span class="token punctuation">}</span>

    logStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>logStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prevStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curParaName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> curParaValue
    <span class="token comment">// logStr = logStr + prevStr + curParaName + &quot;=&quot; + curParaValue</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> logStr
<span class="token punctuation">}</span>

<span class="token comment">// print Function call and stack trace string</span>
<span class="token keyword">function</span> <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span><span class="token parameter">funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">,</span> filterList<span class="token operator">=</span><span class="token keyword">undefined</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;filterList=&quot; + filterList)</span>

  <span class="token keyword">var</span> needPrint <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token keyword">var</span> functionCallStr <span class="token operator">=</span> <span class="token function">genFunctionCallStr</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">)</span>

  <span class="token keyword">var</span> stackStr <span class="token operator">=</span> <span class="token function">genStackStr</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>filterList <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    needPrint <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> curFilter <span class="token keyword">of</span> filterList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log(&quot;curFilter=&quot; + curFilter)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stackStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>curFilter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        needPrint <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;needPrint=&quot; + needPrint)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>needPrint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> functionCallAndStackStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>functionCallStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stackStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token comment">// var functionCallAndStackStr = functionCallStr + &quot;\n&quot; + stackStr</span>

    <span class="token comment">// return functionCallAndStackStr</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>functionCallAndStackStr<span class="token punctuation">)</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// find loaded classes that match a pattern (async)</span>
<span class="token keyword">function</span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token parameter">pattern</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Finding all classes that match pattern: &quot;</span> <span class="token operator">+</span> pattern <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Java<span class="token punctuation">.</span><span class="token function">enumerateLoadedClasses</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">onMatch</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">aClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aClass<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onComplete</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*----------------------------------------
 Android Utils
----------------------------------------*/</span>

<span class="token keyword">function</span> <span class="token function">printProcessRecord</span><span class="token punctuation">(</span><span class="token parameter">curProcessRecord</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;printProcessRecord: curProcessRecord=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  mService=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>mService<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  mProcLock=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>mProcLock<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  info=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>info<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  processInfo=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>processInfo<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  isolated=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>isolated<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  isSdkSandbox=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>isSdkSandbox<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  appZygote=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>appZygote<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  uid=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  userId=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>userId<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  processName=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>processName<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  sdkSandboxClientAppPackage=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>sdkSandboxClientAppPackage<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  sdkSandboxClientAppVolumeUuid=&quot;</span> <span class="token operator">+</span> curProcessRecord<span class="token punctuation">.</span>sdkSandboxClientAppVolumeUuid<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getParcelInfo</span><span class="token punctuation">(</span><span class="token parameter">curParcel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> parcelDataSize <span class="token operator">=</span> curParcel<span class="token punctuation">.</span><span class="token function">dataSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> parcelDataCapacity <span class="token operator">=</span> curParcel<span class="token punctuation">.</span><span class="token function">dataCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// var parcelDataPosition = curParcel.dataPosition()</span>
  <span class="token comment">// var parcelInfoStr = &quot;dataSize=&quot; + parcelDataSize + &quot;, dataCapacity=&quot; + parcelDataCapacity + &quot;, dataPositon = &quot; + parcelDataPosition</span>
  <span class="token keyword">var</span> parcelInfoStr <span class="token operator">=</span> <span class="token string">&quot;Parcel: &quot;</span> <span class="token operator">+</span> curParcel <span class="token operator">+</span> <span class="token string">&quot;, dataSize=&quot;</span> <span class="token operator">+</span> parcelDataSize <span class="token operator">+</span> <span class="token string">&quot;, dataCapacity=&quot;</span> <span class="token operator">+</span> parcelDataCapacity
  <span class="token keyword">return</span> parcelInfoStr
<span class="token punctuation">}</span>

<span class="token comment">// try to read Parcel string</span>
<span class="token keyword">function</span> <span class="token function">tryReadParcelString</span><span class="token punctuation">(</span><span class="token parameter">curParcel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> parcelDataSize <span class="token operator">=</span> curParcel<span class="token punctuation">.</span><span class="token function">dataSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(&quot;curParcel=&quot; + curParcel + &quot;: parcelDataSize=&quot; + parcelDataSize)</span>
  <span class="token keyword">let</span> StepSize <span class="token operator">=</span> <span class="token number">4</span>

  <span class="token keyword">var</span> isFoundStr <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">var</span> strDictList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">var</span> curStr <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">var</span> curStepSize <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">// var foundStr = null </span>
  <span class="token comment">// var strPos = -1</span>
  <span class="token keyword">var</span> foundStrNum <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> curPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> curPos <span class="token operator">&lt;</span> parcelDataSize<span class="token punctuation">;</span> curPos<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    curStepSize <span class="token operator">=</span> StepSize
    curParcel<span class="token punctuation">.</span><span class="token function">setDataPosition</span><span class="token punctuation">(</span>curPos<span class="token punctuation">)</span>
    curStr <span class="token operator">=</span> curParcel<span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curStr<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curStr <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// empty string, continue try read other string</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        isFoundStr <span class="token operator">=</span> <span class="token boolean">true</span>
        foundStrNum <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment">// foundStr = curStr</span>
        <span class="token comment">// strPos = curPos</span>
        <span class="token comment">// console.log(&quot;  [&quot; + curPos + &quot;] string=&quot; + curStr)</span>
        <span class="token comment">// console.log(&quot;  [&quot; + strPos + &quot;] string=&quot; + foundStr)</span>
        <span class="token keyword">var</span> curStrDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;str&quot;</span><span class="token operator">:</span> curStr<span class="token punctuation">,</span> <span class="token string-property property">&quot;pos&quot;</span><span class="token operator">:</span> curPos<span class="token punctuation">}</span>
        strDictList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curStrDict<span class="token punctuation">)</span>
        <span class="token keyword">var</span> newPosition <span class="token operator">=</span> curParcel<span class="token punctuation">.</span><span class="token function">dataPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> posDiff <span class="token operator">=</span> newPosition <span class="token operator">-</span> curPos
        curStepSize <span class="token operator">=</span> posDiff
        <span class="token comment">// console.log(&quot;  [&quot; + foundStrNum + &quot;] strDict=&quot; + toJsonStr(curStrDict, true) + &quot;, pos: &quot; + curPos + &quot; -&gt; &quot; + newPosition +&quot;, curStepSize=&quot; + curStepSize)</span>
        <span class="token comment">// break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    curPos <span class="token operator">+=</span> curStepSize
  <span class="token punctuation">}</span>

  <span class="token comment">// setDataPosition and readString maybe CHANGED position, so need reset position</span>
  curParcel<span class="token punctuation">.</span><span class="token function">setDataPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// if(isFoundStr){</span>
  <span class="token comment">//   // var logStr = toJsonStr(strDictList, true, 1)</span>
  <span class="token comment">//   var logStr = toJsonStr(strDictList, true, 0)</span>
  <span class="token comment">//   console.log(&quot;  logStr=&quot; + logStr)</span>
  <span class="token comment">// }</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;isFoundStr&quot;</span><span class="token operator">:</span> isFoundStr<span class="token punctuation">,</span>
    <span class="token string-property property">&quot;strDictList&quot;</span><span class="token operator">:</span> strDictList
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// print Intent info</span>
<span class="token keyword">function</span> <span class="token function">printIntentInfo</span><span class="token punctuation">(</span><span class="token parameter">curIntent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;printIntentInfo: curIntent=&quot;</span> <span class="token operator">+</span> curIntent<span class="token punctuation">)</span>
  <span class="token keyword">var</span> curComponent <span class="token operator">=</span> curIntent<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Intent component=&quot;</span> <span class="token operator">+</span> curComponent<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>curComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> pkgName <span class="token operator">=</span> curComponent<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> clsName <span class="token operator">=</span> curComponent<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> shortClsName <span class="token operator">=</span> curComponent<span class="token punctuation">.</span><span class="token function">getShortClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> flattenedShortStr <span class="token operator">=</span> curComponent<span class="token punctuation">.</span><span class="token function">flattenToShortString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> flattenedStr <span class="token operator">=</span> curComponent<span class="token punctuation">.</span><span class="token function">flattenToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;    Intent Component info: pkgName=&quot;</span> <span class="token operator">+</span> pkgName <span class="token operator">+</span> <span class="token string">&quot;, clsName=&quot;</span> <span class="token operator">+</span> clsName <span class="token operator">+</span> <span class="token string">&quot;, shortClsName=&quot;</span> <span class="token operator">+</span> shortClsName  <span class="token operator">+</span> <span class="token string">&quot;, flattenedStr=&quot;</span> <span class="token operator">+</span> flattenedStr <span class="token operator">+</span> <span class="token string">&quot;,flattenedShortStr=&quot;</span> <span class="token operator">+</span> flattenedShortStr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/*******************************************************************************
 * Main Hook
*******************************************************************************/</span>

<span class="token keyword">function</span> <span class="token function">hookNativeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// /Users/crifan/dev/dev_src/androidReverse/Android/android.googlesource.com/base-refs_heads_main/core/jni/android_util_Binder.cpp</span>
  <span class="token comment">// status_t onTransact( uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags = 0) override {</span>
  <span class="token comment">// var foundOnTransact = Module.findExportByName(null, &quot;onTransact&quot;)</span>

  <span class="token comment">// let transactModuleName = &quot;libBinder.so&quot;</span>
  <span class="token comment">// let transactModuleName = &quot;libbinder.so&quot;</span>
  <span class="token keyword">let</span> transactModuleName <span class="token operator">=</span> <span class="token string">&quot;libbinder_ndk.so&quot;</span>

  <span class="token keyword">var</span> foundOnTransact <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">findExportByName</span><span class="token punctuation">(</span>transactModuleName<span class="token punctuation">,</span> <span class="token string">&quot;onTransact&quot;</span><span class="token punctuation">)</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foundOnTransact=&quot;</span> <span class="token operator">+</span> foundOnTransact<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>foundOnTransact<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Interceptor<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>foundOnTransact<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">onEnter</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> code <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">var</span> reply <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">var</span> flags <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onTransact: code=&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;, data=&quot;</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">&quot;, reply=&quot;</span> <span class="token operator">+</span> reply <span class="token operator">+</span> <span class="token string">&quot;, flags=&quot;</span> <span class="token operator">+</span> flags<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">onLeave</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">retVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onTransact: retval=&quot;</span> <span class="token operator">+</span> retVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// var foundTransact = Module.findExportByName(null, &quot;transact&quot;)</span>
  <span class="token keyword">var</span> foundTransact <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">findExportByName</span><span class="token punctuation">(</span>transactModuleName<span class="token punctuation">,</span> <span class="token string">&quot;transact&quot;</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foundTransact=&quot;</span> <span class="token operator">+</span> foundTransact<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">hookPrintTransactCodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ---------------------------------------- android.app.IActivityManager$Stub</span>
    <span class="token keyword">var</span> IActivityManagerStubClassName <span class="token operator">=</span> <span class="token string">&quot;android.app.IActivityManager$Stub&quot;</span>
    <span class="token keyword">var</span> IActivityManagerStubCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>IActivityManagerStubClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;IActivityManagerStubCls=&quot;</span> <span class="token operator">+</span> IActivityManagerStubCls<span class="token punctuation">)</span>
    <span class="token comment">// printClassAllMethodsFields(IActivityManagerStubClassName)</span>

    <span class="token comment">// console.log(&quot;IActivityManager$Stub: code_startService=&quot; + code_startService + &quot;, code_broadcastIntent=&quot; + code_broadcastIntent + &quot;, code_startInstrumentation=&quot; + code_startInstrumentation + &quot;, code_unbindService=&quot; + code_unbindService)</span>
    <span class="token keyword">var</span> TRANSACTION_startService <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_startService<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_startService=&quot;</span> <span class="token operator">+</span> TRANSACTION_startService<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_broadcastIntent <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_broadcastIntent<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_broadcastIntent=&quot;</span> <span class="token operator">+</span> TRANSACTION_broadcastIntent<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_unbindService <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_unbindService<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_unbindService=&quot;</span> <span class="token operator">+</span> TRANSACTION_unbindService<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_publishService <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_publishService<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_publishService=&quot;</span> <span class="token operator">+</span> TRANSACTION_publishService<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_startInstrumentation <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_startInstrumentation<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_startInstrumentation=&quot;</span> <span class="token operator">+</span> TRANSACTION_startInstrumentation<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_startActivity <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_startActivity<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_startActivity=&quot;</span> <span class="token operator">+</span> TRANSACTION_startActivity<span class="token punctuation">)</span>
    <span class="token comment">// var TRANSACTION_startActivityAndWait = IActivityManagerStubCls.TRANSACTION_startActivityAndWait.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_startActivityAndWait=&quot; + TRANSACTION_startActivityAndWait)</span>
    <span class="token comment">// var TRANSACTION_startActivityAsCaller = IActivityManagerStubCls.TRANSACTION_startActivityAsCaller.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_startActivityAsCaller=&quot; + TRANSACTION_startActivityAsCaller)</span>
    <span class="token keyword">var</span> TRANSACTION_startActivityAsUser <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_startActivityAsUser<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_startActivityAsUser=&quot;</span> <span class="token operator">+</span> TRANSACTION_startActivityAsUser<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_startActivityFromRecents <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_startActivityFromRecents<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_startActivityFromRecents=&quot;</span> <span class="token operator">+</span> TRANSACTION_startActivityFromRecents<span class="token punctuation">)</span>
    <span class="token comment">// var TRANSACTION_startActivityIntentSender = IActivityManagerStubCls.TRANSACTION_startActivityIntentSender.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_startActivityIntentSender=&quot; + TRANSACTION_startActivityIntentSender)</span>
    <span class="token comment">// var TRANSACTION_startActivityWithConfig = IActivityManagerStubCls.TRANSACTION_startActivityWithConfig.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_startActivityWithConfig=&quot; + TRANSACTION_startActivityWithConfig)</span>

    <span class="token keyword">var</span> TRANSACTION_registerUidObserver <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_registerUidObserver<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_registerUidObserver=&quot;</span> <span class="token operator">+</span> TRANSACTION_registerUidObserver<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_unhandledBack <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_unhandledBack<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_unhandledBack=&quot;</span> <span class="token operator">+</span> TRANSACTION_unhandledBack<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_registerReceiver <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_registerReceiver<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_registerReceiver=&quot;</span> <span class="token operator">+</span> TRANSACTION_registerReceiver<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_attachApplication <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_attachApplication<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_attachApplication=&quot;</span> <span class="token operator">+</span> TRANSACTION_attachApplication<span class="token punctuation">)</span>
    <span class="token comment">// var TRANSACTION_activityIdle = IActivityManagerStubCls.TRANSACTION_activityIdle.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_activityIdle=&quot; + TRANSACTION_activityIdle)</span>
    <span class="token keyword">var</span> TRANSACTION_stopService <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_stopService<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_stopService=&quot;</span> <span class="token operator">+</span> TRANSACTION_stopService<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_bindService <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_bindService<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_bindService=&quot;</span> <span class="token operator">+</span> TRANSACTION_bindService<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_noteWakeupAlarm <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_noteWakeupAlarm<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_noteWakeupAlarm=&quot;</span> <span class="token operator">+</span> TRANSACTION_noteWakeupAlarm<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_openContentUri <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_openContentUri<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_openContentUri=&quot;</span> <span class="token operator">+</span> TRANSACTION_openContentUri<span class="token punctuation">)</span>
    <span class="token keyword">var</span> TRANSACTION_finishReceiver <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_finishReceiver<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_finishReceiver=&quot;</span> <span class="token operator">+</span> TRANSACTION_finishReceiver<span class="token punctuation">)</span>
    <span class="token comment">// var TRANSACTION_startNextMatchingActivity = IActivityManagerStubCls.TRANSACTION_startNextMatchingActivity.value</span>
    <span class="token comment">// console.log(&quot;TRANSACTION_startNextMatchingActivity=&quot; + TRANSACTION_startNextMatchingActivity)</span>

    <span class="token keyword">var</span> TRANSACTION_finishActivity <span class="token operator">=</span> IActivityManagerStubCls<span class="token punctuation">.</span>TRANSACTION_finishActivity<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TRANSACTION_finishActivity=&quot;</span> <span class="token operator">+</span> TRANSACTION_finishActivity<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">hookForceStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Java<span class="token punctuation">.</span>available<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Java is not available&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Java is available&quot;</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Java.androidVersion=&quot;</span> <span class="token operator">+</span> Java<span class="token punctuation">.</span>androidVersion<span class="token punctuation">)</span>

  Java<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> ValidTransactCodeList <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token comment">// 24,</span>
      <span class="token comment">// 26,</span>
      <span class="token comment">// 27,</span>
      <span class="token comment">// 28,</span>
      <span class="token comment">// 29,</span>
      <span class="token comment">// 30,</span>
      <span class="token comment">// 34,</span>

      <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// f12217h = START_ACTIVITY_TRANSACTION = 2+1 = 3</span>
      <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// TRANSACTION_startActivity= 7+1 = 8</span>

      <span class="token number">27</span><span class="token punctuation">,</span> <span class="token comment">// serviceCode = TRANSACTION_startService = 27</span>
      <span class="token comment">// 34, // serviceCode = START_SERVICE_TRANSACTION = 33+1 = 34</span>

      <span class="token number">29</span><span class="token punctuation">,</span> <span class="token comment">// TRANSACTION_bindService = 29</span>

      <span class="token number">15</span><span class="token punctuation">,</span> <span class="token comment">// broadcastCode = TRANSACTION_broadcastIntent = 14+1 = 15</span>
      <span class="token comment">// 14, // broadcastCode = BROADCAST_INTENT_TRANSACTION = 13+1 = 14, TRANSACTION_removeAccountExplicitly = 13+1 = 14</span>

      <span class="token number">37</span><span class="token punctuation">,</span> <span class="token comment">// instrumentationCode = TRANSACTION_startInstrumentation = 36+1= 37</span>
      <span class="token comment">// 44, // instrumentationCode = START_INSTRUMENTATION_TRANSACTION = 43+1= 44</span>
    <span class="token punctuation">]</span>

    <span class="token function">hookNativeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> ThrowableCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Throwable&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ThrowableCls=&quot;</span> <span class="token operator">+</span> ThrowableCls<span class="token punctuation">)</span>
    <span class="token keyword">let</span> curLog <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;android.util.Log&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;curLog=&quot;</span> <span class="token operator">+</span> curLog<span class="token punctuation">)</span>
    <span class="token keyword">let</span> Parcel <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;android.os.Parcel&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Parcel=&quot;</span> <span class="token operator">+</span> Parcel<span class="token punctuation">)</span>

    <span class="token comment">// // com.android.server.wm.ActivityStarter</span>
    <span class="token comment">// var serverCls = Java.use(&quot;com.android.server&quot;)</span>
    <span class="token comment">// console.log(&quot;serverCls=&quot; + serverCls)</span>
    <span class="token comment">// var wmCls = serverCls.wm</span>
    <span class="token comment">// console.log(&quot;wmCls=&quot; + wmCls)</span>
    <span class="token comment">// var ActivityStarterCls = wmCls.ActivityStarter</span>
    <span class="token comment">// console.log(&quot;ActivityStarterCls=&quot; + ActivityStarterCls)</span>
    <span class="token comment">// // private int executeRequest(Request request) {</span>

    <span class="token comment">// hookPrintTransactCodeValue()</span>

    <span class="token comment">// ---------------------------------------- android.os.Binder</span>
    <span class="token keyword">var</span> BinderCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;android.os.Binder&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;BinderCls=&quot;</span> <span class="token operator">+</span> BinderCls<span class="token punctuation">)</span>

    <span class="token comment">// private boolean execTransact(int code, long dataObj, long replyObj, int flags)</span>
    <span class="token keyword">var</span> execTransactFunc <span class="token operator">=</span> BinderCls<span class="token punctuation">.</span>execTransact
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;execTransactFunc=&quot;</span> <span class="token operator">+</span> execTransactFunc<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>execTransactFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      execTransactFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> dataObj<span class="token punctuation">,</span> replyObj<span class="token punctuation">,</span> flags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// var logStr = &quot;&quot;</span>

        <span class="token comment">// if (ValidTransactCodeList.includes(code)) {</span>
          <span class="token keyword">var</span> dataParcel <span class="token operator">=</span> Parcel<span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">)</span>

          <span class="token comment">// var replyPacel = Parcel.obtain(replyObj)</span>
          <span class="token comment">// var dataParcelStr = dataParcel.toString()</span>
          <span class="token comment">// var replyPacelStr = replyPacel.toString()</span>
          <span class="token comment">// console.log(&quot;dataParcelStr=&quot; + dataParcelStr + &quot;, replyPacelStr=&quot; + replyPacelStr)</span>
          <span class="token keyword">var</span> curParcelDataSize <span class="token operator">=</span> dataParcel<span class="token punctuation">.</span><span class="token function">dataSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// console.log(&quot;  curParcelDataSize=&quot; + curParcelDataSize)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>curParcelDataSize <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// let interfaceTokenStartPos = 1</span>
            <span class="token comment">// let interfaceTokenStartPos = 0</span>
            <span class="token comment">// let interfaceTokenStartPos = 4</span>
            <span class="token comment">// let interfaceTokenStartPos = 8</span>
            <span class="token comment">// dataParcel.setDataPosition(interfaceTokenStartPos)</span>
            <span class="token comment">// var interfaceTokenStr = dataParcel.readString()</span>
            <span class="token comment">// console.log(&quot;  interfaceTokenStr=&quot; + interfaceTokenStr)</span>

            <span class="token comment">// var parcelStr = tryReadParcelString(dataParcel)</span>
            <span class="token comment">// var {parcelStr, strPos} = tryReadParcelString(dataParcel)</span>
            <span class="token keyword">var</span> readResultDict <span class="token operator">=</span> <span class="token function">tryReadParcelString</span><span class="token punctuation">(</span>dataParcel<span class="token punctuation">)</span>
            <span class="token comment">// console.log(&quot;parcelStr=&quot; + parcelStr + &quot;, strPos=&quot; + strPos)</span>
            <span class="token keyword">var</span> isFoundStr <span class="token operator">=</span> readResultDict<span class="token punctuation">.</span>isFoundStr
            <span class="token keyword">var</span> strDictList <span class="token operator">=</span> readResultDict<span class="token punctuation">.</span>strDictList
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isFoundStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// var foundStrLog = &quot;&quot;</span>
              <span class="token keyword">var</span> strDictListStr <span class="token operator">=</span> <span class="token function">toJsonStr</span><span class="token punctuation">(</span>strDictList<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
              <span class="token comment">// console.log(&quot;Binder.execTransact: code=&quot; + code + &quot;, dataObj=&quot; + dataObj + &quot;, replyObj=&quot; + replyObj + &quot;, flags=&quot; + flags)</span>
              <span class="token keyword">var</span> execTransactCallStr <span class="token operator">=</span> <span class="token string">&quot;Binder.execTransact: code=&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;, dataObj=&quot;</span> <span class="token operator">+</span> dataObj <span class="token operator">+</span> <span class="token string">&quot;, replyObj=&quot;</span> <span class="token operator">+</span> replyObj <span class="token operator">+</span> <span class="token string">&quot;, flags=&quot;</span> <span class="token operator">+</span> flags
              <span class="token comment">// console.log(execTransactCallStr)</span>

              <span class="token keyword">var</span> dataParcelInfoStr <span class="token operator">=</span> <span class="token function">getParcelInfo</span><span class="token punctuation">(</span>dataParcel<span class="token punctuation">)</span>
              <span class="token comment">// var replyPacelInfoStr = getParcelInfo(replyPacel)</span>
              <span class="token comment">// console.log(&quot;dataParcelInfoStr=&quot; + dataParcelInfoStr + &quot;, replyPacelInfoStr=&quot; + replyPacelInfoStr)</span>
              <span class="token comment">// console.log(&quot;  dataParcel: strDictListStr=&quot; + strDictListStr + &quot;, infoStr=&quot; + dataParcelInfoStr)</span>
              <span class="token keyword">var</span> dataParcelCurAppStr <span class="token operator">=</span> <span class="token string">&quot;  dataParcel: strDictListStr=&quot;</span> <span class="token operator">+</span> strDictListStr <span class="token operator">+</span> <span class="token string">&quot;, infoStr=&quot;</span> <span class="token operator">+</span> dataParcelInfoStr
              <span class="token comment">// console.log(dataParcelCurAppStr)</span>

              <span class="token comment">// for debug: found string not empty, then not call origin transact -&gt; try find this function is true core trigger service or not</span>
              <span class="token comment">// if (parcelStr) {</span>
              <span class="token comment">// if (parcelStr === CurAppPkgName) {</span>
              <span class="token keyword">var</span> isCurApp <span class="token operator">=</span> <span class="token boolean">false</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> strDictList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> idx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> curStrDict <span class="token operator">=</span> strDictList<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
                <span class="token keyword">var</span> curPos <span class="token operator">=</span> curStrDict<span class="token punctuation">[</span><span class="token string">&quot;pos&quot;</span><span class="token punctuation">]</span>
                <span class="token keyword">var</span> curStr <span class="token operator">=</span> curStrDict<span class="token punctuation">[</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>curStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  isCurApp <span class="token operator">=</span> <span class="token boolean">true</span>
                  <span class="token comment">// console.log(&quot;    Found [&quot; + curPos + &quot;] current app: &quot; + curStr)</span>
                  <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>enableNotCallFilter_Binder_execTransact<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isCurApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
                  <span class="token comment">// console.log(&quot;  shouldCallOrigFunc=&quot; + shouldCallOrigFunc)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>

              <span class="token keyword">var</span> shouldLogDetail <span class="token operator">=</span> <span class="token boolean">false</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>isCurApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                shouldLogDetail <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token comment">// console.log(&quot;shouldLogDetail=&quot; + shouldLogDetail)</span>
              <span class="token punctuation">}</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldLogDetail<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// var detailedLogStr = execTransactCallStr + &quot;\n&quot; + dataParcelCurAppStr</span>
                <span class="token keyword">var</span> detailedLogStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>execTransactCallStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dataParcelCurAppStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                <span class="token comment">// var detailedLogStr = execTransactCallStr + &quot;\n&quot; + dataParcelCurAppStr</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>detailedLogStr<span class="token punctuation">)</span>
                <span class="token comment">// foundStrLog = `${execTransactCallStr}\n${dataParcelCurAppStr}`</span>

                <span class="token comment">//   // console.log(&quot;CurApp Binder.execTransact: code=&quot; + code + &quot;, dataObj=&quot; + dataObj + &quot;, replyObj=&quot; + replyObj + &quot;, flags=&quot; + flags + &quot;\n  dataParcel: strDictListStr=&quot; + strDictListStr + &quot;, infoStr=&quot; + dataParcelInfoStr)</span>
                <span class="token comment">//   console.log(&quot;CurApp Binder.execTransact: code=&quot; + code + &quot;, dataObj=&quot; + dataObj + &quot;, replyObj=&quot; + replyObj + &quot;, flags=&quot; + flags)</span>
                <span class="token comment">//   console.log(&quot;  dataParcel: strDictListStr=&quot; + strDictListStr + &quot;, infoStr=&quot; + dataParcelInfoStr)</span>

                <span class="token comment">//   // logStr = `Binder.execTransact: code=${code}, dataObj=${dataObj}, replyObj=${replyObj}, flags=${flags}\n  dataParcel: strDictListStr=${strDictListStr}, infoStr=${ dataParcelInfoStr}`</span>
                <span class="token comment">//   // console.log(&quot;DetailLogStr=&quot; + logStr)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//   console.log(&quot;Simple Binder.execTransact: code=&quot; + code + &quot;, dataObj=&quot; + dataObj + &quot;, flags=&quot; + flags)</span>
                <span class="token comment">//   // logStr = `Simple: Binder.execTransact: code=${code}, dataObj=${dataObj}, flags=${flags}`</span>
                <span class="token comment">//   // console.log(&quot;SimpleLogStr=&quot; + logStr)</span>

                <span class="token comment">// foundStrLog = `Binder.execTransact: code=${code}, dataObj=${dataObj}, flags=${flags}`</span>
                <span class="token keyword">var</span> simpleLog <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Binder.execTransact: code=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, dataObj=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dataObj<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, flags=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>flags<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                <span class="token comment">// var simpleLog = &quot;Binder.execTransact: code=&quot; + code + &quot;, dataObj=&quot; + dataObj + &quot;, flags=&quot; + flags</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>simpleLog<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>

              <span class="token comment">// console.log(foundStrLog)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// PrintStack(ThrowableCls)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Binder execTransact: code=&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;, 0 size data Parcel, flags=&quot;</span> <span class="token operator">+</span> flags<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token comment">// }</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(logStr)</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">execTransact</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> dataObj<span class="token punctuation">,</span> replyObj<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(logStr)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;    Not call Binder.execTransact&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> IBinderClassName <span class="token operator">=</span> <span class="token string">&quot;android.os.IBinder&quot;</span>
    <span class="token keyword">var</span> IBinderCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>IBinderClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;IBinderCls=&quot;</span> <span class="token operator">+</span> IBinderCls<span class="token punctuation">)</span>
    <span class="token comment">// printClassAllMethodsFields(IBinderClassName)</span>
    <span class="token keyword">var</span> firstCallTransacton <span class="token operator">=</span> IBinderCls<span class="token punctuation">.</span><span class="token constant">FIRST_CALL_TRANSACTION</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstCallTransacton=&quot;</span> <span class="token operator">+</span> firstCallTransacton<span class="token punctuation">)</span>
    <span class="token keyword">var</span> firstCallTransactonValue <span class="token operator">=</span> firstCallTransacton<span class="token punctuation">.</span>value
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstCallTransactonValue=&quot;</span> <span class="token operator">+</span> firstCallTransactonValue<span class="token punctuation">)</span>

    <span class="token comment">// public abstract boolean transact (int code, Parcel data, Parcel reply, int flags)</span>
    <span class="token comment">// var transactFunc = IBinderCls.transact</span>

    <span class="token keyword">var</span> transactFunc <span class="token operator">=</span> BinderCls<span class="token punctuation">.</span>transact
    <span class="token keyword">if</span> <span class="token punctuation">(</span>transactFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      transactFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> data<span class="token punctuation">,</span> reply<span class="token punctuation">,</span> flags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> transactOk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transact</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> data<span class="token punctuation">,</span> reply<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ValidTransactCodeList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Binder transact: code=&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;,data=&quot;</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">&quot;,reply=&quot;</span> <span class="token operator">+</span> reply <span class="token operator">+</span> <span class="token string">&quot;,flags=&quot;</span> <span class="token operator">+</span> flags <span class="token operator">+</span> <span class="token string">&quot; -&gt; transactOk=&quot;</span> <span class="token operator">+</span> transactOk<span class="token punctuation">)</span>
          <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> transactOk
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// protected boolean onTransact (int code,  Parcel data,  Parcel reply,  int flags)</span>
    <span class="token keyword">var</span> onTransactFunc <span class="token operator">=</span> BinderCls<span class="token punctuation">.</span>onTransact
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onTransactFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      onTransactFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> data<span class="token punctuation">,</span> reply<span class="token punctuation">,</span> flags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> transactOk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onTransact</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> data<span class="token punctuation">,</span> reply<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ValidTransactCodeList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Binder onTransact: code=&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;,data=&quot;</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">&quot;,reply=&quot;</span> <span class="token operator">+</span> reply <span class="token operator">+</span> <span class="token string">&quot;,flags=&quot;</span> <span class="token operator">+</span> flags <span class="token operator">+</span> <span class="token string">&quot; -&gt; transactOk=&quot;</span> <span class="token operator">+</span> transactOk<span class="token punctuation">)</span>
          <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> transactOk
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ---------------------------------------- android.app.ContextImpl</span>
    <span class="token keyword">var</span> ContextImplClassName <span class="token operator">=</span> <span class="token string">&quot;android.app.ContextImpl&quot;</span>
    <span class="token keyword">var</span> ContextImplCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ContextImplClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ContextImplCls=&quot;</span> <span class="token operator">+</span> ContextImplCls<span class="token punctuation">)</span>
    <span class="token comment">// printClassAllMethodsFields(ContextImplClassName)</span>

    <span class="token comment">// public boolean bindServiceAsUser(Intent service, ServiceConnection conn, int flags, UserHandle user)</span>
    <span class="token keyword">var</span> bindServiceAsUserFunc4 <span class="token operator">=</span> ContextImplCls<span class="token punctuation">.</span>bindServiceAsUser<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.ServiceConnection&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.os.UserHandle&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bindServiceAsUserFunc4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bindServiceAsUserFunc4<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">service<span class="token punctuation">,</span> conn<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(&quot;ContextImpl.bindServiceAsUser 4: service=&quot; + service + &quot;, conn=&quot; + conn + &quot;, flags=&quot; + flags + &quot;, user=&quot; + user)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ContextImpl.bindServiceAsUser 4&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;conn&quot;</span><span class="token operator">:</span> conn<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;flags&quot;</span><span class="token operator">:</span> flags<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;user&quot;</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindServiceAsUser</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> conn<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// public boolean bindServiceAsUser(Intent service, ServiceConnection conn, int flags, Handler handler, UserHandle user)</span>
    <span class="token keyword">var</span> bindServiceAsUserFunc5 <span class="token operator">=</span> ContextImplCls<span class="token punctuation">.</span>bindServiceAsUser<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.ServiceConnection&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.os.Handler&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.os.UserHandle&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bindServiceAsUserFunc5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bindServiceAsUserFunc5<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">service<span class="token punctuation">,</span> conn<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(&quot;ContextImpl.bindServiceAsUser 5: service=&quot; + service + &quot;, conn=&quot; + conn + &quot;, flags=&quot; + flags + &quot;, handler=&quot; + handler + &quot;, user=&quot; + user)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ContextImpl.bindServiceAsUser 5&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;conn&quot;</span><span class="token operator">:</span> conn<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;flags&quot;</span><span class="token operator">:</span> flags<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;handler&quot;</span><span class="token operator">:</span> handler<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;user&quot;</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindServiceAsUser</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> conn<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ---------------------------------------- com.android.server.am.ProcessRecord</span>
    <span class="token keyword">var</span> ProcessRecordClassName <span class="token operator">=</span> <span class="token string">&quot;com.android.server.am.ProcessRecord&quot;</span>
    <span class="token keyword">var</span> ProcessRecordCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ProcessRecordClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ProcessRecordCls=&quot;</span> <span class="token operator">+</span> ProcessRecordCls<span class="token punctuation">)</span>
    <span class="token comment">// printClassAllMethodsFields(ProcessRecordClassName)</span>

    <span class="token comment">// ---------------------------------------- com.android.server.am.ActiveServices</span>
    <span class="token keyword">var</span> ActiveServicesClassName <span class="token operator">=</span> <span class="token string">&quot;com.android.server.am.ActiveServices&quot;</span>
    <span class="token keyword">var</span> ActiveServicesCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ActiveServicesClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ActiveServicesCls=&quot;</span> <span class="token operator">+</span> ActiveServicesCls<span class="token punctuation">)</span>

    <span class="token comment">// private String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg, boolean whileRestarting, boolean permissionsReviewRequired, boolean packageFrozen, boolean enqueueOomAdj)</span>
    <span class="token keyword">var</span> bringUpServiceLockedFunc <span class="token operator">=</span> ActiveServicesCls<span class="token punctuation">.</span>bringUpServiceLocked
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bringUpServiceLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bringUpServiceLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> intentFlags<span class="token punctuation">,</span> execInFg<span class="token punctuation">,</span> whileRestarting<span class="token punctuation">,</span> permissionsReviewRequired<span class="token punctuation">,</span> packageFrozen<span class="token punctuation">,</span> enqueueOomAdj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;ActiveServices.bringUpServiceLocked: r=&quot; + r + &quot;, intentFlags=&quot; + intentFlags + &quot;, execInFg=&quot; + execInFg + &quot;, whileRestarting=&quot; + whileRestarting + &quot;, permissionsReviewRequired=&quot; + permissionsReviewRequired + &quot;, packageFrozen=&quot; + packageFrozen + &quot;, enqueueOomAdj=&quot; + enqueueOomAdj)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>

        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ActiveServices.bringUpServiceLocked&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;r&quot;</span><span class="token operator">:</span> r<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;intentFlags&quot;</span><span class="token operator">:</span> intentFlags<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;execInFg&quot;</span><span class="token operator">:</span> execInFg<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;whileRestarting&quot;</span><span class="token operator">:</span> whileRestarting<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;permissionsReviewRequired&quot;</span><span class="token operator">:</span> permissionsReviewRequired<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;packageFrozen&quot;</span><span class="token operator">:</span> packageFrozen<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;enqueueOomAdj&quot;</span><span class="token operator">:</span> enqueueOomAdj<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ActiveServices_bringUpServiceLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> rStr <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>rStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bringUpServiceLocked</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> intentFlags<span class="token punctuation">,</span> execInFg<span class="token punctuation">,</span> whileRestarting<span class="token punctuation">,</span> permissionsReviewRequired<span class="token punctuation">,</span> packageFrozen<span class="token punctuation">,</span> enqueueOomAdj<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ActiveServices.bringUpServiceLocked&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ComponentName startServiceLocked(IApplicationThread caller, Intent service, String resolvedType, int callingPid, int callingUid, boolean fgRequired, String callingPackage, @Nullable String callingFeatureId, final int userId)</span>
    <span class="token keyword">var</span> startServiceLockedFunc9 <span class="token operator">=</span> ActiveServicesCls<span class="token punctuation">.</span>startServiceLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;android.app.IApplicationThread&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startServiceLockedFunc9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startServiceLockedFunc9<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ActiveServices.startServiceLocked 9&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;caller&quot;</span><span class="token operator">:</span> caller<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;resolvedType&quot;</span><span class="token operator">:</span> resolvedType<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPid&quot;</span><span class="token operator">:</span> callingPid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;fgRequired&quot;</span><span class="token operator">:</span> fgRequired<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPackage&quot;</span><span class="token operator">:</span> callingPackage<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingFeatureId&quot;</span><span class="token operator">:</span> callingFeatureId<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> userId<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ActiveServices_startServiceLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>callingPackage<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startServiceLocked</span><span class="token punctuation">(</span>caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ActiveServices.startServiceLocked 9&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ComponentName startServiceLocked(IApplicationThread caller, Intent service, String resolvedType, int callingPid, int callingUid, boolean fgRequired, String callingPackage, @Nullable String callingFeatureId, final int userId, boolean allowBackgroundActivityStarts, @Nullable IBinder backgroundActivityStartsToken)</span>
    <span class="token keyword">var</span> startServiceLockedFunc11 <span class="token operator">=</span> ActiveServicesCls<span class="token punctuation">.</span>startServiceLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;android.app.IApplicationThread&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.os.IBinder&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startServiceLockedFunc11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startServiceLockedFunc11<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> allowBackgroundActivityStarts<span class="token punctuation">,</span> backgroundActivityStartsToken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ActiveServices.startServiceLocked 11&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;caller&quot;</span><span class="token operator">:</span> caller<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;resolvedType&quot;</span><span class="token operator">:</span> resolvedType<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPid&quot;</span><span class="token operator">:</span> callingPid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;fgRequired&quot;</span><span class="token operator">:</span> fgRequired<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPackage&quot;</span><span class="token operator">:</span> callingPackage<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingFeatureId&quot;</span><span class="token operator">:</span> callingFeatureId<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> userId<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;allowBackgroundActivityStarts&quot;</span><span class="token operator">:</span> allowBackgroundActivityStarts<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;backgroundActivityStartsToken&quot;</span><span class="token operator">:</span> backgroundActivityStartsToken<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ActiveServices_startServiceLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>callingPackage<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startServiceLocked</span><span class="token punctuation">(</span>caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> allowBackgroundActivityStarts<span class="token punctuation">,</span> backgroundActivityStartsToken<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ActiveServices.startServiceLocked 11&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ComponentName startServiceInnerLocked(ServiceMap smap, Intent service, ServiceRecord r, boolean callerFg, boolean addToStarting, int callingUid, boolean wasStartRequested)</span>
    <span class="token keyword">var</span> startServiceInnerLockedFunc7 <span class="token operator">=</span> ActiveServicesCls<span class="token punctuation">.</span>startServiceInnerLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;com.android.server.am.ActiveServices$ServiceMap&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;com.android.server.am.ServiceRecord&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startServiceInnerLockedFunc7<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startServiceInnerLockedFunc7<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">smap<span class="token punctuation">,</span> service<span class="token punctuation">,</span> r<span class="token punctuation">,</span> callerFg<span class="token punctuation">,</span> addToStarting<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> wasStartRequested</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ActiveServices.startServiceInnerLocked 7&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;smap&quot;</span><span class="token operator">:</span> smap<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;r&quot;</span><span class="token operator">:</span> r<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callerFg&quot;</span><span class="token operator">:</span> callerFg<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;addToStarting&quot;</span><span class="token operator">:</span> addToStarting<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;wasStartRequested&quot;</span><span class="token operator">:</span> wasStartRequested<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ActiveServices_startServiceInnerLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> rStr <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>rStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startServiceInnerLocked</span><span class="token punctuation">(</span>smap<span class="token punctuation">,</span> service<span class="token punctuation">,</span> r<span class="token punctuation">,</span> callerFg<span class="token punctuation">,</span> addToStarting<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> wasStartRequested<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ActiveServices.startServiceInnerLocked 7&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// private ComponentName startServiceInnerLocked(ServiceRecord r, Intent service, int callingUid, int callingPid, boolean fgRequired, boolean callerFg, boolean allowBackgroundActivityStarts, @Nullable IBinder backgroundActivityStartsToken)</span>
    <span class="token keyword">var</span> startServiceInnerLockedFunc8 <span class="token operator">=</span> ActiveServicesCls<span class="token punctuation">.</span>startServiceInnerLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;com.android.server.am.ServiceRecord&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.content.Intent&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;android.os.IBinder&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startServiceInnerLockedFunc8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startServiceInnerLockedFunc8<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> service<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callerFg<span class="token punctuation">,</span> allowBackgroundActivityStarts<span class="token punctuation">,</span> backgroundActivityStartsToken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ActiveServices.startServiceInnerLocked 8&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;r&quot;</span><span class="token operator">:</span> r<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPid&quot;</span><span class="token operator">:</span> callingPid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;fgRequired&quot;</span><span class="token operator">:</span> fgRequired<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callerFg&quot;</span><span class="token operator">:</span> callerFg<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;allowBackgroundActivityStarts&quot;</span><span class="token operator">:</span> allowBackgroundActivityStarts<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;backgroundActivityStartsToken&quot;</span><span class="token operator">:</span> backgroundActivityStartsToken<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ActiveServices_startServiceInnerLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> rStr <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>rStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startServiceInnerLocked</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> service<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> callingPid<span class="token punctuation">,</span> fgRequired<span class="token punctuation">,</span> callerFg<span class="token punctuation">,</span> allowBackgroundActivityStarts<span class="token punctuation">,</span> backgroundActivityStartsToken<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ActiveServices.startServiceInnerLocked 8&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ---------------------------------------- com.android.server.am.ProcessList</span>
    <span class="token keyword">var</span> ProcessListCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.server.am.ProcessList&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ProcessListCls=&quot;</span> <span class="token operator">+</span> ProcessListCls<span class="token punctuation">)</span>

    <span class="token comment">//     boolean startProcessLocked(HostingRecord hostingRecord, String entryPoint, ProcessRecord app, int uid, int[] gids, int runtimeFlags, int zygotePolicyFlags, int mountExternal, String seInfo, String requiredAbi, String instructionSet, String invokeWith, long startUptime, long startElapsedTime)</span>
    <span class="token keyword">var</span> startProcessLockedFunc <span class="token operator">=</span> ProcessListCls<span class="token punctuation">.</span>startProcessLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;com.android.server.am.HostingRecord&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;com.android.server.am.ProcessRecord&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;[I&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;long&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;long&apos;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;startProcessLockedFunc=&quot;</span> <span class="token operator">+</span> startProcessLockedFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startProcessLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startProcessLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">hostingRecord<span class="token punctuation">,</span> entryPoint<span class="token punctuation">,</span> app<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> gids<span class="token punctuation">,</span> runtimeFlags<span class="token punctuation">,</span> zygotePolicyFlags<span class="token punctuation">,</span> mountExternal<span class="token punctuation">,</span> seInfo<span class="token punctuation">,</span> requiredAbi<span class="token punctuation">,</span> instructionSet<span class="token punctuation">,</span> invokeWith<span class="token punctuation">,</span> startUptime<span class="token punctuation">,</span> startElapsedTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ProcessList.startProcessLocked: hostingRecord=&quot;</span> <span class="token operator">+</span> hostingRecord <span class="token operator">+</span> <span class="token string">&quot;, entryPoint=&quot;</span> <span class="token operator">+</span> entryPoint <span class="token operator">+</span> <span class="token string">&quot;, app=&quot;</span> <span class="token operator">+</span> app <span class="token operator">+</span> <span class="token string">&quot;, uid=&quot;</span> <span class="token operator">+</span> uid <span class="token operator">+</span> <span class="token string">&quot;, gids=&quot;</span> <span class="token operator">+</span> gids <span class="token operator">+</span> <span class="token string">&quot;, runtimeFlags=&quot;</span> <span class="token operator">+</span> runtimeFlags <span class="token operator">+</span> <span class="token string">&quot;, zygotePolicyFlags=&quot;</span> <span class="token operator">+</span> zygotePolicyFlags <span class="token operator">+</span> <span class="token string">&quot;, mountExternal=&quot;</span> <span class="token operator">+</span> mountExternal <span class="token operator">+</span> <span class="token string">&quot;, seInfo=&quot;</span> <span class="token operator">+</span> seInfo <span class="token operator">+</span> <span class="token string">&quot;, requiredAbi=&quot;</span> <span class="token operator">+</span> requiredAbi <span class="token operator">+</span> <span class="token string">&quot;, instructionSet=&quot;</span> <span class="token operator">+</span> instructionSet <span class="token operator">+</span> <span class="token string">&quot;, invokeWith=&quot;</span> <span class="token operator">+</span> invokeWith <span class="token operator">+</span> <span class="token string">&quot;, startUptime=&quot;</span> <span class="token operator">+</span> startUptime <span class="token operator">+</span> <span class="token string">&quot;, startElapsedTime=&quot;</span> <span class="token operator">+</span> startElapsedTime<span class="token punctuation">)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ProcessList_startProcessLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> appStr <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>appStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startProcessLocked</span><span class="token punctuation">(</span>hostingRecord<span class="token punctuation">,</span> entryPoint<span class="token punctuation">,</span> app<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> gids<span class="token punctuation">,</span> runtimeFlags<span class="token punctuation">,</span> zygotePolicyFlags<span class="token punctuation">,</span> mountExternal<span class="token punctuation">,</span> seInfo<span class="token punctuation">,</span> requiredAbi<span class="token punctuation">,</span> instructionSet<span class="token punctuation">,</span> invokeWith<span class="token punctuation">,</span> startUptime<span class="token punctuation">,</span> startElapsedTime<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ProcessList.startProcessLocked&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// boolean handleProcessStartedLocked(ProcessRecord app, int pid, boolean usingWrapper, long expectedStartSeq, boolean procAttached) {</span>
    <span class="token keyword">var</span> handleProcessStartedLockedFunc <span class="token operator">=</span> ProcessListCls<span class="token punctuation">.</span>handleProcessStartedLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;com.android.server.am.ProcessRecord&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;long&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;handleProcessStartedLockedFunc=&quot;</span> <span class="token operator">+</span> handleProcessStartedLockedFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handleProcessStartedLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      handleProcessStartedLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> usingWrapper<span class="token punctuation">,</span> expectedStartSeq<span class="token punctuation">,</span> procAttached</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ProcessList.handleProcessStartedLocked: app=&quot;</span> <span class="token operator">+</span> app <span class="token operator">+</span> <span class="token string">&quot;, pid=&quot;</span> <span class="token operator">+</span> pid <span class="token operator">+</span> <span class="token string">&quot;, usingWrapper=&quot;</span> <span class="token operator">+</span> usingWrapper <span class="token operator">+</span> <span class="token string">&quot;, expectedStartSeq=&quot;</span> <span class="token operator">+</span> expectedStartSeq <span class="token operator">+</span> <span class="token string">&quot;, procAttached=&quot;</span> <span class="token operator">+</span> procAttached<span class="token punctuation">)</span>
        <span class="token comment">// printProcessRecord(app)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ProcessList_handleProcessStartedLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> appStr <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>appStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleProcessStartedLocked</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> usingWrapper<span class="token punctuation">,</span> expectedStartSeq<span class="token punctuation">,</span> procAttached<span class="token punctuation">)</span>  
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ProcessList.handleProcessStartedLocked&quot;</span><span class="token punctuation">)</span>
          <span class="token comment">// return false</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ---------------------------------------- com.android.server.am.ContentProviderHelper</span>
    <span class="token keyword">var</span> ContentProviderHelperClassName <span class="token operator">=</span> <span class="token string">&quot;com.android.server.am.ContentProviderHelper&quot;</span>
    <span class="token keyword">var</span> ContentProviderHelperCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ContentProviderHelperClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ContentProviderHelperCls=&quot;</span> <span class="token operator">+</span> ContentProviderHelperCls<span class="token punctuation">)</span>

    <span class="token comment">// private ContentProviderHolder getContentProviderImpl(IApplicationThread caller, String name, IBinder token, int callingUid, String callingPackage, String callingTag, boolean stable, int userId)</span>
    <span class="token keyword">var</span> getContentProviderImplFunc <span class="token operator">=</span> ContentProviderHelperCls<span class="token punctuation">.</span>getContentProviderImpl
    <span class="token keyword">if</span> <span class="token punctuation">(</span>getContentProviderImplFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      getContentProviderImplFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> name<span class="token punctuation">,</span> token<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingTag<span class="token punctuation">,</span> stable<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;ContentProviderHelper.getContentProviderImpl: caller=&quot; + caller + &quot;, name=&quot; + name + &quot;, token=&quot; + token + &quot;, callingUid=&quot; + callingUid + &quot;, callingPackage=&quot; + callingPackage + &quot;, callingTag=&quot; + callingTag + &quot;, stable=&quot; + stable + &quot;, userId=&quot; + userId)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>

        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;ContentProviderHelper.getContentProviderImpl&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;caller&quot;</span><span class="token operator">:</span> caller<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;token&quot;</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingPackage&quot;</span><span class="token operator">:</span> callingPackage<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingTag&quot;</span><span class="token operator">:</span> callingTag<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;stable&quot;</span><span class="token operator">:</span> stable<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> userId<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_ContentProviderHelper_getContentProviderImpl<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// if(callingPackage.includes(CurAppPkgName)){</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContentProviderImpl</span><span class="token punctuation">(</span>caller<span class="token punctuation">,</span> name<span class="token punctuation">,</span> token<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingTag<span class="token punctuation">,</span> stable<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call ContentProviderHelper.getContentProviderImpl&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ---------------------------------------- android.os.Handler</span>
    <span class="token keyword">var</span> HandlerClassName <span class="token operator">=</span> <span class="token string">&quot;android.os.Handler&quot;</span>
    <span class="token keyword">var</span> HandlerCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>HandlerClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;HandlerCls=&quot;</span> <span class="token operator">+</span> HandlerCls<span class="token punctuation">)</span>

    <span class="token comment">// public void dispatchMessage(@NonNull Message msg)</span>
    <span class="token keyword">var</span> dispatchMessageFunc <span class="token operator">=</span> HandlerCls<span class="token punctuation">.</span>dispatchMessage
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dispatchMessageFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dispatchMessageFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token keyword">var</span> mgsStr <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mgsStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// console.log(&quot;Handler.dispatchMessage: msg=&quot; + msg)</span>
          <span class="token comment">// PrintStack(ThrowableCls)</span>
          <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;Handler.dispatchMessage&quot;</span>
          <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> msg<span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
          <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

          <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_Handler_dispatchMessage<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// is not : Handler.dispatchMessage: msg={ when=-927ms what=4104 obj=ApplicationExitInfo(timestamp=2023/9/19 16:55 pid=3953 realUid=10249 packageUid=10249 definingUid=10249 user=0 process=com.wallpaper.hd.funny reason=12 (DEPENDENCY DIED) subreason=0 (UNKNOWN) status=0 importance=400 pss=33MB rss=132MB description=depends on provider com.google.android.gms/.phenotype.provider.ConfigurationProvider in dying proc com.google.android.gms.persistent (adj -10000) state=empty trace=null target=com.android.server.am.AppExitInfoTracker$KillHandler }</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>mgsStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationExitInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatchMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call Handler.dispatchMessage&quot;</span><span class="token punctuation">)</span>
          <span class="token comment">// return null</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ---------------------------------------- com.android.server.am.BroadcastQueue</span>
    <span class="token keyword">var</span> BroadcastQueueClassName <span class="token operator">=</span> <span class="token string">&quot;com.android.server.am.BroadcastQueue&quot;</span>
    <span class="token keyword">var</span> BroadcastQueueCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>BroadcastQueueClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;BroadcastQueueCls=&quot;</span> <span class="token operator">+</span> BroadcastQueueCls<span class="token punctuation">)</span>

    <span class="token comment">// final void processNextBroadcastLocked(boolean fromMsg, boolean skipOomAdj)</span>
    <span class="token keyword">var</span> processNextBroadcastLockedFunc <span class="token operator">=</span> BroadcastQueueCls<span class="token punctuation">.</span>processNextBroadcastLocked
    <span class="token keyword">if</span> <span class="token punctuation">(</span>processNextBroadcastLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      processNextBroadcastLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fromMsg<span class="token punctuation">,</span> skipOomAdj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;BroadcastQueue.processNextBroadcastLocked: fromMsg=&quot; + fromMsg + &quot;, skipOomAdj=&quot; + skipOomAdj)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;BroadcastQueue.processNextBroadcastLocked&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;fromMsg&quot;</span><span class="token operator">:</span> fromMsg<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;skipOomAdj&quot;</span><span class="token operator">:</span> skipOomAdj<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processNextBroadcastLocked</span><span class="token punctuation">(</span>fromMsg<span class="token punctuation">,</span> skipOomAdj<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call BroadcastQueue.processNextBroadcastLocked&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ---------------------------------------- com.android.server.am.ActivityManagerService</span>
    <span class="token keyword">var</span> curJavaClassName <span class="token operator">=</span> <span class="token string">&quot;com.android.server.am.ActivityManagerService&quot;</span>
    <span class="token comment">// printClassAllMethodsFields(curJavaClassName)</span>
    <span class="token keyword">var</span> ActivityManagerServiceCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>curJavaClassName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ActivityManagerServiceCls=&quot;</span> <span class="token operator">+</span> ActivityManagerServiceCls<span class="token punctuation">)</span>

    <span class="token comment">// final ProcessRecord startProcessLocked(String processName, ApplicationInfo info, boolean knownToBeDead, int intentFlags, HostingRecord hostingRecord, int zygotePolicyFlags, boolean allowWhileBooting, boolean isolated)</span>
    <span class="token keyword">var</span> amsStartProcessLockedFunc <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>startProcessLocked
    <span class="token keyword">if</span> <span class="token punctuation">(</span>amsStartProcessLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      amsStartProcessLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">processName<span class="token punctuation">,</span> info<span class="token punctuation">,</span> knownToBeDead<span class="token punctuation">,</span> intentFlags<span class="token punctuation">,</span> hostingRecord<span class="token punctuation">,</span> zygotePolicyFlags<span class="token punctuation">,</span> allowWhileBooting<span class="token punctuation">,</span> isolated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;AMS.startProcessLocked: processName=&quot; + processName + &quot;, info=&quot; + info + &quot;, knownToBeDead=&quot; + knownToBeDead + &quot;, intentFlags=&quot; + intentFlags + &quot;, hostingRecord=&quot; + hostingRecord + &quot;, zygotePolicyFlags=&quot; + zygotePolicyFlags + &quot;, allowWhileBooting=&quot; + allowWhileBooting + &quot;, isolated=&quot; + isolated)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;AMS.startProcessLocked&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;processName&quot;</span><span class="token operator">:</span> processName<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> info<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;knownToBeDead&quot;</span><span class="token operator">:</span> knownToBeDead<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;intentFlags&quot;</span><span class="token operator">:</span> intentFlags<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;hostingRecord&quot;</span><span class="token operator">:</span> hostingRecord<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;zygotePolicyFlags&quot;</span><span class="token operator">:</span> zygotePolicyFlags<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;allowWhileBooting&quot;</span><span class="token operator">:</span> allowWhileBooting<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;isolated&quot;</span><span class="token operator">:</span> isolated<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_AMS_startProcessLocked<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>processName<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startProcessLocked</span><span class="token punctuation">(</span>processName<span class="token punctuation">,</span> info<span class="token punctuation">,</span> knownToBeDead<span class="token punctuation">,</span> intentFlags<span class="token punctuation">,</span> hostingRecord<span class="token punctuation">,</span> zygotePolicyFlags<span class="token punctuation">,</span> allowWhileBooting<span class="token punctuation">,</span> isolated<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call AMS.startProcessLocked&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// private boolean attachApplicationLocked(@NonNull IApplicationThread thread, int pid, int callingUid, long startSeq)</span>
    <span class="token keyword">var</span> attachApplicationLockedFunc <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>attachApplicationLocked
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;attachApplicationLockedFunc=&quot;</span> <span class="token operator">+</span> attachApplicationLockedFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attachApplicationLockedFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      attachApplicationLockedFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thread<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> startSeq</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(&quot;AMS.attachApplicationLocked: thread=&quot; + thread + &quot;, pid=&quot; + pid + &quot;, callingUid=&quot; + callingUid + &quot;, startSeq=&quot; + startSeq)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>
        <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;AMS.attachApplicationLocked&quot;</span>
        <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;thread&quot;</span><span class="token operator">:</span> thread<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;pid&quot;</span><span class="token operator">:</span> pid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;callingUid&quot;</span><span class="token operator">:</span> callingUid<span class="token punctuation">,</span>
          <span class="token string-property property">&quot;startSeq&quot;</span><span class="token operator">:</span> startSeq<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachApplicationLocked</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> callingUid<span class="token punctuation">,</span> startSeq<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// public ComponentName startService(IApplicationThread caller, Intent service, String resolvedType, boolean requireForeground, String callingPackage, String callingFeatureId, int userId) throws TransactionTooLargeException {</span>
    <span class="token keyword">var</span> startServiceFunc <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>startService
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;startServiceFunc=&quot;</span> <span class="token operator">+</span> startServiceFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startServiceFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      startServiceFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> requireForeground<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// console.log(&quot;AMS.startService: caller=&quot; + caller + &quot;, service=&quot; + service + &quot;, resolvedType=&quot; + resolvedType + &quot;, requireForeground=&quot; + requireForeground + &quot;, callingPackage=&quot; + callingPackage + &quot;, callingFeatureId=&quot; + callingFeatureId + &quot;, userId=&quot; + userId)</span>
        <span class="token comment">// PrintStack(ThrowableCls)</span>

        <span class="token keyword">var</span> isCurApp <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// printIntentInfo(service)</span>
          <span class="token keyword">var</span> serviceStr <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;serviceStr=&quot;</span> <span class="token operator">+</span> serviceStr<span class="token punctuation">)</span>
          <span class="token comment">// serviceStr=Intent { cmp=com.wallpaper.hd.funny/com.w.thsz.s.Service108 }</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceStr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>CurAppPkgName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            isCurApp <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>isCurApp<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> funcName <span class="token operator">=</span> <span class="token string">&quot;AMS.startService&quot;</span>
          <span class="token keyword">var</span> funcParaDict <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;caller&quot;</span><span class="token operator">:</span> caller<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;service&quot;</span><span class="token operator">:</span> service<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;resolvedType&quot;</span><span class="token operator">:</span> resolvedType<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;requireForeground&quot;</span><span class="token operator">:</span> requireForeground<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;callingPackage&quot;</span><span class="token operator">:</span> callingPackage<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;callingFeatureId&quot;</span><span class="token operator">:</span> callingFeatureId<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> userId<span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// console.log(&quot;will call printFunctionCallAndStack: funcName=&quot; + funcName + &quot;, funcParaDict=&quot; + toJsonStr(funcParaDict) + &quot;, ThrowableCls=&quot; + ThrowableCls)</span>
          <span class="token function">printFunctionCallAndStack</span><span class="token punctuation">(</span>funcName<span class="token punctuation">,</span> funcParaDict<span class="token punctuation">,</span> ThrowableCls<span class="token punctuation">)</span>

          <span class="token keyword">var</span> serviceHasFileDescriptors <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">hasFileDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;serviceHasFileDescriptors=&quot;</span> <span class="token operator">+</span> serviceHasFileDescriptors<span class="token punctuation">)</span>

          <span class="token keyword">if</span><span class="token punctuation">(</span>enableNotCallFilter_AMS_startService<span class="token punctuation">)</span><span class="token punctuation">{</span>
            shouldCallOrigFunc <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallOrigFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// return this.startService(caller, service, resolvedType, requireForeground, callingPackage, callingFeatureId, userId)</span>
          <span class="token keyword">var</span> retComponentName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span>caller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> resolvedType<span class="token punctuation">,</span> requireForeground<span class="token punctuation">,</span> callingPackage<span class="token punctuation">,</span> callingFeatureId<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>

          <span class="token keyword">if</span><span class="token punctuation">(</span>isCurApp<span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;retComponentName=&quot;</span> <span class="token operator">+</span> retComponentName<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">return</span> retComponentName
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;  Not call AMS.startService&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// // !!! Note: hook ActivityManagerService.onTransact always cause Android CRUSH and REBOOT</span>
    <span class="token comment">// // public boolean onTransact(int code, Parcel data, Parcel reply, int flags)</span>
    <span class="token comment">// var amsOnTransactFunc = ActivityManagerServiceCls.onTransact</span>
    <span class="token comment">// console.log(&quot;amsOnTransactFunc=&quot; + amsOnTransactFunc)</span>
    <span class="token comment">// if (amsOnTransactFunc) {</span>
    <span class="token comment">//   amsOnTransactFunc.implementation = function (code, dataParcel, replyParcel, flags) {</span>
    <span class="token comment">//     // if (ValidTransactCodeList.includes(code)) {</span>
    <span class="token comment">//     //   var datParcelStr = tryReadParcelString(dataParcel)</span>
    <span class="token comment">//     //   if (datParcelStr) {</span>
    <span class="token comment">//     //     console.log(&quot;AMS onTransact: code=&quot; + code + &quot;, dataParcel=&quot; + dataParcel + &quot;,datParcelStr=&quot; + datParcelStr + &quot;, replyParcel=&quot; + replyParcel + &quot;, flags=&quot; + flags)</span>
    <span class="token comment">//     //     PrintStack(ThrowableCls)  </span>
    <span class="token comment">//     //   }</span>
    <span class="token comment">//     // }</span>

    <span class="token comment">//     // console.log(&quot;AMS.onTransact: code=&quot; + code + &quot;, dataParcel=&quot; + dataParcel + &quot;, replyParcel=&quot; + replyParcel + &quot;, flags=&quot; + flags)</span>
    <span class="token comment">//     return this.onTransact(code, dataParcel, replyParcel, flags)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>

    <span class="token comment">// // Note: will cause crash &amp; reboot, so temp not hook</span>
    <span class="token comment">// // public boolean startInstrumentation(ComponentName className, String profileFile, int flags, Bundle arguments, IInstrumentationWatcher watcher, IUiAutomationConnection uiAutomationConnection, int userId, String abiOverride)</span>
    <span class="token comment">// var startInstrumentationFunc = ActivityManagerServiceCls.startInstrumentation</span>
    <span class="token comment">// console.log(&quot;startInstrumentationFunc=&quot; + startInstrumentationFunc)</span>
    <span class="token comment">// if (startInstrumentationFunc) {</span>
    <span class="token comment">//   // startInstrumentationFunc.implementation = function (className, profileFile, flags, arguments, watcher, uiAutomationConnection, userId, abiOverride) {</span>
    <span class="token comment">//   startInstrumentationFunc.implementation = function (className, profileFile, flags, arguments1, watcher, uiAutomationConnection, userId, abiOverride) {</span>
    <span class="token comment">//     console.log(&quot;typeof flags=&quot; + (typeof flags) + &quot;,typeof userId=&quot; + (typeof userId))</span>
    <span class="token comment">//     // var Integer = Java.use(&quot;java.lang.Integer&quot;)</span>
    <span class="token comment">//     // var flagsInt = Integer.valueOf(flags)</span>
    <span class="token comment">//     // var userIdInt = Integer.valueOf(userId)</span>
    <span class="token comment">//     // console.log(&quot;typeof flagsInt=&quot; + (typeof flagsInt) + &quot;,typeof userIdInt=&quot; + (typeof userIdInt))</span>

    <span class="token comment">//     console.log(&quot;className=&quot; + className + &quot;, profileFile=&quot; + profileFile + &quot;, flags=&quot; + flags + &quot;, arguments1=&quot; + arguments1 + &quot;, watcher=&quot; + watcher + &quot;, uiAutomationConnection=&quot; + uiAutomationConnection + &quot;, userId=&quot; + userId + &quot;, abiOverride=&quot; + abiOverride)</span>
    <span class="token comment">//     PrintStack(ThrowableCls)</span>
    <span class="token comment">//     // return this.startInstrumentation(className, profileFile, flags, arguments, watcher, uiAutomationConnection, userId, abiOverride)</span>
    <span class="token comment">//     return this.startInstrumentation(className, profileFile, flags, arguments1, watcher, uiAutomationConnection, userId, abiOverride)</span>
    <span class="token comment">//     // return this.startInstrumentation(className, profileFile, flagsInt, arguments1, watcher, uiAutomationConnection, userIdInt, abiOverride)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>

    <span class="token comment">// // public final void com.android.server.am.ActivityManagerService.finishForceStopPackageLocked(java.lang.String,int)</span>
    <span class="token comment">// // private void finishForceStopPackageLocked(final String packageName, int uid) {</span>
    <span class="token comment">// var finishForceStopPackageLockedFunc = ActivityManagerServiceCls.finishForceStopPackageLocked</span>
    <span class="token comment">// console.log(&quot;finishForceStopPackageLockedFunc=&quot; + finishForceStopPackageLockedFunc)</span>
    <span class="token comment">// if (finishForceStopPackageLockedFunc) {</span>
    <span class="token comment">//   finishForceStopPackageLockedFunc.implementation = function (packageName, uid) {</span>
    <span class="token comment">//     PrintStack(ThrowableCls)</span>
    <span class="token comment">//     return this.finishForceStopPackageLocked(packageName, uid)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>

    <span class="token comment">// public void com.android.server.am.ActivityManagerService.forceStopPackage(java.lang.String,int)</span>
    <span class="token comment">// public void forceStopPackage(final String packageName, int userId) {</span>
    <span class="token keyword">var</span> amsForceStopPackageFunc <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>forceStopPackage
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;amsForceStopPackageFunc=&quot;</span> <span class="token operator">+</span> amsForceStopPackageFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>amsForceStopPackageFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      amsForceStopPackageFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">packageName<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceStopPackage</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// public final void com.android.server.am.ActivityManagerService.forceStopPackageLocked(java.lang.String,int,java.lang.String)</span>
    <span class="token comment">// private void forceStopPackageLocked(final String packageName, int uid, String reason) {</span>
    <span class="token keyword">var</span> forceStopPackageLockedFunc3 <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>forceStopPackageLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;forceStopPackageLockedFunc3=&quot;</span> <span class="token operator">+</span> forceStopPackageLockedFunc3<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>forceStopPackageLockedFunc3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      forceStopPackageLockedFunc3<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">packageName<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceStopPackageLocked</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// public final boolean com.android.server.am.ActivityManagerService.forceStopPackageLocked(java.lang.String,int,boolean,boolean,boolean,boolean,boolean,int,java.lang.String)</span>
    <span class="token comment">// final boolean forceStopPackageLocked(String packageName, int appId, boolean callerWillRestart, boolean purgeCache, boolean doit, boolean evenPersistent, boolean uninstalling, int userId, String reason) {</span>
    <span class="token keyword">var</span> forceStopPackageLockedFunc9 <span class="token operator">=</span> ActivityManagerServiceCls<span class="token punctuation">.</span>forceStopPackageLocked<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;int&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;java.lang.String&apos;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;forceStopPackageLockedFunc9=&quot;</span> <span class="token operator">+</span> forceStopPackageLockedFunc9<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>forceStopPackageLockedFunc9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      forceStopPackageLockedFunc9<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">packageName<span class="token punctuation">,</span> appId<span class="token punctuation">,</span> callerWillRestart<span class="token punctuation">,</span> purgeCache<span class="token punctuation">,</span> doit<span class="token punctuation">,</span> evenPersistent<span class="token punctuation">,</span> uninstalling<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceStopPackageLocked</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> appId<span class="token punctuation">,</span> callerWillRestart<span class="token punctuation">,</span> purgeCache<span class="token punctuation">,</span> doit<span class="token punctuation">,</span> evenPersistent<span class="token punctuation">,</span> uninstalling<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ---------------------------------------- android.app.ActivityManager</span>
    <span class="token keyword">var</span> ActivityManagerCls <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;android.app.ActivityManager&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ActivityManagerCls=&quot;</span> <span class="token operator">+</span> ActivityManagerCls<span class="token punctuation">)</span>

    <span class="token comment">// public void android.app.ActivityManager.forceStopPackage(java.lang.String)</span>
    <span class="token comment">// public void forceStopPackage(String packageName) {</span>
    <span class="token keyword">var</span> amForceStopPackageFunc <span class="token operator">=</span> ActivityManagerCls<span class="token punctuation">.</span>forceStopPackage
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;amForceStopPackageFunc=&quot;</span> <span class="token operator">+</span> amForceStopPackageFunc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>amForceStopPackageFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      amForceStopPackageFunc<span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">packageName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PrintStack</span><span class="token punctuation">(</span>ThrowableCls<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceStopPackage</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// // ---------------------------------------- com.android.server.wm.ActivityStarter</span>
    <span class="token comment">// var ActivityStarterCls = Java.use(&quot;com.android.server.wm.ActivityStarter&quot;)</span>
    <span class="token comment">// console.log(&quot;ActivityStarterCls=&quot; + ActivityStarterCls)</span>

    <span class="token comment">// var executeRequestFunc = ActivityStarterCls.executeRequest</span>
    <span class="token comment">// // var executeRequestFunc = ActivityStarterCls._executeRequest</span>
    <span class="token comment">// console.log(&quot;executeRequestFunc=&quot; + executeRequestFunc)</span>
    <span class="token comment">// if (executeRequestFunc) {</span>
    <span class="token comment">//   executeRequestFunc.implementation = function (request) {</span>
    <span class="token comment">//     // 打印当前调用堆栈信息</span>
    <span class="token comment">//     let newThrowable = Throwable.$new()</span>
    <span class="token comment">//     console.log(&quot;newThrowable=&quot; + newThrowable)</span>
    <span class="token comment">//     let stackStr = curLog.getStackTraceString(newThrowable)</span>
    <span class="token comment">//     console.log(&quot;stackStr=&quot; + stackStr)</span>
    <span class="token comment">//     return this.executeRequest(request)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>

    <span class="token comment">// // public void android.app.ActivityManager.forceStopPackageAsUser(java.lang.String,int)</span>
    <span class="token comment">// // public void forceStopPackageAsUser(String packageName, int userId) {</span>
    <span class="token comment">// var forceStopPackageAsUserFunc = ActivityManagerCls.forceStopPackageAsUser</span>
    <span class="token comment">// console.log(&quot;forceStopPackageAsUserFunc=&quot; + forceStopPackageAsUserFunc)</span>
    <span class="token comment">// if (forceStopPackageAsUserFunc) {</span>
    <span class="token comment">//   forceStopPackageAsUserFunc.implementation = function (packageName, userId) {</span>
    <span class="token comment">//     PrintStack(ThrowableCls)</span>
    <span class="token comment">//     return this.forceStopPackageAsUser(packageName, userId)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>


    <span class="token comment">// // ---------------------------------------- com.android.server.pm.Settings</span>
    <span class="token comment">// var SettingsCls = Java.use(&quot;com.android.server.pm.Settings&quot;)</span>
    <span class="token comment">// console.log(&quot;SettingsCls=&quot; + SettingsCls)</span>

    <span class="token comment">// /* static @NonNull PackageSetting createNewSetting(</span>
    <span class="token comment">//         String pkgName,</span>
    <span class="token comment">//         PackageSetting originalPkg,</span>
    <span class="token comment">//         PackageSetting disabledPkg,</span>
    <span class="token comment">//         String realPkgName,</span>
    <span class="token comment">//         SharedUserSetting sharedUser,</span>
    <span class="token comment">//         File codePath,</span>
    <span class="token comment">//         String legacyNativeLibraryPath,</span>
    <span class="token comment">//         String primaryCpuAbi,</span>
    <span class="token comment">//         String secondaryCpuAbi,</span>
    <span class="token comment">//         long versionCode,</span>
    <span class="token comment">//         int pkgFlags,</span>
    <span class="token comment">//         int pkgPrivateFlags,</span>
    <span class="token comment">//         UserHandle installUser,</span>
    <span class="token comment">//         boolean allowInstall,</span>
    <span class="token comment">//         boolean instantApp,</span>
    <span class="token comment">//         boolean virtualPreload,</span>
    <span class="token comment">//         UserManagerService userManager,</span>
    <span class="token comment">//         String[] usesSdkLibraries,</span>
    <span class="token comment">//         long[] usesSdkLibrariesVersions,</span>
    <span class="token comment">//         String[] usesStaticLibraries,</span>
    <span class="token comment">//         long[] usesStaticLibrariesVersions,</span>
    <span class="token comment">//         Set&lt;String&gt; mimeGroupNames,</span>
    <span class="token comment">//         @NonNull UUID domainSetId</span>
    <span class="token comment">//     ) {</span>
    <span class="token comment">// */</span>

    <span class="token comment">// var createNewSettingFunc = SettingsCls.createNewSetting</span>
    <span class="token comment">// console.log(&quot;createNewSettingFunc=&quot; + createNewSettingFunc)</span>
    <span class="token comment">// if (createNewSettingFunc) {</span>
    <span class="token comment">//   createNewSettingFunc.implementation = function (pkgName, originalPkg, disabledPkg, realPkgName, sharedUser, codePath, legacyNativeLibraryPath, primaryCpuAbi, secondaryCpuAbi, versionCode, pkgFlags, pkgPrivateFlags, installUser, allowInstall, instantApp, virtualPreload, userManager, usesSdkLibraries, usesStaticLibraries, usesStaticLibrariesVersions, mimeGroupNames, domainSetId) {</span>
    <span class="token comment">//     PrintStack(ThrowableCls)</span>
    <span class="token comment">//     return this.createNewSetting(pkgName, originalPkg, disabledPkg, realPkgName, sharedUser, codePath, legacyNativeLibraryPath, primaryCpuAbi, secondaryCpuAbi, versionCode, pkgFlags, pkgPrivateFlags, installUser, allowInstall, instantApp, virtualPreload, userManager, usesSdkLibraries, usesStaticLibraries, usesStaticLibrariesVersions, mimeGroupNames, domainSetId)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span>hookForceStop<span class="token punctuation">)</span>
</code></pre>
<footer class="page-footer"><span class="copyright">crifan.org，使用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">署名4.0国际(CC BY 4.0)协议</a>发布 all right reserved，powered by Gitbook</span><span class="footer-modification">最后更新：
2024-07-25 17:58:14
</span></footer></body></html>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="single_class/single_func.html" class="navigation navigation-prev " aria-label="Previous page: 单个类的单个函数">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../frida_trace/" class="navigation navigation-next " aria-label="Next page: frida-trace">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"hookForceStop","level":"1.3.2.2.3","depth":4,"next":{"title":"frida-trace","level":"1.3.3","depth":2,"path":"frida_re_example/frida_trace/README.md","ref":"frida_re_example/frida_trace/README.md","articles":[{"title":"iOS的ObjC","level":"1.3.3.1","depth":3,"path":"frida_re_example/frida_trace/ios_objc/README.md","ref":"frida_re_example/frida_trace/ios_objc/README.md","articles":[{"title":"akd中Apple账号验证过程","level":"1.3.3.1.1","depth":4,"path":"frida_re_example/frida_trace/ios_objc/akd_apple_login.md","ref":"frida_re_example/frida_trace/ios_objc/akd_apple_login.md","articles":[]},{"title":"Preferences中Apple账号登录全过程","level":"1.3.3.1.2","depth":4,"path":"frida_re_example/frida_trace/ios_objc/preferences_full_apple_login.md","ref":"frida_re_example/frida_trace/ios_objc/preferences_full_apple_login.md","articles":[]}]},{"title":"Android","level":"1.3.3.2","depth":3,"path":"frida_re_example/frida_trace/android/README.md","ref":"frida_re_example/frida_trace/android/README.md","articles":[{"title":"commands","level":"1.3.3.2.1","depth":4,"path":"frida_re_example/frida_trace/android/commands.md","ref":"frida_re_example/frida_trace/android/commands.md","articles":[]},{"title":"安卓进程system_server","level":"1.3.3.2.2","depth":4,"path":"frida_re_example/frida_trace/android/system_server.md","ref":"frida_re_example/frida_trace/android/system_server.md","articles":[]}]}]},"previous":{"title":"单个类的单个函数","level":"1.3.2.2.2.1","depth":5,"path":"frida_re_example/frida/android/single_class/single_func.md","ref":"frida_re_example/frida/android/single_class/single_func.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-comscore","anchors","expandable-menu","-lunr","-search","search-plus","disqus","-highlight","prism","prism-themes","github-buttons","-splitter","splitter-nosessionbutcookie","-sharing","sharing-plus","tbfed-pagefooter","donate","sitemap-general","copy-code-button","callouts","toolbar-button"],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"crifan.org，使用<a href='https://creativecommons.org/licenses/by/4.0/deed.zh'>署名4.0国际(CC BY 4.0)协议</a>发布","modify_label":"最后更新：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"disqus":{"useIdentifier":false,"shortName":"crifan"},"callouts":{"showTypeInHeader":false},"toolbar-button":{"label":"下载PDF","url":"https://book.crifan.org/books/frida_re_example_function/pdf/frida_re_example_function.pdf","icon":"fa-file-pdf-o"},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"donate":{"title":"","button":"打赏","wechat":"https://www.crifan.org/files/res/crifan_com/crifan_wechat_pay.jpg","alipay":"https://www.crifan.org/files/res/crifan_com/crifan_alipay_pay.jpg","wechatText":"微信打赏给Crifan","alipayText":"支付宝打赏给Crifan"},"sitemap-general":{"prefix":"https://book.crifan.org/books/frida_re_example_function/website/"},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"splitter-nosessionbutcookie":{},"prism-themes":{},"github-buttons":{"buttons":[{"repo":"frida_re_example_function","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]},"expandable-menu":{},"copy-code-button":{},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","line","linkedin","messenger","pocket","qq","qzone","stumbleupon","twitter","viber","vk","weibo","whatsapp"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"search-plus":{}},"theme":"default","author":"Crifan Li <admin@crifan.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Frida逆向实例和工具函数","language":"zh-hans","links":{"sidebar":{"主页":"http://www.crifan.org"}},"gitbook":"*","description":"整理Frida逆向期间涉及到的各种实际案例，以及整理出的各种工具类函数。其中Frida的实际使用案例，包括网上别人的实例案例，包括官网的Cdeshare，以及frida和frida-trace。frida中包括iOS的ObjC的各种例子。包括Object对象的methods和ownMethods，以及用Interceptor去hook函数的，单个类的单个函数、单个类的所有函数、所有类的所有函数等。以及ApiResolver的案例以及Stalker的案例，尤其是___lldb_unnamed_symbol2575$$akd的完整代码；接着是frida-trace的实际例子，包括ObjC的akd中Apple账号验证过程、Preferences中Apple账号登录全过程的详细内容。"},"file":{"path":"frida_re_example/frida/android/hookforcestop.md","mtime":"2024-07-25T09:58:14.657Z","type":"markdown"},"gitbook":{"version":"4.0.7","time":"2024-07-28T08:09:06.922Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-toolbar-button/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

