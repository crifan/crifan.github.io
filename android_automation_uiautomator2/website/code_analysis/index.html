
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>源码分析 · 安卓自动化测试利器：uiautomator2</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Crifan Li <admin@crifan.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../common_code_snippet/" />
    
    
    <link rel="prev" href="../common_issue_summary/background_service_killed.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"repo":"android_automation_uiautomator2","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://www.crifan.com" target="_blank" class="custom-link">主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../intro/">
            
                <a href="../intro/">
            
                    
                        <b>1.2.</b>
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../build_dev_env/">
            
                <a href="../build_dev_env/">
            
                    
                        <b>1.3.</b>
                    
                    环境搭建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../core_function/">
            
                <a href="../core_function/">
            
                    
                        <b>1.4.</b>
                    
                    核心功能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../core_function/watcher.html">
            
                <a href="../core_function/watcher.html">
            
                    
                        <b>1.4.1.</b>
                    
                    监听
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../core_function/find_element/">
            
                <a href="../core_function/find_element/">
            
                    
                        <b>1.4.2.</b>
                    
                    查找元素
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../core_function/find_element/example_input_box.html">
            
                <a href="../core_function/find_element/example_input_box.html">
            
                    
                        <b>1.4.2.1.</b>
                    
                    举例：浏览器的输入框
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../core_function/find_element/wait_elem_show.html">
            
                <a href="../core_function/find_element/wait_elem_show.html">
            
                    
                        <b>1.4.2.2.</b>
                    
                    等待元素出现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../core_function/find_element/xpath.html">
            
                <a href="../core_function/find_element/xpath.html">
            
                    
                        <b>1.4.2.3.</b>
                    
                    xpath
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../core_function/operate_element/">
            
                <a href="../core_function/operate_element/">
            
                    
                        <b>1.4.3.</b>
                    
                    操作元素
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../core_function/operate_element/click_element.html">
            
                <a href="../core_function/operate_element/click_element.html">
            
                    
                        <b>1.4.3.1.</b>
                    
                    点击元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../core_function/operate_element/input_content.html">
            
                <a href="../core_function/operate_element/input_content.html">
            
                    
                        <b>1.4.3.2.</b>
                    
                    输入内容
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="../core_function/operate_element/get_property.html">
            
                <a href="../core_function/operate_element/get_property.html">
            
                    
                        <b>1.4.3.3.</b>
                    
                    获取元素属性
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../core_function/operate_element/key.html">
            
                <a href="../core_function/operate_element/key.html">
            
                    
                        <b>1.4.4.</b>
                    
                    按键
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../core_function/operate_element/screen.html">
            
                <a href="../core_function/operate_element/screen.html">
            
                    
                        <b>1.4.5.</b>
                    
                    屏幕
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../core_function/operate_element/app.html">
            
                <a href="../core_function/operate_element/app.html">
            
                    
                        <b>1.4.6.</b>
                    
                    APP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../core_function/other_function.html">
            
                <a href="../core_function/other_function.html">
            
                    
                        <b>1.4.7.</b>
                    
                    其他功能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../related/">
            
                <a href="../related/">
            
                    
                        <b>1.5.</b>
                    
                    相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../related/weditor.html">
            
                <a href="../related/weditor.html">
            
                    
                        <b>1.5.1.</b>
                    
                    weditor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../related/adb.html">
            
                <a href="../related/adb.html">
            
                    
                        <b>1.5.2.</b>
                    
                    adb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../related/android_uiautomator_server.html">
            
                <a href="../related/android_uiautomator_server.html">
            
                    
                        <b>1.5.3.</b>
                    
                    android-uiautomator-server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../related/uiautomator.html">
            
                <a href="../related/uiautomator.html">
            
                    
                        <b>1.5.4.</b>
                    
                    uiautomator
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../common_issue_summary/">
            
                <a href="../common_issue_summary/">
            
                    
                        <b>1.6.</b>
                    
                    常见问题和经验
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../common_issue_summary/input_text.html">
            
                <a href="../common_issue_summary/input_text.html">
            
                    
                        <b>1.6.1.</b>
                    
                    文字输入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../common_issue_summary/xml_not_latest/">
            
                <a href="../common_issue_summary/xml_not_latest/">
            
                    
                        <b>1.6.2.</b>
                    
                    xml源码不是最新的
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../common_issue_summary/xml_not_latest/restart_u2_serivice.html">
            
                <a href="../common_issue_summary/xml_not_latest/restart_u2_serivice.html">
            
                    
                        <b>1.6.2.1.</b>
                    
                    重启服务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../common_issue_summary/naf.html">
            
                <a href="../common_issue_summary/naf.html">
            
                    
                        <b>1.6.3.</b>
                    
                    NAF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../common_issue_summary/long_click_not_work.html">
            
                <a href="../common_issue_summary/long_click_not_work.html">
            
                    
                        <b>1.6.4.</b>
                    
                    long_click不工作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../common_issue_summary/background_service_killed.html">
            
                <a href="../common_issue_summary/background_service_killed.html">
            
                    
                        <b>1.6.5.</b>
                    
                    后台服务已被杀掉
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.7.</b>
                    
                    源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../common_code_snippet/">
            
                <a href="../common_code_snippet/">
            
                    
                        <b>1.8.</b>
                    
                    常用代码段
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../common_code_snippet/common_utils.html">
            
                <a href="../common_code_snippet/common_utils.html">
            
                    
                        <b>1.8.1.</b>
                    
                    工具类函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../common_code_snippet/adb.html">
            
                <a href="../common_code_snippet/adb.html">
            
                    
                        <b>1.8.2.</b>
                    
                    adb相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../common_code_snippet/device.html">
            
                <a href="../common_code_snippet/device.html">
            
                    
                        <b>1.8.3.</b>
                    
                    设备相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../common_code_snippet/other.html">
            
                <a href="../common_code_snippet/other.html">
            
                    
                        <b>1.8.4.</b>
                    
                    其他
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../real_examples/">
            
                <a href="../real_examples/">
            
                    
                        <b>1.9.</b>
                    
                    实际案例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../real_examples/baidu_search.html">
            
                <a href="../real_examples/baidu_search.html">
            
                    
                        <b>1.9.1.</b>
                    
                    百度搜索自动化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../real_examples/weixin_related.html">
            
                <a href="../real_examples/weixin_related.html">
            
                    
                        <b>1.9.2.</b>
                    
                    微信相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../real_examples/confirm_buttons.html">
            
                <a href="../real_examples/confirm_buttons.html">
            
                    
                        <b>1.9.3.</b>
                    
                    确定类按钮
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../real_examples/ad_popup.html">
            
                <a href="../real_examples/ad_popup.html">
            
                    
                        <b>1.9.4.</b>
                    
                    广告类弹框
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../real_examples/vivo_auto_install.html">
            
                <a href="../real_examples/vivo_auto_install.html">
            
                    
                        <b>1.9.5.</b>
                    
                    Vivo自动安装app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../real_examples/vivo_auto_login.html">
            
                <a href="../real_examples/vivo_auto_login.html">
            
                    
                        <b>1.9.6.</b>
                    
                    Vivo账号自动登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../real_examples/qihoo_360_auto_login.html">
            
                <a href="../real_examples/qihoo_360_auto_login.html">
            
                    
                        <b>1.9.7.</b>
                    
                    奇虎360自动登录账号
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../appendix/">
            
                <a href="../appendix/">
            
                    
                        <b>1.10.</b>
                    
                    附录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../appendix/reference.html">
            
                <a href="../appendix/reference.html">
            
                    
                        <b>1.10.1.</b>
                    
                    参考资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >源码分析</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x6E90;&#x7801;&#x5206;&#x6790;"><a name="&#x6E90;&#x7801;&#x5206;&#x6790;" class="plugin-anchor" href="#&#x6E90;&#x7801;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6E90;&#x7801;&#x5206;&#x6790;</h1>
<p>&#x6298;&#x817E;uiautomator2&#x671F;&#x95F4;&#xFF0C;&#x5206;&#x6790;&#x4E86;&#x5176;&#x4E2D;&#x90E8;&#x5206;&#x6E90;&#x7801;&#x3002;&#x73B0;&#x628A;&#x8FC7;&#x7A0B;&#x6574;&#x7406;&#x5982;&#x4E0B;&#x4F9B;&#x53C2;&#x8003;&#x3002;</p>
<h2 id="uiautomator-server&#x4E2D;&#x6700;&#x7EC8;&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;dumpwindowhierarchy&#x7684;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x9875;&#x9762;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;"><a name="uiautomator-server&#x4E2D;&#x6700;&#x7EC8;&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;dumpwindowhierarchy&#x7684;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x9875;&#x9762;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;" class="plugin-anchor" href="#uiautomator-server&#x4E2D;&#x6700;&#x7EC8;&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;dumpwindowhierarchy&#x7684;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x9875;&#x9762;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;"><i class="fa fa-link" aria-hidden="true"></i></a>uiautomator-server&#x4E2D;&#x6700;&#x7EC8;&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;dumpWindowHierarchy&#x7684;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x9875;&#x9762;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;</h2>
<h3 id="&#x5148;&#x542F;&#x52A8;&#x4E86;&#x5E95;&#x5C42;&#x7684;jsonrpc&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x76D1;&#x542C;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8981;&#x6267;&#x884C;&#x7684;&#x52A8;&#x4F5C;"><a name="&#x5148;&#x542F;&#x52A8;&#x4E86;&#x5E95;&#x5C42;&#x7684;jsonrpc&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x76D1;&#x542C;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8981;&#x6267;&#x884C;&#x7684;&#x52A8;&#x4F5C;" class="plugin-anchor" href="#&#x5148;&#x542F;&#x52A8;&#x4E86;&#x5E95;&#x5C42;&#x7684;jsonrpc&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x76D1;&#x542C;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8981;&#x6267;&#x884C;&#x7684;&#x52A8;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5148;&#x542F;&#x52A8;&#x4E86;&#x5E95;&#x5C42;&#x7684;jsonrpc&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x76D1;&#x542C;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8981;&#x6267;&#x884C;&#x7684;&#x52A8;&#x4F5C;</h3>
<p>&#x6587;&#x4EF6;&#xFF1A;<code>app/src/androidTest/java/com/github/uiautomator/stub/Stub.java</code></p>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>googlecode<span class="token punctuation">.</span>jsonrpc4j</span><span class="token punctuation">.</span><span class="token class-name">JsonRpcServer</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">int</span> PORT <span class="token operator">=</span> <span class="token number">9008</span><span class="token punctuation">;</span>
    <span class="token class-name">AutomatorHttpServer</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutomatorHttpServer</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">launchService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonRpcServer</span> jrs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonRpcServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AutomatorServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">AutomatorService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/jsonrpc/0&quot;</span><span class="token punctuation">,</span> jrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x4E2D;&#x5BF9;&#x4E8E;launchService&#xFF1A;</p>
<pre class="language-"><code class="lang-java">    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">launchService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemoteException</span> <span class="token punctuation">{</span>
        <span class="token class-name">UiDevice</span> device <span class="token operator">=</span> <span class="token class-name">UiDevice</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">InstrumentationRegistry</span><span class="token punctuation">.</span><span class="token function">getInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token class-name">InstrumentationRegistry</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">wakeUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// Wait for launcher</span>
        <span class="token class-name">String</span> launcherPackage <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">getLauncherPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> ready <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token class-name">Until</span><span class="token punctuation">.</span><span class="token function">hasObject</span><span class="token punctuation">(</span><span class="token class-name">By</span><span class="token punctuation">.</span><span class="token function">pkg</span><span class="token punctuation">(</span>launcherPackage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LAUNCH_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Wait for launcher timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;Launch service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startMonitorService</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startMonitorService</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.github.uiautomator.ACTION_START&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.github.uiautomator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fix error: Service Intent must be explicit</span>
        context<span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x53BB;&#x542F;&#x52A8;&#x4E86;<code>com.github.uiautomator</code>&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;uiautomator&#x7684;&#x670D;&#x52A1;&#x4E86;&#x3002;</p>
<p>&#x800C;&#x524D;&#x9762;&#x7684;<code>JsonRpcServer</code>&#x7684;<code>jrs</code>&#xFF0C;&#x5219;&#x662F;&#xFF1A;</p>
<ul>
<li>&#x8D1F;&#x8D23;&#x76D1;&#x542C;<code>/jsonrpc/0</code><ul>
<li>&#x5BF9;&#x5E94;&#x7740;&#x4E4B;&#x524D;<code>uiautomator2</code>&#x4E2D;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x8BF7;&#x6C42;<ul>
<li><code>Shell$ curl -X POST -d &apos;b&apos;{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: &quot;1f056baf5d6b2ea2cb7e546efb7cd64f&quot;, &quot;method&quot;: &quot;dumpWindowHierarchy&quot;, &quot;params&quot;: [true, null]}&apos;&apos; http://127.0.0.1:64445/jsonrpc/0</code></li>
<li>&#x4E2D;&#x7684;<code>jsonrpc/0</code></li>
</ul>
</li>
</ul>
</li>
<li>&#x5176;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7684;&#x7C7B;&#x662F;<code>AutomatorServiceImpl</code>&#x7684;<code>AutomatorService</code><ul>
<li>&#x4E0B;&#x9762;&#x5C31;&#x6765;&#x4ECB;&#x7ECD;<code>AutomatorServiceImpl</code></li>
</ul>
</li>
</ul>
<p>&#x6587;&#x4EF6;&#xFF1A;<code>app/src/androidTest/java/com/github/uiautomator/stub/AutomatorServiceImpl.java</code></p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutomatorServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AutomatorService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * It&apos;s to test if the service is alive.
     *
     * @return &apos;pong&apos;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;pong&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the device info.
     *
     * @return device info.
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DeviceInfo</span> <span class="token function">deviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DeviceInfo</span><span class="token punctuation">.</span><span class="token function">getDeviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;</p>
<ul>
<li><code>ping</code><ul>
<li>&#x8FD4;&#x56DE;<code>pong</code><ul>
<li>&#x8868;&#x793A;&#x670D;&#x52A1;&#x8FD8;&#x5728;&#xFF0C;&#x6709;&#x6548;&#x3001;alive</li>
</ul>
</li>
</ul>
</li>
<li><code>deviceInfo</code><ul>
<li>&#x5BF9;&#x5E94;&#x7740;&#x4E4B;&#x524D;&#x8C03;&#x8BD5;&#xFF1A;<ul>
<li><code>d = u2.connect(&apos;8c8a4d4d&apos;)</code></li>
</ul>
</li>
<li>&#x671F;&#x95F4;&#x8F93;&#x51FA;&#x7684;&#xFF1A;<ul>
<li><code>conn=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>urllib3.connection.HTTPConnection</span> <span class="token attr-name">object</span> <span class="token attr-name">at</span> <span class="token attr-name">0x1077f4be0</span><span class="token punctuation">&gt;</span></span>,method=POST,url=/jsonrpc/0,timeout_obj=Timeout(connect=2, read=2, total=None),body={&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;deviceInfo&quot;},headers={&apos;User-Agent&apos;: &apos;python-requests/2.22.0&apos;, &apos;Accept-Encoding&apos;: &apos;gzip, deflate&apos;, &apos;Accept&apos;: &apos;*/*&apos;, &apos;Connection&apos;: &apos;keep-alive&apos;, &apos;Content-Length&apos;: &apos;51&apos;},chunked=False</code></li>
</ul>
</li>
<li>&#x4E2D;&#x7684;<ul>
<li><code>&quot;method&quot;: &quot;deviceInfo&quot;</code></li>
</ul>
</li>
<li>&#x7528;&#x4E8E;&#x8FD4;&#x56DE;&#x8BBE;&#x5907;&#x4FE1;&#x606F;</li>
</ul>
</li>
</ul>
<p>&#x800C;AutomatorServiceImpl&#x4E2D;&#x6D77;&#x6CB9;&#x5176;&#x4ED6;&#x5F88;&#x591A;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x4E4B;&#x524D;&#x63A5;&#x89E6;&#x8FC7;&#x7684;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">drag</span><span class="token punctuation">(</span><span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token keyword">int</span> endX<span class="token punctuation">,</span> <span class="token keyword">int</span> endY<span class="token punctuation">,</span> <span class="token keyword">int</span> steps<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NotImplementedException</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">swipe</span><span class="token punctuation">(</span><span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token keyword">int</span> endX<span class="token punctuation">,</span> <span class="token keyword">int</span> endY<span class="token punctuation">,</span> <span class="token keyword">int</span> steps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p>&#x90FD;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x57FA;&#x7840;&#x529F;&#x80FD;&#x3002;</p>
<pre class="language-"><code class="lang-java">    <span class="token comment">// Multi touch is a little complicated</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">injectInputEvent</span><span class="token punctuation">(</span><span class="token keyword">int</span> action<span class="token punctuation">,</span> <span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> metaState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MotionEvent</span> e <span class="token operator">=</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">uptimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">uptimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                action<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> metaState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span><span class="token class-name">InputDevice</span><span class="token punctuation">.</span>SOURCE_TOUCHSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> b <span class="token operator">=</span> uiAutomation<span class="token punctuation">.</span><span class="token function">injectInputEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x4E4B;&#x524D;&#x5C31;&#x9047;&#x5230;&#x8FC7;&#x591A;&#x6B21;&#xFF0C;&#x4E0A;&#x5C42;&#x8C03;&#x7528;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x4F1A;&#x63D0;&#x5230;&#x8FD9;&#x4E2A;</p>
<p>&#x6BD4;&#x5982;&#xFF1A;</p>
<p>&#x3010;&#x5DF2;&#x89E3;&#x51B3;&#x3011;python&#x7684;uiautomator2&#x62A5;&#x9519;&#xFF1A;uiautomator2.exceptions.JsonRpcError -32601 Method not found data injectInputEvent</p>
<p>&#x4E2D;&#x7684;</p>
<pre class="language-"><code class="lang-java">    obj<span class="token punctuation">.</span>jsonrpc<span class="token punctuation">.</span><span class="token function">injectInputEvent</span><span class="token punctuation">(</span>ACTION_DOWN<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x5176;&#x4ED6;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5F88;&#x591A;&#xFF1A;</p>
<pre class="language-"><code class="lang-java">    <span class="token comment">/**
     * Simulates a short press using key name.
     *
     * @param key possible key name is home, back, left, right, up, down, center, menu, search, enter, delete(or del), recent(recent apps), volume_up, volume_down, volume_mute, camera, power
     * @return true if successful, else return false
     * @throws RemoteException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">pressKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemoteException</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> result<span class="token punctuation">;</span>
        key <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressHome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;back&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDPadLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDPadRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;up&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDPadUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;down&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDPadDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDPadCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;menu&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;search&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;enter&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;delete&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;del&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;recent&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressRecentApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;volume_up&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;volume_down&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_DOWN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;volume_mute&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_MUTE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;camera&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_CAMERA<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> result <span class="token operator">=</span> <span class="token string">&quot;power&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> device<span class="token punctuation">.</span><span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_POWER<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">pressKeyCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token keyword">int</span> metaState<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearTextField</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>




    <span class="token comment">/**
     * Reads the text property of the UI element
     *
     * @param obj the selector of the UiObject.
     * @return text value of the current node represented by this UiObject
     * @throws UiObjectNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getText</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> device<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Sets the text in an editable field, after clearing the field&apos;s content. The UiSelector selector of this object must reference a UI element that is editable. When you call this method, the method first simulates a click() on editable field to set focus. The method then clears the field&apos;s contents and injects your specified text into the field. If you want to capture the original contents of the field, call getText() first. You can then modify the text and use this method to update the field.
     *
     * @param obj  the selector of the UiObject.
     * @param text string to set
     * @return true if operation is successful
     * @throws UiObjectNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> <span class="token operator">|</span> <span class="token class-name">StaleObjectException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> device<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Performs a click at the center of the visible bounds of the UI element represented by this UiObject.
     *
     * @param obj the target ui object.
     * @return true id successful else false
     * @throws UiObjectNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> device<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            obj<span class="token punctuation">.</span><span class="token function">toUiObject2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * Clicks the bottom and right corner or top and left corner of the UI element
     *
     * @param obj    the target ui object.
     * @param corner &quot;br&quot;/&quot;bottomright&quot; means BottomRight, &quot;tl&quot;/&quot;topleft&quot; means TopLeft, &quot;center&quot; means Center.
     * @return true on success
     * @throws UiObjectNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> corner<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">click</span><span class="token punctuation">(</span>device<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> corner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token class-name">UiObject</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> corner<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>corner <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> corner <span class="token operator">=</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">;</span>
        corner <span class="token operator">=</span> corner<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;br&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;bottomright&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">clickBottomRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;tl&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;topleft&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">clickTopLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corner<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dragTo</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">,</span> <span class="token class-name">Selector</span> destObj<span class="token punctuation">,</span> <span class="token keyword">int</span> steps<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">NotImplementedException</span> <span class="token punctuation">{</span>




    <span class="token comment">/**
     * Performs the swipe up/down/left/right action on the UiObject
     *
     * @param obj   the target ui object.
     * @param dir   &quot;u&quot;/&quot;up&quot;, &quot;d&quot;/&quot;down&quot;, &quot;l&quot;/&quot;left&quot;, &quot;r&quot;/&quot;right&quot;
     * @param steps indicates the number of injected move steps into the system. Steps are injected about 5ms apart. So a 100 steps may take about 1/2 second to complete.
     * @return true of successful
     * @throws UiObjectNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">swipe</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> dir<span class="token punctuation">,</span> <span class="token keyword">int</span> steps<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">swipe</span><span class="token punctuation">(</span>device<span class="token punctuation">.</span><span class="token function">findObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toUiSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dir<span class="token punctuation">,</span> steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">swipe</span><span class="token punctuation">(</span><span class="token class-name">UiObject</span> item<span class="token punctuation">,</span> <span class="token class-name">String</span> dir<span class="token punctuation">,</span> <span class="token keyword">int</span> steps<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UiObjectNotFoundException</span> <span class="token punctuation">{</span>
        dir <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;up&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">swipeUp</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;down&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">swipeDown</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">swipeLeft</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;right&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> result <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">swipeRight</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p>&#x5176;&#x4ED6;&#x66F4;&#x591A;&#x51FD;&#x6570;&#x5C31;&#x4E0D;&#x8D34;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>
<h3 id="&#x5E95;&#x5C42;&#x8C03;&#x7528;dumpwindowhierarchy&#xFF0C;&#x5904;&#x7406;&#xFF0C;&#x8FD4;&#x56DE;&#x6570;&#x636E;"><a name="&#x5E95;&#x5C42;&#x8C03;&#x7528;dumpwindowhierarchy&#xFF0C;&#x5904;&#x7406;&#xFF0C;&#x8FD4;&#x56DE;&#x6570;&#x636E;" class="plugin-anchor" href="#&#x5E95;&#x5C42;&#x8C03;&#x7528;dumpwindowhierarchy&#xFF0C;&#x5904;&#x7406;&#xFF0C;&#x8FD4;&#x56DE;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5E95;&#x5C42;&#x8C03;&#x7528;dumpWindowHierarchy&#xFF0C;&#x5904;&#x7406;&#xFF0C;&#x8FD4;&#x56DE;&#x6570;&#x636E;</h3>
<p>&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;AutomatorServiceImpl.java &#x4E2D;&#x7684;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x51FD;&#x6570;&#xFF0C;&#x6B64;&#x5904;&#x6700;&#x5173;&#x5FC3;&#x7684;dumpWindowHierarchy&#x4E86;&#xFF1A;</p>
<pre class="language-"><code class="lang-java">    <span class="token comment">/**
     * Helper method used for debugging to dump the current window&apos;s layout hierarchy. The file root location is /data/local/tmp
     *
     * @param compressed use compressed layout hierarchy or not using setCompressedLayoutHeirarchy method. Ignore the parameter in case the API level lt 18.
     * @param filename   the filename to be stored. @deprecated
     * @return the absolute path name of dumped file.
     */</span>
    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> compressed<span class="token punctuation">,</span> <span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span>compressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Helper method used for debugging to dump the current window&apos;s layout hierarchy.
     *
     * @param compressed use compressed layout hierarchy or not using setCompressedLayoutHeirarchy method. Ignore the parameter in case the API level lt 18.
     * @return the absolute path name of dumped file.
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> compressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        device<span class="token punctuation">.</span><span class="token function">setCompressedLayoutHeirarchy</span><span class="token punctuation">(</span>compressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AccessibilityNodeInfoDumper</span><span class="token punctuation">.</span><span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            device.dumpWindowHierarchy(os);</span>


            <span class="token keyword">return</span> os<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;dump Window Hierarchy got IOException &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//ignore</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x524D;&#x4E00;&#x4E2A;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> compressed<span class="token punctuation">,</span> <span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre>
<p>&#x5DF2;&#x5E9F;&#x5F03;&#x3002;</p>
<p>&#x540E;&#x4E00;&#x4E2A;&#xFF0C;&#x6838;&#x5FC3;&#x662F;&#x8C03;&#x7528;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token class-name">AccessibilityNodeInfoDumper</span><span class="token punctuation">.</span><span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>app/src/androidTest/java/com/github/uiautomator/stub/AccessibilityNodeInfoDumper.java</code></p>
<pre class="language-"><code class="lang-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dumpWindowHierarchy</span><span class="token punctuation">(</span><span class="token class-name">UiDevice</span> device<span class="token punctuation">,</span> <span class="token class-name">OutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">XmlSerializer</span> serializer <span class="token operator">=</span> <span class="token class-name">Xml</span><span class="token punctuation">.</span><span class="token function">newSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">setFeature</span><span class="token punctuation">(</span><span class="token string">&quot;http://xmlpull.org/v1/doc/features.html#indent-output&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">startDocument</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">startTag</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hierarchy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rotation&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>device<span class="token punctuation">.</span><span class="token function">getDisplayRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AccessibilityNodeInfo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr$ <span class="token operator">=</span> <span class="token function">getWindowRoots</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// device.getWindowRoots();</span>
        <span class="token keyword">int</span> len$ <span class="token operator">=</span> arr$<span class="token punctuation">.</span>length<span class="token punctuation">;</span>


        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i$ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$ <span class="token operator">&lt;</span> len$<span class="token punctuation">;</span> <span class="token operator">++</span>i$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">AccessibilityNodeInfo</span> root <span class="token operator">=</span> arr$<span class="token punctuation">[</span>i$<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">dumpNodeRec</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> serializer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> device<span class="token punctuation">.</span><span class="token function">getDisplayWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> device<span class="token punctuation">.</span><span class="token function">getDisplayHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        serializer<span class="token punctuation">.</span><span class="token function">endTag</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hierarchy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serializer<span class="token punctuation">.</span><span class="token function">endDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5C31;&#x662F;&#x6B64;&#x5904;&#x7684;dumpWindowHierarchy&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x751F;&#x6210;xml&#x5185;&#x5BB9;&#x540E;&#xFF0C;&#x6240;&#x8FD4;&#x56DE;&#x7684;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x67D0;&#x6B21;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<p>jsonrpc&#x7684;&#x8C03;&#x7528;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>191120 10:17:07<span class="token punctuation">]</span><span class="token punctuation">[</span>__init__.py 493<span class="token punctuation">]</span> jsonrpc_call: jsonrpc_url<span class="token operator">=</span>http://127.0.0.1:64445/jsonrpc/0, method<span class="token operator">=</span>dumpWindowHierarchy, params<span class="token operator">=</span><span class="token punctuation">(</span>True, None<span class="token punctuation">)</span>, http_timeout<span class="token operator">=</span>60
</code></pre>
<p>&#x5E95;&#x5C42;&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x662F;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">Shell$ <span class="token function">curl</span> -X POST -d <span class="token string">&apos;b&apos;</span><span class="token punctuation">{</span><span class="token string">&quot;jsonrpc&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;2.0&quot;</span>, <span class="token string">&quot;id&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;5a175f3159cc1aa2e27f1cb68f5a0509&quot;</span>, <span class="token string">&quot;method&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;dumpWindowHierarchy&quot;</span>, <span class="token string">&quot;params&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>true, null<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token string">&apos;&apos;</span> http://127.0.0.1:64445/jsonrpc/0
</code></pre>
<p>&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">Output<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token string">&quot;jsonrpc&quot;</span><span class="token keyword">:</span><span class="token string">&quot;2.0&quot;</span>,<span class="token string">&quot;id&quot;</span><span class="token keyword">:</span><span class="token string">&quot;5a175f3159cc1aa2e27f1cb68f5a0509&quot;</span>,<span class="token string">&quot;result&quot;</span><span class="token keyword">:</span><span class="token string">&quot;&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos; standalone=&apos;yes&apos; ?&gt;&lt;hierarchy rotation=\&quot;0\&quot;&gt;&lt;node index=\&quot;0\&quot; text=\&quot;\&quot; resource-id=\&quot;\&quot; class=\&quot;android.widget.FrameLayout\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;&#x5F53;&#x524D;&#x6240;&#x5728;&#x9875;&#x9762;,&#x641C;&#x4E00;&#x641C;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;false\&quot; enabled=\&quot;true\&quot; focusable=\&quot;false\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,0][720,1208]\&quot;&gt;&lt;node index=\&quot;0\&quot; text=\&quot;\&quot; resource-id=\&quot;com.tencent.mm:id/om\&quot; class=\&quot;android.widget.FrameLayout\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;containerFrameLayout\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;false\&quot; enabled=\&quot;true\&quot; focusable=\&quot;false\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,134][720,1208]\&quot;&gt;&lt;node index=\&quot;0\&quot; text=\&quot;\&quot; resource-id=\&quot;com.tencent.mm:id/boe\&quot; class=\&quot;android.widget.FrameLayout\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;containerFrameLayout\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;false\&quot; enabled=\&quot;true\&quot; focusable=\&quot;false\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,134][720,1208]\&quot;&gt;&lt;node NAF=\&quot;true\&quot; index=\&quot;0\&quot; text=\&quot;\&quot; resource-id=\&quot;\&quot; class=\&quot;com.tencent.tbs.core.webkit.WebView\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;true\&quot; enabled=\&quot;true\&quot; focusable=\&quot;true\&quot; focused=\&quot;true\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;true\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,134][720,1208]\&quot; /&gt;&lt;/node&gt;&lt;/node&gt;&lt;node index=\&quot;1\&quot; text=\&quot;\&quot; resource-id=\&quot;com.tencent.mm:id/m4\&quot; class=\&quot;android.widget.LinearLayout\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;true\&quot; enabled=\&quot;true\&quot; focusable=\&quot;false\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,48][71,134]\&quot;&gt;&lt;node index=\&quot;0\&quot; text=\&quot;\&quot; resource-id=\&quot;com.tencent.mm:id/m5\&quot; class=\&quot;android.widget.ImageView\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;&#x8FD4;&#x56DE;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;false\&quot; enabled=\&quot;true\&quot; focusable=\&quot;false\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[0,48][71,134]\&quot; /&gt;&lt;/node&gt;&lt;node index=\&quot;3\&quot; text=\&quot;gh_cfcfcee032cc\&quot; resource-id=\&quot;com.tencent.mm:id/m7\&quot; class=\&quot;android.widget.EditText\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;true\&quot; enabled=\&quot;true\&quot; focusable=\&quot;true\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;true\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[116,48][706,134]\&quot; /&gt;&lt;node NAF=\&quot;true\&quot; index=\&quot;4\&quot; text=\&quot;\&quot; resource-id=\&quot;com.tencent.mm:id/m3\&quot; class=\&quot;android.widget.ImageButton\&quot; package=\&quot;com.tencent.mm\&quot; content-desc=\&quot;\&quot; checkable=\&quot;false\&quot; checked=\&quot;false\&quot; clickable=\&quot;true\&quot; enabled=\&quot;true\&quot; focusable=\&quot;true\&quot; focused=\&quot;false\&quot; scrollable=\&quot;false\&quot; long-clickable=\&quot;false\&quot; password=\&quot;false\&quot; selected=\&quot;false\&quot; bounds=\&quot;[663,69][706,112]\&quot; /&gt;&lt;/node&gt;&lt;/hierarchy&gt;&quot;</span><span class="token punctuation">}</span>
</code></pre>
<p>&#x53EF;&#x89C1;&#x5176;&#x4E2D;&#x7684;xml&#x5934;&#x90E8;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre class="language-"><code class="lang-xml"><span class="token prolog">&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos; standalone=&apos;yes&apos; ?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hierarchy</span> <span class="token attr-name">rotation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x7684;<code>XmlSerializer</code>&#x7684;&#x4EE3;&#x7801;&#x6240;&#x751F;&#x6210;&#x7684;&#x3002;</p>
<p>&#x800C;&#x5176;&#x4ED6;&#x7684;node&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x662F;dumpNodeRec&#x6240;&#x751F;&#x6210;&#x7684;&#x3002;</p>
<p>&#x7531;&#x6B64;&#xFF0C;&#x540E;&#x7EED;&#x6DF1;&#x5165;&#x7814;&#x7A76;&#xFF0C;&#x624D;&#x77E5;&#x9053;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x8282;&#x70B9;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x7B26;&#x5408;NAF&#x6761;&#x4EF6;&#xFF0C;&#x5219;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x5176;&#x4E0B;&#x5185;&#x5BB9;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;NAF=&quot;true&quot;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x540E;&#x7EED;&#x53EA;&#x8FD4;&#x56DE;&#x90E8;&#x5206;&#x9875;&#x9762;&#x5185;&#x5BB9;&#x7684;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x8BE6;&#x89C1;&#xFF1A;</p>
<ul>
<li>&#x3010;&#x672A;&#x89E3;&#x51B3;&#x3011;uiautomator2&#x4E2D;dump_hierarchy&#x4E2D;&#x53EA;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9875;&#x9762;&#x7684;&#x90E8;&#x5206;&#x7684;xml&#x6E90;&#x7801;</li>
<li>&#x3010;&#x5DF2;&#x89E3;&#x51B3;&#x3011;&#x641E;&#x61C2;uiautomator-server&#x4E2D;&#x6700;&#x7EC8;&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;dumpWindowHierarchy&#x7684;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x9875;&#x9762;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;</li>
</ul>
<footer class="page-footer"><span class="copyright">crifan.com&#xFF0C;&#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">&#x7F72;&#x540D;4.0&#x56FD;&#x9645;(CC BY 4.0)&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6700;&#x540E;&#x66F4;&#x65B0;&#xFF1A;
2020-08-09 10:14:28
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../common_issue_summary/background_service_killed.html" class="navigation navigation-prev " aria-label="Previous page: 后台服务已被杀掉">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../common_code_snippet/" class="navigation navigation-next " aria-label="Next page: 常用代码段">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"源码分析","level":"1.7","depth":1,"next":{"title":"常用代码段","level":"1.8","depth":1,"path":"common_code_snippet/README.md","ref":"common_code_snippet/README.md","articles":[{"title":"工具类函数","level":"1.8.1","depth":2,"path":"common_code_snippet/common_utils.md","ref":"common_code_snippet/common_utils.md","articles":[]},{"title":"adb相关","level":"1.8.2","depth":2,"path":"common_code_snippet/adb.md","ref":"common_code_snippet/adb.md","articles":[]},{"title":"设备相关","level":"1.8.3","depth":2,"path":"common_code_snippet/device.md","ref":"common_code_snippet/device.md","articles":[]},{"title":"其他","level":"1.8.4","depth":2,"path":"common_code_snippet/other.md","ref":"common_code_snippet/other.md","articles":[]}]},"previous":{"title":"后台服务已被杀掉","level":"1.6.5","depth":2,"path":"common_issue_summary/background_service_killed.md","ref":"common_issue_summary/background_service_killed.md","articles":[]},"dir":"ltr"},"config":{"plugins":["google-adsense","theme-comscore","anchors","-lunr","-search","search-plus","disqus","-highlight","prism","prism-themes","github-buttons","splitter","-sharing","sharing-plus","tbfed-pagefooter","expandable-chapters-small","ga","donate","sitemap-general","copy-code-button","callouts","toolbar-button"],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"crifan.com，使用<a href='https://creativecommons.org/licenses/by/4.0/deed.zh'>署名4.0国际(CC BY 4.0)协议</a>发布","modify_label":"最后更新：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"disqus":{"useIdentifier":false,"shortName":"crifan"},"callouts":{"showTypeInHeader":false},"toolbar-button":{"label":"下载PDF","url":"https://book.crifan.com/books/android_automation_uiautomator2/pdf/android_automation_uiautomator2.pdf","icon":"fa-file-pdf-o"},"splitter":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"donate":{"alipay":"https://www.crifan.com/files/res/crifan_com/crifan_alipay_pay.jpg","alipayText":"支付宝打赏给Crifan","button":"打赏","title":"","wechat":"https://www.crifan.com/files/res/crifan_com/crifan_wechat_pay.jpg","wechatText":"微信打赏给Crifan"},"sitemap-general":{"prefix":"https://book.crifan.com/books/android_automation_uiautomator2/website/"},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"prism-themes":{},"google-adsense":{"ads":[{"client":"ca-pub-6626240105039250"}]},"github-buttons":{"buttons":[{"repo":"android_automation_uiautomator2","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]},"expandable-chapters-small":{},"copy-code-button":{},"ga":{"configuration":"auto","token":"UA-28297199-1"},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","line","linkedin","messenger","pocket","qq","qzone","stumbleupon","twitter","viber","vk","weibo","whatsapp"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"search-plus":{}},"theme":"default","author":"Crifan Li <admin@crifan.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"安卓自动化测试利器：uiautomator2","language":"zh-hans","links":{"sidebar":{"主页":"http://www.crifan.com"}},"gitbook":"3.2.3","description":"总结安卓设备自动化测试领域好用的库uiautomator2，包括简介；如何搭建环境；有哪些核心功能，比如监听、用xpath或driver传参等方式查找元素，且给出了具体的浏览器的输入框如何查找定位的例子、以及常见的操作元素，比如点击元素、输入内容等、如何获取当前屏幕的截图和xml源码；以及与u2相关的内容，比如辅助调试的weditor、adb、android-uiautomator-server、uiautomator；以及常见问题和经验，比如文字输入、NAF、long_click不工作、后台服务被杀掉等；以及一些源码分析；和通用代码段，包括工具类函数、adb相关、设备相关等；最后给出参考资料和文档。以及额外加上了很多实际案例，比如常见的确定类弹框按钮、自动关闭各大应用市场的广告类弹框、Vivo自动安装app、Vivo自动登录账号、奇虎360的自动登录账号。以及其他一些常见逻辑。"},"file":{"path":"code_analysis/README.md","mtime":"2020-08-09T02:14:28.655Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-09-11T14:25:39.897Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-google-adsense/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toolbar-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

