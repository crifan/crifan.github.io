
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>函数调用逻辑 · iOS逆向开发：YouTube逆向</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.1">
        <meta name="author" content="Crifan Li <admin@crifan.com>">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="common_url.html" />
    
    
    <link rel="prev" href="ida_code.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"repo":"ios_re_youtube_reverse","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://www.crifan.org" target="_blank" class="custom-link">主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../reverse_youtube_overview/">
            
                <a href="../../reverse_youtube_overview/">
            
                    
                        <b>1.2.</b>
                    
                    iOS逆向YouTube概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../re_yt_steps/">
            
                <a href="../../re_yt_steps/">
            
                    
                        <b>1.3.</b>
                    
                    逆向YouTube过程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../re_yt_steps/crack_ipa/">
            
                <a href="../../re_yt_steps/crack_ipa/">
            
                    
                        <b>1.3.1.</b>
                    
                    砸壳ipa
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../re_yt_steps/crack_ipa/install_ipa.html">
            
                <a href="../../re_yt_steps/crack_ipa/install_ipa.html">
            
                    
                        <b>1.3.1.1.</b>
                    
                    安装ipa
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../re_yt_steps/static_analysis/">
            
                <a href="../../re_yt_steps/static_analysis/">
            
                    
                        <b>1.3.2.</b>
                    
                    静态分析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../../re_yt_steps/static_analysis/export_header.html">
            
                <a href="../../re_yt_steps/static_analysis/export_header.html">
            
                    
                        <b>1.3.2.1.</b>
                    
                    导出头文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../../re_yt_steps/static_analysis/ida_f5_code.html">
            
                <a href="../../re_yt_steps/static_analysis/ida_f5_code.html">
            
                    
                        <b>1.3.2.2.</b>
                    
                    IDA分析代码逻辑
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../re_yt_steps/dynamic_debug/">
            
                <a href="../../re_yt_steps/dynamic_debug/">
            
                    
                        <b>1.3.3.</b>
                    
                    动态调试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../../re_yt_steps/dynamic_debug/view_ui/">
            
                <a href="../../re_yt_steps/dynamic_debug/view_ui/">
            
                    
                        <b>1.3.3.1.</b>
                    
                    分析界面元素
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1.1" data-path="../../re_yt_steps/dynamic_debug/view_ui/reveal.html">
            
                <a href="../../re_yt_steps/dynamic_debug/view_ui/reveal.html">
            
                    
                        <b>1.3.3.1.1.</b>
                    
                    Reveal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.1.2" data-path="../../re_yt_steps/dynamic_debug/view_ui/cycript.html">
            
                <a href="../../re_yt_steps/dynamic_debug/view_ui/cycript.html">
            
                    
                        <b>1.3.3.1.2.</b>
                    
                    Cycript
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../../re_yt_steps/dynamic_debug/debug_logic/">
            
                <a href="../../re_yt_steps/dynamic_debug/debug_logic/">
            
                    
                        <b>1.3.3.2.</b>
                    
                    调试代码逻辑
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.2.1" data-path="../../re_yt_steps/dynamic_debug/debug_logic/xcode_monkeydev.html">
            
                <a href="../../re_yt_steps/dynamic_debug/debug_logic/xcode_monkeydev.html">
            
                    
                        <b>1.3.3.2.1.</b>
                    
                    Xcode+MonkeyDev
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../../re_yt_steps/repeat_steps.html">
            
                <a href="../../re_yt_steps/repeat_steps.html">
            
                    
                        <b>1.3.4.</b>
                    
                    重复上述过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../../re_yt_steps/invoked/">
            
                <a href="../../re_yt_steps/invoked/">
            
                    
                        <b>1.3.5.</b>
                    
                    期间涉及
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../../re_yt_steps/invoked/restore_symbol.html">
            
                <a href="../../re_yt_steps/invoked/restore_symbol.html">
            
                    
                        <b>1.3.5.1.</b>
                    
                    恢复符号表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="../../re_yt_steps/invoked/charles_capture.html">
            
                <a href="../../re_yt_steps/invoked/charles_capture.html">
            
                    
                        <b>1.3.5.2.</b>
                    
                    Charles抓包
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.4.</b>
                    
                    逆向YouTube产出
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../yt_app_internal/">
            
                <a href="../yt_app_internal/">
            
                    
                        <b>1.4.1.</b>
                    
                    YouTube的app内部逻辑
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../yt_app_internal/class_imp.html">
            
                <a href="../yt_app_internal/class_imp.html">
            
                    
                        <b>1.4.1.1.</b>
                    
                    很多类的具体实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../yt_app_internal/resp_data.html">
            
                <a href="../yt_app_internal/resp_data.html">
            
                    
                        <b>1.4.1.2.</b>
                    
                    返回数据
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.4.2.</b>
                    
                    YouTube广告过滤相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="hook_class.html">
            
                <a href="hook_class.html">
            
                    
                        <b>1.4.2.1.</b>
                    
                    hook的类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="ida_code.html">
            
                <a href="ida_code.html">
            
                    
                        <b>1.4.2.2.</b>
                    
                    IDA伪代码
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2.3" data-path="func_call.html">
            
                <a href="func_call.html">
            
                    
                        <b>1.4.2.3.</b>
                    
                    函数调用逻辑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="common_url.html">
            
                <a href="common_url.html">
            
                    
                        <b>1.4.2.4.</b>
                    
                    常见url
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../re_yt_summary/">
            
                <a href="../../re_yt_summary/">
            
                    
                        <b>1.5.</b>
                    
                    逆向YouTube总结
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../sub_book/">
            
                <a href="../../sub_book/">
            
                    
                        <b>1.6.</b>
                    
                    子教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../appendix/">
            
                <a href="../../appendix/">
            
                    
                        <b>1.7.</b>
                    
                    附录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../appendix/reference.html">
            
                <a href="../../appendix/reference.html">
            
                    
                        <b>1.7.1.</b>
                    
                    参考资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >函数调用逻辑</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <html><head></head><body><h1 id="函数调用逻辑"><a name="函数调用逻辑" class="plugin-anchor" href="#函数调用逻辑"><i class="fa fa-link" aria-hidden="true"></i></a>函数调用逻辑</h1>
<p>广告过滤内部调用逻辑，涉及到多个函数多个参数：</p>
<h2 id="disableadsfilterlogic"><a name="disableadsfilterlogic" class="plugin-anchor" href="#disableadsfilterlogic"><i class="fa fa-link" aria-hidden="true"></i></a>disable_ads_filter_logic</h2>
<p><code>disable_ads_filter_logic.coffee</code></p>
<pre class="language-"><code class="lang-c">禁用广告过滤时，多次调试

目前的发现的逻辑是：

<span class="token operator">--</span><span class="token operator">-</span>

【<span class="token number">1</span>】即使是 oad 的 initplayback ，正常返回response，也会返回错误

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>

请求：
NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval
  URL<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=be5e83dddc65db9b&amp;initcwndbps=1127500&amp;mt=1657589100&amp;ack=1&amp;cpn=j3M40XDCGhcG1Jgj&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
  cachePolicy<span class="token operator">=</span><span class="token number">0</span>
  timeoutInterval<span class="token operator">=</span><span class="token number">60.000000</span>

响应：
NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersion<span class="token operator">:</span>headerFields<span class="token operator">:</span>
  url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=be5e83dddc65db9b&amp;initcwndbps=1127500&amp;mt=1657589100&amp;ack=1&amp;cpn=j3M40XDCGhcG1Jgj&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
  statusCode<span class="token operator">=</span><span class="token number">200</span>
  HTTPVersion<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
  headerFields<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">&quot;alt-svc&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;h3=\&quot;:443\&quot;; ma=2592000,h3-29=\&quot;:443\&quot;; ma=2592000,h3-Q050=\&quot;:443\&quot;; ma=2592000,h3-Q046=\&quot;:443\&quot;; ma=2592000,h3-Q043=\&quot;:443\&quot;; ma=2592000,quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;46,43\&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cache-control&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;public, max-age=86400&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;client-protocol&quot;</span> <span class="token operator">=</span> quic<span class="token punctuation">;</span>
    <span class="token string">&quot;content-type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cross-origin-resource-policy&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cross-origin&quot;</span><span class="token punctuation">;</span>
    date <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 01:52:01 GMT&quot;</span><span class="token punctuation">;</span>
    expires <span class="token operator">=</span> <span class="token string">&quot;Wed, 13 Jul 2022 01:52:01 GMT&quot;</span><span class="token punctuation">;</span>
    server <span class="token operator">=</span> <span class="token string">&quot;gvs 1.0&quot;</span><span class="token punctuation">;</span>
    vary <span class="token operator">=</span> Origin<span class="token punctuation">;</span>
    <span class="token string">&quot;x-content-type-options&quot;</span> <span class="token operator">=</span> nosniff<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

但还是会报错：

NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  errDomain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
  code<span class="token operator">=</span><span class="token number">6000</span>
  userInfo<span class="token operator">=</span><span class="token punctuation">{</span>
    HAMErrorDetails <span class="token operator">=</span> <span class="token string">&quot;cronet=10|internal=-356|quic=85&quot;</span><span class="token punctuation">;</span>
    HAMErrorURLRequest <span class="token operator">=</span> &quot;<span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x282833ae0</span><span class="token operator">&gt;</span> 
      <span class="token punctuation">{</span>
        URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=be5e83dddc65db9b&amp;initcwndbps=1127500&amp;mt=1657589100&amp;ack=1&amp;cpn=j3M40XDCGhcG1Jgj&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
      <span class="token punctuation">}</span>&quot;<span class="token punctuation">;</span>
    HAMRequestNumberLoadTaskKey <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

以及：

NSError ml_mediaErrorWithCode<span class="token operator">:</span>underlyingError<span class="token operator">:</span>
  arg1<span class="token operator">=</span><span class="token number">708</span>
  underlyingError<span class="token operator">=</span>
    Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
    Code<span class="token operator">=</span><span class="token number">6000</span> <span class="token string">&quot;(null)&quot;</span>
    UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
      HAMErrorDetails<span class="token operator">=</span>cronet<span class="token operator">=</span><span class="token number">10</span><span class="token operator">|</span>internal<span class="token operator">=</span><span class="token operator">-</span><span class="token number">356</span><span class="token operator">|</span>quic<span class="token operator">=</span><span class="token number">85</span>
      HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">1</span>
      HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x282833ae0</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>
        URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=be5e83dddc65db9b&amp;initcwndbps=1127500&amp;mt=1657589100&amp;ack=1&amp;cpn=j3M40XDCGhcG1Jgj&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140 }} -&gt; mmewc=Error Domain=YTMediaError Code=708 &quot;(null)&quot; UserInfo={NSUnderlyingError=0x283bda940 {Error Domain=com.google.ios.hamplayer Code=6000 &quot;(null)&quot; UserInfo={HAMErrorDetails=cronet=10|internal=-356|quic=85, HAMRequestNumberLoadTaskKey=1, HAMErrorURLRequest=&lt;NSMutableURLRequest: 0x282833ae0&gt; { URL: https://rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=be5e83dddc65db9b&amp;initcwndbps=1127500&amp;mt=1657589100&amp;ack=1&amp;cpn=j3M40XDCGhcG1Jgj&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>

NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
  URL<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=38d955056e41c6f3&amp;initcwndbps=1195000&amp;mt=1657590782&amp;ack=1&amp;cpn=SKSZKIy7lZZ2pxor&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
  cachePolicy<span class="token operator">=</span><span class="token number">0</span>
  timeoutInterval<span class="token operator">=</span><span class="token number">60.000000</span>

响应：

NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersion<span class="token operator">:</span>headerFields<span class="token operator">:</span>
  url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=38d955056e41c6f3&amp;initcwndbps=1195000&amp;mt=1657590782&amp;ack=1&amp;cpn=SKSZKIy7lZZ2pxor&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
  statusCode<span class="token operator">=</span><span class="token number">200</span>
  HTTPVersion<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
  headerFields<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">&quot;alt-svc&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;h3=\&quot;:443\&quot;; ma=2592000,h3-29=\&quot;:443\&quot;; ma=2592000,h3-Q050=\&quot;:443\&quot;; ma=2592000,h3-Q046=\&quot;:443\&quot;; ma=2592000,h3-Q043=\&quot;:443\&quot;; ma=2592000,quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;46,43\&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cache-control&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;public, max-age=86400&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;client-protocol&quot;</span> <span class="token operator">=</span> quic<span class="token punctuation">;</span>
    <span class="token string">&quot;content-type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cross-origin-resource-policy&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cross-origin&quot;</span><span class="token punctuation">;</span>
    date <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 02:00:07 GMT&quot;</span><span class="token punctuation">;</span>
    expires <span class="token operator">=</span> <span class="token string">&quot;Wed, 13 Jul 2022 02:00:07 GMT&quot;</span><span class="token punctuation">;</span>
    server <span class="token operator">=</span> <span class="token string">&quot;gvs 1.0&quot;</span><span class="token punctuation">;</span>
    vary <span class="token operator">=</span> Origin<span class="token punctuation">;</span>
    <span class="token string">&quot;x-content-type-options&quot;</span> <span class="token operator">=</span> nosniff<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

也还是会报错：

NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  errDomain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
  code<span class="token operator">=</span><span class="token number">6000</span>
  userInfo<span class="token operator">=</span><span class="token punctuation">{</span>
    HAMErrorDetails <span class="token operator">=</span> <span class="token string">&quot;cronet=10|internal=-356|quic=85&quot;</span><span class="token punctuation">;</span>
    HAMErrorURLRequest <span class="token operator">=</span> &quot;<span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x2828fc1b0</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
       URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=38d955056e41c6f3&amp;initcwndbps=1195000&amp;mt=1657590782&amp;ack=1&amp;cpn=SKSZKIy7lZZ2pxor&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
    <span class="token punctuation">}</span>&quot;<span class="token punctuation">;</span>
    HAMRequestNumberLoadTaskKey <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

以及：

NSError HAMErrorWithCode<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  reqUrl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=38d955056e41c6f3&amp;initcwndbps=1195000&amp;mt=1657590782&amp;ack=1&amp;cpn=SKSZKIy7lZZ2pxor&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>

以及：

NSError ml_mediaErrorWithCode<span class="token operator">:</span>underlyingError<span class="token operator">:</span>
  arg1<span class="token operator">=</span><span class="token number">708</span>
  underlyingError<span class="token operator">=</span>
    Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
    Code<span class="token operator">=</span><span class="token number">6000</span> <span class="token string">&quot;(null)&quot;</span>
    UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
      HAMErrorDetails<span class="token operator">=</span>cronet<span class="token operator">=</span><span class="token number">10</span><span class="token operator">|</span>internal<span class="token operator">=</span><span class="token operator">-</span><span class="token number">356</span><span class="token operator">|</span>quic<span class="token operator">=</span><span class="token number">85</span>
      HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">1</span>
      HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x2828fc1b0</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpqe.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=38d955056e41c6f3&amp;initcwndbps=1195000&amp;mt=1657590782&amp;ack=1&amp;cpn=SKSZKIy7lZZ2pxor&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

【<span class="token number">2</span>】即使是 ctier<span class="token operator">=</span>L 的 videoplayback，在 前几次请求（rn<span class="token operator">=</span><span class="token number">1</span>、rn<span class="token operator">=</span><span class="token number">2</span>等）时，正常返回response，也会报错

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> rn<span class="token operator">=</span><span class="token number">1</span> 的 ctier<span class="token operator">=</span>L

NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
  URL<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=1</span>
  cachePolicy<span class="token operator">=</span><span class="token number">0</span>
  timeoutInterval<span class="token operator">=</span><span class="token number">60.000000</span> 

也还是会报错：

NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  reqUrl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=1</span>

以及：

NSError HAMErrorWithCode<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  reqUrl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=1</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> rn<span class="token operator">=</span><span class="token number">2</span> 的 ctier<span class="token operator">=</span>L

正常响应，但也报错：

NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersionLheaderFields<span class="token operator">:</span>
  url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=2</span>
  statusCode<span class="token operator">=</span><span class="token number">200</span>
  HTTPVersion<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
  headerFields<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">&quot;alt-svc&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;h3=\&quot;:443\&quot;; ma=2592000,h3-29=\&quot;:443\&quot;; ma=2592000,h3-Q050=\&quot;:443\&quot;; ma=2592000,h3-Q046=\&quot;:443\&quot;; ma=2592000,h3-Q043=\&quot;:443\&quot;; ma=2592000,quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;46,43\&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cache-control&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;private, max-age=21041&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;client-protocol&quot;</span> <span class="token operator">=</span> quic<span class="token punctuation">;</span>
    <span class="token string">&quot;content-type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cross-origin-resource-policy&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cross-origin&quot;</span><span class="token punctuation">;</span>
    date <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 02:14:24 GMT&quot;</span><span class="token punctuation">;</span>
    expires <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 02:14:24 GMT&quot;</span><span class="token punctuation">;</span>
    server <span class="token operator">=</span> <span class="token string">&quot;gvs 1.0&quot;</span><span class="token punctuation">;</span>
    vary <span class="token operator">=</span> Origin<span class="token punctuation">;</span>
    <span class="token string">&quot;x-content-type-options&quot;</span> <span class="token operator">=</span> nosniff<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

但也会报错：

NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>

【<span class="token number">3</span>】当 rn<span class="token operator">=</span><span class="token number">2</span> 或 rn<span class="token operator">=</span><span class="token number">3</span> 时的 ctier<span class="token operator">=</span>L 就正常了，不报错了，能正常返回数据了

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> rn<span class="token operator">=</span><span class="token number">3</span> 的 ctier<span class="token operator">=</span>L

NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
  URL<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=3</span>
  cachePolicy<span class="token operator">=</span><span class="token number">0</span>
  timeoutInterval<span class="token operator">=</span><span class="token number">60.000000</span>

响应：

NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersion<span class="token operator">:</span>headerFields<span class="token operator">:</span>
  url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657613405&amp;ei=_dfMYqC2IuGajQTGv7PYAw&amp;ip=162.253.45.206&amp;id=o-AIjeweHrLqp_Pz6Ozv20T5JprNQBR0HmN6o8txqvBehU&amp;source=youtube&amp;requiressl=yes&amp;mh=GE&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnlk&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=22&amp;ctier=L&amp;initcwndbps=1213750&amp;svpuc=1&amp;sabr=1&amp;mt=1657591502&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgVsPJepnUO4V9FcfXV3OqVZtNkVp5xDAw-jIIOVaPqpUCID1hXsWyAMG-_A41aRCm2HF5eqtfDTt5IJs_ATne2Jfz&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgTJgONnp0_iio87Dj5f9DciH8TzxX_zPCs1clwp4poqACIDPhiXjWBAuAs9GAhBSD11lyHobe7EfWyHSV4Eoixwhh&amp;cpn=aFN2DnMpoKgorDiB&amp;rn=3</span>
  statusCode<span class="token operator">=</span><span class="token number">200</span>
  HTTPVersion<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
  headerFields<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">&quot;alt-svc&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;h3=\&quot;:443\&quot;; ma=2592000,h3-29=\&quot;:443\&quot;; ma=2592000,h3-Q050=\&quot;:443\&quot;; ma=2592000,h3-Q046=\&quot;:443\&quot;; ma=2592000,h3-Q043=\&quot;:443\&quot;; ma=2592000,quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;46,43\&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cache-control&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;private, max-age=20802&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;client-protocol&quot;</span> <span class="token operator">=</span> quic<span class="token punctuation">;</span>
    <span class="token string">&quot;content-type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span><span class="token punctuation">;</span>
    <span class="token string">&quot;cross-origin-resource-policy&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cross-origin&quot;</span><span class="token punctuation">;</span>
    date <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 02:18:23 GMT&quot;</span><span class="token punctuation">;</span>
    expires <span class="token operator">=</span> <span class="token string">&quot;Tue, 12 Jul 2022 02:18:23 GMT&quot;</span><span class="token punctuation">;</span>
    server <span class="token operator">=</span> <span class="token string">&quot;gvs 1.0&quot;</span><span class="token punctuation">;</span>
    vary <span class="token operator">=</span> Origin<span class="token punctuation">;</span>
    <span class="token string">&quot;x-content-type-options&quot;</span> <span class="token operator">=</span> nosniff<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> rn<span class="token operator">=</span><span class="token number">2</span> 的 ctier<span class="token operator">=</span>L，且能正常返回视频数据chunks

MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveResponse<span class="token operator">:</span>
  arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x285a0bb70</span><span class="token operator">&gt;</span>
  didReceiveResponse<span class="token operator">=</span><span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x280dae440</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
      URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657615602&amp;ei=kuDMYrOaBpHDigT5y4LYDw&amp;ip=162.253.45.206&amp;id=o-AMkZiBzQ6p7kCJW94A6DtyMGG3HfqwKg1KnZ-fNzwp2U&amp;source=youtube&amp;requiressl=yes&amp;mh=Mk&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsknsk&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=22&amp;ctier=L&amp;initcwndbps=1266250&amp;svpuc=1&amp;sabr=1&amp;mt=1657593666&amp;fvip=4&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgAqEYZlR2jQz3cDKbLMWJKMhZa_JyTS1vtd_9O64WLDkCIQDfL32Gx3XA9C4XUvNdiiXvM8TQjClSjAv2N0B2bt-flw%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRgIhAJ8F9p0MlD7yBXsonsAKJ95tApty4njmPKzuAFqoM81WAiEAlFcqzn3LXLCxMMe_WxKUJOd4L9uLrZ7oP_BtbspIFBY%3D&amp;cpn=tuURUWDAKHN5FNX8&amp;rn=2</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">{</span>
      Status Code<span class="token operator">:</span> <span class="token number">200</span>
      Headers <span class="token punctuation">{</span>
        <span class="token string">&quot;Cache-Control&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;private, max-age=20896&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token string">&quot;Content-Type&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;application/vnd.yt-ump&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        Date <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;Tue, 12 Jul 2022 02:53:26 GMT&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        Expires <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;Tue, 12 Jul 2022 02:53:26 GMT&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        Server <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;gvs 1.0&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vary <span class="token operator">=</span>     <span class="token punctuation">(</span>
            Origin
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token string">&quot;alt-svc&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;h3=\&quot;:443\&quot;; ma=2592000,h3-29=\&quot;:443\&quot;; ma=2592000,h3-Q050=\&quot;:443\&quot;; ma=2592000,h3-Q046=\&quot;:443\&quot;; ma=2592000,h3-Q043=\&quot;:443\&quot;; ma=2592000,quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;46,43\&quot;&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token string">&quot;client-protocol&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            quic
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token string">&quot;cross-origin-resource-policy&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            <span class="token string">&quot;cross-origin&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token string">&quot;x-content-type-options&quot;</span> <span class="token operator">=</span>     <span class="token punctuation">(</span>
            nosniff
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span>
  arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x285a0bb70</span><span class="token operator">&gt;</span>
  didReceiveData<span class="token operator">=</span><span class="token punctuation">{</span>length <span class="token operator">=</span> <span class="token number">65536</span><span class="token punctuation">,</span> bytes <span class="token operator">=</span> <span class="token number">0x235908d0</span> fa0610d0 fa0618e0 d4033a4b <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">4286</span>a906 e50ad07b <span class="token punctuation">}</span>

不过后续此处 rn<span class="token operator">=</span><span class="token number">2</span> 的 ctier<span class="token operator">=</span>L 也报错了：

NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>
  https<span class="token operator">:</span><span class="token comment">//rr1---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1657615602&amp;ei=kuDMYrOaBpHDigT5y4LYDw&amp;ip=162.253.45.206&amp;id=o-AMkZiBzQ6p7kCJW94A6DtyMGG3HfqwKg1KnZ-fNzwp2U&amp;source=youtube&amp;requiressl=yes&amp;mh=Mk&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsknsk&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=22&amp;ctier=L&amp;initcwndbps=1266250&amp;svpuc=1&amp;sabr=1&amp;mt=1657593666&amp;fvip=4&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgAqEYZlR2jQz3cDKbLMWJKMhZa_JyTS1vtd_9O64WLDkCIQDfL32Gx3XA9C4XUvNdiiXvM8TQjClSjAv2N0B2bt-flw%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRgIhAJ8F9p0MlD7yBXsonsAKJ95tApty4njmPKzuAFqoM81WAiEAlFcqzn3LXLCxMMe_WxKUJOd4L9uLrZ7oP_BtbspIFBY%3D&amp;cpn=tuURUWDAKHN5FNX8&amp;rn=2</span>
</code></pre>
<h2 id="youtubecallsequence"><a name="youtubecallsequence" class="plugin-anchor" href="#youtubecallsequence"><i class="fa fa-link" aria-hidden="true"></i></a>youtubeCallSequence</h2>
<ul>
<li>内部多个函数的调用过程：最初是从播放时间变成0开始分析，慢慢找到的函数调用逻辑<ul>
<li>其中最核心的几个函数：<ul>
<li>请求request<ul>
<li><code>NSURLRequest requestWithURL:cachePolicy:timeoutInterval:</code></li>
<li><code>NSURLRequest initWithURL:cachePolicy:timeoutInterval:</code></li>
</ul>
</li>
<li>响应response<ul>
<li><code>NSHTTPURLResponse initWithURL:statusCode:HTTPVersion:headerFields:</code></li>
</ul>
</li>
<li>其他<ul>
<li>Cronet<ul>
<li><code>-[HAMCronetDataLoadTask startWithDelegate:delegateQueue:]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>全部内容详见：</p>
<p><code>youtubeCallSequence.coffee</code></p>
<pre class="language-"><code class="lang-c">最后更新<span class="token operator">:</span> <span class="token number">20220823</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

【第一个广告视频ID的产生来源：googlevideo<span class="token punctuation">.</span>com<span class="token operator">/</span>initplayback】

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

最早的 initplayback 的 <span class="token function">request</span> <span class="token punctuation">(</span>的 http body 的 data <span class="token punctuation">)</span>的来源：

YTPlaybackDataLoader onlinePromise
    YTPlaybackDataLoader createPlaybackRequest
        YTPlaybackRequestFactory playbackRequestForPlayerTransition<span class="token operator">:</span>visibility<span class="token operator">:</span>viewportSizeProvider<span class="token operator">:</span>mediaStickySettings<span class="token operator">:</span>prefetchContext<span class="token operator">:</span>
            YTPlaybackRequestFactory playbackRequestForNavigationEndpoint<span class="token operator">:</span>autoplay<span class="token operator">:</span>autonav<span class="token operator">:</span>flungFromMDX<span class="token operator">:</span>expiredForSeconds<span class="token operator">:</span>visibility<span class="token operator">:</span>viewportSizeProvider<span class="token operator">:</span>mediaStickySettings<span class="token operator">:</span>playerRequestDecorator<span class="token operator">:</span>prefetchContext<span class="token operator">:</span>latencyLogger<span class="token operator">:</span>watchEndpointLoggingContext<span class="token operator">:</span>
                YTPlaybackRequest initWithProtoRequest<span class="token operator">:</span>URLRequestProperties<span class="token operator">:</span>CPN<span class="token operator">:</span>QOEController<span class="token operator">:</span>latencyLogger<span class="token operator">:</span>
                    参数<span class="token operator">:</span>
                        URLRequestProperties<span class="token operator">=</span><span class="token punctuation">{</span>
                            MLOnesieRequestContext <span class="token operator">=</span> <span class="token string">&quot;&lt;MLOnesieRequestContext: 0x28240cd80&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword">inline</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                YTPlayerRequestFactory innerTubeRequestForPlayerWithVideoID<span class="token operator">:</span>playlistID<span class="token operator">:</span>playlistIndex<span class="token operator">:</span>playbackContext<span class="token operator">:</span>forOffline<span class="token operator">:</span>clickTrackingParams<span class="token operator">:</span>playerParams<span class="token operator">:</span>
                    参数<span class="token operator">:</span>
                        videoID<span class="token operator">=</span>DpJ7BL6RdFM
                        playlistID<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
                        playlistIndex<span class="token operator">=</span><span class="token number">0</span>
                        playbackContext<span class="token operator">=</span><span class="token operator">&lt;</span>YTIPlaybackContext <span class="token number">0x282fbc480</span><span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            content_playback_context <span class="token punctuation">{</span>
                                time_since_last_ad_seconds<span class="token operator">:</span> <span class="token number">0</span>
                                lact_milliseconds<span class="token operator">:</span> <span class="token number">1834558</span>
                                autoplays_since_last_ad<span class="token operator">:</span> <span class="token number">0</span>
                                conn<span class="token operator">:</span> <span class="token number">3</span>
                                vis<span class="token operator">:</span> <span class="token number">5</span>
                                fling<span class="token operator">:</span> false
                                autoplay<span class="token operator">:</span> true
                                adsense_client_params<span class="token operator">:</span> <span class="token string">&quot;video_format=22&amp;sdkv=i.17.08&amp;output=xml_vast2&quot;</span>
                                autonav<span class="token operator">:</span> true
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        forOffline<span class="token operator">=</span>False
                        clickTrackingParams<span class="token operator">=</span><span class="token punctuation">{</span>length <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">,</span> bytes <span class="token operator">=</span> <span class="token number">0x08001084</span> <span class="token number">67221308</span> <span class="token number">95</span>b584e3 <span class="token number">95</span>ddf902 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> d494091d <span class="token number">560607</span>d6 <span class="token punctuation">}</span>
                        playerParams<span class="token operator">=</span>CkkIDxAGQhd3LU1FWTViSkRJUE5vOWtQaU1tdHlBa4oDKSADKAIwBzgFShMI1raF45Xd<span class="token operator">-</span>QIVg<span class="token operator">-</span>YoBR2IZAuZUgYIBT<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>TElUWV0mZ3Y9W0dPT0dMRV9WSUVXQUJJTElUWV0Y0A8YAfAEAfgEAQ<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">3</span>D

                    返回值<span class="token operator">:</span>
                        <span class="token operator">&lt;</span>YTIPlayerRequest <span class="token number">0x2838233a0</span><span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            context <span class="token punctuation">{</span>
                                client <span class="token punctuation">{</span>
                                    hl<span class="token operator">:</span> <span class="token string">&quot;zh-CN&quot;</span>
                                    gl<span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span>
                                    device_make<span class="token operator">:</span> <span class="token string">&quot;Apple&quot;</span>
                                    device_model<span class="token operator">:</span> <span class="token string">&quot;iPhone9,1&quot;</span>
                                    client_name<span class="token operator">:</span> IOS
                                    client_version<span class="token operator">:</span> <span class="token string">&quot;17.08.2&quot;</span>
                                    os_name<span class="token operator">:</span> <span class="token string">&quot;iOS&quot;</span>
                                    os_version<span class="token operator">:</span> <span class="token string">&quot;13.3.1.17D50&quot;</span>
                                    raw_device_id<span class="token operator">:</span> <span class="token string">&quot;FC1C0EA4-13EB-4B2E-AB49-32609F28DC8B&quot;</span>
                                    screen_width_points<span class="token operator">:</span> <span class="token number">375</span>
                                    screen_height_points<span class="token operator">:</span> <span class="token number">667</span>
                                    screen_pixel_density<span class="token operator">:</span> <span class="token number">2</span>
                                    client_form_factor<span class="token operator">:</span> SMALL_FORM_FACTOR
                                    window_width_points<span class="token operator">:</span> <span class="token number">375</span>
                                    window_height_points<span class="token operator">:</span> <span class="token number">667</span>
                                    connection_type<span class="token operator">:</span> CONN_WIFI
                                    config_info <span class="token punctuation">{</span>
                                        cold_config_data<span class="token operator">:</span> <span class="token string">&quot;CMvakJgGENLcrQUQjPKtBRCl760FEMaFrQUQmNStBRCFta4FEKedrgUQgYauBRDXka0FEOK5rgUQx7GtBRCHqq4FEJOvrgUQhqGuBRCBxa0FEI6lrQUQkJmuBRCvs64FEOW4rgUQz4WuBRDxuq0FEIjprQUQj5SuBRDBvK4FEIy9rgUQxZquBRDtiq0FELytrgUQjZSuBRDqna0FEL22rgUQqM-oFxCcva4FEJyxrgUQy6KuBRD0x60FEIH4rQUQuIuuBRDUg64FEKmqrgUQnv2tBRCFka4FELTPqBcQibGuBRD3iK4FEOK8rgUQ0_GtBRDYvK4FEIG4rgUQpbCuBRCboK4FENm7rQUQ4a2uBRCX-60FEMWFrgUQt8utBRDrma0FEJaarQUQzeCtBRDr5K0FEPy6rgUQ6pesBRDX9a0FEO-3rgUaMkFDS0c1cG5XU0dZOFRhMFRnNkJ5VjlieWtLUGRUVmxQUkxCWHhkRktXclJ5XzVNNmxRIjJBQ0tHNXBuV1NHWThUYTBUZzZCeVY5YnlrS1BkVFZsUFJMQlh4ZEZLV3JSeV81TTZsUSoYQ0FNU0RBMERzTXlxQWhVRGdvdTVEQT09&quot;</span>
                                        cold_hash_data<span class="token operator">:</span> <span class="token string">&quot;CPnFk5gGEhQxMTU5NDYyMDIxMjM1NDQwNDMxOBjL2pCYBii0z6gXKOK8rgUoibGuBSj3iK4FKJugrgUogbiuBSilsK4FKNi8rgUo0_GtBSiB-K0FKMuirgUonLGuBSiFka4FKJ79rQUouIuuBSipqq4FKPTHrQUo1IOuBSj8uq4FKNf1rQUo77euBSjql6wFKJf7rQUo4a2uBSjZu60FKLfLrQUolpqtBSjr5K0FKMWFrgUo65mtBSjN4K0FKJOvrgUoh6quBSjXka0FKOK5rgUox7GtBSiOpa0FKK-zrgUokJmuBSiBxa0FKIahrgUo0tytBSinna4FKMaFrQUogYauBSil760FKIW1rgUojPKtBSjqna0FKI2UrgUovK2uBSi9tq4FKJjUrQUoxZquBSjtiq0FKKjPqBconL2uBSjxuq0FKIjprQUoj5SuBSjluK4FKIy9rgUoz4WuBSjBvK4FMjJBQ0tHNXBuV1NHWThUYTBUZzZCeVY5YnlrS1BkVFZsUFJMQlh4ZEZLV3JSeV81TTZsUToyQUNLRzVwbldTR1k4VGEwVGc2QnlWOWJ5a0tQZFRWbFBSTEJYeGRGS1dyUnlfNU02bFFCGENBTVNEQTBEc015cUFoVURnb3U1REE9PQ%3D%3D&quot;</span>
                                        hot_hash_data<span class="token operator">:</span> <span class="token string">&quot;CPnFk5gGEhQxNjEzNDg0MTcwMTQ4MTYyODk3Nxj5xZOYBijJ-f0SKPne_RIo1P_9EiiRvv0SKIPt_RIoy639Eijc4P0SKOK__RIo0979Eii7_v0SKILG_RIopdD9Eijizv0SKNLL_RIopqr9EiiFrP0SKKXv_RIonv_8EijI8f0SKL3K_RIope39EijU-f0SKIrg_RIo4az9EiibzP0SKNfM_RIomcb9EiiLqP0SKM7A_RIolOT8EiifgP4SKLn1_BIo89_9EijC_v0SKMvs_RIoytj9EiikxP0SKNGf_RIoyvD9EiiZ-f0SKML2_RIovL79EijGsv0SKNCy_RIo3JP9EiiqtP0SKOO4_RIo4Oz9Eiir1v0SKOPJ_RIo-Pn9EiiBgv0SKKbw_RIoqar9Eii93v0SKMTs_RIyMkFDS0c1cG5XU0dZOFRhMFRnNkJ5VjlieWtLUGRUVmxQUkxCWHhkRktXclJ5XzVNNmxROjJBQ0tHNXBuV1NHWThUYTBUZzZCeVY5YnlrS1BkVFZsUFJMQlh4ZEZLV3JSeV81TTZsUUIcQ0FNU0VRMEJvdGY2RlpzcEZRRGR6OElNbk13RQ%3D%3D&quot;</span>
                                    <span class="token punctuation">}</span>
                                    screen_density_float<span class="token operator">:</span> <span class="token number">2</span>
                                    utc_offset_minutes<span class="token operator">:</span> <span class="token number">480</span>
                                    user_interface_theme<span class="token operator">:</span> USER_INTERFACE_THEME_DARK
                                    time_zone<span class="token operator">:</span> <span class="token string">&quot;Asia/Shanghai&quot;</span>
                                    eml_template_context<span class="token operator">:</span> <span class="token string">&quot; \313\334\314\373\331\206\352\310\001 \206\327\321\205\205\213\346\323\361\001 \212\221\203\351\370\266\265\3168 \270\361\327\226\250\315\324\301) \221\307\376\333\240\306\304\357\370\001 \204\255\254\350\361\275\307\370\203\001 \365\360\247\340\223\316\264\322\016 \263\301\327\347\206\371\271\266. \320\301\200\233\321\362\214\245\027 \220\364\314\240\332\360\264\300\314\001 \270\365\242\255\321\241\372\326y \360\322\224\360\247\344\261\322\033 \310\335\301\224\261\262\275\372&gt; \346\261\374\316\345\221\323\350\321\001 \217\375\340\345\313\225\361\264% \206\370\205\214\332\344\367\272\247\001 \343\237\335\242\271\344\250\261\023 \333\236\251\262\323\323\306\322\200\001 \201\311\332\214\371\363\217\252\267\001 \223\240\255\221\227\300\300\301\267\001 \332\271\246\252\206\257\225\273~ \214\327\321\232\303\213\204\363\251\001 \250\321\220\302\333\240\347\222\327\001 \307\306\342\230\345\316\241\330~ \233\311\261\225\335\357\225\226\030 \214\222\262\254\377\315\326\267\365\001 \207\251\305\212\325\337\205\206\345\001 \252\207\217\352\236\264\232\265r&quot;</span>
                                    memory_total_kbytes<span class="token operator">:</span> <span class="token number">2099249</span>
                                    notification_permission_info <span class="token punctuation">{</span>
                                        notifications_setting<span class="token operator">:</span> NOTIFICATIONS_SETTING_ENABLED
                                        last_device_opt_in_change_time_ago_sec<span class="token operator">:</span> <span class="token number">5707596</span>
                                    <span class="token punctuation">}</span>
                                    client_store_info <span class="token punctuation">{</span>
                                        ios_store_country<span class="token operator">:</span> <span class="token string">&quot;CHN&quot;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                                user <span class="token punctuation">{</span>
                                <span class="token punctuation">}</span>
                                request <span class="token punctuation">{</span>
                                <span class="token punctuation">}</span>
                                click_tracking <span class="token punctuation">{</span>
                                    click_tracking_params<span class="token operator">:</span> <span class="token string">&quot;\010\000\020\204g\&quot;\023\010\225\265\204\343\225\335\371\002\025=\324\224\t\035V\006\007\326&quot;</span>
                                <span class="token punctuation">}</span>
                                ad_signals_info <span class="token punctuation">{</span>
                                    params <span class="token punctuation">{</span>
                                        key<span class="token operator">:</span> <span class="token string">&quot;ms&quot;</span>
                                        value<span class="token operator">:</span> <span class="token string">&quot;zNCgkMGJRpQCc6aMdpeOGv6ez_sOHNtGlWj7lg6EjWr7O7ZqIEwzYOOSsfzRnPhx3kY3I33makVsgrtFOzKammmPQqrf9Jq_eK18MyBdl-obQx_U8oanWw-_NlQf7l191piuk2G3xzWMnXXln426o9M5jcbqwVPf5Nf8opchuOQBNPYwEbDXj6uTpkZl47lPLlO0BZpF5xWpjI14zuD3co0YMnBQHEcZv3AKQlp0UEksZdiohp69QkO1ZoUPZrZrjty7kzuy6swSY7C5Baex2ZA11fj7Qkd_oxnqRxRlsMQuxaBF5CjfVUE5DMAQyxDg3aC3iCqE83h7TJTnSRhOIQ&quot;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                            video_id<span class="token operator">:</span> <span class="token string">&quot;DpJ7BL6RdFM&quot;</span>
                            playback_context <span class="token punctuation">{</span>
                                content_playback_context <span class="token punctuation">{</span>
                                    time_since_last_ad_seconds<span class="token operator">:</span> <span class="token number">0</span>
                                    lact_milliseconds<span class="token operator">:</span> <span class="token number">1834558</span>
                                    autoplays_since_last_ad<span class="token operator">:</span> <span class="token number">0</span>
                                    conn<span class="token operator">:</span> <span class="token number">3</span>
                                    vis<span class="token operator">:</span> <span class="token number">5</span>
                                    fling<span class="token operator">:</span> false
                                    autoplay<span class="token operator">:</span> true
                                    adsense_client_params<span class="token operator">:</span> <span class="token string">&quot;video_format=22&amp;sdkv=i.17.08&amp;output=xml_vast2&quot;</span>
                                    autonav<span class="token operator">:</span> true
                                    mdx_context <span class="token punctuation">{</span> mdx_context <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                            racy_check_ok<span class="token operator">:</span> false
                            for_offline<span class="token operator">:</span> false
                            params<span class="token operator">:</span> <span class="token string">&quot;CkkIDxAGQhd3LU1FWTViSkRJUE5vOWtQaU1tdHlBa4oDKSADKAIwBzgFShMI1raF45Xd-QIVg-YoBR2IZAuZUgYIBTABWAFoAXAJEpkaEpYaCAESkRoSDXByb21vdGVkVmlkZW9K_xkIARL6GSKpCwgTEp0LaHR0cHM6Ly93d3cuZ29vZ2xl ... ... tDTElDS19NU10mYWRfbXQ9W0FEX01UXSZhY3Z3PVtWSUVXQUJJTElUWV0mZ3Y9W0dPT0dMRV9WSUVXQUJJTElUWV0Y0A8YAfAEAfgEAQ%3D%3D&quot;</span>
                            cpn<span class="token operator">:</span> <span class="token string">&quot;Fmq_1vPSmpZkjLS0&quot;</span>
                            override_muted_at_start<span class="token operator">:</span> false
                            caption_params <span class="token punctuation">{</span>
                                device_captions_on<span class="token operator">:</span> false
                            <span class="token punctuation">}</span>
                            video_quality_setting_params <span class="token punctuation">{</span>
                                video_quality_setting_mobile_network<span class="token operator">:</span> VIDEO_QUALITY_SETTING_UNKNOWN
                                video_quality_setting_wifi<span class="token operator">:</span> VIDEO_QUALITY_SETTING_UNKNOWN
                                video_quality_last_written_ms<span class="token operator">:</span> <span class="token number">0</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>

                    YTIPlayerRequest init
                        GPBMessage


注：

GPBMessage <span class="token operator">~</span><span class="token operator">=</span> General Protocol Buffer Message


<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

调用 HAMDataLoadRequest 时 传入了 POST的application<span class="token operator">/</span>x<span class="token operator">-</span>protobuf的NSData：

Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTTimedAction startTimerWithFireDate<span class="token operator">:</span>timeInterval<span class="token operator">:</span>repeats<span class="token operator">:</span>runLoopMode<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">40</span>
    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTTimedAction triggerAction<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">124</span>
        YouTube`<span class="token operator">-</span><span class="token punctuation">[</span>YTInlineMutedPlaybackContainerController startPlaybackImmediately<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">324</span>
            YouTube`<span class="token operator">-</span><span class="token punctuation">[</span>YTInlineMutedPlaybackWatchController loadVideoAndAttachView<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">256</span>
                Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTPlayerViewController prepareToLoadWithPlayerTransition<span class="token operator">:</span>expectedLayout<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">276</span>
                    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTLocalPlaybackController prepareToLoadWithPlayerTransition<span class="token operator">:</span>expectedLayout<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">556</span>
                        Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTPlaybackDataLoader startLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1060</span>
                            Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTPlaybackDataLoader onlinePromise<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">332</span>
                                Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTPlayerService makePlaybackRequest<span class="token operator">:</span>responseBlock<span class="token operator">:</span>errorBlock<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">524</span>
                                    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTPlayerServiceTask sendRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">248</span>
                                        Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTInnerTubeRequestor makeInnerTubeRequest<span class="token operator">:</span>withParser<span class="token operator">:</span>completionBlock<span class="token operator">:</span>retryEnabled<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>enableLatencyTicks<span class="token operator">:</span>mutableSharedData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">28</span>
                                            Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTInnerTubeRequestor makeInnerTubeRequest<span class="token operator">:</span>withParser<span class="token operator">:</span>completionBlock<span class="token operator">:</span>retryEnabled<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>enableLatencyTicks<span class="token operator">:</span>mutableSharedData<span class="token operator">:</span>nilIdentityIsSignedOut<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">36</span>
                                                Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTBaseInnerTubeService makePOSTRequest<span class="token operator">:</span>withParser<span class="token operator">:</span>completionBlock<span class="token operator">:</span>retryEnabled<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>enableLatencyTicks<span class="token operator">:</span>mutableSharedData<span class="token operator">:</span>nilIdentityIsSignedOut<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">540</span>
                                                    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTBaseInnerTubeService performHTTPRequest<span class="token operator">:</span>service<span class="token operator">:</span>withIdentity<span class="token operator">:</span>dataBlock<span class="token operator">:</span>errorBlock<span class="token operator">:</span>retryEnabled<span class="token operator">:</span>nilIdentityIsSignedOut<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">628</span>
                                                        Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTVisitorDataRequestDecorator decorateRequest<span class="token operator">:</span>withCompletionBlock<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">260</span>
                                                            sub_186AB30 <span class="token operator">=</span> Module_Framework`___lldb_unnamed_symbol14785$$Module_Framework <span class="token operator">+</span> <span class="token number">608</span>
                                                                Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTBaseNetworkService performHTTPRequest<span class="token operator">:</span>withAuthorizer<span class="token operator">:</span>responseBlock<span class="token operator">:</span>errorBlock<span class="token operator">:</span>retryConfig<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">184</span>
                                                                    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>YTBaseNetworkService performHTTPRequest<span class="token operator">:</span>withAuthorizer<span class="token operator">:</span>backgroundCompletionBlock<span class="token operator">:</span>retryConfig<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">928</span>
                                                                        Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieUMPFetcherTask resume<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">208</span>
                                                                            Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieRequestFactory onesieRequestForPlayerRequest<span class="token operator">:</span>authorization<span class="token operator">:</span>dataLoader<span class="token operator">:</span>context<span class="token operator">:</span>cryptor<span class="token operator">:</span>requestNumber<span class="token operator">:</span>completionHandler<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">432</span>
                                                                                Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieRequestFactory onesieRequestForPlayerRequest<span class="token operator">:</span>authorization<span class="token operator">:</span>dataLoader<span class="token operator">:</span>context<span class="token operator">:</span>cryptor<span class="token operator">:</span>requestNumber<span class="token operator">:</span>completionHandler<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">64</span>
                                                                                    Module_Framework`<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieRequestFactory onesieRequestForPlayerRequest<span class="token operator">:</span>dataLoader<span class="token operator">:</span>context<span class="token operator">:</span>cryptor<span class="token operator">:</span>requestNumber<span class="token operator">:</span>error<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">5628</span>
                                                                                        参数<span class="token operator">:</span>
                                                                                            request<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x282e83150</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                                                                URL<span class="token operator">:</span> <span class="token string">&quot;https://youtubei.googleapis.com/youtubei/v1/player?key=AIzaSyB-63vPrdThhKuerbB2N_l7Kwwcxj6yUAc&amp;id=r17kWuxKXKs&amp;t=DA5C7286-F10C-4EBC-942E-96B8CA551C57&quot;</span>
                                                                                            <span class="token punctuation">}</span>
                                                                                            dataLoader<span class="token operator">=</span><span class="token operator">&lt;</span>HAMCronetDataLoader<span class="token operator">:</span> <span class="token number">0x283c621f0</span><span class="token operator">&gt;</span>
                                                                                            context<span class="token operator">=</span><span class="token operator">&lt;</span>MLOnesieRequestContext<span class="token operator">:</span> <span class="token number">0x2809ae3a0</span><span class="token operator">&gt;</span>
                                                                                            cryptor<span class="token operator">=</span><span class="token operator">&lt;</span>MLOnesiePlayerServiceCryptor<span class="token operator">:</span> <span class="token number">0x283c68930</span><span class="token operator">&gt;</span>
                                                                                            requestNumber<span class="token operator">=</span><span class="token number">1</span>
                                                                                            error<span class="token operator">=</span><span class="token number">0x16d760c08</span>

                                                                                        HAMDataLoadRequest initWithRangedURL<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>HTTPMethod<span class="token operator">:</span>HTTPContentType<span class="token operator">:</span>HTTPBody<span class="token operator">:</span>idempotent<span class="token operator">:</span>
                                                                                            参数<span class="token operator">:</span>
                                                                                                rangeUrl<span class="token operator">=</span><span class="token operator">&lt;</span>HAMRangedURL<span class="token operator">:</span> <span class="token number">0x281963320</span><span class="token operator">&gt;</span>
                                                                                                    URL <span class="token operator">=</span> <span class="token string">&quot;https://rr1---sn-hp57kndr.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;rbqsm=fr&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=fd97bcf151a359c8&amp;initcwndbps=1645000&amp;mt=1661156982&amp;pxtags=Cg4KAnR4EggyNDE5NzI3NQ&amp;rxtags=Cg4KAnR4EggyNDE5NzI3NQ,Cg4KAnR4EggyNDE5NzI3Ng,Cg4KAnR4EggyNDE5NzI3Nw&amp;ack=1&amp;cpn=AuykYLjoeyBPVKWO&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140&quot;</span>
                                                                                                timeoutInterval<span class="token operator">=</span><span class="token number">60</span>
                                                                                                HTTPMethod<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span>
                                                                                                HTTPContentType<span class="token operator">=</span><span class="token string">&quot;application/x-protobuf&quot;</span>
                                                                                                HTTPBody<span class="token operator">=</span><span class="token number">7647</span> bytes
                                                                                                idempotent<span class="token operator">=</span>true

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

googlevideo<span class="token punctuation">.</span>com<span class="token operator">/</span>initplayback 的调用顺序：

<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">]</span>

MLOnesieUMPFetcherTask onRequestFactoryCompletionWithRequest<span class="token operator">:</span>error<span class="token operator">:</span>
    参数<span class="token operator">:</span>
        request<span class="token operator">=</span><span class="token operator">&lt;</span>HAMDataLoadRequest<span class="token operator">:</span> <span class="token number">0x282027040</span><span class="token operator">&gt;</span>
            <span class="token function">_idempotent</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span><span class="token operator">:</span> YES
            <span class="token function">_rangedURL</span> <span class="token punctuation">(</span>HAMRangedURL<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">&lt;</span>HAMRangedURL<span class="token operator">:</span> <span class="token number">0x283831120</span><span class="token operator">&gt;</span>
            <span class="token function">_timeoutInterval</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">60</span>
            <span class="token function">_HTTPMethod</span> <span class="token punctuation">(</span>NSString<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> @<span class="token string">&quot;POST&quot;</span>
            <span class="token function">_HTTPContentType</span> <span class="token punctuation">(</span>NSString<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> @<span class="token string">&quot;application/x-protobuf&quot;</span>
            <span class="token function">_HTTPBody</span> <span class="token punctuation">(</span>NSData<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">&lt;</span>NSConcreteData<span class="token operator">:</span> <span class="token number">0x283831140</span><span class="token operator">&gt;</span>
        error<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>

    startRequestTask_104238C <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieUMPFetcherTask onRequestFactoryCompletionWithRequest<span class="token operator">:</span>error<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">64</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                    参数<span class="token operator">:</span>
                        URL<span class="token operator">=</span><span class="token string">&quot;https://rr5---sn-p5qddn76.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;rbqsm=fr&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=a52feece777301a2&amp;initcwndbps=1786250&amp;mt=1660899670&amp;pxtags=Cg4KAnR4EggyNDE5NzI3NQ&amp;rxtags=Cg4KAnR4EggyNDE5NzI3NQ,Cg4KAnR4EggyNDE5NzI3Ng,Cg4KAnR4EggyNDE5NzI3Nw&amp;ack=1&amp;cpn=Bu494mABvg3R6sCr&amp;rn=1&amp;opr=1&amp;pvi=160,133,134,135,136,137,298,299,264&amp;pai=139,140&quot;</span>
                        cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                        timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">]</span>

callPrewarmConnection_10470B8
    startTask_1048AA0 <span class="token operator">=</span> ___lldb_unnamed_symbol12576$$Module_Framework <span class="token operator">+</span> <span class="token number">72</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">380</span>
                NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                    参数<span class="token operator">:</span>
                        URL<span class="token operator">=</span><span class="token string">&quot;https://rr2---sn-p5qs7nsr.googlevideo.com/initplayback?source=youtube&amp;orc=1&amp;oeis=1&amp;c=IOS&amp;oss=1&amp;oda=1&amp;oad=5500&amp;ovd=5500&amp;oaad=11000&amp;oavd=11000&amp;ocs=700&amp;oputc=1&amp;oses=1&amp;ofpcc=1&amp;osbr=1&amp;osnz=1&amp;rbqsm=fr&amp;msp=1&amp;odeak=1&amp;odepv=1&amp;osfc=1&amp;id=8bfb111f4c684ce5&amp;initcwndbps=1683750&amp;mt=1660916238&amp;pxtags=Cg4KAnR4EggyNDE5NzI3NQ&amp;rxtags=Cg4KAnR4EggyNDE5NzI3NQ,Cg4KAnR4EggyNDE5NzI3Ng,Cg4KAnR4EggyNDE5NzI3Nw&amp;cpn=YCXS_oBo1TcIotC0&amp;pai=0&amp;pvi=0&amp;owc=1&quot;</span>
                        cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                        timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span> 的后续response的data的parse解析过程

当 禁用广告过滤 正常加载广告时的流程：

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> MLServerABRLoader <span class="token operator">-&gt;</span> HAMMP4InitializationChunk

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">292</span>
        MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span>
            serverABRUMPParserParseResponseData_FE2F90 <span class="token operator">=</span> ___lldb_unnamed_symbol12192$$Module_Framework <span class="token operator">+</span> <span class="token number">136</span>
                parserParseData_32CAA84 <span class="token operator">=</span> ___lldb_unnamed_symbol84370$$Module_Framework <span class="token operator">+</span> <span class="token number">160</span>
                    extractMediaHeaderBytes_32CAC60
                    callParseData_32CAE80 <span class="token operator">=</span> ___lldb_unnamed_symbol84372$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span>
                        sub_FE4C80 <span class="token operator">=</span> ___lldb_unnamed_symbol12224$$Module_Framework
                            BaseUMPParser_parseData_FE37D4 <span class="token operator">=</span> ___lldb_unnamed_symbol12209$$Module_Framework <span class="token operator">+</span> <span class="token number">172</span>
                                citer 的 videoplayback
                                    <span class="token keyword">for</span> youtube<span class="token operator">::</span>media<span class="token operator">::</span>ServerABRUMPParser <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">=</span><span class="token operator">&gt;</span> checkMediaHeaderUmpBadPartid_107DD4C <span class="token operator">=</span> ___lldb_unnamed_symbol12801$$Module_Framework
                                        MLQOEError QOEErrorWithCode<span class="token operator">:</span>details<span class="token operator">:</span>
                                            参数：
                                                code<span class="token operator">=</span>ump<span class="token punctuation">.</span>badpartid
                                                details<span class="token operator">=</span><span class="token punctuation">{</span> partid <span class="token operator">=</span> <span class="token number">0xA</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

                                其他情况，比如<span class="token operator">:</span> 正常流程 或  oad 的 initplayback
                                    <span class="token keyword">for</span> youtube<span class="token operator">::</span>media<span class="token operator">::</span>OnesieUMPParser <span class="token operator">+</span> <span class="token number">504</span> <span class="token operator">=</span><span class="token operator">&gt;</span> checkMediaHeaderUmpBadPartid_1046494 <span class="token operator">=</span> ___lldb_unnamed_symbol12555$$Module_Framework
                                        toCallProcessMediaHeader_FE2EB0 <span class="token operator">=</span> ___lldb_unnamed_symbol12191$$Module_Framework <span class="token operator">+</span> <span class="token number">108</span>
                                            validateMediaHeader_FE72BC <span class="token operator">=</span> ___lldb_unnamed_symbol12318$$Module_Framework <span class="token operator">+</span> <span class="token number">144</span>
                                                parseAndSaveChunk_107D850 <span class="token operator">=</span> ___lldb_unnamed_symbol12797$$Module_Framework <span class="token operator">+</span> <span class="token number">64</span>
                                                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader chunkForMediaHeader<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">324</span>
                                                        <span class="token operator">-</span><span class="token punctuation">[</span>MLMP4ChunkFactory initializationChunkWithURL<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">72</span>
                                                            HAMMP4InitializationChunk initWithFormat<span class="token operator">:</span>rangedURL<span class="token operator">:</span>preferTrackTimescale<span class="token operator">:</span>
                                                                参数： <span class="token keyword">case</span> <span class="token number">1</span>
                                                                    arg1<span class="token operator">=</span><span class="token number">0x0000000282ca6b80</span>
                                                                    arg2<span class="token operator">=</span><span class="token number">0x000000028116c800</span>
                                                                    arg3<span class="token operator">=</span><span class="token function">false</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> MLOnesieUMPFetcherTask <span class="token operator">-&gt;</span> HAMMP4InitializationChunk

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieUMPFetcherTask dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">196</span>
        ___lldb_unnamed_symbol12192$$Module_Framework <span class="token operator">+</span> <span class="token number">136</span>
            ___lldb_unnamed_symbol84370$$Module_Framework <span class="token operator">+</span> <span class="token number">160</span>
                ___lldb_unnamed_symbol84372$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span>
                    ___lldb_unnamed_symbol12209$$Module_Framework <span class="token operator">+</span> <span class="token number">312</span>
                        sub_1045904 <span class="token operator">=</span> ___lldb_unnamed_symbol12549$$Module_Framework <span class="token operator">+</span> <span class="token number">168</span>
                            ___lldb_unnamed_symbol12191$$Module_Framework <span class="token operator">+</span> <span class="token number">108</span>
                                processOnesieMediaHeader_10482D8 <span class="token operator">=</span> ___lldb_unnamed_symbol12575$$Module_Framework <span class="token operator">+</span> <span class="token number">1120</span>
                                    <span class="token operator">-</span><span class="token punctuation">[</span>MLMP4ChunkFactory initializationChunkWithURL<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">72</span>
                                        HAMMP4InitializationChunk initWithFormat<span class="token operator">:</span>rangedURL<span class="token operator">:</span>preferTrackTimescale<span class="token operator">:</span>

<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> MLServerABRDataLoadTask <span class="token operator">-&gt;</span> HAMChunk

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">292</span>
        ___lldb_unnamed_symbol12192$$Module_Framework <span class="token operator">+</span> <span class="token number">136</span>
            ___lldb_unnamed_symbol84370$$Module_Framework <span class="token operator">+</span> <span class="token number">160</span>
                ___lldb_unnamed_symbol84372$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span>
                    ___lldb_unnamed_symbol12209$$Module_Framework <span class="token operator">+</span> <span class="token number">336</span>
                        sub_107DAB0 <span class="token operator">=</span> ___lldb_unnamed_symbol12800$$Module_Framework <span class="token operator">+</span> <span class="token number">232</span>
                            HAMChunk loadDidCompleteWithError<span class="token operator">:</span>

<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> MLOnesieChunkLoadTask <span class="token operator">-&gt;</span> HAMChunk

<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieChunkLoadTask initWithRange<span class="token operator">:</span>chunks<span class="token operator">:</span>dataBuffer<span class="token operator">:</span>cache<span class="token operator">:</span>delegate<span class="token operator">:</span>queue<span class="token operator">:</span>latencyLogger<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">100</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseChunkLoadTask didReceiveData<span class="token operator">:</span>error<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">656</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseChunkLoadTask currentChunkDidComplete<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">256</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMMediaChunk loadDidCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">48</span>
                HAMChunk loadDidCompleteWithError<span class="token operator">:</span>

<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> MLServerABRLoader recordInvalidFormatQOEErrorWithFormatID<span class="token operator">:</span>extraDetails<span class="token operator">:</span>

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didReceiveData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">292</span>
        ___lldb_unnamed_symbol12192$$Module_Framework <span class="token operator">+</span> <span class="token number">136</span>
            ___lldb_unnamed_symbol84370$$Module_Framework <span class="token operator">+</span> <span class="token number">160</span>
                ___lldb_unnamed_symbol84372$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span>
                    ___lldb_unnamed_symbol12209$$Module_Framework <span class="token operator">+</span> <span class="token number">624</span>
                        chekAndCallProcessMediaHeader_FE43F4 <span class="token operator">=</span> ___lldb_unnamed_symbol12214$$Module_Framework <span class="token operator">+</span> <span class="token number">276</span>
                            ___lldb_unnamed_symbol12191$$Module_Framework <span class="token operator">+</span> <span class="token number">108</span>
                                <span class="token keyword">void</span> youtube<span class="token operator">::</span>media<span class="token operator">::</span>BaseUMPParser<span class="token operator">::</span>AccumulateDataAndParseProto<span class="token operator">&lt;</span>video_streaming<span class="token operator">::</span>FormatInitializationMetadata<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span> absl<span class="token operator">::</span>string_view<span class="token punctuation">,</span> video_streaming<span class="token operator">::</span>UMPPartID<span class="token punctuation">,</span> std<span class="token operator">::</span>__1<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token punctuation">(</span>video_streaming<span class="token operator">::</span>FormatInitializationMetadata<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token char">&apos;lambda&apos;</span><span class="token punctuation">(</span>absl<span class="token operator">::</span>string_view<span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>absl<span class="token operator">::</span>string_view<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">+</span> <span class="token number">436</span>
                                    sub_FE61AC <span class="token operator">=</span> ___lldb_unnamed_symbol12275$$Module_Framework <span class="token operator">+</span> <span class="token number">160</span>
                                        callDidParseFormatInitializationMetadata_107E5FC <span class="token operator">=</span> ___lldb_unnamed_symbol12805$$Module_Framework <span class="token operator">+</span> <span class="token number">44</span>
                                            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader didParseFormatInitializationMetadata<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">268</span>
                                                MLServerABRLoader recordInvalidFormatQOEErrorWithFormatID<span class="token operator">:</span>extraDetails<span class="token operator">:</span>
                                                    参数<span class="token operator">:</span>
                                                        formatID<span class="token operator">=</span><span class="token string">&quot;140_1629449114196897&quot;</span>
                                                        extraDetails<span class="token operator">=</span><span class="token string">&quot;init_metadata_badid&quot;</span>



相关函数<span class="token operator">:</span>

<span class="token punctuation">[</span>callParseData_32CAE80<span class="token punctuation">]</span>
核心代码逻辑：
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>curServerABRUMPParserOffset0x20Value <span class="token operator">+</span> <span class="token number">0x30LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// </span>
                                                <span class="token comment">// call: sub_FE4C80 = ___lldb_unnamed_symbol12224:</span>
                                                <span class="token comment">//   x0 = curServerABRUMPParserOffset0x20Value</span>
                                                <span class="token comment">//   x1 = curServerABRUMPParserOffset0x40Ptr</span>
                                                <span class="token comment">//   x2 = remainBufferSizePtr</span>
                                                <span class="token comment">//   x3 = mediaHeaderBytesPtr</span>

<span class="token punctuation">[</span>sub_FE4C80<span class="token punctuation">]</span>
核心逻辑：
  <span class="token keyword">return</span> <span class="token function">BaseUMPParser_parseData_FE37D4</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token operator">*</span>a3<span class="token punctuation">,</span> <span class="token operator">*</span>a4<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>BaseUMPParser_parseData_FE37D4<span class="token punctuation">]</span>
核心逻辑：
    result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">__int64</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>result <span class="token operator">+</span> <span class="token number">0x70LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 实际调试 = 出错流程？: checkMediaHeaderUmpBadPartid_107DD4C</span>

<span class="token punctuation">[</span>chekAndCallProcessMediaHeader_FE43F4<span class="token punctuation">]</span>
核心逻辑：
    <span class="token function">toCallProcessMediaHeader_FE2EB0</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>v21<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>toCallProcessMediaHeader_FE2EB0<span class="token punctuation">]</span>
核心逻辑：
    result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">__int64</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v9 <span class="token operator">+</span> <span class="token number">0x30LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// for MLServerABRDataLoadTask(MLServerABRLoader) is: validateMediaHeader_FE72BC</span>
    <span class="token comment">// for MLOnesieUMPFetcherTask is: processOnesieMediaHeader_10482D8</span>

<span class="token punctuation">[</span>validateMediaHeader_FE72BC<span class="token punctuation">]</span>
核心逻辑：
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span>__fastcall <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__int64<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v2 <span class="token operator">+</span> <span class="token number">32LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v10<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// = parseAndSaveChunk_107D850</span>

<span class="token punctuation">[</span>parseAndSaveChunk_107D850<span class="token punctuation">]</span>
核心逻辑：
  v7 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">objc_object</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLServerABRLoader_<span class="token punctuation">,</span> <span class="token string">&quot;chunkForMediaHeader:&quot;</span><span class="token punctuation">,</span> mediaHeader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>youtube<span class="token operator">::</span>media<span class="token operator">::</span>BaseUMPParser<span class="token operator">::</span>AccumulateDataAndParseProto<span class="token operator">&lt;</span>video_streaming<span class="token operator">::</span>FormatInitializationMetadata<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span>absl<span class="token operator">::</span>string_view<span class="token punctuation">,</span>video_streaming<span class="token operator">::</span>UMPPartID<span class="token punctuation">,</span>std<span class="token operator">::</span>__1<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>video_streaming<span class="token operator">::</span>FormatInitializationMetadata<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token punctuation">{</span><span class="token function">lambda</span><span class="token punctuation">(</span>absl<span class="token operator">::</span>string_view<span class="token punctuation">)</span><span class="token punctuation">]</span>
核心逻辑：
  <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v20 <span class="token operator">+</span> <span class="token number">0x30LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sub_FE61AC</span>

<span class="token punctuation">[</span>sub_FE61AC<span class="token punctuation">]</span>
核心逻辑：
  <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v3 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x50LL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// callDidParseFormatInitializationMetadata_107E5FC</span>


<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

ctier 重发请求 死循环的调用逻辑：

<span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span>
    shouldSendRequest<span class="token operator">==</span>True<span class="token operator">:</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader createDataLoadTaskForRequest<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">128</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader dataLoadTaskForHTTPBody<span class="token operator">:</span>isPrimaryHostProbing<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                        NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>

        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">88</span>
            HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span>
                Cronet_UrlRequestCallback_OnResponseStarted_194CCE4 <span class="token operator">=</span> ___lldb_unnamed_symbol15676$$Module_Framework
                    generateNewHttpResponse_194D6D8 <span class="token operator">=</span> ___lldb_unnamed_symbol15681$$Module_Framework <span class="token operator">+</span> <span class="token number">376</span> <span class="token operator">=</span> sub_194D6D8
                        NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersion<span class="token operator">:</span>headerFields<span class="token operator">:</span> <span class="token operator">-&gt;</span> 创建新的 ctier 的response

                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didReceiveResponse<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveResponse<span class="token operator">:</span><span class="token punctuation">]</span>   <span class="token operator">-&gt;</span> 当 ctier 报错时
                            NSError HAMErrorWithURLResponse<span class="token operator">:</span>userInfo<span class="token operator">:</span>request<span class="token operator">:</span>
                                    NSError HAMErrorWithCode<span class="token operator">:</span>userInfo<span class="token operator">:</span>

                Cronet_UrlRequestCallback_OnSucceeded_194D248 <span class="token operator">=</span> ___lldb_unnamed_symbol15678$$Module_Framework
                    MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span>
                        MLServerABRLoader dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span>
                            MLServerABRLoader updateLoadRetryPolicyOnLoadCompletionWithError<span class="token operator">:</span>
                                MLDefaultLoadRetryPolicy didCompleteLoadWithError<span class="token operator">:</span>
                                    error<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">:</span> MLDefaultLoadRetryPolicy cancelRetryAndResetBackoff<span class="token operator">:</span>
                                        retryID<span class="token operator">++</span>

                                error<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">:</span> MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span>
                                    canRetry<span class="token operator">==</span>True<span class="token operator">:</span> callExecuteRetryBlockWithRetryID_FF3070 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">44</span>
                                        <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy executeRetryBlockWithRetryID<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">68</span>
                                            callMLServerABRLoaderContinueLoading_107B5A8
                                                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">924</span>
                                                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">88</span>
                                                        HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span> <span class="token operator">-&gt;</span> 进入 ctier 的死循环 重复请求

                                    canRetry<span class="token operator">==</span>False<span class="token operator">:</span> callMLServerABRLoaderFailWithError_107B5B8
                                        MLServerABRLoader failWithError<span class="token operator">:</span>



<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

相关函数详解：

MLServerABRLoader dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> curServerABRUMPParser <span class="token punctuation">)</span>
        <span class="token function">parseResponseError_107E6B0</span><span class="token punctuation">(</span>curServerABRUMPParser<span class="token punctuation">,</span> inputError_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>inputError_1
        <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>curMLServerABRLoader<span class="token operator">-&gt;</span>_didReceiveChunkForCurrentRequest
        <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>curMLServerABRLoader<span class="token operator">-&gt;</span>_didReceiveNextRequestPolicyForCurrentRequest <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        defaultBackOffTimeMs <span class="token operator">=</span> curMLServerABRLoader<span class="token operator">-&gt;</span>_defaultBackOffTimeMs<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> defaultBackOffTimeMs <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLServerABRLoader<span class="token punctuation">,</span> <span class="token string">&quot;updateLoadRetryPolicyOnLoadCompletionWithError:&quot;</span><span class="token punctuation">,</span> inputError_3<span class="token punctuation">)</span><span class="token punctuation">;</span>


MLServerABRLoader updateLoadRetryPolicyOnLoadCompletionWithError<span class="token operator">:</span>
    参数：
        <span class="token keyword">case</span> <span class="token number">1</span>
            arg1<span class="token operator">=</span><span class="token punctuation">{</span>
                Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
                Code<span class="token operator">=</span><span class="token number">10000</span> <span class="token string">&quot;(null)&quot;</span>
                UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
                    HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                    HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x280ab2470</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                        URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=L&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=1</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            arg1<span class="token operator">=</span>domain<span class="token operator">:</span> <span class="token string">&quot;com.google.ios.hamplayer&quot;</span> <span class="token operator">-</span> code<span class="token operator">:</span> <span class="token number">6009</span>

        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
            Code<span class="token operator">=</span><span class="token number">6009</span> <span class="token string">&quot;(null)&quot;</span>
            UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
                HAMErrorHTTPURLResponse<span class="token operator">=</span><span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x28095cd60</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=L&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2</span>
                    <span class="token punctuation">}</span>
                    <span class="token punctuation">{</span>
                        Status Code<span class="token operator">:</span> <span class="token number">302</span><span class="token punctuation">,</span>
                        Headers <span class="token punctuation">{</span>
                            Connection <span class="token operator">=</span> close
                            Content<span class="token operator">-</span>Length <span class="token operator">=</span> <span class="token number">0</span>
                            Location <span class="token operator">=</span> <span class="token string">&quot;https://rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=A&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2&quot;</span>
                            Server <span class="token operator">=</span> <span class="token string">&quot;atomos-tproxy 1.0&quot;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
                HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x280ab1f50</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=L&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

    核心代码逻辑：
        <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curMLServerABRLoader<span class="token operator">-&gt;</span>_loadRetryPolicy<span class="token punctuation">,</span> <span class="token string">&quot;didCompleteLoadWithError:&quot;</span><span class="token punctuation">,</span> error_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> error_ <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curMLServerABRLoader<span class="token operator">-&gt;</span>_loadRetryPolicy<span class="token punctuation">,</span> <span class="token string">&quot;canRetry&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                blockInvoke <span class="token operator">=</span> callMLServerABRLoaderContinueLoading_107B5A8<span class="token punctuation">;</span>

                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadRetryPolicy<span class="token punctuation">,</span> <span class="token string">&quot;scheduleRetryWithBlock:&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>StackBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                blockInvoke1 <span class="token operator">=</span> callMLServerABRLoaderFailWithError_107B5B8<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    调用到：
        MLDefaultLoadRetryPolicy canRetry

        MLDefaultLoadRetryPolicy didCompleteLoadWithError<span class="token operator">:</span>

        MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span>

        callMLServerABRLoaderContinueLoading_107B5A8

        callMLServerABRLoaderFailWithError_107B5B8


MLDefaultLoadRetryPolicy didCompleteLoadWithError<span class="token operator">:</span>
    参数：
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> error<span class="token operator">=</span><span class="token constant">NULL</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token function">NSError</span><span class="token punctuation">(</span>
                    Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
                    Code<span class="token operator">=</span><span class="token number">10000</span> <span class="token string">&quot;(null)&quot;</span>
                    UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
                        HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                        HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x2838e9480</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
                            URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr4---sn-a5msenes.googlevideo.com/videoplayback?expire=1654443385&amp;ei=GXmcYoryCa-RsfIP1Oy_mAs&amp;ip=104.172.170.169&amp;id=o-ANzDZ3h7N5rZAloUCdQGuYMBEb80Uu_e4KPc7xaAyG1K&amp;source=youtube&amp;requiressl=yes&amp;mh=_h&amp;mm=31,29&amp;mn=sn-a5msenes,sn-a5mekn6k&amp;ms=au,rdu&amp;mv=m&amp;mvi=4&amp;pl=17&amp;ctier=L&amp;initcwndbps=1842500&amp;svpuc=1&amp;sabr=1&amp;mt=1654421335&amp;fvip=1&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgLJQmm-EOXj9xFFyjCBHlgn2RiukSzRseDFdGPROqJ8ACIQCdoic9p3flB3FJOu2lqys31IE4I-wBZKNPR-hjkf0HHA%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgULlnjQq0nkVEN6oLDPNPfvxUrcF1uFeiOfQiUhNE9RMCIGbuOCNl2TVJp2VegKsJVujYtW_j53A1zYzznjVe3xp3&amp;cpn=q6v1kI3_nWlzP4Qd&amp;rn=1 </span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
    核心代码逻辑：
        <span class="token keyword">if</span> <span class="token punctuation">(</span> inputError <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>inputError<span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>zero_2710 <span class="token operator">&amp;&amp;</span> <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>inputError_<span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> algn0x20_1779 <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_errors<span class="token punctuation">,</span> <span class="token string">&quot;addObject:&quot;</span><span class="token punctuation">,</span> inputError_<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_backoffCalculator<span class="token punctuation">,</span> <span class="token string">&quot;updateInterval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_errors<span class="token punctuation">,</span> <span class="token string">&quot;removeAllObjects&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_backoffCalculator<span class="token punctuation">,</span> <span class="token string">&quot;resetInterval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLDefaultLoadRetryPolicy<span class="token punctuation">,</span> <span class="token string">&quot;cancelRetryAndResetBackoff:&quot;</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    调用到：
        MLDefaultLoadRetryPolicy cancelRetryAndResetBackoff<span class="token operator">:</span>


MLDefaultLoadRetryPolicy cancelRetryAndResetBackoff<span class="token operator">:</span>
    核心逻辑：
        <span class="token operator">++</span>self<span class="token operator">-&gt;</span>_retryID<span class="token punctuation">;</span>
        curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_retryBlock <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>


MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span>
    核心逻辑：
        curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_retryBlock <span class="token operator">=</span> newRetryBlock_2<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>curRetryBlock <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            retryID <span class="token operator">=</span> curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_retryID<span class="token punctuation">;</span>
            <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curMLDefaultLoadRetryPolicy<span class="token operator">-&gt;</span>_backoffCalculator<span class="token punctuation">,</span> <span class="token string">&quot;interval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dispathTime_backoffInterval <span class="token operator">=</span> <span class="token function">dispatch_time</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">signed</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>backoffInterval <span class="token operator">*</span> <span class="token number">1000000000.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            blockInvoke <span class="token operator">=</span> callExecuteRetryBlockWithRetryID_FF3070<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    调用到：
        callExecuteRetryBlockWithRetryID_FF3070


Cronet_UrlRequestCallback_OnResponseStarted_194CCE4 <span class="token operator">=</span> ___lldb_unnamed_symbol15676$$Module_Framework <span class="token operator">+</span> <span class="token number">80</span> <span class="token operator">=</span> sub_194CCE4
    代码核心逻辑：
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>curCronetDataLoadTask<span class="token operator">-&gt;</span>taskCancelled_ <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            newNSHTTPURLResponse <span class="token operator">=</span> <span class="token function">generateNewHttpResponse_194D6D8</span><span class="token punctuation">(</span>responseInfo_<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curCronetDataLoadTask_<span class="token operator">-&gt;</span>delegate_<span class="token punctuation">,</span>
                <span class="token string">&quot;dataLoadTask:didReceiveResponse:&quot;</span><span class="token punctuation">,</span>
                curCronetDataLoadTask_<span class="token operator">-&gt;</span>parentTask_<span class="token punctuation">,</span>
                curCronetDataLoadTask_<span class="token operator">-&gt;</span>response_
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">signed</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">getResponseStatusCode_3DFA210</span><span class="token punctuation">(</span>responseInfo_<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">400</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                curCronetDataLoadTask_<span class="token operator">-&gt;</span>bufferData_ <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>curCronetDataLoadTask_<span class="token operator">-&gt;</span>bufferDataSize_<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">tryResetTimeoutTimer_194C704</span><span class="token punctuation">(</span>curCronetDataLoadTask_<span class="token punctuation">)</span><span class="token punctuation">;</span>

                cronetUrlRequestReadResult <span class="token operator">=</span> <span class="token function">callCronetUrlRequestRead_3DF9370</span><span class="token punctuation">(</span>request_<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>cronetUrlRequestReadResult <span class="token punctuation">)</span> <span class="token comment">// read error</span>
                <span class="token punctuation">{</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                newHamError <span class="token operator">=</span> <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>
                    <span class="token operator">&amp;</span>OBJC_CLASS___NSError<span class="token punctuation">,</span>
                    <span class="token string">&quot;HAMErrorWithURLResponse:userInfo:request:&quot;</span><span class="token punctuation">,</span>
                    curCronetDataLoadTask_<span class="token operator">-&gt;</span>response_<span class="token punctuation">,</span>
                    curCronetDataLoadTask_<span class="token operator">-&gt;</span>userInfo_<span class="token punctuation">,</span>
                    curCronetDataLoadTask_<span class="token operator">-&gt;</span>URLRequest_
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curCronetDataLoadTask_<span class="token operator">-&gt;</span>delegate_<span class="token punctuation">,</span>
                    <span class="token string">&quot;dataLoadTask:didCompleteWithError:&quot;</span><span class="token punctuation">,</span>
                    curCronetDataLoadTask_<span class="token operator">-&gt;</span>parentTask_<span class="token punctuation">,</span>
                    newHamError_
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>curCronetDataLoadTask_<span class="token operator">-&gt;</span>observer_<span class="token punctuation">,</span>
                    <span class="token string">&quot;dataLoadTask:didCompleteWithError:&quot;</span><span class="token punctuation">,</span>
                    curCronetDataLoadTask_<span class="token operator">-&gt;</span>parentTask_<span class="token punctuation">,</span>
                    newHamError_
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">objc_msgSend_3E84298</span><span class="token punctuation">(</span>curCronetDataLoadTask_<span class="token operator">-&gt;</span>timeoutTimer_<span class="token punctuation">,</span> <span class="token string">&quot;invalidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>


<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

新生成 ctier<span class="token operator">=</span>L 的 NSMutableURLRequest 请求 的函数调用顺序：

<span class="token operator">-</span><span class="token punctuation">[</span>HAMPlayerInternal playerLoop<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1736</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseTrackRenderer prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">48</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMSBARAudioTrackRenderer internalPrepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMQueueingRootSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">704</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMDASHSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">100</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRController prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">840</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader createDataLoadTaskForRequest<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">128</span>
                                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader dataLoadTaskForHTTPBody<span class="token operator">:</span>isPrimaryHostProbing<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                                    <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                        <span class="token operator">-</span><span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                            NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                                                某次参数：
                                                    URL<span class="token operator">=</span><span class="token string">&quot;https://rr4---sn-nx57ynsz.googlevideo.com/videoplayback?expire=1655759112&amp;ei=p4ywYoCpO-GMsfIP9c-j-A0&amp;ip=72.174.144.110&amp;id=o-AOtW_cgK5DpGSlTFzlnNQ5jG-qYf6YbO-W_J4o6Z7Bg0&amp;source=youtube&amp;requiressl=yes&amp;mh=mR&amp;mm=31,29&amp;mn=sn-nx57ynsz,sn-nx5s7n7y&amp;ms=au,rdu&amp;mv=m&amp;mvi=4&amp;pl=19&amp;ctier=L&amp;initcwndbps=1712500&amp;svpuc=1&amp;sabr=1&amp;mt=1655737257&amp;fvip=1&amp;keepalive=yes&amp;fexp=24001373,24007246,24208264&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgdJbzVTf5BpT1a0Qd-15luRpD3uxu9oqoIBFYuNPFrw0CIHogAdP_kVZFI1gE2yvIbih1AY5458ViOpGC77ywCY1Y&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgUMelUGd_HH1szTAu1xTcLTCTp0LZCwG81qqdxbtYQoMCIB1IHI2PgnSgrenK-M60dwFaKwacbIvmjERFx0ri9OG9&amp;cpn=G0hmRCCW6nH0wNIr&amp;rn=1&quot;</span>
                                                    cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                                                    timeoutInterval<span class="token operator">=</span><span class="token number">60</span>
                                                CFNetwork`___lldb_unnamed_symbol231$$CFNetwork <span class="token operator">+</span> <span class="token number">64</span>
                                                    NSURLRequest initWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                                                        某次参数：
                                                            URL<span class="token operator">=</span><span class="token string">&quot;https://rr4---sn-nx57ynsz.googlevideo.com/videoplayback?expire=1655759112&amp;ei=p4ywYoCpO-GMsfIP9c-j-A0&amp;ip=72.174.144.110&amp;id=o-AOtW_cgK5DpGSlTFzlnNQ5jG-qYf6YbO-W_J4o6Z7Bg0&amp;source=youtube&amp;requiressl=yes&amp;mh=mR&amp;mm=31,29&amp;mn=sn-nx57ynsz,sn-nx5s7n7y&amp;ms=au,rdu&amp;mv=m&amp;mvi=4&amp;pl=19&amp;ctier=L&amp;initcwndbps=1712500&amp;svpuc=1&amp;sabr=1&amp;mt=1655737257&amp;fvip=1&amp;keepalive=yes&amp;fexp=24001373,24007246,24208264&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgdJbzVTf5BpT1a0Qd-15luRpD3uxu9oqoIBFYuNPFrw0CIHogAdP_kVZFI1gE2yvIbih1AY5458ViOpGC77ywCY1Y&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRAIgUMelUGd_HH1szTAu1xTcLTCTp0LZCwG81qqdxbtYQoMCIB1IHI2PgnSgrenK-M60dwFaKwacbIvmjERFx0ri9OG9&amp;cpn=G0hmRCCW6nH0wNIr&amp;rn=1&quot;</span>
                                                            cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                                                            timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

触发 HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span> 的调用顺序：

<span class="token punctuation">[</span>第一次 rn<span class="token operator">=</span><span class="token number">1</span> ctiler<span class="token operator">=</span>L<span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token punctuation">[</span>HAMPlayerInternal playerLoop<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1736</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseTrackRenderer prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">48</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMSBARAudioTrackRenderer internalPrepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMQueueingRootSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">704</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMDASHSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">100</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRController prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
                        _logos_method$_ungrouped$MLServerABRLoader$<span class="token function">continueLoading</span><span class="token punctuation">(</span>self<span class="token operator">=</span><span class="token number">0x000000012e689210</span><span class="token punctuation">,</span> _cmd<span class="token operator">=</span><span class="token string">&quot;continueLoading&quot;</span><span class="token punctuation">)</span> at youtubeCronet<span class="token punctuation">.</span>xm<span class="token operator">:</span><span class="token number">289</span><span class="token operator">:</span><span class="token number">5</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">924</span>
                                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">88</span>
                                    HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span>
                                        某次的参数：
                                            arg1<span class="token operator">=</span>delegate<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x284243690</span><span class="token operator">&gt;</span>
                                            arg2<span class="token operator">=</span>delegateQueue<span class="token operator">=</span><span class="token operator">&lt;</span>OS_dispatch_queue_serial<span class="token operator">:</span> MLHAMPlayer<span class="token operator">&gt;</span>
                                        此时：
                                            reqUrl
                                                rn<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1658155941&amp;ei=RR_VYqa6GJTlNsC6gIgE&amp;ip=162.253.45.206&amp;id=o-AGLA8-7MEt9wIIkvKGany12Vu6HmM4t-R27oa-wU3eyG&amp;source=youtube&amp;requiressl=yes&amp;mh=Mk&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsrnsd&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pl=22&amp;ctier=L&amp;initcwndbps=1168750&amp;svpuc=1&amp;sabr=1&amp;mt=1658133649&amp;fvip=5&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIhAMoq1fU-fdprDjIkRanRHLMJLg-mISEmElCC7_OqigFVAiBpC6IpBGXN_mWIzoPn8nG2Ah4WNEIauk5j3_y4uUJooQ%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgaeU1mBeqHILR9DlKWm0nihNijdMhZgAFvJjbZKW1FrUCIQDFRyVh1aMUMdMDCNfmmOPgasbwsu5dLSdY3JFfsKFiKw%3D%3D&amp;cpn=2oxmwItyhlTlzWXv&amp;rn=1</span>

<span class="token punctuation">[</span>第二次 rn<span class="token operator">=</span><span class="token number">2</span> ctiler<span class="token operator">=</span>L<span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">44</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy executeRetryBlockWithRetryID<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">68</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">924</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">88</span>
                HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span>
                    某次的参数：
                        arg1<span class="token operator">=</span>delegate<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x286198f00</span><span class="token operator">&gt;</span>
                        arg2<span class="token operator">=</span>delegateQueue<span class="token operator">=</span><span class="token operator">&lt;</span>OS_dispatch_queue_serial<span class="token operator">:</span> MLHAMPlayer<span class="token punctuation">[</span><span class="token number">0x280218180</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> xref <span class="token operator">=</span> <span class="token number">34</span><span class="token punctuation">,</span> ref <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> sref <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> target <span class="token operator">=</span> com<span class="token punctuation">.</span>apple<span class="token punctuation">.</span>root<span class="token punctuation">.</span>user<span class="token operator">-</span>initiated<span class="token operator">-</span>qos<span class="token punctuation">.</span>overcommit<span class="token punctuation">[</span><span class="token number">0x11050d080</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">0x1</span><span class="token punctuation">,</span> state <span class="token operator">=</span> <span class="token number">0x006000a500001801</span><span class="token punctuation">,</span> enqueued<span class="token punctuation">,</span> dirty<span class="token punctuation">,</span> max qos <span class="token number">5</span><span class="token punctuation">,</span> draining on <span class="token number">0x1803</span><span class="token punctuation">,</span> in<span class="token operator">-</span>barrier<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    此时：
                        reqUrl
                            rn<span class="token operator">=</span><span class="token number">2</span>时<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1658305786&amp;ei=mWjXYuCLOOucir4P3c6AiAQ&amp;ip=162.253.45.206&amp;id=o-AMnr7yIbmMhFTmywfJSN8wAIx4A4Qoq0hGO91N7dCzIp&amp;source=youtube&amp;requiressl=yes&amp;mh=hx&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsknek&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pcm2cms=yes&amp;pl=22&amp;ctier=L&amp;initcwndbps=1031250&amp;svpuc=1&amp;sabr=1&amp;mt=1658283891&amp;fvip=1&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhANNsZzr74YwYCad-wykDLNs7C6jNLkdlTSuiVTHlI2v0AiEA4JnoG-7SCvNPKqt9iFwCbPDyHgfX8NtTULRDqp6HnRM%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgXZKQOPCBuuyxe3Bdk0qXJbgIxsJqr_7LpKHE7xQ1OnQCIQDq4WnBDfATQNkxbpOWAQ_RM4NEThcpb0aqUFqbjUC1vg%3D%3D&amp;cpn=aCkM2ux19mPWYM5x&amp;rn=2</span>

<span class="token punctuation">[</span>第三次 rn<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>rn<span class="token operator">=</span><span class="token number">3</span> ctiler<span class="token operator">=</span>A<span class="token punctuation">]</span>
    调用顺序同上
    但是URL略有不同
                    此时：
                        reqUrl
                            rn<span class="token operator">=</span><span class="token number">3</span>时<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr2---sn-phvo-jpql.googlevideo.com/videoplayback?expire=1658305786&amp;ei=mWjXYuCLOOucir4P3c6AiAQ&amp;ip=162.253.45.206&amp;id=o-AMnr7yIbmMhFTmywfJSN8wAIx4A4Qoq0hGO91N7dCzIp&amp;source=youtube&amp;requiressl=yes&amp;mh=hx&amp;mm=31,29&amp;mn=sn-phvo-jpql,sn-vgqsknek&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pcm2cms=yes&amp;pl=22&amp;ctier=A&amp;initcwndbps=1031250&amp;svpuc=1&amp;sabr=1&amp;mt=1658283891&amp;fvip=1&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhANNsZzr74YwYCad-wykDLNs7C6jNLkdlTSuiVTHlI2v0AiEA4JnoG-7SCvNPKqt9iFwCbPDyHgfX8NtTULRDqp6HnRM%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgXZKQOPCBuuyxe3Bdk0qXJbgIxsJqr_7LpKHE7xQ1OnQCIQDq4WnBDfATQNkxbpOWAQ_RM4NEThcpb0aqUFqbjUC1vg%3D%3D&amp;cpn=aCkM2ux19mPWYM5x&amp;rn=2&amp;rn=3</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

ctier<span class="token operator">=</span>L 的 请求 NSMutableURLRequest 也返回 NSError 出错 的函数调用顺序

<span class="token operator">-</span><span class="token punctuation">[</span>HAMPlayerInternal playerLoop<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1736</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseTrackRenderer prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">48</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMPixelBufferVideoTrackRenderer internalPrepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMVideoDecoderSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">80</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMQueueingRootSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">632</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>HAMDASHSampleBufferSource seekToTime<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRController seekToTime<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">36</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader seekDidOccur<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">148</span>
                                ___lldb_unnamed_symbol15667$$Module_Framework <span class="token operator">+</span> <span class="token number">112</span>
                                    NSError HAMErrorWithCode<span class="token operator">:</span>userInfo<span class="token operator">:</span>
                                        某次的参数：
                                            arg1<span class="token operator">=</span><span class="token number">10000</span>
                                            arg2<span class="token operator">=</span><span class="token punctuation">{</span>
                                                    HAMErrorURLRequest <span class="token operator">=</span> <span class="token string">&quot;&lt;NSMutableURLRequest: 0x28302c0b0&gt; { URL: https://rr2---sn-nx5s7nel.googlevideo.com/videoplayback?expire=1655754561&amp;ei=4HqwYt29JNSDkwbAt5vQDg&amp;ip=72.174.144.110&amp;id=o-AJjQlPwnnZAb4c4XmDyophxk9bxSybJHNgVtg0xPnY5B&amp;source=youtube&amp;requiressl=yes&amp;mh=Vb&amp;mm=31,29&amp;mn=sn-nx5s7nel,sn-nx57ynsl&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=19&amp;ctier=L&amp;initcwndbps=1721250&amp;svpuc=1&amp;sabr=1&amp;mt=1655732690&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246,24208264&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIhAIoI_-R65dCbFSiymVXG3fMpNeJO5LUNC-t_O1IRl6aJAiBy8tnuzG_Gag61Wwu-Pk1DAyQd1MvY4t2MVxvfYVA5mg%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIhAPgKcNRbTnALWCxhsV7ZpQ48EmZyL8VzBjUOIbM1y6SfAiAMJA2YCB4AUnlHaS9MuE1aWCkpY5JLkHyY5yooEGQU9Q%3D%3D&amp;cpn=uDxkagKFinGD-plw&amp;rn=1 }&quot;</span><span class="token punctuation">;</span>
                                                    HAMRequestNumberLoadTaskKey <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span>
                                    NSError errorWithDomain<span class="token operator">:</span>code<span class="token operator">:</span>userInfo<span class="token operator">:</span>
                                        某次的参数：
                                            arg1<span class="token operator">=</span><span class="token string">&quot;com.google.ios.hamplayer&quot;</span>
                                            arg2<span class="token operator">=</span><span class="token number">10000</span>
                                            arg3<span class="token operator">=</span><span class="token punctuation">{</span>
                                                    HAMErrorURLRequest <span class="token operator">=</span> <span class="token string">&quot;&lt;NSMutableURLRequest: 0x28302c0b0&gt; { URL: https://rr2---sn-nx5s7nel.googlevideo.com/videoplayback?expire=1655754561&amp;ei=4HqwYt29JNSDkwbAt5vQDg&amp;ip=72.174.144.110&amp;id=o-AJjQlPwnnZAb4c4XmDyophxk9bxSybJHNgVtg0xPnY5B&amp;source=youtube&amp;requiressl=yes&amp;mh=Vb&amp;mm=31,29&amp;mn=sn-nx5s7nel,sn-nx57ynsl&amp;ms=au,rdu&amp;mv=m&amp;mvi=2&amp;pl=19&amp;ctier=L&amp;initcwndbps=1721250&amp;svpuc=1&amp;sabr=1&amp;mt=1655732690&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246,24208264&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIhAIoI_-R65dCbFSiymVXG3fMpNeJO5LUNC-t_O1IRl6aJAiBy8tnuzG_Gag61Wwu-Pk1DAyQd1MvY4t2MVxvfYVA5mg%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIhAPgKcNRbTnALWCxhsV7ZpQ48EmZyL8VzBjUOIbM1y6SfAiAMJA2YCB4AUnlHaS9MuE1aWCkpY5JLkHyY5yooEGQU9Q%3D%3D&amp;cpn=uDxkagKFinGD-plw&amp;rn=1 }&quot;</span><span class="token punctuation">;</span>
                                                    HAMRequestNumberLoadTaskKey <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

说明：下面是 ctier<span class="token operator">=</span>A 的 NSURLRequest 的调用顺序

<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span><span class="token punctuation">]</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">44</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy executeRetryBlockWithRetryID<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">68</span>
            某次的参数：arg1<span class="token operator">=</span><span class="token number">3</span>

            MLServerABRLoader continueLoading
                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">840</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader createDataLoadTaskForRequest<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">128</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader dataLoadTaskForHTTPBody<span class="token operator">:</span>isPrimaryHostProbing<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                <span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                    NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                                        某次的参数：
                                            URL<span class="token operator">=</span><span class="token string">&quot;https://rr1---sn-bvvbax4pcxg-najl.googlevideo.com/videoplayback?expire=1654284469&amp;ei=VAyaYvi5G4eHsfIPqoK1kAg&amp;ip=136.36.116.116&amp;id=o-AD4uH0_eMoADlcTGlFs1Uw5dhdYtelrEPN9konw5oPZb&amp;source=youtube&amp;requiressl=yes&amp;mh=_u&amp;mm=31,29&amp;mn=sn-bvvbax4pcxg-najl,sn-o097znsl&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pl=20&amp;ctier=A&amp;initcwndbps=1786250&amp;svpuc=1&amp;sabr=1&amp;mt=1654262462&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgRHLJbeJI4tvvoD9pV1KThMgoBW8xgE27L2nGFfXaX6YCIQC6SEOoNiuui3-5O_gkauy6nXCQZN1Es1omMAH7ZoPfyQ%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIhAKMDmxqaOMD0YMFLUgG8otkDKKVPLHSBRuD3yKVVpd-DAiB73wqU9tdTRN5zW-yIL3kXDXwNuQ7L4ua7n00tb6YnFA%3D%3D&amp;cpn=WPioc6dOPwVsC718&amp;rn=2&amp;rn=5&quot;</span>
                                            cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                                            timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

                                        某次的返回值：
                                            <span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x280ab2460</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=L&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=1</span>
                                            <span class="token punctuation">}</span>

                                        CFNetwork`___lldb_unnamed_symbol231$$CFNetwork <span class="token operator">+</span> <span class="token number">64</span>

                                            NSURLRequest initWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                                                参数 <span class="token keyword">case</span> <span class="token number">1</span>：
                                                    URL<span class="token operator">=</span><span class="token string">&quot;https://rr1---sn-bvvbax4pcxg-najl.googlevideo.com/videoplayback?expire=1654284469&amp;ei=VAyaYvi5G4eHsfIPqoK1kAg&amp;ip=136.36.116.116&amp;id=o-AD4uH0_eMoADlcTGlFs1Uw5dhdYtelrEPN9konw5oPZb&amp;source=youtube&amp;requiressl=yes&amp;mh=_u&amp;mm=31,29&amp;mn=sn-bvvbax4pcxg-najl,sn-o097znsl&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pl=20&amp;ctier=A&amp;initcwndbps=1786250&amp;svpuc=1&amp;sabr=1&amp;mt=1654262462&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgRHLJbeJI4tvvoD9pV1KThMgoBW8xgE27L2nGFfXaX6YCIQC6SEOoNiuui3-5O_gkauy6nXCQZN1Es1omMAH7ZoPfyQ%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIhAKMDmxqaOMD0YMFLUgG8otkDKKVPLHSBRuD3yKVVpd-DAiB73wqU9tdTRN5zW-yIL3kXDXwNuQ7L4ua7n00tb6YnFA%3D%3D&amp;cpn=WPioc6dOPwVsC718&amp;rn=2&amp;rn=5&quot;</span>
                                                    cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                                                    timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

                                                参数 <span class="token keyword">case</span> <span class="token number">2</span>：
                                                    URL<span class="token operator">=</span><span class="token string">&quot;https://rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=A&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2&amp;rn=3&quot;</span>
                                                    cachePolicy<span class="token operator">=</span>NSURLRequestUseProtocolCachePolicy
                                                    timeoutInterval<span class="token operator">=</span><span class="token number">60</span>

                                                <span class="token keyword">return</span> <span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x28063c790</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-bvvbax4pcxg-najl.googlevideo.com/videoplayback?expire=1654284469&amp;ei=VAyaYvi5G4eHsfIPqoK1kAg&amp;ip=136.36.116.116&amp;id=o-AD4uH0_eMoADlcTGlFs1Uw5dhdYtelrEPN9konw5oPZb&amp;source=youtube&amp;requiressl=yes&amp;mh=_u&amp;mm=31,29&amp;mn=sn-bvvbax4pcxg-najl,sn-o097znsl&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pl=20&amp;ctier=A&amp;initcwndbps=1786250&amp;svpuc=1&amp;sabr=1&amp;mt=1654262462&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRQIgRHLJbeJI4tvvoD9pV1KThMgoBW8xgE27L2nGFfXaX6YCIQC6SEOoNiuui3-5O_gkauy6nXCQZN1Es1omMAH7ZoPfyQ%3D%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIhAKMDmxqaOMD0YMFLUgG8otkDKKVPLHSBRuD3yKVVpd-DAiB73wqU9tdTRN5zW-yIL3kXDXwNuQ7L4ua7n00tb6YnFA%3D%3D&amp;cpn=WPioc6dOPwVsC718&amp;rn=2&amp;rn=5</span>
                                                <span class="token punctuation">}</span>


<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token punctuation">[</span>HAMPlayerInternal playerLoop<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1736</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseTrackRenderer prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">48</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMSBARAudioTrackRenderer internalPrepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMQueueingRootSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">704</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMDASHSampleBufferSource prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">100</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRController prepareAndReturnError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">40</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">840</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader createDataLoadTaskForRequest<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">128</span>
                                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoader dataLoadTaskForHTTPBody<span class="token operator">:</span>isPrimaryHostProbing<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                                    <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoader taskWithRequest<span class="token operator">:</span>userInfo<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                        <span class="token operator">-</span><span class="token punctuation">[</span>HAMDataLoadRequest buildURLRequest<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">140</span>
                                            NSURLRequest requestWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>
                                                CFNetwork`___lldb_unnamed_symbol231$$CFNetwork <span class="token operator">+</span> <span class="token number">64</span>
                                                    NSURLRequest initWithURL<span class="token operator">:</span>cachePolicy<span class="token operator">:</span>timeoutInterval<span class="token operator">:</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

说明：下面是 ctier<span class="token operator">=</span>A 的 response <span class="token operator">=</span> NSHTTPURLResponse 的调用顺序

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span> <span class="token operator">=</span> sub_194D978
    ___lldb_unnamed_symbol110205$$Module_Framework <span class="token operator">+</span> <span class="token number">40</span> <span class="token operator">=</span> sub_38FCE24
        ___lldb_unnamed_symbol171000$$Module_Framework <span class="token operator">+</span> <span class="token number">28</span> <span class="token operator">=</span> sub_3DF8048
            ___lldb_unnamed_symbol170908$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span> <span class="token operator">=</span> sub_3DF60E8
                Cronet_UrlRequestCallback_OnResponseStarted_194CCE4 <span class="token operator">=</span> ___lldb_unnamed_symbol15676$$Module_Framework <span class="token operator">+</span> <span class="token number">80</span> <span class="token operator">=</span> sub_194CCE4
                    generateNewHttpResponse_194D6D8 <span class="token operator">=</span> ___lldb_unnamed_symbol15681$$Module_Framework <span class="token operator">+</span> <span class="token number">376</span> <span class="token operator">=</span> sub_194D6D8
                        NSHTTPURLResponse initWithURL<span class="token operator">:</span>statusCode<span class="token operator">:</span>HTTPVersion<span class="token operator">:</span>headerFields<span class="token operator">:</span>
                            某次参数<span class="token operator">:</span>
                                url<span class="token operator">=</span><span class="token string">&quot;https://rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=A&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2&amp;rn=3&quot;</span><span class="token punctuation">,</span>
                                statusCode<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>
                                HTTPVersion<span class="token operator">=</span><span class="token number">0x0000000000000000</span><span class="token punctuation">,</span>
                                headerFields<span class="token operator">=</span><span class="token number">4</span> key<span class="token operator">/</span>value pairs

                            某次的返回值：
                                <span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x280ee1d00</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=A&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2&amp;rn=3</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token punctuation">{</span>
                                        Status Code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                                        Headers <span class="token punctuation">{</span>
                                            Connection <span class="token operator">=</span> <span class="token string">&quot;keep-alive&quot;</span>
                                            <span class="token string">&quot;Content-Length&quot;</span> <span class="token operator">=</span> <span class="token number">0</span>
                                            <span class="token string">&quot;Content-Type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span>
                                            Server <span class="token operator">=</span> <span class="token string">&quot;atomos-tproxy 1.0&quot;</span>
                                        <span class="token punctuation">}</span> 
                                    <span class="token punctuation">}</span>


<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>


触发了 HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span> 当第一次 ctier<span class="token operator">=</span>A 的url 时的调用顺序：

<span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy scheduleRetryWithBlock<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">44</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLDefaultLoadRetryPolicy executeRetryBlockWithRetryID<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">68</span>
        某次参数：
            arg1<span class="token operator">=</span><span class="token number">2</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader continueLoading<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">924</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">88</span>
                某次的参数：
                    arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x281226d00</span><span class="token operator">&gt;</span>
                    arg2<span class="token operator">=</span><span class="token operator">&lt;</span>OS_dispatch_queue_serial<span class="token operator">:</span> MLHAMPlayer<span class="token punctuation">[</span><span class="token number">0x282d34f00</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> xref <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">,</span> ref <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> sref <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> target <span class="token operator">=</span> com<span class="token punctuation">.</span>apple<span class="token punctuation">.</span>root<span class="token punctuation">.</span>user<span class="token operator">-</span>initiated<span class="token operator">-</span>qos<span class="token punctuation">.</span>overcommit<span class="token punctuation">[</span><span class="token number">0x10c651080</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">0x1</span><span class="token punctuation">,</span> state <span class="token operator">=</span> <span class="token number">0x006000a50001a401</span><span class="token punctuation">,</span> enqueued<span class="token punctuation">,</span> dirty<span class="token punctuation">,</span> max qos <span class="token number">5</span><span class="token punctuation">,</span> draining on <span class="token number">0x1a403</span><span class="token punctuation">,</span> in<span class="token operator">-</span>barrier<span class="token punctuation">}</span><span class="token operator">&gt;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

下面是 ctier<span class="token operator">=</span>A 的 response <span class="token operator">=</span> NSHTTPURLResponse 在生成了之后，被调用到 statusCode 时的调用顺序

<span class="token operator">-</span><span class="token punctuation">[</span>MLPlayerItemEventCenter networkRequestDidReceiveResponseWithEvent<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">204</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>MLQOEPingController networkRequestDidReceiveResponseWithEvent<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">272</span>
        NSHTTPURLResponse statusCode
            <span class="token keyword">return</span> <span class="token number">200</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

说明：下面是 ctier<span class="token operator">=</span>A 的response后的，始终retry重发请求的相关的调用逻辑

<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">]</span>

cancelCronetDataLoadTask_194BFB8
    reportDataLoadTaskError_194DA94 <span class="token operator">=</span> sub_194DA94 <span class="token operator">=</span> ___lldb_unnamed_symbol15689$$Module_Framework <span class="token operator">+</span> <span class="token number">40</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">368</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">260</span>
                参数
                    <span class="token keyword">case</span> <span class="token number">1</span>：
                        arg1<span class="token operator">=</span><span class="token number">0x0000000281aaa490</span>
                        arg2<span class="token operator">=</span>domain<span class="token operator">:</span> <span class="token string">&quot;com.google.ios.hamplayer&quot;</span> <span class="token operator">-</span> code<span class="token operator">:</span> <span class="token number">10000</span>
                    <span class="token keyword">case</span> <span class="token number">2</span>：
                        arg1<span class="token operator">=</span><span class="token number">0x0000000280597a50</span>
                        arg2<span class="token operator">=</span>domain<span class="token operator">:</span> <span class="token string">&quot;com.google.ios.hamplayer&quot;</span> <span class="token operator">-</span> code<span class="token operator">:</span> <span class="token number">6009</span>

                MLServerABRLoader updateLoadRetryPolicyOnLoadCompletionWithError<span class="token operator">:</span>

<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">]</span>

<span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span>
    ___lldb_unnamed_symbol110205$$Module_Framework <span class="token operator">+</span> <span class="token number">40</span>
        ___lldb_unnamed_symbol171023$$Module_Framework <span class="token operator">+</span> <span class="token number">32</span>
            ___lldb_unnamed_symbol170906$$Module_Framework <span class="token operator">+</span> <span class="token number">84</span>
                Cronet_UrlRequestCallback_OnRedirectReceived_194C9D8 <span class="token operator">=</span> ___lldb_unnamed_symbol15675$$Module_Framework <span class="token operator">+</span> <span class="token number">620</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">368</span>
                        <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader dataLoadTask<span class="token operator">:</span>didCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">260</span>
                            MLServerABRLoader updateLoadRetryPolicyOnLoadCompletionWithError<span class="token operator">:</span>


<span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">]</span>

找到 死循环 多次重试的调用关系了：

callHAMTimerFire_199CFB8 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer initWithQueue<span class="token operator">:</span>startNanoseconds<span class="token operator">:</span>intervalNanoseconds<span class="token operator">:</span>leewayNanoseconds<span class="token operator">:</span>repeats<span class="token operator">:</span>block<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">36</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer fire<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">52</span>
        callMLOnesieConnectionOpenerOnPingTimer_1039FB8 <span class="token operator">=</span> sub_1039FB8 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieConnectionOpener scheduleNextRequestUsingStartDelay<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">36</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieConnectionOpener onPingTimer<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">180</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">932</span>
                    tryResetTimeoutTimer_194C704 <span class="token operator">=</span> sub_194C704 <span class="token operator">=</span> ___lldb_unnamed_symbol15674$$Module_Framework <span class="token operator">+</span> <span class="token number">200</span>
                        <span class="token operator">+</span><span class="token punctuation">[</span>HAMTimer timerWithQueue<span class="token operator">:</span>startNanoseconds<span class="token operator">:</span>leewayNanoseconds<span class="token operator">:</span>block<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">104</span>
                            <span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer initWithQueue<span class="token operator">:</span>startNanoseconds<span class="token operator">:</span>intervalNanoseconds<span class="token operator">:</span>leewayNanoseconds<span class="token operator">:</span>repeats<span class="token operator">:</span>block<span class="token operator">:</span><span class="token punctuation">]</span>

<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>

<span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer initWithQueue<span class="token operator">:</span>startNanoseconds<span class="token operator">:</span>intervalNanoseconds<span class="token operator">:</span>leewayNanoseconds<span class="token operator">:</span>repeats<span class="token operator">:</span>block<span class="token operator">:</span><span class="token punctuation">]</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer initWithQueue<span class="token operator">:</span>startNanoseconds<span class="token operator">:</span>intervalNanoseconds<span class="token operator">:</span>leewayNanoseconds<span class="token operator">:</span>repeats<span class="token operator">:</span>block<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">36</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>HAMTimer fire<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">52</span>
            callMLOnesieConnectionOpenerOnPingTimer_1039FB8 <span class="token operator">=</span> sub_1039FB8 <span class="token operator">=</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieConnectionOpener scheduleNextRequestUsingStartDelay<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">36</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieConnectionOpener onPingTimer<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">180</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">648</span>
                        某次参数：
                            arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLOnesieConnectionOpener<span class="token operator">:</span> <span class="token number">0x2829dde00</span><span class="token operator">&gt;</span>
                            delegateQueue <span class="token operator">=</span><span class="token operator">&lt;</span>OS_dispatch_queue_serial<span class="token operator">:</span> queue_serial<span class="token punctuation">[</span><span class="token number">0x283868800</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> xref <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> ref <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> sref <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> target <span class="token operator">=</span> com<span class="token punctuation">.</span>apple<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>qos<span class="token punctuation">.</span>overcommit<span class="token punctuation">[</span><span class="token number">0x104664f80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">0x1</span><span class="token punctuation">,</span> state <span class="token operator">=</span> <span class="token number">0x006000a500012805</span><span class="token punctuation">,</span> enqueued<span class="token punctuation">,</span> dirty<span class="token punctuation">,</span> max qos <span class="token number">5</span><span class="token punctuation">,</span> draining on <span class="token number">0x12807</span><span class="token punctuation">,</span> in<span class="token operator">-</span>barrier<span class="token punctuation">}</span><span class="token operator">&gt;</span>

                        核心代码<span class="token operator">:</span>
                            <span class="token function">sub_3DF9004</span><span class="token punctuation">(</span>sub_194C27C<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        Cronet_Executor_ExecuteFunc_194C27C <span class="token operator">=</span> sub_194C27C <span class="token operator">=</span> ___lldb_unnamed_symbol15668
                            <span class="token operator">-</span><span class="token punctuation">[</span>HAMCronetDataLoadTask startWithDelegate<span class="token operator">:</span>delegateQueue<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">36</span> <span class="token operator">=</span> sub_194D978
                                ___lldb_unnamed_symbol110205$$Module_Framework <span class="token operator">+</span> <span class="token number">40</span> <span class="token operator">=</span> sub_38FCE24
                                    ___lldb_unnamed_symbol171000$$Module_Framework <span class="token operator">+</span> <span class="token number">28</span> <span class="token operator">=</span> sub_3DF8048
                                        ___lldb_unnamed_symbol170908$$Module_Framework <span class="token operator">+</span> <span class="token number">52</span> <span class="token operator">=</span> sub_3DF60E8
                                            Cronet_UrlRequestCallback_OnResponseStarted_194CCE4 <span class="token operator">=</span> sub_194CCE4 <span class="token operator">=</span> ___lldb_unnamed_symbol15676$$Module_Framework <span class="token operator">+</span> <span class="token number">124</span>
                                                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRDataLoadTask dataLoadTask<span class="token operator">:</span>didReceiveResponse<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">424</span>
                                                    <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABRLoader dataLoadTask<span class="token operator">:</span>didReceiveResponse<span class="token operator">:</span><span class="token punctuation">]</span>
                                                        某次的参数：
                                                            arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABRDataLoadTask<span class="token operator">:</span> <span class="token number">0x2806a7060</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                            arg2<span class="token operator">=</span><span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x280ee1d00</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr1---sn-8xgp1vo-p5ql.googlevideo.com/videoplayback?expire=1654546559&amp;ei=HwyeYrH5DJWN_9EPouqpqA8&amp;ip=70.110.26.104&amp;id=o-ABMZsKNB0GJ_BmboM7YSytnAHB7ASC_Y7GC6jO056wJe&amp;source=youtube&amp;requiressl=yes&amp;mh=ji&amp;mm=31,29&amp;mn=sn-8xgp1vo-p5ql,sn-p5qlsndz&amp;ms=au,rdu&amp;mv=m&amp;mvi=1&amp;pcm2cms=yes&amp;pl=20&amp;ctier=A&amp;initcwndbps=1490000&amp;svpuc=1&amp;sabr=1&amp;mt=1654524545&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRgIhAPnD2xwm1J-b9yvruQe1aozyNm_9xaCQvtdIM7n32vA5AiEA4mVXjIUgf7425J8XlwfLdVhMyDiZHFtRhRE1jHxtWZo%3D&amp;lsparams=mh,mm,mn,ms,mv,mvi,pcm2cms,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgd3ooIz7fpF6JTB11opldSL1WIPtx4L5FaBEqhdEZBLwCIQChh18q1sc8T2XEIwlQBI8O9cF_DI2FPVLjVCNRHhRPCQ%3D%3D&amp;cpn=sjOhS6zpDL-OE-pP&amp;rn=2&amp;rn=3</span>
                                                                <span class="token punctuation">}</span>
                                                                <span class="token punctuation">{</span>
                                                                    Status Code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> Headers <span class="token punctuation">{</span>
                                                                        Connection <span class="token operator">=</span> <span class="token string">&quot;keep-alive&quot;</span>
                                                                        <span class="token string">&quot;Content-Length&quot;</span> <span class="token operator">=</span> <span class="token number">0</span>
                                                                        <span class="token string">&quot;Content-Type&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;application/vnd.yt-ump&quot;</span>
                                                                        Server <span class="token operator">=</span> <span class="token string">&quot;atomos-tproxy 1.0&quot;</span>
                                                                    <span class="token punctuation">}</span>
                                                                <span class="token punctuation">}</span>

                                                        NSError HAMErrorWithURLResponse<span class="token operator">:</span>userInfo<span class="token operator">:</span>request<span class="token operator">:</span>
                                                            某次的参数：
                                                                response<span class="token operator">=</span><span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x281464760</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                userInfo<span class="token operator">=</span><span class="token punctuation">{</span>
                                                                    HAMRequestNumberLoadTaskKey <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                                request<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x2810f1090</span><span class="token operator">&gt;</span>

                                                            v22 <span class="token operator">=</span> <span class="token function">objc_msgSend</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>v7<span class="token punctuation">,</span> <span class="token string">&quot;HAMErrorWithCode:userInfo:&quot;</span><span class="token punctuation">,</span> v20<span class="token operator">=</span><span class="token number">6000</span><span class="token punctuation">,</span> v14<span class="token operator">=</span>userInfoDict<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                                NSError HAMErrorWithCode<span class="token operator">:</span>userInfo<span class="token operator">:</span>
                                                                    某次的参数：
                                                                        hamErrCode<span class="token operator">=</span><span class="token number">6000</span><span class="token punctuation">,</span>
                                                                        userInfo<span class="token operator">=</span>dict

                                                                    <span class="token keyword">return</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token function">objc_msgSend</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>self<span class="token punctuation">,</span> <span class="token string">&quot;errorWithDomain:code:userInfo:&quot;</span><span class="token punctuation">,</span> <span class="token function">CFSTR</span><span class="token punctuation">(</span><span class="token string">&quot;com.google.ios.hamplayer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a3<span class="token punctuation">,</span> a4<span class="token punctuation">)</span><span class="token punctuation">;</span>

                                                                    某次的返回值：
                                                                        Error Domain<span class="token operator">=</span>com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>hamplayer
                                                                        Code<span class="token operator">=</span><span class="token number">6000</span> <span class="token string">&quot;(null)&quot;</span>
                                                                        UserInfo<span class="token operator">=</span><span class="token punctuation">{</span>
                                                                            HAMErrorHTTPURLResponse<span class="token operator">=</span><span class="token operator">&lt;</span>NSHTTPURLResponse<span class="token operator">:</span> <span class="token number">0x281ceda60</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                                                    URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr5---sn-q4flrnee.googlevideo.com/videoplayback?expire=1654110110&amp;ei=PmOXYpHwG-6Rlu8P0LO9yAQ&amp;ip=72.179.224.229&amp;id=o-ANJ-ePUG7jWZMQ_icM7pjIuiwW8IEgTemHHlekQlItK_&amp;source=youtube&amp;requiressl=yes&amp;mh=aT&amp;mm=31,29&amp;mn=sn-q4flrnee,sn-q4fl6ns7&amp;ms=au,rdu&amp;mv=m&amp;mvi=5&amp;pl=21&amp;ctier=A&amp;initcwndbps=1480000&amp;svpuc=1&amp;sabr=1&amp;mt=1654088228&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgTokhxlKrvIZN4PZHmqi4CCoCk-_Bdgi_WTIIrlx1Y7ICIGr2dSn6txZUrrMdum-VwuQ8TbwSK-HTPVVZB28aPwO-&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgGW-eIbWvW75lrbGlodLzWTMVtDL7KtlxEW-gROi_6_kCIQDwf7k8v2jZdCDAY9KKlCf_k_T4IsKDoL2nm-49RdhBfQ%3D%3D&amp;cpn=F98L8S2i9bcH06us&amp;rn=2&amp;rn=3</span>
                                                                                <span class="token punctuation">}</span>
                                                                                <span class="token punctuation">{</span>
                                                                                    Status Code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                                                                                    Headers <span class="token punctuation">{</span>
                                                                                        Connection <span class="token operator">=</span> <span class="token string">&quot;keep-alive&quot;</span>
                                                                                        <span class="token string">&quot;Content-Length&quot;</span> <span class="token operator">=</span> <span class="token number">0</span>
                                                                                        Server <span class="token operator">=</span> <span class="token string">&quot;atomos-tproxy 1.0&quot;</span>
                                                                                    <span class="token punctuation">}</span>
                                                                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                                            HAMRequestNumberLoadTaskKey<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
                                                                            HAMErrorURLRequest<span class="token operator">=</span><span class="token operator">&lt;</span>NSMutableURLRequest<span class="token operator">:</span> <span class="token number">0x281886580</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                                                                                URL<span class="token operator">:</span> https<span class="token operator">:</span><span class="token comment">//rr5---sn-q4flrnee.googlevideo.com/videoplayback?expire=1654110110&amp;ei=PmOXYpHwG-6Rlu8P0LO9yAQ&amp;ip=72.179.224.229&amp;id=o-ANJ-ePUG7jWZMQ_icM7pjIuiwW8IEgTemHHlekQlItK_&amp;source=youtube&amp;requiressl=yes&amp;mh=aT&amp;mm=31,29&amp;mn=sn-q4flrnee,sn-q4fl6ns7&amp;ms=au,rdu&amp;mv=m&amp;mvi=5&amp;pl=21&amp;ctier=A&amp;initcwndbps=1480000&amp;svpuc=1&amp;sabr=1&amp;mt=1654088228&amp;fvip=2&amp;keepalive=yes&amp;fexp=24001373,24007246&amp;c=IOS&amp;sparams=expire,ei,ip,id,source,requiressl,ctier,svpuc,sabr&amp;sig=AOq0QJ8wRAIgTokhxlKrvIZN4PZHmqi4CCoCk-_Bdgi_WTIIrlx1Y7ICIGr2dSn6txZUrrMdum-VwuQ8TbwSK-HTPVVZB28aPwO-&amp;lsparams=mh,mm,mn,ms,mv,mvi,pl,initcwndbps&amp;lsig=AG3C_xAwRQIgGW-eIbWvW75lrbGlodLzWTMVtDL7KtlxEW-gROi_6_kCIQDwf7k8v2jZdCDAY9KKlCf_k_T4IsKDoL2nm-49RdhBfQ%3D%3D&amp;cpn=F98L8S2i9bcH06us&amp;rn=2&amp;rn=3</span>
                                                                            <span class="token punctuation">}</span>
                                                                        <span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

当 去掉广告过滤 时，调用到 MLServerABRLoader onesieDataLoader<span class="token operator">:</span>didCompleteChunks<span class="token operator">:</span>withError<span class="token operator">:</span> 的顺序：

<span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieChunkLoadTask initWithRange<span class="token operator">:</span>chunks<span class="token operator">:</span>dataBuffer<span class="token operator">:</span>cache<span class="token operator">:</span>delegate<span class="token operator">:</span>queue<span class="token operator">:</span>latencyLogger<span class="token operator">:</span><span class="token punctuation">]</span>
    sub_10380F8 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieChunkLoadTask initWithRange<span class="token operator">:</span>chunks<span class="token operator">:</span>dataBuffer<span class="token operator">:</span>cache<span class="token operator">:</span>delegate<span class="token operator">:</span>queue<span class="token operator">:</span>latencyLogger<span class="token operator">:</span><span class="token punctuation">]</span>_block
        sub_10381F8 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">[</span>MLOnesieChunkLoadTask initWithRange<span class="token operator">:</span>chunks<span class="token operator">:</span>dataBuffer<span class="token operator">:</span>cache<span class="token operator">:</span>delegate<span class="token operator">:</span>queue<span class="token operator">:</span>latencyLogger<span class="token operator">:</span><span class="token punctuation">]</span>_block_block <span class="token operator">+</span> <span class="token number">344</span> <span class="token operator">=</span> 
            <span class="token operator">-</span><span class="token punctuation">[</span>HAMBaseChunkLoadTask didCompleteWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">412</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>MLServerABROnesieDataLoader chunks<span class="token operator">:</span>didCompleteLoadingWithError<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">92</span>
                    MLServerABRLoader onesieDataLoader<span class="token operator">:</span>didCompleteChunks<span class="token operator">:</span>withError<span class="token operator">:</span>
                        参数举例：
                            <span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> 
                                arg1<span class="token operator">=</span><span class="token number">0x0000000282b42000</span><span class="token punctuation">,</span>
                                arg2<span class="token operator">=</span><span class="token number">1</span> element<span class="token punctuation">,</span>
                                arg3<span class="token operator">=</span>domain<span class="token operator">:</span> <span class="token string">&quot;com.google.ios.hamplayer&quot;</span> <span class="token operator">-</span> code<span class="token operator">:</span> <span class="token number">10000</span>
                            <span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">:</span> 
                                arg1<span class="token operator">=</span><span class="token operator">&lt;</span>MLServerABROnesieDataLoader<span class="token operator">:</span> <span class="token number">0x282bd5e80</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> 
                                arg2<span class="token operator">=</span><span class="token operator">&lt;</span>__NSSingleObjectArrayI <span class="token number">0x2807d1510</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
                                        <span class="token operator">&lt;</span>HAMMP4InitializationChunk<span class="token operator">:</span> <span class="token number">0x282bc3b80</span><span class="token operator">&gt;</span>
                                    <span class="token punctuation">)</span>
                                arg3<span class="token operator">=</span><span class="token constant">NULL</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

下面是：MLServerABRLoader initWithQueue 的调用顺序

<span class="token operator">-</span><span class="token punctuation">[</span>GPCPromise resolveChild<span class="token operator">:</span><span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">128</span>
    <span class="token operator">-</span><span class="token punctuation">[</span>YTVideoResolver registerCompletionBlocksOnPlaybackDataLoader<span class="token punctuation">]</span>_block <span class="token operator">+</span> <span class="token number">64</span>
        <span class="token operator">-</span><span class="token punctuation">[</span>YTVideoResolver didLoadVideoWithPlaybackData<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">108</span>
            <span class="token operator">-</span><span class="token punctuation">[</span>YTVideoResolver changeToState<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">92</span>
                <span class="token operator">-</span><span class="token punctuation">[</span>YTLocalPlaybackController videoResolver<span class="token operator">:</span>didChangeFromState<span class="token operator">:</span>toState<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">488</span>
                    <span class="token operator">-</span><span class="token punctuation">[</span>YTLocalPlaybackController startPlaybackWithVideoResolver<span class="token operator">:</span>internallyPrebufferedVideoController<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">2184</span>
                        YTAdsControlFlowPlaybackCoordinator startPrerollAdBreak
                            <span class="token operator">-</span><span class="token punctuation">[</span>YTAdsControlFlowPlaybackCoordinator startPrerollAdBreak<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">52</span>
                                <span class="token operator">-</span><span class="token punctuation">[</span>YTAdsControlFlowPlaybackCoordinator doneWithPlayerBytesSlotWithBreakType<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">80</span>
                                    <span class="token operator">-</span><span class="token punctuation">[</span>YTLocalPlaybackController adsPlaybackCoordinator<span class="token operator">:</span>didFinishBreakWithBreakType<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">68</span>
                                        <span class="token operator">-</span><span class="token punctuation">[</span>YTSingleVideoSequencer activateContentSequence<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">224</span>
                                            <span class="token operator">-</span><span class="token punctuation">[</span>YTSingleVideoSequencer activateVideoController<span class="token operator">:</span>reloadContext<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">248</span>
                                                <span class="token operator">-</span><span class="token punctuation">[</span>YTSingleVideoController initializeAndLoadWithViewportSizeProvider<span class="token operator">:</span>playerVisibility<span class="token operator">:</span>reloadContext<span class="token operator">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">860</span>
                                                    <span class="token operator">-</span><span class="token punctuation">[</span>MLHAMQueuePlayer load<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">220</span>
                                                        <span class="token operator">-</span><span class="token punctuation">[</span>MLHAMPlayerItem load<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">3088</span>

                                                            MLServerABRLoader initWithQueue<span class="token operator">:</span>dataLoader<span class="token operator">:</span>playerEventCenter<span class="token operator">:</span>playerItemEventCenter<span class="token operator">:</span>streamingData<span class="token operator">:</span>mediaCommonConfig<span class="token operator">:</span>hamplayerConfig<span class="token operator">:</span>onesieVideoData<span class="token operator">:</span>QOEController<span class="token operator">:</span>loadRetryPolicy<span class="token operator">:</span>isLiveSource<span class="token operator">:</span>livePlayerConfig<span class="token operator">:</span>windowedLiveConfig<span class="token operator">:</span>metadata
                                                                说明：某次调试时参数：
                                                                    arg1<span class="token operator">=</span><span class="token operator">&lt;</span>OS_dispatch_queue_serial<span class="token operator">:</span> MLHAMPlayer<span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                    dataLoader<span class="token operator">=</span><span class="token operator">&lt;</span>HAMCronetDataLoader<span class="token operator">:</span> <span class="token number">0x281782e20</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                    playerEventCenter<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                    playerItemEventCenter<span class="token operator">=</span><span class="token operator">&lt;</span>MLPlayerItemEventCenter<span class="token operator">:</span> <span class="token number">0x2833eb6b0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                    streamingData<span class="token operator">=</span><span class="token operator">&lt;</span>MLStreamingData<span class="token operator">:</span> <span class="token number">0x2801f8940</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                    mediaCommonConfig<span class="token operator">=</span><span class="token operator">&lt;</span>YTIMediaCommonConfig <span class="token number">0x282a39200</span><span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                                                        dynamic_readahead_config <span class="token punctuation">{</span>
                                                                            max_read_ahead_media_time_ms<span class="token operator">:</span> <span class="token number">8000</span>
                                                                            min_read_ahead_media_time_ms<span class="token operator">:</span> <span class="token number">15000</span>
                                                                            read_ahead_growth_rate_ms<span class="token operator">:</span> <span class="token number">1000</span>
                                                                        <span class="token punctuation">}</span>
                                                                        media_ustreamer_request_config <span class="token punctuation">{</span>
                                                                            video_playback_use_ump<span class="token operator">:</span> true
                                                                            video_playback_ustreamer_config<span class="token operator">:</span> <span class="token string">&quot;\n\317\003\n\326\002\010\000\020\200\005\030\350\002%\372~\252&gt;-\000\000\200?5=\n\227?h\001r9\n\022mfs2_cmfs_v3_1_043\022\037\n\035\n\014device_model\022\r\n\013\n\tiphone9,1\030\000 \001r\026\n\022mfs2_cmfs_v3_1_043\030\000x\350\002\200\001\001\250\001\001\265\001\366(\334?\240\002\350\002\332\002\\\020\260\352\001\030\250F \240\234\001(\33060\230uH\001P\001X\001h\001p\210\&apos;\200\001\364\003\270\001\001\300\001\001\340\001\003\370\001\001\210\002\001\220\002\001\230\002\014\240\002\001\250\002\001\260\002\001\270\002\001\300\002\001\310\002\001\320\002\002\340\002\001\350\002\002\200\003\002\220\003\001\370\265\221\345\014\001\372\002-\010\014\020\030\0302 2-\000\000pB5\000\000\214B@\001H\001P\nX\ne\000\000\200@h\300pp\001\210\001\001\315\001\000\000\200?\202\003\000\210\003\001\220\003\001\240\003\001\250\003\001\260\003\003\310\003\001\320\003\001\330\003\001\340\003\220N\270\004\001\312\004\035\n\024\010\300&gt;\020\230u\030\350\007%\000\000\000\000(\0000\000@\001\020\340\324\003\030\320\017\360\004\001\370\004\001\030\001 \0012\014\010\211\001\020\257\267\220\271\236\212\367\0022\014\010\210\001\020\314\203\356\267\236\212\367\0022\014\010\207\001\020\343\206\301\271\236\212\367\0022\014\010\206\001\020\366\305\356\267\236\212\367\0022\014\010\205\001\020\306\327\220\271\236\212\367\0022\014\010\240\001\020\236\312\314\270\236\212\367\0022\014\010\213\001\020\217\354\253\267\236\212\367\0022\014\010\214\001\020\266\312\253\267\236\212\367\002:\000\022L\000\362\330\357\3010E\002!\000\230\215\&apos;\203G\270\247?\020\342\310\337E\255\271;\354\266\367\210\342\0247\233~\206\3612l\177\363\200\002 ^\262\221\336\225\324\217B\213H\327r\217\352\327]\335\253E*Y_\210\216\tI\336\027bA\274\177\032\002ei&quot;</span>
                                                                        <span class="token punctuation">}</span>
                                                                        server_readahead_config <span class="token punctuation">{</span>
                                                                            enable<span class="token operator">:</span> true
                                                                            next_request_policy <span class="token punctuation">{</span>
                                                                                target_audio_readahead_ms<span class="token operator">:</span> <span class="token number">120000</span>
                                                                                target_video_readahead_ms<span class="token operator">:</span> <span class="token number">120000</span>
                                                                            <span class="token punctuation">}</span>
                                                                        <span class="token punctuation">}</span>
                                                                        use_server_driven_abr<span class="token operator">:</span> true
                                                                        sabr_client_config <span class="token punctuation">{</span>
                                                                            default_back_off_time_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                            enable_host_fallback<span class="token operator">:</span> true
                                                                            primary_probing_delay_ms<span class="token operator">:</span> <span class="token number">5000</span>
                                                                            max_failure_attempts_before_fallback<span class="token operator">:</span> <span class="token number">2</span>
                                                                        <span class="token punctuation">}</span>
                                                                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                                    hamplayerConfig<span class="token operator">=</span><span class="token operator">&lt;</span>YTIHamplayerConfig <span class="token number">0x110ca4440</span><span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                                                        enable_on_cellular<span class="token operator">:</span> true
                                                                        qos_class<span class="token operator">:</span> IOS_QOS_CLASS_USER_INITIATED
                                                                        decode_qos_class<span class="token operator">:</span> IOS_QOS_CLASS_USER_INITIATED
                                                                        video_track_renderer <span class="token punctuation">{</span>
                                                                            hamplayer_pixel_buffer_video_track_renderer_config <span class="token punctuation">{</span>
                                                                                min_frame_queue_size<span class="token operator">:</span> <span class="token number">3</span>
                                                                                target_frame_queue_size<span class="token operator">:</span> <span class="token number">22</span>
                                                                                max_frame_fall_behind_ms<span class="token operator">:</span> <span class="token number">500</span>
                                                                                queue_more_frames_on_render<span class="token operator">:</span> true
                                                                            <span class="token punctuation">}</span>
                                                                        <span class="token punctuation">}</span>
                                                                        stall_predictor <span class="token punctuation">{</span>
                                                                            hamplayer_default_stall_predictor_config <span class="token punctuation">{</span>
                                                                                max_buffer_readahead_ms<span class="token operator">:</span> <span class="token number">8000</span>
                                                                                min_buffer_readahead_ms<span class="token operator">:</span> <span class="token number">1500</span>
                                                                                bandwidth_tweak_scalar<span class="token operator">:</span> <span class="token number">0.95</span>
                                                                                bandwidth_tweak_constant<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">48000</span>
                                                                            <span class="token punctuation">}</span>
                                                                        <span class="token punctuation">}</span>
                                                                        live <span class="token punctuation">{</span>
                                                                            enable_accurate_seek<span class="token operator">:</span> false
                                                                            accurate_seek_retry_limit<span class="token operator">:</span> <span class="token number">3</span>
                                                                            enable_accurate_seek_after_prepared<span class="token operator">:</span> false
                                                                            enable_ss_dai_emsg_parsing<span class="token operator">:</span> true
                                                                            enable_ss_dai_update_chunk_start_time<span class="token operator">:</span> true
                                                                            fix_post_live_head_segment<span class="token operator">:</span> false
                                                                            finish_live_playback_if_stream_completed<span class="token operator">:</span> false
                                                                        <span class="token punctuation">}</span>
                                                                        async_decode<span class="token operator">:</span> true
                                                                        network_stats_sampler_config <span class="token punctuation">{</span>
                                                                            minimum_sample_size<span class="token operator">:</span> <span class="token number">8192</span>
                                                                            minimum_sample_duration_ms<span class="token operator">:</span> <span class="token number">1</span>
                                                                            target_sample_duration_ms<span class="token operator">:</span> <span class="token number">400</span>
                                                                        <span class="token punctuation">}</span>
                                                                        decode_teardown_on_decode_queue<span class="token operator">:</span> true
                                                                        decode_wait_for_frames_before_teardown<span class="token operator">:</span> true
                                                                        decode_separate_queues<span class="token operator">:</span> true
                                                                        decode_no_wait_for_terminate<span class="token operator">:</span> true
                                                                        resync_policy_config <span class="token punctuation">{</span>
                                                                            target_readahead_ms<span class="token operator">:</span> <span class="token number">2000</span>
                                                                            min_required_time_ms<span class="token operator">:</span> <span class="token number">500</span>
                                                                            max_elapsed_time_ms<span class="token operator">:</span> <span class="token number">10000</span>
                                                                            seek_tolerance_ms<span class="token operator">:</span> <span class="token number">1000</span>
                                                                        <span class="token punctuation">}</span>
                                                                        audio_abr_config <span class="token punctuation">{</span>
                                                                            downshift_scalar<span class="token operator">:</span> <span class="token number">3</span>
                                                                            downshift_constant<span class="token operator">:</span> <span class="token number">0</span>
                                                                            upshift_scalar<span class="token operator">:</span> <span class="token number">6</span>
                                                                            upshift_constant<span class="token operator">:</span> <span class="token number">0</span>
                                                                            max_downshift_readahead_ms<span class="token operator">:</span> <span class="token number">30000</span>
                                                                            min_upshift_readahead_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                            upshift_replace_media<span class="token operator">:</span> false
                                                                            buffer_target_readahead<span class="token operator">:</span> <span class="token number">8</span>
                                                                            buffer_max_size_bytes<span class="token operator">:</span> <span class="token number">107374182</span>
                                                                            buffer_trim_behind<span class="token operator">:</span> <span class="token number">60</span>
                                                                            buffer_trim_ahead<span class="token operator">:</span> <span class="token number">120</span>
                                                                            max_chunks_per_request<span class="token operator">:</span> <span class="token number">0</span>
                                                                            sync_readahead<span class="token operator">:</span> <span class="token number">10</span>
                                                                            stun_duration<span class="token operator">:</span> <span class="token number">0</span>
                                                                            max_consecutive_errors<span class="token operator">:</span> <span class="token number">0</span>
                                                                            min_upshift_replace_chunks_readahead_ms<span class="token operator">:</span> <span class="token number">5000</span>
                                                                            low_memory_warn_buffer_size_bytes<span class="token operator">:</span> <span class="token number">107374182</span>
                                                                            low_memory_critical_buffer_size_bytes<span class="token operator">:</span> <span class="token number">107374182</span>
                                                                            low_memory_buffer_size_cool_down_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                            disable_hdr_in_low_power_mode<span class="token operator">:</span> true
                                                                            observe_network_active_controller<span class="token operator">:</span> false
                                                                        <span class="token punctuation">}</span>
                                                                        video_abr_config <span class="token punctuation">{</span>
                                                                            downshift_scalar<span class="token operator">:</span> <span class="token number">1</span>
                                                                            downshift_constant<span class="token operator">:</span> <span class="token number">48000</span>
                                                                            upshift_scalar<span class="token operator">:</span> <span class="token number">1</span>
                                                                            upshift_constant<span class="token operator">:</span> <span class="token number">48000</span>
                                                                            oversend_factor<span class="token operator">:</span> <span class="token number">1.18</span>
                                                                            max_downshift_readahead_ms<span class="token operator">:</span> <span class="token number">30000</span>
                                                                            min_upshift_readahead_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                            upshift_replace_media<span class="token operator">:</span> false
                                                                            local_max_bitrate_readahead<span class="token operator">:</span> <span class="token number">15</span>
                                                                            buffer_target_readahead<span class="token operator">:</span> <span class="token number">8</span>
                                                                            buffer_max_size_bytes<span class="token operator">:</span> <span class="token number">751619276</span>
                                                                            buffer_trim_behind<span class="token operator">:</span> <span class="token number">60</span>
                                                                            buffer_trim_ahead<span class="token operator">:</span> <span class="token number">120</span>
                                                                            max_chunks_per_request<span class="token operator">:</span> <span class="token number">0</span>
                                                                            min_readahead_for_average_bitrate<span class="token operator">:</span> <span class="token number">10000</span>
                                                                            load_extra_formats<span class="token operator">:</span> false
                                                                            sync_readahead<span class="token operator">:</span> <span class="token number">10</span>
                                                                            stun_duration<span class="token operator">:</span> <span class="token number">10</span>
                                                                            use_high_replication_formats_while_stunned<span class="token operator">:</span> true
                                                                            max_consecutive_errors<span class="token operator">:</span> <span class="token number">4</span>
                                                                            min_upshift_replace_chunks_readahead_ms<span class="token operator">:</span> <span class="token number">5000</span>
                                                                            max_media_seconds_per_request<span class="token operator">:</span> <span class="token number">11</span>
                                                                            low_memory_warn_buffer_size_bytes<span class="token operator">:</span> <span class="token number">751619276</span>
                                                                            low_memory_critical_buffer_size_bytes<span class="token operator">:</span> <span class="token number">751619276</span>
                                                                            low_memory_buffer_size_cool_down_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                            disable_hdr_in_low_power_mode<span class="token operator">:</span> true
                                                                            hpq_oversend_factor<span class="token operator">:</span> <span class="token number">1.72</span>
                                                                            observe_network_active_controller<span class="token operator">:</span> false
                                                                        <span class="token punctuation">}</span>
                                                                        enable_airplay_audio<span class="token operator">:</span> true
                                                                        chunk_loader_config <span class="token punctuation">{</span>
                                                                            enable_fallback_host<span class="token operator">:</span> true
                                                                            max_failure_attempts_before_fallback<span class="token operator">:</span> <span class="token number">3</span>
                                                                            primary_probing_delay<span class="token operator">:</span> <span class="token number">5000</span>
                                                                            treat_no_media_as_cancellation<span class="token operator">:</span> true
                                                                        <span class="token punctuation">}</span>
                                                                        sbar_audio_track_renderer <span class="token punctuation">{</span>
                                                                            samples_per_buffer<span class="token operator">:</span> <span class="token number">10</span>
                                                                            flush_on_return_from_background<span class="token operator">:</span> true
                                                                            trim_priming<span class="token operator">:</span> false
                                                                            feed_media_data<span class="token operator">:</span> true
                                                                            handle_automatic_flush<span class="token operator">:</span> true
                                                                            renderer_max_retry_count<span class="token operator">:</span> <span class="token number">2</span>
                                                                            use_all_tracks_for_playability_status<span class="token operator">:</span> false
                                                                        <span class="token punctuation">}</span>
                                                                        use_multiple_periods_player<span class="token operator">:</span> true
                                                                        load_retry_config <span class="token punctuation">{</span>
                                                                            max_non_network_errors<span class="token operator">:</span> <span class="token number">2</span>
                                                                        <span class="token punctuation">}</span>
                                                                        render_view_type<span class="token operator">:</span> HAMPLAYER_RENDER_VIEW_TYPE_IOSURFACE_MAIN_THREAD
                                                                        server_abr_config <span class="token punctuation">{</span>
                                                                            fallback_on_error<span class="token operator">:</span> true
                                                                            fallback_disable_server_abr_duration_seconds<span class="token operator">:</span> <span class="token number">5</span>
                                                                            enable_local_streams<span class="token operator">:</span> false
                                                                            log_partial_chunk_eviction<span class="token operator">:</span> false
                                                                            max_fallback_attempts<span class="token operator">:</span> <span class="token number">5</span>
                                                                            seek_through_medialib_when_receiving_partial_chunk<span class="token operator">:</span> false
                                                                            continue_loading_timer_interval_ms<span class="token operator">:</span> <span class="token number">1000</span>
                                                                            continue_loading_timer_leeway_ms<span class="token operator">:</span> <span class="token number">100</span>
                                                                            cover_chunk_discontinuity<span class="token operator">:</span> true
                                                                            keep_stall_for_live_when_close_to_seekable_end<span class="token operator">:</span> false
                                                                            allow_multiple_server_seek<span class="token operator">:</span> true
                                                                            use_reload_context_for_fallback<span class="token operator">:</span> true
                                                                        <span class="token punctuation">}</span>
                                                                        use_new_sample_buffer_source<span class="token operator">:</span> true
                                                                        stop_track_renderer_before_disabling<span class="token operator">:</span> true
                                                                        log_debug_details_on_long_wait_threshold_ms<span class="token operator">:</span> <span class="token number">15000</span>
                                                                        deprecate_stall_predictor<span class="token operator">:</span> true
                                                                        player_loop_timer_interval_ms<span class="token operator">:</span> <span class="token number">20</span>
                                                                        player_loop_timer_leeway_ms<span class="token operator">:</span> <span class="token number">0</span>
                                                                        offline_config <span class="token punctuation">{</span>
                                                                            downloader_apply_audio_track_filter<span class="token operator">:</span> false
                                                                            downloader_apply_abr_filter<span class="token operator">:</span> false
                                                                        <span class="token punctuation">}</span>
                                                                        select_default_track_for_multi_audio<span class="token operator">:</span> true
                                                                        use_reload_context_request_number<span class="token operator">:</span> true
                                                                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                                onesieVideoData<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                QOEController<span class="token operator">=</span><span class="token operator">&lt;</span>MLQOEPingController<span class="token operator">:</span> <span class="token number">0x115df0ef0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                loadRetryPolicy<span class="token operator">=</span><span class="token operator">&lt;</span>MLDefaultLoadRetryPolicy<span class="token operator">:</span> <span class="token number">0x28385b160</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                isLiveSource<span class="token operator">=</span>False<span class="token punctuation">,</span>
                                                                livePlayerConfig<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                windowedLiveConfig<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                metadataRelay<span class="token operator">=</span><span class="token operator">&lt;</span>MLHAMManifestlessMetadataCollector<span class="token operator">:</span> <span class="token number">0x281551f80</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                delegate<span class="token operator">=</span><span class="token operator">&lt;</span>MLHAMPlayerItem<span class="token operator">:</span> <span class="token number">0x122203240</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                latencyLogger<span class="token operator">=</span><span class="token operator">&lt;</span>YTWatchLatencyTickLogger<span class="token operator">:</span> <span class="token number">0x2801ea200</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                                                watchEndpointUstreamerConfig<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                periodID<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                                                                firstRequestNumber<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                                                cache<span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
</code></pre>
<footer class="page-footer"><span class="copyright">crifan.org，使用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">署名4.0国际(CC BY 4.0)协议</a>发布 all right reserved，powered by Gitbook</span><span class="footer-modification">最后更新：
2022-10-27 11:05:54
</span></footer></body></html>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ida_code.html" class="navigation navigation-prev " aria-label="Previous page: IDA伪代码">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="common_url.html" class="navigation navigation-next " aria-label="Next page: 常见url">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"函数调用逻辑","level":"1.4.2.3","depth":3,"next":{"title":"常见url","level":"1.4.2.4","depth":3,"path":"re_yt_output/yt_ads_filter/common_url.md","ref":"re_yt_output/yt_ads_filter/common_url.md","articles":[]},"previous":{"title":"IDA伪代码","level":"1.4.2.2","depth":3,"path":"re_yt_output/yt_ads_filter/ida_code.md","ref":"re_yt_output/yt_ads_filter/ida_code.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-comscore","anchors","expandable-menu","-lunr","-search","search-plus","disqus","-highlight","prism","prism-themes","github-buttons","-splitter","splitter-nosessionbutcookie","-sharing","sharing-plus","tbfed-pagefooter","donate","sitemap-general","copy-code-button","callouts","toolbar-button"],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"crifan.org，使用<a href='https://creativecommons.org/licenses/by/4.0/deed.zh'>署名4.0国际(CC BY 4.0)协议</a>发布","modify_label":"最后更新：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"disqus":{"useIdentifier":false,"shortName":"crifan"},"callouts":{"showTypeInHeader":false},"toolbar-button":{"label":"下载PDF","url":"https://book.crifan.org/books/ios_re_youtube_reverse/pdf/ios_re_youtube_reverse.pdf","icon":"fa-file-pdf-o"},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"donate":{"title":"","button":"打赏","wechat":"https://www.crifan.org/files/res/crifan_com/crifan_wechat_pay.jpg","alipay":"https://www.crifan.org/files/res/crifan_com/crifan_alipay_pay.jpg","wechatText":"微信打赏给Crifan","alipayText":"支付宝打赏给Crifan"},"sitemap-general":{"prefix":"https://book.crifan.org/books/ios_re_youtube_reverse/website/"},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"splitter-nosessionbutcookie":{},"prism-themes":{},"github-buttons":{"buttons":[{"repo":"ios_re_youtube_reverse","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]},"expandable-menu":{},"copy-code-button":{},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","line","linkedin","messenger","pocket","qq","qzone","stumbleupon","twitter","viber","vk","weibo","whatsapp"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"search-plus":{}},"theme":"default","author":"Crifan Li <admin@crifan.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"iOS逆向开发：YouTube逆向","language":"zh-hans","links":{"sidebar":{"主页":"http://www.crifan.org"}},"gitbook":"*","description":"以YouTube逆向介绍典型的iOS逆向的流程。先是YouTube逆向概述，再是详细介绍iOS的YouTube逆向的详细过程，包括砸壳ipa以及安装ipa、静态分析的导出头文件、IDA分析代码逻辑、动态调试的分析界面元素和MonkeyDev调试，其中界面分析用Reveal、Cycript；MonkeyDev调试典型逻辑是，猜测类和函数、写hook代码、加断点调试；期间涉及到恢复符号表、Charles抓包；然后介绍逆向的产出和相关总结；产出包括app内部逻辑和广告过滤相关内容；以及相关子教程。"},"file":{"path":"re_yt_output/yt_ads_filter/func_call.md","mtime":"2022-10-27T03:05:54.676Z","type":"markdown"},"gitbook":{"version":"3.7.1","time":"2022-11-06T09:57:36.174Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-toolbar-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

