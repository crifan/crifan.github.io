
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>crifan版wda · iOS自动化测试利器：facebook-wda</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Crifan Li <admin@crifan.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="element_process.html" />
    
    
    <link rel="prev" href="wda.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"repo":"ios_automation_facebook_wda","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://www.crifan.com" target="_blank" class="custom-link">主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../intro/">
            
                <a href="../intro/">
            
                    
                        <b>1.2.</b>
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../setup_environment/">
            
                <a href="../setup_environment/">
            
                    
                        <b>1.3.</b>
                    
                    搭建环境
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../setup_environment/note_common_qa/">
            
                <a href="../setup_environment/note_common_qa/">
            
                    
                        <b>1.3.1.</b>
                    
                    常见问题和心得
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../setup_environment/note_common_qa/xcode_build_webdriveragent_xcodeproj.html">
            
                <a href="../setup_environment/note_common_qa/xcode_build_webdriveragent_xcodeproj.html">
            
                    
                        <b>1.3.1.1.</b>
                    
                    XCode编译WebDriverAgent.xcodeproj
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../summary/">
            
                <a href="../summary/">
            
                    
                        <b>1.4.</b>
                    
                    开发心得
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../summary/weditor.html">
            
                <a href="../summary/weditor.html">
            
                    
                        <b>1.4.1.</b>
                    
                    weditor
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../ios_pitfall/">
            
                <a href="../ios_pitfall/">
            
                    
                        <b>1.5.</b>
                    
                    iOS的各种坑
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../ios_pitfall/get_source_xml.html">
            
                <a href="../ios_pitfall/get_source_xml.html">
            
                    
                        <b>1.5.1.</b>
                    
                    获取源码xml
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.6.</b>
                    
                    常用代码段
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="wda.html">
            
                <a href="wda.html">
            
                    
                        <b>1.6.1.</b>
                    
                    wda
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.6.1.1" data-path="crifan_wda.html">
            
                <a href="crifan_wda.html">
            
                    
                        <b>1.6.1.1.</b>
                    
                    crifan版wda
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="element_process.html">
            
                <a href="element_process.html">
            
                    
                        <b>1.6.2.</b>
                    
                    元素处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="ios_device.html">
            
                <a href="ios_device.html">
            
                    
                        <b>1.6.3.</b>
                    
                    iOS设备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="app/">
            
                <a href="app/">
            
                    
                        <b>1.6.4.</b>
                    
                    app
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="app/manage_app.html">
            
                <a href="app/manage_app.html">
            
                    
                        <b>1.6.4.1.</b>
                    
                    app管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.2" data-path="app/first_run_guide.html">
            
                <a href="app/first_run_guide.html">
            
                    
                        <b>1.6.4.2.</b>
                    
                    首次登录引导页
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.3" data-path="app/weixin/">
            
                <a href="app/weixin/">
            
                    
                        <b>1.6.4.3.</b>
                    
                    微信
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.3.1" data-path="app/weixin/safe_mode.html">
            
                <a href="app/weixin/safe_mode.html">
            
                    
                        <b>1.6.4.3.1.</b>
                    
                    安全模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.3.2" data-path="app/weixin/public_account.html">
            
                <a href="app/weixin/public_account.html">
            
                    
                        <b>1.6.4.3.2.</b>
                    
                    微信公众号
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4.4" data-path="app/settings/">
            
                <a href="app/settings/">
            
                    
                        <b>1.6.4.4.</b>
                    
                    设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.4.1" data-path="app/settings/update_wifi_proxy.html">
            
                <a href="app/settings/update_wifi_proxy.html">
            
                    
                        <b>1.6.4.4.1.</b>
                    
                    更新WiFi代理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4.5" data-path="app/app_store/">
            
                <a href="app/app_store/">
            
                    
                        <b>1.6.4.5.</b>
                    
                    AppStore
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.5.1" data-path="app/app_store/auto_install_app.html">
            
                <a href="app/app_store/auto_install_app.html">
            
                    
                        <b>1.6.4.5.1.</b>
                    
                    自动安装app
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="process_popup.html">
            
                <a href="process_popup.html">
            
                    
                        <b>1.6.5.</b>
                    
                    弹框处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="debug_assist.html">
            
                <a href="debug_assist.html">
            
                    
                        <b>1.6.6.</b>
                    
                    调试辅助
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../source_analysis/">
            
                <a href="../source_analysis/">
            
                    
                        <b>1.7.</b>
                    
                    源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../appendix/">
            
                <a href="../appendix/">
            
                    
                        <b>1.8.</b>
                    
                    附录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../appendix/ios_app_bundle_id.html">
            
                <a href="../appendix/ios_app_bundle_id.html">
            
                    
                        <b>1.8.1.</b>
                    
                    iOS内置app的bundle id
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../appendix/doc.html">
            
                <a href="../appendix/doc.html">
            
                    
                        <b>1.8.2.</b>
                    
                    文档
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../appendix/reference.html">
            
                <a href="../appendix/reference.html">
            
                    
                        <b>1.8.3.</b>
                    
                    参考资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >crifan版wda</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="crifan&#x7248;wda"><a name="crifan&#x7248;wda" class="plugin-anchor" href="#crifan&#x7248;wda"><i class="fa fa-link" aria-hidden="true"></i></a>crifan&#x7248;wda</h1>
<p>&#x6B64;&#x5904;&#x8C03;&#x8BD5;&#x671F;&#x95F4;&#xFF0C;&#x5DF2;&#x7ECF;&#x57FA;&#x4E8E;<code>v0.7.2</code>&#x7684;&#x539F;&#x7248;<a href="https://github.com/openatx/facebook-wda/tree/0.7.2" target="_blank">openatx&#x7684;facebook-wda</a>&#x505A;&#x4E86;&#x4E0D;&#x5C11;&#x6539;&#x52A8;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E8E;&#x652F;&#x6301;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#x529F;&#x80FD;&#xFF0C;&#x548C;&#x4FEE;&#x590D;&#x4E86;&#x4E00;&#x4E9B;bug&#x3002;</p>
<p>&#x6709;&#x9700;&#x8981;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x4E0B;&#x9762;&#x6E90;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x66FF;&#x6362;&#x5DF2;&#x5B89;&#x88C5;&#x597D;&#x7684;<code>wda</code></p>
<p>&#x6CE8;&#xFF1A;&#x5DF2;&#x5B89;&#x88C5;&#x597D;&#x7684;wda&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6B64;&#x5904;&#x662F;<code>/Users/limao/.pyenv/versions/3.8.0/Python.framework/Versions/3.8/lib/python3.8/site-packages/wda/__init__.py</code>&#xFF0C;&#x4F9B;&#x53C2;&#x8003;&#x3002;</p>
<h2 id="crifan&#x7248;wda&#x6E90;&#x7801;"><a name="crifan&#x7248;wda&#x6E90;&#x7801;" class="plugin-anchor" href="#crifan&#x7248;wda&#x6E90;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>crifan&#x7248;wda&#x6E90;&#x7801;</h2>
<ul>
<li>&#x5728;&#x7EBF;&#x4E0B;&#x8F7D;&#xFF1A;<ul>
<li><a href="https://book.crifan.com/books/ios_automation_facebook_wda/website/assets/file/crifan_wda__init__.py" target="_blank">crifan&#x7248;wda <code>__init__.py</code></a></li>
</ul>
</li>
<li>&#x76F4;&#x63A5;&#x8D34;&#x51FA;&#x6E90;&#x7801;&#xFF1A;</li>
</ul>
<pre class="language-"><code class="lang-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># Updated: 20200609 17:01</span>
<span class="token comment"># Editor: Crifan Li</span>

<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> print_function<span class="token punctuation">,</span> unicode_literals

<span class="token keyword">import</span> base64
<span class="token keyword">import</span> copy
<span class="token keyword">import</span> functools
<span class="token keyword">import</span> io
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict<span class="token punctuation">,</span> namedtuple

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> retry
<span class="token keyword">import</span> six
<span class="token keyword">from</span> six<span class="token punctuation">.</span>moves <span class="token keyword">import</span> urllib
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> functools <span class="token keyword">import</span> cached_property <span class="token comment"># Python3.8+</span>
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    <span class="token keyword">from</span> cached_property <span class="token keyword">import</span> cached_property

<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> xcui_element_types

<span class="token keyword">import</span> logging
<span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

urlparse <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlparse
_urljoin <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urljoin

<span class="token keyword">if</span> six<span class="token punctuation">.</span>PY3<span class="token punctuation">:</span>
    <span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>

DEBUG <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># to change to logging -&gt; later can use colorful logging</span>
<span class="token keyword">print</span> <span class="token operator">=</span> logging<span class="token punctuation">.</span>debug

HTTP_TIMEOUT <span class="token operator">=</span> <span class="token number">60.0</span>  <span class="token comment"># unit second</span>

<span class="token comment"># RETRY_INTERVAL = 0.01</span>
RETRY_INTERVAL <span class="token operator">=</span> <span class="token number">0.1</span>

LANDSCAPE <span class="token operator">=</span> <span class="token string">&apos;LANDSCAPE&apos;</span>
PORTRAIT <span class="token operator">=</span> <span class="token string">&apos;PORTRAIT&apos;</span>
LANDSCAPE_RIGHT <span class="token operator">=</span> <span class="token string">&apos;UIA_DEVICE_ORIENTATION_LANDSCAPERIGHT&apos;</span>
PORTRAIT_UPSIDEDOWN <span class="token operator">=</span> <span class="token string">&apos;UIA_DEVICE_ORIENTATION_PORTRAIT_UPSIDEDOWN&apos;</span>

alert_callback <span class="token operator">=</span> <span class="token boolean">None</span>

JSONDecodeError <span class="token operator">=</span> json<span class="token punctuation">.</span>decoder<span class="token punctuation">.</span>JSONDecodeError <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>
    json<span class="token punctuation">.</span>decoder<span class="token punctuation">,</span> <span class="token string">&quot;JSONDecodeError&quot;</span><span class="token punctuation">)</span> <span class="token keyword">else</span> ValueError

<span class="token comment">################################################################################</span>
<span class="token comment"># Definition</span>
<span class="token comment">################################################################################</span>

<span class="token comment"># https://developer.apple.com/documentation/uikit/uidevice/1620042-batterylevel?language=objc</span>
<span class="token keyword">class</span> <span class="token class-name">BatteryState</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Unknown <span class="token operator">=</span> <span class="token number">0</span>
    Unplugged <span class="token operator">=</span> <span class="token number">1</span>
    Charging <span class="token operator">=</span> <span class="token number">2</span>
    Full <span class="token operator">=</span> <span class="token number">3</span>

<span class="token comment"># https://developer.apple.com/documentation/xctest/xctimagequality?language=objc</span>
<span class="token keyword">class</span> <span class="token class-name">ScreenshotQuality</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Original <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># lossless PNG image</span>
    Medium <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># high quality lossy JPEG image</span>
    Low <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># highly compressed lossy JPEG image</span>

<span class="token comment"># https://developer.apple.com/documentation/xctest/xcuiapplicationstate?language=objc</span>
<span class="token keyword">class</span> <span class="token class-name">ApplicationState</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Unknown <span class="token operator">=</span> <span class="token number">0</span>
    NotRunning <span class="token operator">=</span> <span class="token number">1</span>
    RunningBackgroundSuspended <span class="token operator">=</span> <span class="token number">2</span>
    RunningBackground <span class="token operator">=</span> <span class="token number">3</span>
    RunningForeground <span class="token operator">=</span> <span class="token number">4</span>


<span class="token keyword">class</span> <span class="token class-name">WDAError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; base wda error &quot;&quot;&quot;</span>


<span class="token keyword">class</span> <span class="token class-name">WDARequestError</span><span class="token punctuation">(</span>WDAError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> status<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>status <span class="token operator">=</span> status
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&apos;WDARequestError(status=%d, value=%s)&apos;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
                                                         self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">WDAEmptyResponseError</span><span class="token punctuation">(</span>WDAError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; response body is empty &quot;&quot;&quot;</span>


<span class="token keyword">class</span> <span class="token class-name">WDAElementNotFoundError</span><span class="token punctuation">(</span>WDAError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; element not found &quot;&quot;&quot;</span>


<span class="token keyword">class</span> <span class="token class-name">WDAElementNotDisappearError</span><span class="token punctuation">(</span>WDAError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; element not disappera &quot;&quot;&quot;</span>


<span class="token comment">################################################################################</span>
<span class="token comment"># Utils Functions</span>
<span class="token comment">################################################################################</span>

<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>dictionary<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Convert dict to namedtuple
    &quot;&quot;&quot;</span>
    <span class="token keyword">return</span> namedtuple<span class="token punctuation">(</span><span class="token string">&apos;GenericDict&apos;</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dictionary<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">**</span>dictionary<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">urljoin</span><span class="token punctuation">(</span><span class="token operator">*</span>urls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    The default urlparse.urljoin behavior look strange
    Standard urlparse.urljoin(&apos;http://a.com/foo&apos;, &apos;/bar&apos;)
    Expect: http://a.com/foo/bar
    Actually: http://a.com/bar

    This function fix that.
    &quot;&quot;&quot;</span>
    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>_urljoin<span class="token punctuation">,</span> <span class="token punctuation">[</span>u<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&apos;/&apos;</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> urls <span class="token keyword">if</span> u<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">&apos;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">roundint</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">namedlock</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Returns:
        threading.Lock
    &quot;&quot;&quot;</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>namedlock<span class="token punctuation">,</span> <span class="token string">&apos;locks&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        namedlock<span class="token punctuation">.</span>locks <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Lock<span class="token punctuation">)</span>
    <span class="token keyword">return</span> namedlock<span class="token punctuation">.</span>locks<span class="token punctuation">[</span>name<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">httpdo</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    thread safe http request
    &quot;&quot;&quot;</span>
    p <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">with</span> namedlock<span class="token punctuation">(</span>p<span class="token punctuation">.</span>scheme <span class="token operator">+</span> <span class="token string">&quot;://&quot;</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>netloc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> _unsafe_httpdo<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">_unsafe_httpdo</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">&apos;GET&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Do HTTP Request
    &quot;&quot;&quot;</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
        body <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token keyword">if</span> data <span class="token keyword">else</span> <span class="token string">&apos;&apos;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Shell: curl -X {method} -d &apos;{body}&apos; &apos;{url}&apos;&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            method<span class="token operator">=</span>method<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token operator">=</span>body <span class="token keyword">or</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">,</span> url<span class="token operator">=</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span>method<span class="token punctuation">,</span>
                                    url<span class="token punctuation">,</span>
                                    json<span class="token operator">=</span>data<span class="token punctuation">,</span>
                                    timeout<span class="token operator">=</span>HTTP_TIMEOUT<span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ConnectionError<span class="token punctuation">,</span>
            requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ReadTimeout<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">raise</span>

    <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
        ms <span class="token operator">=</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;Return ({:.0f}ms): {}&apos;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        retjson <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
        retjson<span class="token punctuation">[</span><span class="token string">&apos;status&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> retjson<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;status&apos;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> convert<span class="token punctuation">(</span>retjson<span class="token punctuation">)</span>
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>status <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> WDARequestError<span class="token punctuation">(</span>r<span class="token punctuation">.</span>status<span class="token punctuation">,</span> r<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token keyword">and</span> r<span class="token punctuation">.</span>value<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> WDARequestError<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># status:100 for new WebDriverAgent error</span>
        <span class="token keyword">return</span> r
    <span class="token keyword">except</span> JSONDecodeError<span class="token punctuation">:</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> WDAEmptyResponseError<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">raise</span> WDAError<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>


<span class="token comment">################################################################################</span>
<span class="token comment"># Main</span>
<span class="token comment">################################################################################</span>


<span class="token keyword">class</span> <span class="token class-name">HTTPClient</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">,</span> alert_callback<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            address (string): url address eg: http://localhost:8100
            alert_callback (func): function to call when alert popup
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>address <span class="token operator">=</span> address
        self<span class="token punctuation">.</span>alert_callback <span class="token operator">=</span> alert_callback

    <span class="token keyword">def</span> <span class="token function">new_client</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> HTTPClient<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>address<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&apos;/&apos;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>alert_callback<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_fetch_no_alert<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token comment"># return httpdo(urljoin(self.address, url), method, data)</span>

    <span class="token keyword">def</span> <span class="token function">_fetch_no_alert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        target_url <span class="token operator">=</span> urljoin<span class="token punctuation">(</span>self<span class="token punctuation">.</span>address<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> httpdo<span class="token punctuation">(</span>target_url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">except</span> WDARequestError <span class="token keyword">as</span> err<span class="token punctuation">:</span>
            <span class="token keyword">if</span> depth <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
            <span class="token keyword">if</span> err<span class="token punctuation">.</span>status <span class="token operator">!=</span> <span class="token number">26</span><span class="token punctuation">:</span>  <span class="token comment"># alert status code</span>
                <span class="token keyword">raise</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">callable</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alert_callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
            self<span class="token punctuation">.</span>alert_callback<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_fetch_no_alert<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> depth<span class="token operator">=</span>depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; Handle GET,POST,DELETE, etc ... &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fetch<span class="token punctuation">,</span> key<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> height

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&apos;Rect(x={x}, y={y}, width={w}, height={h})&apos;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            x<span class="token operator">=</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span>self<span class="token punctuation">.</span>y<span class="token punctuation">,</span> w<span class="token operator">=</span>self<span class="token punctuation">.</span>width<span class="token punctuation">,</span> h<span class="token operator">=</span>self<span class="token punctuation">.</span>height<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">center</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;calc center position&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> namedtuple<span class="token punctuation">(</span><span class="token string">&apos;Point&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;x&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;y&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
                                               self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">origin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> namedtuple<span class="token punctuation">(</span><span class="token string">&apos;Point&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;x&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;y&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">left</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">top</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>y

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">right</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">bottom</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">x0</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">y0</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>y

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">x1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">y1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">centerX</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># return self.center[&quot;x&quot;]</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">centerY</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token comment"># return self.center[&quot;y&quot;]</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">isZero</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        isXZero <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">==</span> <span class="token number">0</span>
        isYZero <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">==</span> <span class="token number">0</span>
        isWidthZero <span class="token operator">=</span> self<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token number">0</span>
        isHeightZero <span class="token operator">=</span> self<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token number">0</span>
        isAllZero <span class="token operator">=</span> isXZero <span class="token keyword">and</span> isYZero <span class="token keyword">and</span> isWidthZero <span class="token keyword">and</span> isHeightZero
        <span class="token keyword">return</span> isAllZero


<span class="token keyword">class</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> _session_id<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            target (string): the device url

        If target is empty, device url will set to env-var &quot;DEVICE_URL&quot; if defined else set to &quot;http://localhost:8100&quot;
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> url<span class="token punctuation">:</span>
            url <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;DEVICE_URL&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;http://localhost:8100&apos;</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r&quot;^https?://&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Invalid URL: %r&quot;</span> <span class="token operator">%</span> url

        self<span class="token punctuation">.</span>http <span class="token operator">=</span> HTTPClient<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

        <span class="token comment"># Session variable</span>
        self<span class="token punctuation">.</span>__session_id <span class="token operator">=</span> _session_id
        self<span class="token punctuation">.</span>__timeout <span class="token operator">=</span> <span class="token number">30.0</span>
        self<span class="token punctuation">.</span>__target <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">wait_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        wait until WDA back to normal

        Returns:
            bool (if wda works)
        &quot;&quot;&quot;</span>
        deadline <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeout
        <span class="token keyword">while</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> deadline<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    @retry<span class="token punctuation">.</span>retry<span class="token punctuation">(</span>exceptions<span class="token operator">=</span>WDAEmptyResponseError<span class="token punctuation">,</span> tries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> delay<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">status</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;status&apos;</span><span class="token punctuation">)</span>
        sid <span class="token operator">=</span> res<span class="token punctuation">.</span>sessionId
        res<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token string">&apos;sessionId&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> sid
        <span class="token keyword">return</span> res<span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Press home button&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/homescreen&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">healthcheck</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Hit healthcheck&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;/wda/healthcheck&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">locked</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; returns locked status, true or false &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/locked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">lock</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/lock&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">unlock</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; unlock screen, double press home &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/unlock&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">app_current</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            dict, eg:
            {
                &quot;running&quot; : true,
                &quot;state&quot; : 4,
                &quot;generation&quot; : 0,
                &quot;processArguments&quot; : {
                    &quot;env&quot; : {},
                    &quot;args&quot; : []
                },
                &quot;title&quot; : &quot;&quot;,
                &quot;bundleId&quot; : &quot;com.tencent.xin&quot;,
                &quot;label&quot; : &quot;&#x5FAE;&#x4FE1;&quot;,
                &quot;path&quot; : &quot;&quot;,
                &quot;name&quot; : &quot;&quot;,
                &quot;pid&quot; : 1357
            }
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/activeAppInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">source</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">&apos;xml&apos;</span><span class="token punctuation">,</span> accessible<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            format (str): only &apos;xml&apos; and &apos;json&apos; source types are supported
            accessible (bool): when set to true, format is always &apos;json&apos;
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> accessible<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;/wda/accessibleSource&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;source?format=&apos;</span> <span class="token operator">+</span> <span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">screenshot</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> png_filename<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">&apos;pillow&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Screenshot with PNG format

        Args:
            png_filename(string): optional, save file name
            format(string): return format, &quot;raw&quot; or &quot;pillow&quot; (default)

        Returns:
            PIL.Image or raw png data

        Raises:
            WDARequestError
        &quot;&quot;&quot;</span>
        value <span class="token operator">=</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;screenshot&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        raw_value <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        png_header <span class="token operator">=</span> <span class="token string">b&quot;\x89PNG\r\n\x1a\n&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> raw_value<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>png_header<span class="token punctuation">)</span> <span class="token keyword">and</span> png_filename<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> WDARequestError<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;screenshot png format error&quot;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> png_filename<span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>png_filename<span class="token punctuation">,</span> <span class="token string">&apos;wb&apos;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>raw_value<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">format</span> <span class="token operator">==</span> <span class="token string">&apos;raw&apos;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> raw_value
        <span class="token keyword">elif</span> <span class="token builtin">format</span> <span class="token operator">==</span> <span class="token string">&apos;pillow&apos;</span><span class="token punctuation">:</span>
            <span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
            buff <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>raw_value<span class="token punctuation">)</span>
            <span class="token keyword">return</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;unknown format&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">session</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                bundle_id<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                arguments<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                environment<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                alert_action<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            - bundle_id (str): the app bundle id
            - arguments (list): [&apos;-u&apos;, &apos;https://www.google.com/ncr&apos;]
            - enviroment (dict): {&quot;KEY&quot;: &quot;VAL&quot;}
            - alert_action (str): &quot;accept&quot; or &quot;dismiss&quot;

        WDA Return json like

        {
            &quot;value&quot;: {
                &quot;sessionId&quot;: &quot;69E6FDBA-8D59-4349-B7DE-A9CA41A97814&quot;,
                &quot;capabilities&quot;: {
                    &quot;device&quot;: &quot;iphone&quot;,
                    &quot;browserName&quot;: &quot;&#x90E8;&#x843D;&#x51B2;&#x7A81;&quot;,
                    &quot;sdkVersion&quot;: &quot;9.3.2&quot;,
                    &quot;CFBundleIdentifier&quot;: &quot;com.supercell.magic&quot;
                }
            },
            &quot;sessionId&quot;: &quot;69E6FDBA-8D59-4349-B7DE-A9CA41A97814&quot;,
            &quot;status&quot;: 0
        }

        To create a new session, send json data like

        {
            &quot;desiredCapabilities&quot;: {
                &quot;bundleId&quot;: &quot;your-bundle-id&quot;,
                &quot;app&quot;: &quot;your-app-path&quot;
                &quot;shouldUseCompactResponses&quot;: (bool),
                &quot;shouldUseTestManagerForVisibilityDetection&quot;: (bool),
                &quot;maxTypingFrequency&quot;: (integer),
                &quot;arguments&quot;: (list(str)),
                &quot;environment&quot;: (dict: str-&gt;str)
            },
        }
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> bundle_id <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self

        <span class="token keyword">if</span> arguments <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&apos;arguments must be a list&apos;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> environment <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&apos;environment must be a dict&apos;</span><span class="token punctuation">)</span>

        capabilities <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&apos;bundleId&apos;</span><span class="token punctuation">:</span> bundle_id<span class="token punctuation">,</span>
            <span class="token string">&apos;arguments&apos;</span><span class="token punctuation">:</span> arguments<span class="token punctuation">,</span>
            <span class="token string">&apos;environment&apos;</span><span class="token punctuation">:</span> environment<span class="token punctuation">,</span>
            <span class="token string">&apos;shouldWaitForQuiescence&apos;</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
            <span class="token comment"># In the latest appium/WebDriverAgent, set shouldWaitForQuiescence to True will stuck</span>
            <span class="token comment"># &apos;useJSONSource&apos;: True,</span>
            <span class="token comment"># &apos;simpleIsVisibleCheck&apos;: True,</span>
            <span class="token comment"># &apos;shouldUseTestManagerForVisibilityDetection&apos;: True,</span>
        <span class="token punctuation">}</span>
        <span class="token comment"># Remove empty value to prevent WDARequestError</span>
        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>capabilities<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> capabilities<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                capabilities<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>k<span class="token punctuation">)</span>

        <span class="token keyword">if</span> alert_action<span class="token punctuation">:</span>
            <span class="token keyword">assert</span> alert_action <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dismiss&quot;</span><span class="token punctuation">]</span>
            capabilities<span class="token punctuation">[</span><span class="token string">&quot;defaultAlertAction&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> alert_action

        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&apos;desiredCapabilities&apos;</span><span class="token punctuation">:</span> capabilities<span class="token punctuation">,</span>  <span class="token comment"># For old WDA</span>
            <span class="token string">&quot;capabilities&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;alwaysMatch&quot;</span><span class="token punctuation">:</span> capabilities<span class="token punctuation">,</span>  <span class="token comment"># For recent WDA 2019/08/28</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;data=%s&quot;</span> <span class="token operator">%</span> data<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;session&apos;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
            <span class="token comment"># if DEBUG:</span>
            <span class="token comment">#     # print(&quot;res=%s&quot; % res)</span>
            <span class="token comment">#     # respJson = res.json()</span>
            <span class="token comment">#     # print(&quot;respJson=%s&quot; % respJson)</span>
            <span class="token comment">#     respDict = dict(res)</span>
            <span class="token comment">#     print(&quot;respDict=%s&quot; % respDict)</span>
        <span class="token keyword">except</span> WDAEmptyResponseError<span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">&quot;&quot;&quot; when there is alert, might be got empty response
            use /wda/apps/state may still get sessionId
            &quot;&quot;&quot;</span>
            res <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>app_state<span class="token punctuation">(</span>bundle_id<span class="token punctuation">)</span>
            <span class="token keyword">if</span> res<span class="token punctuation">.</span>value <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
        <span class="token keyword">return</span> Client<span class="token punctuation">(</span>self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>address<span class="token punctuation">,</span> _session_id<span class="token operator">=</span>res<span class="token punctuation">.</span>sessionId<span class="token punctuation">)</span>

    <span class="token comment">#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#</span>
    <span class="token comment">######  Session methods and properties ######</span>
    <span class="token comment">#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return &apos;wda.Client (sessionId=%s)&apos; % self._sid</span>
        <span class="token keyword">return</span> <span class="token string">&apos;wda.Client (sessionId=%s)&apos;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>__session_id

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Usage example:
            with c.session(&quot;com.example.app&quot;) as app:
                # do something
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_id

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">_session_id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>__session_id<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__session_id
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&apos;sessionId&apos;</span><span class="token punctuation">]</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">_session_http</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> HTTPClient<span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>new_client<span class="token punctuation">(</span><span class="token string">&quot;session/&quot;</span><span class="token operator">+</span>self<span class="token punctuation">.</span>_session_id<span class="token punctuation">)</span>

    @cached_property
    <span class="token keyword">def</span> <span class="token function">scale</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        UIKit scale factor

        Refs:
            https://developer.apple.com/library/archive/documentation/DeviceInformation/Reference/iOSDeviceCompatibility/Displays/Displays.html
        There is another way to get scale
            self.http.get(&quot;/wda/screen&quot;).value returns {&quot;statusBarSize&quot;: {&apos;width&apos;: 320, &apos;height&apos;: 20}, &apos;scale&apos;: 2}
        &quot;&quot;&quot;</span>
        v <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;v=%s&quot;</span> <span class="token operator">%</span> v<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>

    @cached_property
    <span class="token keyword">def</span> <span class="token function">bundle_id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; the session matched bundle id &quot;&quot;&quot;</span>
        v <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token keyword">return</span> v<span class="token punctuation">[</span><span class="token string">&apos;capabilities&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;CFBundleIdentifier&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">implicitly_wait</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        set default element search timeout
        &quot;&quot;&quot;</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>seconds<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__timeout <span class="token operator">=</span> seconds

    <span class="token keyword">def</span> <span class="token function">battery_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns dict:
            eg: {&quot;level&quot;: 1, &quot;state&quot;: 2}
            level: 0 ~ 1.0, battery electricity percent
            state: unknown=0, unplugged=1, charging=2, full=3
                https://developer.apple.com/documentation/uikit/uidevice/batterystate
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/batteryInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">matchTouchID</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        postResp <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/wda/touch_id&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;match&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        respValue <span class="token operator">=</span> postResp<span class="token punctuation">.</span>value
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;/wda/touch_id: respValue=%s&quot;</span> <span class="token operator">%</span> respValue<span class="token punctuation">)</span>
        <span class="token keyword">return</span> respValue

    <span class="token keyword">def</span> <span class="token function">device_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns dict:
            eg: {&apos;currentLocale&apos;: &apos;zh_CN&apos;, &apos;timeZone&apos;: &apos;Asia/Shanghai&apos;}
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/device/info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">screen_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;get screen info
            https://developer.apple.com/library/archive/documentation/DeviceInformation/Reference/iOSDeviceCompatibility/Displays/Displays.html

        Returns dict:
            eg: 
                {&apos;statusBarSize&apos;: {&apos;width&apos;: 375, &apos;height&apos;: 20}, &apos;scale&apos;: 2}
                -&gt; updated wda code, can return more info:
                {&apos;statusBarSize&apos;: {&apos;width&apos;: 375, &apos;height&apos;: 20}, &apos;nativeScale&apos;: 2.88, &apos;nativeBounds&apos;: {&apos;y&apos;: 0, &apos;x&apos;: 0, &apos;width&apos;: 921, &apos;height&apos;: 1382}, &apos;bounds&apos;: {&apos;y&apos;: 0, &apos;x&apos;: 0, &apos;width&apos;: 320, &apos;height&apos;: 480}, &apos;scale&apos;: 2}
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;self._session_http=%s&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/screen&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token comment"># return self.http.get(&quot;/wda/screen&quot;).value</span>

    <span class="token keyword">def</span> <span class="token function">window_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;get window size info

        Returns dict:
            eg: {&apos;width&apos;: 375, &apos;height&apos;: 667}
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/window/size&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token comment"># return self.http.get(&quot;/window/size&quot;).value</span>

    <span class="token keyword">def</span> <span class="token function">get_settings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/appium/settings&quot;</span><span class="token punctuation">)</span>
        respSettings <span class="token operator">=</span> resp<span class="token punctuation">.</span>value
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token comment"># print(&quot;resp=%s&quot; % resp) #  TypeError not all arguments converted during string formatting</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;respSettings=%s&quot;</span> <span class="token operator">%</span> respSettings<span class="token punctuation">)</span>
        <span class="token keyword">return</span> respSettings

    <span class="token keyword">def</span> <span class="token function">set_settings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> newSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
        postResp <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/appium/settings&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;settings&quot;</span><span class="token punctuation">:</span> newSettings<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        respNewSettings <span class="token operator">=</span> postResp<span class="token punctuation">.</span>value
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;respNewSettings=%s&quot;</span> <span class="token operator">%</span> respNewSettings<span class="token punctuation">)</span>
        <span class="token keyword">return</span> respNewSettings

    <span class="token keyword">def</span> <span class="token function">setSnapshotTimeout</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> newSnapshotTimeout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;set new snapshotTimeout value for current session /appium/settings&quot;&quot;&quot;</span>
        newSettings <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;snapshotTimeout&quot;</span><span class="token punctuation">:</span> newSnapshotTimeout
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>set_settings<span class="token punctuation">(</span>newSettings<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">set_clipboard</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token string">&quot;plaintext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; set clipboard &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            <span class="token string">&quot;/wda/setPasteboard&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;contentType&quot;</span><span class="token punctuation">:</span> content_type
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">set_alert_callback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            callback (func): called when alert popup

        Example of callback:

            def callback(session):
                session.alert.accept()
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">callable</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>alert_callback <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>callback<span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>alert_callback <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment">#Not working</span>
    <span class="token comment">#def get_clipboard(self):</span>
    <span class="token comment">#   self.http.post(&quot;/wda/getPasteboard&quot;).value</span>

    <span class="token comment"># Not working</span>
    <span class="token comment">#def siri_activate(self, text):</span>
    <span class="token comment">#    self.http.post(&quot;/wda/siri/activate&quot;, {&quot;text&quot;: text})</span>

    <span class="token keyword">def</span> <span class="token function">app_launch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                   bundle_id<span class="token punctuation">,</span>
                   arguments<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   environment<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                   wait_for_quiescence<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            - bundle_id (str): the app bundle id
            - arguments (list): [&apos;-u&apos;, &apos;https://www.google.com/ncr&apos;]
            - enviroment (dict): {&quot;KEY&quot;: &quot;VAL&quot;}
            - wait_for_quiescence (bool): default False
        &quot;&quot;&quot;</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            <span class="token string">&quot;/wda/apps/launch&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bundleId&quot;</span><span class="token punctuation">:</span> bundle_id<span class="token punctuation">,</span>
                <span class="token string">&quot;arguments&quot;</span><span class="token punctuation">:</span> arguments<span class="token punctuation">,</span>
                <span class="token string">&quot;environment&quot;</span><span class="token punctuation">:</span> environment<span class="token punctuation">,</span>
                <span class="token string">&quot;shouldWaitForQuiescence&quot;</span><span class="token punctuation">:</span> wait_for_quiescence<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">app_activate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bundle_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/wda/apps/launch&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;bundleId&quot;</span><span class="token punctuation">:</span> bundle_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">app_terminate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bundle_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/wda/apps/terminate&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;bundleId&quot;</span><span class="token punctuation">:</span> bundle_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">app_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bundle_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns example:
            {
                &quot;value&quot;: 4,
                &quot;sessionId&quot;: &quot;0363BDC5-4335-47ED-A54E-F7CCB65C6A65&quot;
            }

            value: enum ApplicationState
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/wda/apps/state&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;bundleId&quot;</span><span class="token punctuation">:</span> bundle_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">app_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Not working very well, only show springboard

        Returns:
            list of app

        Return example:
            [{&apos;pid&apos;: 52, &apos;bundleId&apos;: &apos;com.apple.springboard&apos;}]
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;/wda/apps/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">open_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        TODO: Never successed using before. Looks like use Siri to search.
        https://github.com/facebook/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBSessionCommands.m#L43
        Args:
            url (str): url

        Raises:
            WDARequestError
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;url&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&apos;url&apos;</span><span class="token punctuation">:</span> url<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">deactivate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Put app into background and than put it back
        Args:
            - duration (float): deactivate time, seconds
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/deactivateApp&apos;</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>duration<span class="token operator">=</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">tap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/tap/0&apos;</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>x<span class="token operator">=</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_percent2pos</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x=%s, y=%s, window_size=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> window_size<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            w<span class="token punctuation">,</span> h <span class="token operator">=</span> window_size <span class="token keyword">or</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;type(w)=%s&quot;</span> <span class="token operator">%</span> <span class="token builtin">type</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;type(h)=%s&quot;</span> <span class="token operator">%</span> <span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;w=%s, h=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># x = int(x * w) if isinstance(x, float) else x</span>
            <span class="token comment"># y = int(y * h) if isinstance(y, float) else y</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    convertedX <span class="token operator">=</span> x <span class="token operator">*</span> w
                    xInt <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>convertedX<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># consider as real float position value</span>
                    xInt <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                x <span class="token operator">=</span> xInt

            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;=</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    convertedY <span class="token operator">=</span> y <span class="token operator">*</span> h
                    yInt <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>convertedY<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># consider as real float position value</span>
                    yInt <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
                y <span class="token operator">=</span> yInt

            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;type(x)=%s&quot;</span> <span class="token operator">%</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;type(y)=%s&quot;</span> <span class="token operator">%</span> <span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x=%s, y=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">assert</span> w <span class="token operator">&gt;=</span> x <span class="token operator">&gt;=</span> <span class="token number">0</span>
            <span class="token keyword">assert</span> h <span class="token operator">&gt;=</span> y <span class="token operator">&gt;=</span> <span class="token number">0</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        x, y can be float(percent) or int
        &quot;&quot;&quot;</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>_percent2pos<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>tap<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">double_tap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>_percent2pos<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/doubleTap&apos;</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>x<span class="token operator">=</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">tap_hold</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Tap and hold for a moment

        Args:
            - x, y(int, float): float(percent) or int(absolute coordicate)
            - duration(float): seconds of hold time

        [[FBRoute POST:@&quot;/wda/touchAndHold&quot;] respondWithTarget:self action:@selector(handleTouchAndHoldCoordinate:)],
        &quot;&quot;&quot;</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>_percent2pos<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;x&apos;</span><span class="token punctuation">:</span> x<span class="token punctuation">,</span> <span class="token string">&apos;y&apos;</span><span class="token punctuation">:</span> y<span class="token punctuation">,</span> <span class="token string">&apos;duration&apos;</span><span class="token punctuation">:</span> duration<span class="token punctuation">}</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/touchAndHold&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">swipe</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            x1, y1, x2, y2 (int, float): float(percent), int(coordicate)
            duration (float): start coordinate press duration (seconds)

        [[FBRoute POST:@&quot;/wda/dragfromtoforduration&quot;] respondWithTarget:self action:@selector(handleDragCoordinate:)],
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            size <span class="token operator">=</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
            x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> self<span class="token punctuation">.</span>_percent2pos<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
            x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> self<span class="token punctuation">.</span>_percent2pos<span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> size<span class="token punctuation">)</span>

        data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>fromX<span class="token operator">=</span>x1<span class="token punctuation">,</span> fromY<span class="token operator">=</span>y1<span class="token punctuation">,</span> toX<span class="token operator">=</span>x2<span class="token punctuation">,</span> toY<span class="token operator">=</span>y2<span class="token punctuation">,</span> duration<span class="token operator">=</span>duration<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/dragfromtoforduration&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">swipe_left</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        w<span class="token punctuation">,</span> h <span class="token operator">=</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>swipe<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">swipe_right</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        w<span class="token punctuation">,</span> h <span class="token operator">=</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>swipe<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">swipe_up</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        w<span class="token punctuation">,</span> h <span class="token operator">=</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>swipe<span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h<span class="token punctuation">,</span> w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">swipe_down</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        w<span class="token punctuation">,</span> h <span class="token operator">=</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>swipe<span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">orientation</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return string
        One of &lt;PORTRAIT | LANDSCAPE&gt;
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;orientation&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    @orientation<span class="token punctuation">.</span>setter
    <span class="token keyword">def</span> <span class="token function">orientation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            - orientation(string): LANDSCAPE | PORTRAIT | UIA_DEVICE_ORIENTATION_LANDSCAPERIGHT |
                    UIA_DEVICE_ORIENTATION_PORTRAIT_UPSIDEDOWN
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;orientation&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&apos;orientation&apos;</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">window_size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            namedtuple: eg
                Size(width=320, height=568)
        &quot;&quot;&quot;</span>
        value <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;/window/size&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        w <span class="token operator">=</span> roundint<span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token string">&apos;width&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        h <span class="token operator">=</span> roundint<span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token string">&apos;height&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> namedtuple<span class="token punctuation">(</span><span class="token string">&apos;Size&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;width&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;height&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">send_keys</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        send keys, yet I know not, todo function
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> six<span class="token punctuation">.</span>string_types<span class="token punctuation">)</span><span class="token punctuation">:</span>
            value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/keys&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&apos;value&apos;</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">keyboard_dismiss</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Not working for now
        &quot;&quot;&quot;</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">&quot;not pass tests, this method is not allowed to use&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/wda/keyboard/dismiss&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">xpath</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        For weditor, d.xpath(...)
        &quot;&quot;&quot;</span>
        httpclient <span class="token operator">=</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>new_client<span class="token punctuation">(</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Selector<span class="token punctuation">(</span>httpclient<span class="token punctuation">,</span> self<span class="token punctuation">,</span> xpath<span class="token operator">=</span>value<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">alert</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Alert<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># close session</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">&apos;timeout&apos;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> kwargs<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">&apos;timeout&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>__timeout
        <span class="token keyword">return</span> Selector<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_session_http<span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">alibaba</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; Only used in alibaba company &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">import</span> wda_taobao
            <span class="token keyword">return</span> wda_taobao<span class="token punctuation">.</span>Alibaba<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span>
                <span class="token string">&quot;@alibaba property requires wda_taobao library installed&quot;</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">taobao</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">import</span> wda_taobao
            <span class="token keyword">return</span> wda_taobao<span class="token punctuation">.</span>Taobao<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span>
                <span class="token string">&quot;@taobao property requires wda_taobao library installed&quot;</span><span class="token punctuation">)</span>


Session <span class="token operator">=</span> Client <span class="token comment"># for compability</span>

<span class="token keyword">class</span> <span class="token class-name">Alert</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_c <span class="token operator">=</span> client
        self<span class="token punctuation">.</span>http <span class="token operator">=</span> client<span class="token punctuation">.</span>http

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">exists</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>text
        <span class="token keyword">except</span> WDARequestError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">if</span> e<span class="token punctuation">.</span>status <span class="token operator">!=</span> <span class="token number">27</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;/alert/text&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token comment"># return self._c._session_http.get(&apos;/alert/text&apos;).value</span>

    <span class="token keyword">def</span> <span class="token function">wait</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start_time <span class="token operator">&lt;</span> timeout<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/alert/accept&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">dismiss</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/alert/dismiss&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">buttons</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_c<span class="token punctuation">.</span>_session_http<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;/wda/alert/buttons&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token comment"># return self.http.get(&apos;/wda/alert/buttons&apos;).value</span>

    <span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> button_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            - button_name: the name of the button
        &quot;&quot;&quot;</span>
        <span class="token comment"># Actually, It has no difference POST to accept or dismiss</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/alert/accept&apos;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> button_name<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Selector</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                 httpclient<span class="token punctuation">,</span>
                 session<span class="token punctuation">,</span>
                 predicate<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 <span class="token builtin">id</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 className<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 <span class="token builtin">type</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 nameContains<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 nameMatches<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 text<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 textContains<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 textMatches<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 valueContains<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 valueMatches<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 labelContains<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 visible<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 enabled<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>

                 <span class="token comment"># https://github.com/facebookarchive/WebDriverAgent/wiki/Predicate-Queries-Construction-Rules</span>
                 <span class="token comment">#  rect - Element&apos;s rectangle as a dictionary with the following keys: x, y, width, height</span>
                 rect<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 y<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 width<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 height<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>

                 classChain<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 xpath<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 parent_class_chains<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 timeout<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span>
                 index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&apos;&apos;&apos;
        Args:
            predicate (str): predicate string
            id (str): raw identifier
            className (str): attr of className
            type (str): alias of className
            name (str): attr for name
            nameContains (str): attr of name contains
            nameMatches (str): regex string
            text (str): alias of name
            textContains (str): alias of nameContains
            textMatches (str): alias of nameMatches
            value (str): attr of value, not used in most times
            valueContains (str): attr of value contains
            valueMatches (str): attr of value regex string
            label (str): attr for label
            labelContains (str): attr for label contains
            visible (bool): is visible
            enabled (bool): is enabled
            rect (dict):  Element&apos;s rectangle as a dictionary with the following keys: x, y, width, height
            x (int/str):  x of rect
            y (int/str):  y of rect
            width (int/str):  width of rect
            height (int/str):  height of rect
            classChain (str): string of ios chain query, eg: **/XCUIElementTypeOther[`value BEGINSWITH &apos;blabla&apos;`]
            xpath (str): xpath string, a little slow, but works fine
            timeout (float): maxium wait element time, default 10.0s
            index (int): index of founded elements

        WDA use two key to find elements &quot;using&quot;, &quot;value&quot;
        Examples:
        &quot;using&quot; can be on of 
            &quot;partial link text&quot;, &quot;link text&quot;
            &quot;name&quot;, &quot;id&quot;, &quot;accessibility id&quot;
            &quot;class name&quot;, &quot;class chain&quot;, &quot;xpath&quot;, &quot;predicate string&quot;

        predicate string support many keys
            UID,
            accessibilityContainer,
            accessible,
            enabled,
            frame,
            label,
            name,
            rect,
            type,
            value,
            visible,
            wdAccessibilityContainer,
            wdAccessible,
            wdEnabled,
            wdFrame,
            wdLabel,
            wdName,
            wdRect,
            wdType,
            wdUID,
            wdValue,
            wdVisible
        &apos;&apos;&apos;</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: httpclient=%s, session=%s, predicate=%s, id=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>httpclient<span class="token punctuation">,</span> session<span class="token punctuation">,</span> predicate<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: className=%s, type=%s, name=%s, nameContains=%s, nameMatches=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> nameContains<span class="token punctuation">,</span> nameMatches<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: text=%s, textContains=%s, textMatches=%s, value=%s, valueContains=%s, valueMatches=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> textContains<span class="token punctuation">,</span> textMatches<span class="token punctuation">,</span> value<span class="token punctuation">,</span> valueContains<span class="token punctuation">,</span> valueMatches<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: label=%s, labelContains=%s, visible=%s, value=%s, enabled=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>label<span class="token punctuation">,</span> labelContains<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enabled<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: rect=%s, x=%s, y=%s, width=%s, height=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>rect<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Selector __init__: classChain=%s, xpath=%s, parent_class_chains=%s, timeout=%s, index=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>classChain<span class="token punctuation">,</span> xpath<span class="token punctuation">,</span> parent_class_chains<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>http <span class="token operator">=</span> httpclient
        self<span class="token punctuation">.</span>session <span class="token operator">=</span> session

        self<span class="token punctuation">.</span>predicate <span class="token operator">=</span> predicate
        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>
        self<span class="token punctuation">.</span>class_name <span class="token operator">=</span> className <span class="token keyword">or</span> <span class="token builtin">type</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> self<span class="token punctuation">.</span>_add_escape_character_for_quote_prime_character<span class="token punctuation">(</span>
            name <span class="token keyword">or</span> text<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name_part <span class="token operator">=</span> nameContains <span class="token keyword">or</span> textContains
        self<span class="token punctuation">.</span>name_regex <span class="token operator">=</span> nameMatches <span class="token keyword">or</span> textMatches
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>value_part <span class="token operator">=</span> valueContains
        self<span class="token punctuation">.</span>value_regex <span class="token operator">=</span> valueMatches
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> label
        self<span class="token punctuation">.</span>label_part <span class="token operator">=</span> labelContains

        <span class="token comment"># self.enabled = enabled</span>
        <span class="token comment"># self.visible = visible</span>
        <span class="token comment"># self.enabled = self._toBool(enabled)</span>
        <span class="token comment"># self.visible = self._toBool(visible)</span>
        <span class="token keyword">if</span> enabled <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>enabled <span class="token operator">=</span> self<span class="token punctuation">.</span>_toBool<span class="token punctuation">(</span>enabled<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> visible <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>visible <span class="token operator">=</span> self<span class="token punctuation">.</span>_toBool<span class="token punctuation">(</span>visible<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> rect<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>rect <span class="token operator">=</span> rect
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>rect <span class="token operator">=</span> <span class="token boolean">None</span>

            rectDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

            <span class="token keyword">if</span> x<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                rectDict<span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>x
            <span class="token keyword">if</span> y<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
                rectDict<span class="token punctuation">[</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>y
            <span class="token keyword">if</span> width<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span>
                rectDict<span class="token punctuation">[</span><span class="token string">&quot;width&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>width
            <span class="token keyword">if</span> height<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span>
                rectDict<span class="token punctuation">[</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>height

            <span class="token keyword">if</span> rectDict<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>rect <span class="token operator">=</span> rectDict

        self<span class="token punctuation">.</span>index <span class="token operator">=</span> index

        self<span class="token punctuation">.</span>xpath <span class="token operator">=</span> self<span class="token punctuation">.</span>_fix_xcui_type<span class="token punctuation">(</span>xpath<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>class_chain <span class="token operator">=</span> self<span class="token punctuation">.</span>_fix_xcui_type<span class="token punctuation">(</span>classChain<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout
        <span class="token comment"># some fixtures</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>class_name <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>class_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>
                <span class="token string">&apos;XCUIElementType&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>class_name <span class="token operator">=</span> <span class="token string">&apos;XCUIElementType&apos;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>class_name
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>
                    <span class="token string">&apos;^&apos;</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&apos;.*&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>name_regex <span class="token operator">=</span> <span class="token string">&apos;.*&apos;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name_regex
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>
                    <span class="token string">&apos;$&apos;</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&apos;.*&apos;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>name_regex <span class="token operator">=</span> self<span class="token punctuation">.</span>name_regex <span class="token operator">+</span> <span class="token string">&apos;.*&apos;</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;after update: self.name_regex=%s&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>parent_class_chains <span class="token operator">=</span> parent_class_chains

    <span class="token keyword">def</span> <span class="token function">_toBool</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputValue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        respBool <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            respBool <span class="token operator">=</span> inputValue
        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            lowerStr <span class="token operator">=</span> inputValue<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
            TrueStrList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yes&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> lowerStr <span class="token keyword">in</span> TrueStrList<span class="token punctuation">:</span>
                respBool <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> inputValue <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                respBool <span class="token operator">=</span> <span class="token boolean">True</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;inputValue=%s -&gt; respBool=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>inputValue<span class="token punctuation">,</span> respBool<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> respBool

    <span class="token keyword">def</span> <span class="token function">_fix_xcui_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> s <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        re_element <span class="token operator">=</span> <span class="token string">&apos;|&apos;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>xcui_element_types<span class="token punctuation">.</span>ELEMENTS<span class="token punctuation">)</span>
        <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&apos;/(&apos;</span> <span class="token operator">+</span> re_element <span class="token operator">+</span> <span class="token string">&apos;)&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/XCUIElementType\g&lt;1&gt;&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_add_escape_character_for_quote_prime_character</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Fix for https://github.com/openatx/facebook-wda/issues/33
        Returns:
            string with properly formated quotes, or non changed text
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> text <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">&quot;&apos;&quot;</span> <span class="token keyword">in</span> text<span class="token punctuation">:</span>
                <span class="token keyword">return</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;&apos;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\\&apos;&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token string">&apos;&quot;&apos;</span> <span class="token keyword">in</span> text<span class="token punctuation">:</span>
                <span class="token keyword">return</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&apos;&quot;&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;\\&quot;&apos;</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> text
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> text

    <span class="token keyword">def</span> <span class="token function">_wdasearch_single</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> using<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            bool, str
                True, element info:
                    {
                        &quot;id&quot;: &quot;0F000000-0000-0000-D703-000000000000&quot;,
                        &quot;name&quot;: &quot;&#x901A;&#x8BAF;&#x5F55;&quot;,
                        &quot;value&quot;: None,
                        &quot;text&quot;: &quot;&#x901A;&#x8BAF;&#x5F55;&quot;,
                        &quot;label&quot;: &quot;&#x901A;&#x8BAF;&#x5F55;&quot;,
                        &quot;rect&quot;: {
                            &quot;y&quot;: 619,
                            &quot;x&quot;: 96,
                            &quot;width&quot;: 90,
                            &quot;height&quot;: 48
                        },
                        &quot;type&quot;: &quot;XCUIElementTypeButton&quot;
                    }

                False, error info: 
                    {
                        &quot;error&quot; : &quot;no such element&quot;,
                        &quot;message&quot; : &quot;unable to find an element using &apos;class chain&apos;, value &apos;**\/XCUIElementTypeAny[`name == &apos;&#x641C;&#x7D22;&apos;`]&apos;&quot;,
                        &quot;traceback&quot; : &quot;(\n\t0   WebDriverAgentLib                   0x0000000100f011ec FBNoSuchElementErrorResponseForRequest....... 4\n)&quot;
                    }
        &quot;&quot;&quot;</span>
        isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;Unknown error&quot;</span>

        postDict <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&apos;using&apos;</span><span class="token punctuation">:</span> using<span class="token punctuation">,</span>
            <span class="token string">&apos;value&apos;</span><span class="token punctuation">:</span> value
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;postDict=%s&quot;</span> <span class="token operator">%</span> postDict<span class="token punctuation">)</span>

        isException <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token comment"># resp = self.http.post(&apos;/element&apos;, postDict)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            resp <span class="token operator">=</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/element&apos;</span><span class="token punctuation">,</span> postDict<span class="token punctuation">)</span>
        <span class="token keyword">except</span> WDARequestError <span class="token keyword">as</span> wdaReqErr<span class="token punctuation">:</span>
            isException <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;wdaReqErr=%s&quot;</span> <span class="token operator">%</span> wdaReqErr<span class="token punctuation">)</span>

            errCode <span class="token operator">=</span> wdaReqErr<span class="token punctuation">.</span>status
            errMsg <span class="token operator">=</span> wdaReqErr<span class="token punctuation">.</span>value
            errorInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span> errCode<span class="token punctuation">,</span>
                <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> errMsg
            <span class="token punctuation">}</span>
            respInfo <span class="token operator">=</span> errorInfo

        <span class="token keyword">if</span> <span class="token keyword">not</span> isException<span class="token punctuation">:</span>
            <span class="token comment"># if DEBUG:</span>
            <span class="token comment">#     print(&quot;postDict=%s -&gt; resp=%s&quot; % (postDict, resp))</span>

            respValue <span class="token operator">=</span> resp<span class="token punctuation">.</span>value
            <span class="token comment"># if DEBUG:</span>
            <span class="token comment">#     print(&quot;respValue=%s&quot; % respValue)</span>

            respValueKeys <span class="token operator">=</span> respValue<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
            hasError <span class="token operator">=</span> <span class="token string">&quot;error&quot;</span> <span class="token keyword">in</span> respValueKeys
            hasMessage <span class="token operator">=</span> <span class="token string">&quot;message&quot;</span> <span class="token keyword">in</span> respValueKeys
            isError <span class="token operator">=</span> hasError <span class="token keyword">and</span> hasMessage

            <span class="token keyword">if</span> isError<span class="token punctuation">:</span>
                <span class="token triple-quoted-string string">&quot;&quot;&quot;
                {
                    &quot;value&quot; : {
                        &quot;error&quot; : &quot;no such element&quot;,
                        &quot;message&quot; : &quot;unable to find an element using &apos;class chain&apos;, value &apos;**\/XCUIElementTypeAny[`name == &apos;&#x641C;&#x7D22;&apos;`]&apos;&quot;,
                        &quot;traceback&quot; : &quot;(\n\t0   WebDriverAgentLib    0x0000000100f011ec FBNoSuchElementErrorResponseForRequest....... 4\n)&quot;
                    },
                    &quot;sessionId&quot; : &quot;DCF1A843-9FB9-4415-9A7C-8AF4ACDC3046&quot;
                }
                &quot;&quot;&quot;</span>
                isFound <span class="token operator">=</span> <span class="token boolean">False</span>
                errorInfo <span class="token operator">=</span> respValue
                respInfo <span class="token operator">=</span> errorInfo
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                isFound <span class="token operator">=</span> <span class="token boolean">True</span>
                elementId <span class="token operator">=</span> respValue<span class="token punctuation">[</span><span class="token string">&apos;ELEMENT&apos;</span><span class="token punctuation">]</span>
                <span class="token comment"># if DEBUG:</span>
                <span class="token comment">#     print(&quot;elementId=%s&quot; % elementId)</span>

                <span class="token triple-quoted-string string">&quot;&quot;&quot;
                {
                    &quot;value&quot; : {
                        &quot;text&quot; : null,
                        &quot;element-6066-11e4-a52e-4f735466cecf&quot; : &quot;00000000-0000-0000-0000-000000000000&quot;,
                        &quot;label&quot; : null,
                        &quot;attribute\/name&quot; : null,
                        &quot;attribute\/value&quot; : null,
                        &quot;ELEMENT&quot; : &quot;00000000-0000-0000-0000-000000000000&quot;
                    },
                    &quot;sessionId&quot; : &quot;E649E60F-16A1-48D4-8840-67387787A0A2&quot;
                }
                &quot;&quot;&quot;</span>
                EmptyId <span class="token operator">=</span> <span class="token string">&quot;00000000-0000-0000-0000-000000000000&quot;</span>

                <span class="token keyword">if</span> elementId <span class="token operator">==</span> EmptyId<span class="token punctuation">:</span>
                    isFound <span class="token operator">=</span> <span class="token boolean">False</span>
                    respInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;error&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;empty id&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;message&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;found element but id is empty %s from %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>EmptyId<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>postDict<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token triple-quoted-string string">&quot;&quot;&quot;
                    {
                        &quot;value&quot; : {
                            &quot;element-6066-11e4-a52e-4f735466cecf&quot; : &quot;19010000-0000-0000-A303-000000000000&quot;,
                            &quot;attribute/name&quot; : &quot;&#x6DFB;&#x52A0;&quot;,
                            &quot;attribute/value&quot; : null,
                            &quot;text&quot; : &quot;&#x6DFB;&#x52A0;&quot;,
                            &quot;label&quot; : &quot;&#x6DFB;&#x52A0;&quot;,
                            &quot;rect&quot; : {
                                &quot;y&quot; : 20,
                                &quot;x&quot; : 317,
                                &quot;width&quot; : 58,
                                &quot;height&quot; : 44
                            },
                            &quot;type&quot; : &quot;XCUIElementTypeButton&quot;,
                            &quot;name&quot; : &quot;XCUIElementTypeButton&quot;,
                            &quot;ELEMENT&quot; : &quot;19010000-0000-0000-A303-000000000000&quot;
                        },
                        &quot;sessionId&quot; : &quot;DCF1A843-9FB9-4415-9A7C-8AF4ACDC3046&quot;
                    }
                    &quot;&quot;&quot;</span>
                    elementInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> elementId
                    <span class="token punctuation">}</span>
                    <span class="token comment"># respKeyList = [&quot;type&quot;,&quot;label&quot;,&quot;name&quot;,&quot;text&quot;,&quot;rect&quot;,&quot;attribute/name&quot;,&quot;attribute/value&quot;]</span>
                    <span class="token comment"># mapKeyList =  [&quot;type&quot;,&quot;label&quot;,    &quot;&quot;,&quot;text&quot;,&quot;rect&quot;,          &quot;name&quot;,          &quot;value&quot;]</span>
                    respKeyMap <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;label&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;label&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;rect&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rect&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;attribute/name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;attribute/value&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">for</span> eachKey <span class="token keyword">in</span> respValueKeys<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> eachKey <span class="token keyword">in</span> respKeyMap<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            eachValue <span class="token operator">=</span> respValue<span class="token punctuation">[</span>eachKey<span class="token punctuation">]</span>
                            mapRealKey <span class="token operator">=</span> respKeyMap<span class="token punctuation">[</span>eachKey<span class="token punctuation">]</span>
                            <span class="token keyword">if</span> mapRealKey<span class="token punctuation">:</span>
                                elementInfo<span class="token punctuation">[</span>mapRealKey<span class="token punctuation">]</span> <span class="token operator">=</span> eachValue

                    respInfo <span class="token operator">=</span> elementInfo

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;isFound=%s, respInfo=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>isFound<span class="token punctuation">,</span> respInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># return elementId</span>
        <span class="token keyword">return</span> isFound<span class="token punctuation">,</span> respInfo

    <span class="token keyword">def</span> <span class="token function">_wdasearch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> using<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            element_ids (list(string)): example [&apos;id1&apos;, &apos;id2&apos;]

        HTTP example response:
        [
            {&quot;ELEMENT&quot;: &quot;E2FF5B2A-DBDF-4E67-9179-91609480D80A&quot;},
            {&quot;ELEMENT&quot;: &quot;597B1A1E-70B9-4CBE-ACAD-40943B0A6034&quot;}
        ]
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;using=%s, value=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>using<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>

        element_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># for v in self.http.post(&apos;/elements&apos;, {</span>
        <span class="token comment">#         &apos;using&apos;: using,</span>
        <span class="token comment">#         &apos;value&apos;: value</span>
        <span class="token comment"># }).value:</span>
        <span class="token comment">#     element_ids.append(v[&apos;ELEMENT&apos;])</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&apos;/elements&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">&apos;using&apos;</span><span class="token punctuation">:</span> using<span class="token punctuation">,</span>
                <span class="token string">&apos;value&apos;</span><span class="token punctuation">:</span> value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        valueList <span class="token operator">=</span> resp<span class="token punctuation">.</span>value

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;valueList=%s&quot;</span> <span class="token operator">%</span> valueList<span class="token punctuation">)</span>

        <span class="token keyword">for</span> eachValue <span class="token keyword">in</span> valueList<span class="token punctuation">:</span>
            eachElement <span class="token operator">=</span> eachValue<span class="token punctuation">[</span><span class="token string">&apos;ELEMENT&apos;</span><span class="token punctuation">]</span>
            element_ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span>eachElement<span class="token punctuation">)</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;element_ids=%s&quot;</span> <span class="token operator">%</span> element_ids<span class="token punctuation">)</span>

        <span class="token keyword">return</span> element_ids

    <span class="token keyword">def</span> <span class="token function">_gen_class_chain</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># just return if aleady exists predicate</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">&apos;/XCUIElementTypeAny[`&apos;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>predicate <span class="token operator">+</span> <span class="token string">&apos;`]&apos;</span>
        qs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>name<span class="token punctuation">:</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;name == &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>name_part<span class="token punctuation">:</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;name CONTAINS &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name_part<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">:</span>
            <span class="token comment"># escapedNameRegex = self.name_regex.encode(&apos;unicode_escape&apos;)</span>
            <span class="token comment"># if DEBUG:</span>
            <span class="token comment">#     print(&quot;self.name_regex=%s, escapedNameRegex=%s&quot; % (self.name_regex, escapedNameRegex))</span>
            <span class="token comment"># qs.append(&quot;name MATCHES &apos;%s&apos;&quot; % escapedNameRegex)</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;name MATCHES &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name_regex<span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;after add name_regex: qs=%s&quot;</span> <span class="token operator">%</span> qs<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>label<span class="token punctuation">:</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;label == &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>label<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>label_part<span class="token punctuation">:</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;label CONTAINS &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>label_part<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>value<span class="token punctuation">:</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;value == &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>value_part<span class="token punctuation">:</span>
            <span class="token comment"># qs.append(&quot;value CONTAINS &#x2019;%s&apos;&quot; % self.value_part)</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;value CONTAINS &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>value_part<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>value_regex<span class="token punctuation">:</span>
            <span class="token comment"># escapedValueRegex = self.value_regex.encode(&apos;unicode_escape&apos;)</span>
            <span class="token comment"># if DEBUG:</span>
            <span class="token comment">#     print(&quot;self.value_regex=%s, escapedValueRegex=%s&quot; % (self.value_regex, escapedValueRegex))</span>
            <span class="token comment"># qs.append(&quot;value MATCHES &apos;%s&apos;&quot; % escapedValueRegex)</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;value MATCHES &apos;%s&apos;&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>value_regex<span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;after add value_regex: qs=%s&quot;</span> <span class="token operator">%</span> qs<span class="token punctuation">)</span>

        <span class="token comment"># BoolTrueValue = &quot;true&quot;</span>
        <span class="token comment"># BoolFalseValue = &quot;false&quot;</span>
        BoolTrueValue <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>
        BoolFalseValue <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>enabled <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            enabledValue <span class="token operator">=</span> BoolTrueValue <span class="token keyword">if</span> self<span class="token punctuation">.</span>enabled <span class="token keyword">else</span> BoolFalseValue
            enableKey <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span>
            <span class="token comment"># enableKey = &quot;wdEnabled&quot;</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;%s == %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>enableKey<span class="token punctuation">,</span> enabledValue<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 20200427: after merge latest WebDriverAgent, continue test visible</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;self.visible=%s&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>visible<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>visible <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            visibleKey <span class="token operator">=</span> <span class="token string">&quot;visible&quot;</span>
            <span class="token comment"># Note: WebDriverAgent says support visible, but actually not support visible</span>
            <span class="token comment">#   so temp change to (maybe similar meaning) accessible</span>
            <span class="token comment"># 20200402: sometime use visible or accessible can NOT found element, so not use it</span>
            <span class="token comment"># visibleKey = &quot;accessible&quot;</span>
            <span class="token comment"># 20200408: debug displayed</span>
            <span class="token comment"># visibleKey = &quot;displayed&quot;</span>
            visibleValue <span class="token operator">=</span>  BoolTrueValue <span class="token keyword">if</span> self<span class="token punctuation">.</span>visible <span class="token keyword">else</span> BoolFalseValue
            visibleConditionStr <span class="token operator">=</span> <span class="token string">&quot;%s == %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>visibleKey<span class="token punctuation">,</span> visibleValue<span class="token punctuation">)</span>
            qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>visibleConditionStr<span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;visibleConditionStr=%s&quot;</span> <span class="token operator">%</span> visibleConditionStr<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;qs=%s&quot;</span> <span class="token operator">%</span> qs<span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>rect<span class="token punctuation">:</span>
            rectKeyList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;width&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> eachRectKey <span class="token keyword">in</span> rectKeyList<span class="token punctuation">:</span>
                <span class="token keyword">if</span> eachRectKey <span class="token keyword">in</span> self<span class="token punctuation">.</span>rect<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    eachRectValue <span class="token operator">=</span> self<span class="token punctuation">.</span>rect<span class="token punctuation">[</span>eachRectKey<span class="token punctuation">]</span>
                    curMatchRule <span class="token operator">=</span> <span class="token string">&quot;rect.%s == %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>eachRectKey<span class="token punctuation">,</span> eachRectValue<span class="token punctuation">)</span>
                    qs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>curMatchRule<span class="token punctuation">)</span>

        predicate <span class="token operator">=</span> <span class="token string">&apos; AND &apos;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>qs<span class="token punctuation">)</span>
        chain <span class="token operator">=</span> <span class="token string">&apos;/&apos;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>class_name <span class="token keyword">or</span> <span class="token string">&apos;XCUIElementTypeAny&apos;</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> predicate<span class="token punctuation">:</span>
            chain <span class="token operator">=</span> chain <span class="token operator">+</span> <span class="token string">&apos;[`&apos;</span> <span class="token operator">+</span> predicate <span class="token operator">+</span> <span class="token string">&apos;`]&apos;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index<span class="token punctuation">:</span>
            chain <span class="token operator">=</span> chain <span class="token operator">+</span> <span class="token string">&apos;[%d]&apos;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>index

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;generated class chain=%s&quot;</span> <span class="token operator">%</span> chain<span class="token punctuation">)</span>

        <span class="token keyword">return</span> chain

    <span class="token keyword">def</span> <span class="token function">find_element_ids</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        elems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch<span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch<span class="token punctuation">(</span><span class="token string">&apos;predicate string&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>xpath<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch<span class="token punctuation">(</span><span class="token string">&apos;xpath&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>xpath<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>class_chain<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch<span class="token punctuation">(</span><span class="token string">&apos;class chain&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>class_chain<span class="token punctuation">)</span>

        chain <span class="token operator">=</span> <span class="token string">&apos;**&apos;</span> <span class="token operator">+</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>parent_class_chains<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>_gen_class_chain<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;CHAIN: %s&apos;</span><span class="token punctuation">,</span> chain<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch<span class="token punctuation">(</span><span class="token string">&apos;class chain&apos;</span><span class="token punctuation">,</span> chain<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">find_element_id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch_single<span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">:</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;PREDICATE: %s&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch_single<span class="token punctuation">(</span><span class="token string">&apos;predicate string&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>predicate<span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>xpath<span class="token punctuation">:</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;XPATH: %s&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>xpath<span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch_single<span class="token punctuation">(</span><span class="token string">&apos;xpath&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>xpath<span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>class_chain<span class="token punctuation">:</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;CLASS_CHAIN: %s&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>class_chain<span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch_single<span class="token punctuation">(</span><span class="token string">&apos;class chain&apos;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>class_chain<span class="token punctuation">)</span>

        chain <span class="token operator">=</span> <span class="token string">&apos;**&apos;</span> <span class="token operator">+</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>parent_class_chains<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>_gen_class_chain<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;CHAIN: %s&apos;</span><span class="token punctuation">,</span> chain<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wdasearch_single<span class="token punctuation">(</span><span class="token string">&apos;class chain&apos;</span><span class="token punctuation">,</span> chain<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">find_element</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            True, Element: single element
            False, error info
        &quot;&quot;&quot;</span>
        <span class="token comment"># element = None</span>
        <span class="token comment"># elementId = self.find_element_id()</span>
        isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> self<span class="token punctuation">.</span>find_element_id<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token comment"># print(&apos;elementId=%s&apos; % elementId)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;isFound=%s, respInfo=%s&apos;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>isFound<span class="token punctuation">,</span> respInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> isFound<span class="token punctuation">:</span>
            elementInfo <span class="token operator">=</span> respInfo
            elementId <span class="token operator">=</span> elementInfo<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span>

            <span class="token comment"># add bounds support</span>
            curBounds <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">if</span> <span class="token string">&quot;rect&quot;</span> <span class="token keyword">in</span> elementInfo<span class="token punctuation">:</span>
                rectDict <span class="token operator">=</span> elementInfo<span class="token punctuation">[</span><span class="token string">&quot;rect&quot;</span><span class="token punctuation">]</span>
                x <span class="token operator">=</span> rectDict<span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span>
                y <span class="token operator">=</span> rectDict<span class="token punctuation">[</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">]</span>
                width <span class="token operator">=</span> rectDict<span class="token punctuation">[</span><span class="token string">&quot;width&quot;</span><span class="token punctuation">]</span>
                height <span class="token operator">=</span> rectDict<span class="token punctuation">[</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">]</span>
                curBounds <span class="token operator">=</span> Rect<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;curBounds=%s&quot;</span> <span class="token operator">%</span> curBounds<span class="token punctuation">)</span>

            <span class="token comment"># element = Element(self.http.new_client(&apos;&apos;), elementId, rect=curRect)</span>
            element <span class="token operator">=</span> Element<span class="token punctuation">(</span>self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>new_client<span class="token punctuation">(</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elementId<span class="token punctuation">,</span> bounds<span class="token operator">=</span>curBounds<span class="token punctuation">)</span>

            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;element=%s&apos;</span> <span class="token operator">%</span> element<span class="token punctuation">)</span>

            respInfo <span class="token operator">=</span> element

        <span class="token keyword">return</span> isFound<span class="token punctuation">,</span> respInfo

    <span class="token keyword">def</span> <span class="token function">find_elements</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns:
            Element (list): all the elements
        &quot;&quot;&quot;</span>
        es <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> element_id <span class="token keyword">in</span> self<span class="token punctuation">.</span>find_element_ids<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;find_elements: element_id=%s&apos;</span> <span class="token operator">%</span> element_id<span class="token punctuation">)</span>
            ele <span class="token operator">=</span> Element<span class="token punctuation">(</span>self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>new_client<span class="token punctuation">(</span><span class="token string">&apos;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> element_id<span class="token punctuation">)</span>
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;find_elements: ele=%s&apos;</span> <span class="token operator">%</span> ele<span class="token punctuation">)</span>
            es<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ele<span class="token punctuation">)</span>
        <span class="token keyword">return</span> es

    <span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span>

        elementIdList <span class="token operator">=</span> self<span class="token punctuation">.</span>find_element_ids<span class="token punctuation">(</span><span class="token punctuation">)</span>
        elementIdNum <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>elementIdList<span class="token punctuation">)</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;count: elementIdList=%s&quot;</span> <span class="token operator">%</span> elementIdList<span class="token punctuation">)</span>

        <span class="token keyword">return</span> elementIdNum

    <span class="token comment"># def get(self, timeout=None, raise_error=True, isRespSingle=False):</span>
    <span class="token comment"># def get(self, timeout=None, raise_error=True, isRespSingle=True):</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            timeout (float): timeout for query element, unit seconds
                Default 10s

        Returns:
            True, Element
            False, error info

        Raises:
        &quot;&quot;&quot;</span>
        isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">&quot;Unknown error&quot;</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token comment"># print(&quot;get: timeout=%s, raise_error=%s, isRespSingle=%s&quot; % (timeout, raise_error, isRespSingle))</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;get: timeout=%s&quot;</span> <span class="token operator">%</span> timeout<span class="token punctuation">)</span>

        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> timeout <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            timeout <span class="token operator">=</span> self<span class="token punctuation">.</span>timeout

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;get: timeout=%s&quot;</span> <span class="token operator">%</span> timeout<span class="token punctuation">)</span>

        endTime <span class="token operator">=</span> start_time <span class="token operator">+</span> timeout
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token comment"># if isRespSingle:</span>
            <span class="token comment">#     singleElement = self.find_element()</span>
            <span class="token comment">#     if singleElement:</span>
            <span class="token comment">#         return singleElement</span>
            <span class="token comment"># else:</span>
            <span class="token comment">#     elems = self.find_elements()</span>
            <span class="token comment">#     if len(elems) &gt; 0:</span>
            <span class="token comment">#         return elems[0]</span>
            isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> self<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> isFound<span class="token punctuation">:</span>
                <span class="token keyword">return</span> isFound<span class="token punctuation">,</span> respInfo

            curTime <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> endTime <span class="token operator">&lt;</span> curTime<span class="token punctuation">:</span>
                <span class="token keyword">break</span>

            <span class="token comment"># time.sleep(0.01)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>RETRY_INTERVAL<span class="token punctuation">)</span>

            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
                curDatetime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>fromtimestamp<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>curTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;curDatetime=%s -&gt; Not timeout, continue find&quot;</span> <span class="token operator">%</span> curDatetime<span class="token punctuation">)</span>

        <span class="token comment"># # check alert again</span>
        <span class="token comment"># sessionAlertExists = self.session.alert.exists</span>
        <span class="token comment"># httpAlertCallback = self.http.alert_callback</span>

        <span class="token comment"># if DEBUG:</span>
        <span class="token comment">#     print(&quot;get: sessionAlertExists=%s, httpAlertCallback=%s&quot; % (sessionAlertExists, httpAlertCallback))</span>

        <span class="token comment"># if sessionAlertExists and httpAlertCallback:</span>
        <span class="token comment">#     self.http.alert_callback()</span>

        <span class="token comment">#     if DEBUG:</span>
        <span class="token comment">#         print(&quot;get: timeout=%s, raise_error=%s&quot; % (timeout, raise_error))</span>

        <span class="token comment">#     # return self.get(timeout, raise_error)</span>
        <span class="token comment">#     return self.get(timeout)</span>

        <span class="token comment"># if raise_error:</span>
        <span class="token comment">#     raise WDAElementNotFoundError(&quot;element not found&quot;, &quot;timeout %.1f&quot; % timeout)</span>
        <span class="token keyword">return</span> isFound<span class="token punctuation">,</span> respInfo

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> oper<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;oper=%s&quot;</span> <span class="token operator">%</span> oper<span class="token punctuation">)</span>

        <span class="token comment"># return getattr(self.get(), oper)</span>
        isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;isFound=%s, respInfo=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>isFound<span class="token punctuation">,</span> respInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> isFound<span class="token punctuation">:</span>
            element <span class="token operator">=</span> respInfo
            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> oper<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">set_timeout</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Set element wait timeout
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> s
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> index
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">child</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        chain <span class="token operator">=</span> self<span class="token punctuation">.</span>_gen_class_chain<span class="token punctuation">(</span><span class="token punctuation">)</span>
        kwargs<span class="token punctuation">[</span><span class="token string">&apos;parent_class_chains&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>parent_class_chains <span class="token operator">+</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span>
        <span class="token keyword">return</span> Selector<span class="token punctuation">(</span>self<span class="token punctuation">.</span>http<span class="token punctuation">,</span> self<span class="token punctuation">.</span>session<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">exists</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>find_element_ids<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>index

    <span class="token keyword">def</span> <span class="token function">click_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Wait element and perform click

        Args:
            timeout (float): timeout for wait

        Returns:
            bool: if successfully clicked
        &quot;&quot;&quot;</span>
        <span class="token comment"># e = self.get(timeout=timeout, raise_error=False)</span>
        <span class="token comment"># if e is None:</span>
        <span class="token comment">#     return False</span>
        isFound<span class="token punctuation">,</span> respInfo <span class="token operator">=</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
        <span class="token keyword">if</span> isFound<span class="token punctuation">:</span>
            e <span class="token operator">=</span> respInfo

            e<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token comment"># def wait(self, timeout=None, raise_error=True):</span>
    <span class="token keyword">def</span> <span class="token function">wait</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; alias of get
        Args:
            timeout (float): timeout seconds

        Raises:
        &quot;&quot;&quot;</span>
        <span class="token comment"># return self.get(timeout=timeout, raise_error=raise_error)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">wait_gone</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> raise_error<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            timeout (float): default timeout
            raise_error (bool): return bool or raise error

        Returns:
            bool: works when raise_error is False

        Raises:
            WDAElementNotDisappearError
        &quot;&quot;&quot;</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> timeout <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> timeout <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            timeout <span class="token operator">=</span> self<span class="token punctuation">.</span>timeout
        <span class="token keyword">while</span> start_time <span class="token operator">+</span> timeout <span class="token operator">&gt;</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> raise_error<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">raise</span> WDAElementNotDisappearError<span class="token punctuation">(</span><span class="token string">&quot;element not gone&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># todo</span>
    <span class="token comment"># pinch</span>
    <span class="token comment"># touchAndHold</span>
    <span class="token comment"># dragfromtoforduration</span>
    <span class="token comment"># twoFingerTap</span>

    <span class="token comment"># todo</span>
    <span class="token comment"># handleGetIsAccessibilityContainer</span>
    <span class="token comment"># [[FBRoute GET:@&quot;/wda/element/:uuid/accessibilityContainer&quot;] respondWithTarget:self action:@selector(handleGetIsAccessibilityContainer:)],</span>


<span class="token keyword">class</span> <span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># def __init__(self, httpclient, id):</span>
    <span class="token comment"># def __init__(self, httpclient, id, rect=None):</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> httpclient<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> bounds<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        base_url eg: http://localhost:8100/session/$SESSION_ID
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>http <span class="token operator">=</span> httpclient
        self<span class="token punctuation">.</span>_id <span class="token operator">=</span> <span class="token builtin">id</span>
        <span class="token comment"># add cached rect=bounds, to avoid later get rect but return 0</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;bounds=%s&quot;</span> <span class="token operator">%</span> bounds<span class="token punctuation">)</span>
        <span class="token keyword">if</span> bounds<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>bounds <span class="token operator">=</span> bounds
            <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;use pass in bounds=%s&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&apos;&lt;wda.Element(id=&quot;{}&quot;)&gt;&apos;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_req</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token string">&apos;/element/&apos;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">+</span> url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_wda_req</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>http<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token string">&apos;/wda/element/&apos;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">+</span> url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_prop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_req<span class="token punctuation">(</span><span class="token string">&apos;get&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/&apos;</span> <span class="token operator">+</span> key<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">_wda_prop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">(</span><span class="token string">&apos;GET&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;wda/element/%s/%s&apos;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token keyword">return</span> ret

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_id

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">label</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;attribute/label&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">className</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;attribute/type&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;text&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return self._prop(&apos;name&apos;)</span>
        <span class="token comment"># Note: here property name, internally: FBElementCommands.m -&gt; handleGetName -&gt; use wdType</span>
        <span class="token comment"># so, for:</span>
        <span class="token comment"># &lt;XCUIElementTypeButton type=&quot;XCUIElementTypeButton&quot; name=&quot;&#xA5;1.00&quot; label=&quot;&#xA5;1.00&quot; enabled=&quot;true&quot; visible=&quot;true&quot; x=&quot;154&quot; y=&quot;152&quot; width=&quot;74&quot; height=&quot;30&quot;/&gt;</span>
        <span class="token comment"># name is XCUIElementTypeButton in type=&quot;XCUIElementTypeButton&quot;</span>
        <span class="token comment"># not expected: &#xA5;1.00 in name=&quot;&#xA5;1.00&quot;</span>
        <span class="token comment"># so change to &apos;attribute/name&apos;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;attribute/name&apos;</span><span class="token punctuation">)</span> <span class="token comment"># &#xA5;1.00</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">displayed</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&quot;displayed&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">enabled</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;enabled&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">accessible</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wda_prop<span class="token punctuation">(</span><span class="token string">&quot;accessible&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># return self._prop(&quot;accessible&quot;)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">accessibility_container</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wda_prop<span class="token punctuation">(</span><span class="token string">&apos;accessibilityContainer&apos;</span><span class="token punctuation">)</span>
        <span class="token comment"># return self._prop(&apos;accessibilityContainer&apos;)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token comment"># Special: not used cache value for AppStore downloading element value will changed</span>
    <span class="token comment">#   &lt;XCUIElementTypeButton type=&quot;XCUIElementTypeButton&quot; value=&quot;18%&quot; name=&quot;&#x6B63;&#x5728;&#x4E0B;&#x8F7D;&quot; label=&quot;&#x6B63;&#x5728;&#x4E0B;&#x8F7D;&quot; enabled=&quot;true&quot; visible=&quot;true&quot; x=&quot;154&quot; y=&quot;308&quot; width=&quot;74&quot; height=&quot;30&quot;/&gt;</span>
    <span class="token comment">#   if use cache, later always get None</span>
    <span class="token comment"># @cached_property</span>
    <span class="token keyword">def</span> <span class="token function">value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        curValue <span class="token operator">=</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;attribute/value&apos;</span><span class="token punctuation">)</span>
        <span class="token comment"># curValue = self._prop(&apos;attribute/wdValue&apos;)</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;curValue=%s&quot;</span> <span class="token operator">%</span> curValue<span class="token punctuation">)</span>
        <span class="token keyword">return</span> curValue

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">enabled</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;enabled&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">visible</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># if DEBUG:</span>
        <span class="token comment">#     print(&quot;call attribute/visible to get visible value&quot;)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;attribute/visible&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># @property</span>
    <span class="token decorator annotation punctuation">@cached_property</span>
    <span class="token keyword">def</span> <span class="token function">bounds</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;try get Element bounds=rect&quot;</span><span class="token punctuation">)</span>

        value <span class="token operator">=</span> self<span class="token punctuation">.</span>_prop<span class="token punctuation">(</span><span class="token string">&apos;rect&apos;</span><span class="token punctuation">)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> value<span class="token punctuation">[</span><span class="token string">&apos;x&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">[</span><span class="token string">&apos;y&apos;</span><span class="token punctuation">]</span>
        w<span class="token punctuation">,</span> h <span class="token operator">=</span> value<span class="token punctuation">[</span><span class="token string">&apos;width&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">[</span><span class="token string">&apos;height&apos;</span><span class="token punctuation">]</span>
        rectObj <span class="token operator">=</span> Rect<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        <span class="token keyword">if</span> DEBUG<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;rectObj=%s&quot;</span> <span class="token operator">%</span> rectObj<span class="token punctuation">)</span>
        <span class="token keyword">return</span> rectObj

    <span class="token comment"># operations</span>
    <span class="token keyword">def</span> <span class="token function">tap</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/click&apos;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot; Alias of tap &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>tap<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">tap_hold</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Tap and hold for a moment

        Args:
            duration (float): seconds of hold time

        [[FBRoute POST:@&quot;/wda/element/:uuid/touchAndHold&quot;] respondWithTarget:self action:@selector(handleTouchAndHold:)],
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wda_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/touchAndHold&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&apos;duration&apos;</span><span class="token punctuation">:</span> duration<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">scroll</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">&apos;visible&apos;</span><span class="token punctuation">,</span> distance<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            direction (str): one of &quot;visible&quot;, &quot;up&quot;, &quot;down&quot;, &quot;left&quot;, &quot;right&quot;
            distance (float): swipe distance, only works when direction is not &quot;visible&quot;

        Raises:
            ValueError

        distance=1.0 means, element (width or height) multiply 1.0
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> direction <span class="token operator">==</span> <span class="token string">&apos;visible&apos;</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_wda_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/scroll&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&apos;toVisible&apos;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> direction <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&apos;up&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;down&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;left&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;right&apos;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_wda_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/scroll&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">&apos;direction&apos;</span><span class="token punctuation">:</span> direction<span class="token punctuation">,</span>
                <span class="token string">&apos;distance&apos;</span><span class="token punctuation">:</span> distance
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;Invalid direction&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">pinch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> velocity<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Args:
            scale (float): scale must &gt; 0
            velocity (float): velocity must be less than zero when scale is less than 1

        Example:
            pinchIn  -&gt; scale:0.5, velocity: -1
            pinchOut -&gt; scale:2.0, velocity: 1
        &quot;&quot;&quot;</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;scale&apos;</span><span class="token punctuation">:</span> scale<span class="token punctuation">,</span> <span class="token string">&apos;velocity&apos;</span><span class="token punctuation">:</span> velocity<span class="token punctuation">}</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_wda_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/pinch&apos;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">set_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/value&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&apos;value&apos;</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">clear_text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_req<span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/clear&apos;</span><span class="token punctuation">)</span>

    <span class="token comment"># def child(self, **kwargs):</span>
    <span class="token comment">#     return Selector(self.__base_url, self._id, **kwargs)</span>

    <span class="token comment"># todo lot of other operations</span>
    <span class="token comment"># tap_hold</span>
</code></pre>
<footer class="page-footer"><span class="copyright">crifan.com&#xFF0C;&#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">&#x7F72;&#x540D;4.0&#x56FD;&#x9645;(CC BY 4.0)&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6700;&#x540E;&#x66F4;&#x65B0;&#xFF1A;
2021-07-17 15:09:12
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="wda.html" class="navigation navigation-prev " aria-label="Previous page: wda">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="element_process.html" class="navigation navigation-next " aria-label="Next page: 元素处理">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"crifan版wda","level":"1.6.1.1","depth":3,"next":{"title":"元素处理","level":"1.6.2","depth":2,"path":"common_code/element_process.md","ref":"common_code/element_process.md","articles":[]},"previous":{"title":"wda","level":"1.6.1","depth":2,"path":"common_code/wda.md","ref":"common_code/wda.md","articles":[{"title":"crifan版wda","level":"1.6.1.1","depth":3,"path":"common_code/crifan_wda.md","ref":"common_code/crifan_wda.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["google-adsense","theme-comscore","anchors","-lunr","-search","search-plus","disqus","-highlight","prism","prism-themes","github-buttons","splitter","-sharing","sharing-plus","tbfed-pagefooter","expandable-chapters-small","ga","donate","sitemap-general","copy-code-button","callouts","toolbar-button"],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"crifan.com，使用<a href='https://creativecommons.org/licenses/by/4.0/deed.zh'>署名4.0国际(CC BY 4.0)协议</a>发布","modify_label":"最后更新：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"disqus":{"useIdentifier":false,"shortName":"crifan"},"callouts":{"showTypeInHeader":false},"toolbar-button":{"label":"下载PDF","url":"http://book.crifan.com/books/ios_automation_facebook_wda/pdf/ios_automation_facebook_wda.pdf","icon":"fa-file-pdf-o"},"splitter":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"donate":{"alipay":"https://www.crifan.com/files/res/crifan_com/crifan_alipay_pay.jpg","alipayText":"支付宝打赏给Crifan","button":"打赏","title":"","wechat":"https://www.crifan.com/files/res/crifan_com/crifan_wechat_pay.jpg","wechatText":"微信打赏给Crifan"},"sitemap-general":{"prefix":"https://book.crifan.com/gitbook/ios_automation_facebook_wda/website/"},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"prism-themes":{},"google-adsense":{"ads":[{"client":"ca-pub-6626240105039250"}]},"github-buttons":{"buttons":[{"repo":"ios_automation_facebook_wda","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]},"expandable-chapters-small":{},"copy-code-button":{},"ga":{"configuration":"auto","token":"UA-28297199-1"},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","line","linkedin","messenger","pocket","qq","qzone","stumbleupon","twitter","viber","vk","weibo","whatsapp"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"search-plus":{}},"theme":"default","author":"Crifan Li <admin@crifan.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"iOS自动化测试利器：facebook-wda","language":"zh-hans","links":{"sidebar":{"主页":"http://www.crifan.com"}},"gitbook":"3.2.3","description":"总结iOS自动化主流框架facebook-wda的简介，环境搭建以及常见问题，以及开发的心得，包括用weditor调试界面和元素，尤其是iOS的各种坑，以及常用代码段，包括crifan优化后的wda、元素处理、iOS设备操作、app的各个方面，比如app管理、首次登录引导页、微信的安全模式和微信公众号、设置中的更新WiFi代理、AppStore的自动安装iOS的app、弹框处理、调试辅助代码等，并给出部分源码分析，最后附上文档和参考资料。"},"file":{"path":"common_code/crifan_wda.md","mtime":"2021-07-17T07:09:12.276Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-07-17T07:45:58.004Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-google-adsense/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toolbar-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

