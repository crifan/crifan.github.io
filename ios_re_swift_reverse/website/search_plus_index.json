{"./":{"url":"./","title":"å‰è¨€","keywords":"","body":"iOSé€†å‘ï¼šSwifté€†å‘ æœ€æ–°ç‰ˆæœ¬ï¼šv1.1.1 æ›´æ–°æ—¶é—´ï¼š20240229 ç®€ä»‹ æ•´ç†iOSé€†å‘æœŸé—´ï¼Œå…³äºSwifté€†å‘ç›¸å…³çš„å„ç§çŸ¥è¯†ã€‚åŒ…æ‹¬é€šç”¨é€»è¾‘å’Œå„ç§å¸¸è§ç±»å‹ï¼Œå°¤å…¶æ˜¯å„ç§ç±»å‹çš„å†…å­˜å¸ƒå±€ã€‚ æºç +æµè§ˆ+ä¸‹è½½ æœ¬ä¹¦çš„å„ç§æºç ã€åœ¨çº¿æµè§ˆåœ°å€ã€å¤šç§æ ¼å¼æ–‡ä»¶ä¸‹è½½å¦‚ä¸‹ï¼š HonKitæºç  crifan/ios_re_swift_reverse: iOSé€†å‘ï¼šSwifté€†å‘ å¦‚ä½•ä½¿ç”¨æ­¤HonKitæºç å»ç”Ÿæˆå‘å¸ƒä¸ºç”µå­ä¹¦ è¯¦è§ï¼šcrifan/honkit_template: demo how to use crifan honkit template and demo åœ¨çº¿æµè§ˆ iOSé€†å‘ï¼šSwifté€†å‘ book.crifan.org iOSé€†å‘ï¼šSwifté€†å‘ crifan.github.io ç¦»çº¿ä¸‹è½½é˜…è¯» iOSé€†å‘ï¼šSwifté€†å‘ PDF iOSé€†å‘ï¼šSwifté€†å‘ ePub iOSé€†å‘ï¼šSwifté€†å‘ Mobi ç‰ˆæƒå’Œç”¨é€”è¯´æ˜ æ­¤ç”µå­ä¹¦æ•™ç¨‹çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æ— ç‰¹åˆ«è¯´æ˜ï¼Œå‡ä¸ºæœ¬äººåŸåˆ›ã€‚å…¶ä¸­éƒ¨åˆ†å†…å®¹å‚è€ƒè‡ªç½‘ç»œï¼Œå‡å·²å¤‡æ³¨äº†å‡ºå¤„ã€‚å¦‚å‘ç°æœ‰ä¾µæƒï¼Œè¯·é€šè¿‡é‚®ç®±è”ç³»æˆ‘ admin è‰¾ç‰¹ crifan.comï¼Œæˆ‘ä¼šå°½å¿«åˆ é™¤ã€‚è°¢è°¢åˆä½œã€‚ å„ç§æŠ€æœ¯ç±»æ•™ç¨‹ï¼Œä»…ä½œä¸ºå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚è¯·å‹¿ç”¨äºä»»ä½•éæ³•ç”¨é€”ã€‚å¦‚æœ‰éæ³•ç”¨é€”ï¼Œå‡ä¸æœ¬äººæ— å…³ã€‚ é¸£è°¢ æ„Ÿè°¢æˆ‘çš„è€å©†é™ˆé›ªçš„åŒ…å®¹ç†è§£å’Œæ‚‰å¿ƒç…§æ–™ï¼Œæ‰ä½¿å¾—æˆ‘crifanæœ‰æ›´å¤šç²¾åŠ›å»ä¸“æ³¨æŠ€æœ¯ä¸“ç ”å’Œæ•´ç†å½’çº³å‡ºè¿™äº›ç”µå­ä¹¦å’ŒæŠ€æœ¯æ•™ç¨‹ï¼Œç‰¹æ­¤é¸£è°¢ã€‚ å…¶ä»– ä½œè€…çš„å…¶ä»–ç”µå­ä¹¦ æœ¬äººcrifanè¿˜å†™äº†å…¶ä»–150+æœ¬ç”µå­ä¹¦æ•™ç¨‹ï¼Œæ„Ÿå…´è¶£å¯ç§»æ­¥è‡³ï¼š crifan/crifan_ebook_readme: Crifançš„ç”µå­ä¹¦çš„ä½¿ç”¨è¯´æ˜ å…³äºä½œè€… å…³äºä½œè€…æ›´å¤šä»‹ç»ï¼Œè¯¦è§ï¼š å…³äºCrifanLiæèŒ‚ â€“ åœ¨è·¯ä¸Š crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-29 14:23:57 "},"swift_re_overview/":{"url":"swift_re_overview/","title":"Swifté€†å‘æ¦‚è§ˆ","keywords":"","body":"Swifté€†å‘æ¦‚è§ˆ iOSé€†å‘æœŸé—´ï¼Œæœ‰äº›appäºŒè¿›åˆ¶ä»£ç å†…éƒ¨æ˜¯ï¼šObjCå’ŒSwiftæ··åˆçš„ã€‚ æ‰€ä»¥æ¶‰åŠåˆ°ï¼šSwifté€†å‘ã€‚ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:07 "},"swift_re_overview/mindmap.html":{"url":"swift_re_overview/mindmap.html","title":"Swifté€†å‘è„‘å›¾","keywords":"","body":"Swifté€†å‘è„‘å›¾ æ­¤å¤„ç”¨è„‘å›¾å»è¡¨ç¤ºå‡ºæ­¤æ•™ç¨‹çš„æ ¸å¿ƒå†…å®¹ï¼š Swifté€†å‘è„‘å›¾ Swifté€†å‘è„‘å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-28 21:31:59 "},"swift_basic/":{"url":"swift_basic/","title":"SwiftåŸºç¡€çŸ¥è¯†","keywords":"","body":"SwiftåŸºç¡€çŸ¥è¯† crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:35:44 "},"swift_function/":{"url":"swift_function/","title":"Swiftå‡½æ•°","keywords":"","body":"Swiftå‡½æ•° crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:45:38 "},"swift_function/SwiftObject/":{"url":"swift_function/SwiftObject/","title":"SwiftObject","keywords":"","body":"SwiftObject crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:13:01 "},"swift_function/SwiftObject/swift_getinitializedobjcclass.html":{"url":"swift_function/SwiftObject/swift_getinitializedobjcclass.html","title":"swift_getInitializedObjCClass","keywords":"","body":"swift_getInitializedObjCClass æºç  swift/stdlib/public/runtime/SwiftObject.mm at main Â· apple/swift (github.com) Class swift::swift_getInitializedObjCClass(Class c) { // Used when we have class metadata and we want to ensure a class has been // initialized by the Objective-C runtime. We need to do this because the // class \"c\" might be valid metadata, but it hasn't been initialized yet. // Send a message that's likely not to be overridden to minimize potential // side effects. Ignore the return value in case it is overridden to // return something different. See // https://github.com/apple/swift/issues/52863 for an example. [c self]; return c; } æ€»ç»“ Swiftçš„swift_getInitializedObjCClasså‡½æ•°å®šä¹‰ Class swift::swift_getInitializedObjCClass(Class c) å‚æ•° Class c è¿”å›å€¼ ç±»å‹ï¼šClass crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:41:50 "},"swift_function/unsafemutablebufferpointer/":{"url":"swift_function/unsafemutablebufferpointer/","title":"UnsafeMutableBufferPointer","keywords":"","body":"UnsafeMutableBufferPointer crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:11:42 "},"swift_function/unsafemutablebufferpointer/init_start_count.html":{"url":"swift_function/unsafemutablebufferpointer/init_start_count.html","title":"init(start:count:)","keywords":"","body":"UnsafeMutableBufferPointer.init(start:count:) æºç  swift/stdlib/public/core/UnsafeRawBufferPointer.swift.gyb @frozen public struct Unsafe${Mutable}RawBufferPointer { @usableFromInline internal let _position, _end: Unsafe${Mutable}RawPointer? /// Creates a buffer over the specified number of contiguous bytes starting /// at the given pointer. /// /// - Parameters: /// - start: The address of the memory that starts the buffer. If `starts` /// is `nil`, `count` must be zero. However, `count` may be zero even /// for a non-`nil` `start`. /// - count: The number of bytes to include in the buffer. `count` must not /// be negative. @inlinable public init( @_nonEphemeral start: Unsafe${Mutable}RawPointer?, count: Int ) { _debugPrecondition(count >= 0, \"${Self} with negative count\") _debugPrecondition(count == 0 || start != nil, \"${Self} has a nil start and nonzero count\") _position = start _end = start.map { $0 + _assumeNonNegative(count) } } } æ€»ç»“ UnsafeMutableBufferPointer init(start:count:) å®šä¹‰ init(start: UnsafeMutablePointer?, count: Int) å‚æ•° start: UnsafeMutablePointer? count: Int è¿”å›å€¼ æŒ‡é’ˆ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:44:37 "},"swift_function/array/":{"url":"swift_function/array/","title":"Array","keywords":"","body":"Array crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:47:06 "},"swift_function/array/formindex_after.html":{"url":"swift_function/array/formindex_after.html","title":"formIndex(after:)","keywords":"","body":"Array.formIndex(after:) æºç  swift/stdlib/public/core/Array.swift /// Replaces the given index with its successor. /// /// - Parameter i: A valid index of the collection. `i` must be less than /// `endIndex`. @inlinable public func formIndex(after i: inout Int) { // NOTE: this is a manual specialization of index movement for a Strideable // index that is required for Array performance. The optimizer is not // capable of creating partial specializations yet. // NOTE: Range checks are not performed here, because it is done later by // the subscript function. i += 1 } æ€»ç»“ Swiftå‡½æ•°ï¼šArray.formIndex(after:) å®šä¹‰ formIndex(after i: inout Int) å‚æ•° å˜é‡å ä¼ å…¥ï¼šafter å†…éƒ¨ï¼ši ç±»å‹ï¼šinout Int == æŒ‡é’ˆç±»å‹ï¼Œå†…éƒ¨ä¼šæ”¹å˜å€¼ è¿”å›å€¼ ä¼ å…¥çš„after==i ï¼ˆå€¼å·²åŠ 1ï¼‰ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:48:27 "},"swift_function/set/":{"url":"swift_function/set/","title":"Set","keywords":"","body":"Set crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:13:57 "},"swift_function/set/nativeset_unsafeinsertnew.html":{"url":"swift_function/set/nativeset_unsafeinsertnew.html","title":"_NativeSet._unsafeInsertNew","keywords":"","body":"_NativeSet._unsafeInsertNew swift/stdlib/public/core/NativeSet.swift extension _NativeSet { // Insertions /// Insert a new element into uniquely held storage. /// Storage must be uniquely referenced with adequate capacity. /// The `element` must not be already present in the Set. @inlinable internal func _unsafeInsertNew(_ element: __owned Element) { _internalInvariant(count + 1 crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:14:52 "},"swift_re_related/":{"url":"swift_re_related/","title":"Swifté€†å‘ç›¸å…³","keywords":"","body":"Swifté€†å‘ç›¸å…³ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:28:48 "},"swift_re_related/static_analysis/":{"url":"swift_re_related/static_analysis/","title":"é™æ€åˆ†æ","keywords":"","body":"Swifté€†å‘ä¹‹é™æ€åˆ†æ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:27:31 "},"swift_re_related/static_analysis/export_header.html":{"url":"swift_re_related/static_analysis/export_header.html","title":"å¯¼å‡ºå¤´æ–‡ä»¶","keywords":"","body":"å¯¼å‡ºSwiftå¤´æ–‡ä»¶ TODOï¼šæŠŠå¯¼å‡ºObjCå’ŒSwiftæ··æ·†æ—¶ä¼šæŠ¥é”™çš„é—®é¢˜ï¼Œå’Œè§£å†³åŠæ³•ï¼ˆæœ€æ–°ç‰ˆçš„class-dumpï¼‰ï¼Œæ•´ç†è¿‡æ¥ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:29:18 "},"swift_re_related/static_analysis/ida.html":{"url":"swift_re_related/static_analysis/ida.html","title":"IDAåˆ†æ","keywords":"","body":"IDAåˆ†æSwift TODOï¼šæŠŠå·²åŠ åˆ°IDAä¸­çš„ï¼Œå„ç§ç±»å‹çš„å®šä¹‰ï¼Œæ•´ç†è¿‡æ¥ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:30:57 "},"swift_re_related/dynamic_debug/":{"url":"swift_re_related/dynamic_debug/","title":"åŠ¨æ€è°ƒè¯•","keywords":"","body":"Swifté€†å‘ä¹‹åŠ¨æ€è°ƒè¯• è°ƒè¯•æ—¶ï¼Œè¾…åŠ©ç”¨IDAæ‰“å¼€Swiftçš„å„ç§åº“æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š libswiftCore.dylib libswiftFoundation.dylib ç­‰ç­‰ æ–¹ä¾¿è°ƒè¯•å†…å®¹ã€‚ è¿™æ ·ï¼Œé€šè¿‡åŠ¨æ€è°ƒè¯•å’ŒæŸ¥çœ‹IDAä¸­çš„åˆ†æï¼Œå‡½æ•°çš„ä¼ªä»£ç å®ç°ç­‰ç­‰ï¼Œå°±å¯ä»¥æœ‰æ›´æ·±å…¥çš„ç†è§£å¾ˆå¤šå‡½æ•°å’Œå˜é‡äº†ã€‚ TODOï¼šæŠŠä¸‹é¢å¸–å­ä¸­æœ‰ç”¨çš„å†…å®¹ï¼Œæ•´ç†è¿‡æ¥ï¼š ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šswift_getAssociatedTypeWitness ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šData.withUnsafeMutableBytes(_:) ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šData.withUnsafeBytes(_:) ã€æœªè§£å†³ã€‘iOSé€†å‘WhatsAppï¼šswiftPodCopy_10039A1B4 ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šSet.init(_:) ã€è®°å½•ã€‘iOSé€†å‘Swiftï¼šIDAé™æ€åˆ†ælibswiftFoundation.dylib ã€‚ã€‚ã€‚ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šåº“æ–‡ä»¶libswiftCore.dylib ã€å·²è§£å†³ã€‘iOSé€†å‘WhatsAppï¼šArrayAdoptStorage_2ToW1_CB2C static Swift.Array.adoptStorage(: __owned Swift._ContiguousArrayStorage, count: Swift.Int) -> (Swift.Array, Swift.UnsafeMutablePointer) ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šdyld_stub_binder ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šStringçš„WitnessTableè¯¦æƒ… destroy value witness for Swift.String ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šFloatå¯¹åº”çš„Builtin.Int32çš„VWTçš„å…·ä½“å€¼ type metadata for Swift.Float ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼š_NativeSet._unsafeInsertNew Swift.NativeSet._unsafeInsertNew(: __owned Ï„_0_0, at: Swift._HashTable.Bucket) -> () ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šOptionalçš„VWT=ValueWitnessTable ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼š_SetStorage.allocate static Swift._SetStorage.allocate(capacity: Swift.Int) -> Swift._SetStorage ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šXcodeä¸­ç»™Swiftå‡½æ•°_NativeSet.initåŠ æ–­ç‚¹ Swift._NativeSet.init(capacity: Swift.Int) -> Swift._NativeSet ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šNativeSet Collection ã€æœªè§£å†³ã€‘iOSé€†å‘WhatsAppï¼šCollection.map(_:)(void) ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šswift_getAssociatedTypeWitness Swift.Collection.isEmpty.getter : Swift.Bool ã€åŸºæœ¬è§£å†³ã€‘iOSé€†å‘Swiftï¼šprotocol requirements base descriptorçš„å«ä¹‰ protocol requirements base descriptor for Swift.Collection ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šSwiftçš„pod_copy pod_copy(swift::OpaqueValue, swift::OpaqueValue, swift::TargetMetadata const*) ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šSwift._ContiguousArrayStorage type metadata accessor for Swift._ContiguousArrayStorage ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šswift_getTypeByMangledNameInContext ã€æœªè§£å†³ã€‘iOSé€†å‘ï¼š__swift_instantiateConcreteTypeFromMangledName ã€å·²è§£å†³ã€‘iOSé€†å‘WhatsAppï¼šSwiftå‡½æ•°String.append(_:)çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„å®ç°é€»è¾‘ Swift.String.append(Swift.String) -> () crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:33 "},"swift_common/":{"url":"swift_common/","title":"Swifté€šç”¨é€»è¾‘","keywords":"","body":"Swifté€šç”¨é€»è¾‘ å…¶ä»– ValueBuffer Exitential Container? Box? Opaque ? crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:32:50 "},"swift_common/typemetadata/":{"url":"swift_common/typemetadata/","title":"TypeMetadata","keywords":"","body":"TypeMetadata Swiftä¸­æœ‰å‡ ç§Metadata ä¸»è¦æœ‰2ç±» Classçš„ï¼šTargetClassMetadata == ClassMetadata éClassçš„=ï¼ˆStructã€Enumã€Optionalç­‰ï¼‰Valueçš„ï¼šTargetValueMetadata = ValueMetadata é€šç”¨é€»è¾‘ TargetClassMetadataå’ŒTargetValueMetadataï¼Œéƒ½ç»§æ‰¿è‡ªï¼šTargetMetadata TargetMetadata å±æ€§=å­—æ®µ Kind å¦å¤–ä¸€ç§è¡¨è¿°ï¼š Swiftä¸­çš„Metadata TargetMetadata ClassMetadata ==TargetClassMetadata é€‚ç”¨äºï¼šClassç±» ValueMetadata ==TargetValueMetadata é€‚ç”¨äºï¼šéClass == Structã€Enumã€Optionalç­‰Value crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:22:10 "},"swift_common/typemetadata/valuemetadata/":{"url":"swift_common/typemetadata/valuemetadata/","title":"ValueMetadata","keywords":"","body":"ValueMetadata å†…å­˜å¸ƒå±€ å›¾ Swiftçš„ValueMetadataå’ŒVWTçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ = Swift ValueMetadata and VWT Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„ValueMetadataå’ŒVWTçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå®šä¹‰ æ–‡å­— Swiftä¸­çš„ï¼šTargetValueMetadata ç»§æ‰¿å…³ç³» TargetValueMetadata = ValueMetadata TargetMetadata å­—æ®µ=å±æ€§=å†…å­˜å¸ƒå±€ TargetMetadata StoredPointer Kind the kind. Only valid for non-class metadata; getKind() must be used to get the kind value TargetValueMetadata TargetSignedPointer* Description An out-of-line description of the type è¯´æ˜ æ­¤å¤„çš„Descriptionæ ¹æ®å…·ä½“ç±»å‹ä¸åŒï¼Œåˆ™æ˜¯ä¸åŒçš„å†…å®¹ ä¸¾ä¾‹ Struct TargetStructDescriptor=StructDescriptor åŠ åˆ°IDAä¸­çš„å®šä¹‰ struct ValueMetadata { __int64 kind; void *description; }; crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-23 14:44:48 "},"swift_common/typemetadata/valuemetadata/vwt.html":{"url":"swift_common/typemetadata/valuemetadata/vwt.html","title":"VWT","keywords":"","body":"VWT=ValueWitnessTable æ¦‚è¿° VWTç»“æ„å¸ƒå±€ æ–‡å­— Swiftçš„VWT=Value Witness Table ç»“æ„å¸ƒå±€=å­—æ®µ=å±æ€§ [+0x00] = void* initializeBufferWithCopyOfBuffer [+0x08] = void* destroy [+0x10] = void* initializeWithCopy [+0x18] = void* assignWithCopy [+0x20] = void* initializeWithTake [+0x28] = void* assignWithTake [+0x30] = void* getEnumTagSinglePayload [+0x38] = void* storeEnumTagSinglePayload [+0x40] = void* int64 size [+0x48] = void* int64 stride [+0x50~0x53] = int32 flags [+0x54~0x57] = int32 extraInhabitantCount å›¾ è¯¦è§ï¼š ValueMetadata åŠ å…¥åˆ°IDAä¸­çš„å®šä¹‰ struct ValueWitnessTable struct __cppobj ValueWitnessTable { void (__fastcall *initializeBufferWithCopyOfBuffer)(void *dst, void *src, void *metadataSelf); void (__fastcall *destroy)(void *object, void *witnessSelf); void (__fastcall *initializeWithCopy)(void *dst, void *src, void *metadataSelf); void (__fastcall *assignWithCopy)(void *dst, void *src, void *metadataSelf); void (__fastcall *initializeWithTake)(void *dst, void *src, void *metadataSelf); void (__fastcall *assignWithTake)(void *dst, void *src, void *metadataSelf); unsigned __int64 (__fastcall *getEnumTagSinglePayload)(void *enumPtr, __int64 emptyCases, void *metadataSelf); void (__fastcall *storeEnumTagSinglePayload)(void *enumPtr, __int64 whichCase, void *metadataSelf); __int64 size; __int64 stride; TargetValueWitnessFlags flags; __int32 extraInhabitantCount; }; enum TargetValueWitnessFlags 000000FF ; enum TargetValueWitnessFlags, mappedto_10385, bitfield, width 4 bytes 000000FF AlignmentMask EQU 0xFF 00010000 IsNonPOD EQU 0x10000 00020000 IsNonInline EQU 0x20000 00080000 HasSpareBits EQU 0x80000 00100000 IsNonBitwiseTakable EQU 0x100000 00200000 HasEnumWitnesses EQU 0x200000 00400000 Incomplete EQU 0x400000 00800000 IsNonCopyable EQU 0x800000 00800000 è¯¦è§£ å†…å­˜å¸ƒå±€ Swiftçš„VWT=Value Witness Table ç»“æ„å¸ƒå±€=å­—æ®µ=å±æ€§ [+0x00] = initializeBufferWithCopyOfBuffer å®šä¹‰ï¼šT *(*initializeBufferWithCopyOfBuffer)(B *dest, B *src, M *self); [+0x08] = destroy å®šä¹‰ï¼švoid (*destroy)(T *object, witness_t *self); [+0x10] = initializeWithCopy å®šä¹‰ï¼šT *(*initializeWithCopy)(T *dest, T *src, M *self); [+0x18] = assignWithCopy å®šä¹‰ï¼šT *(*assignWithCopy)(T *dest, T *src, M *self); [+0x20] = initializeWithTake å®šä¹‰ï¼šT *(*initializeWithTake)(T *dest, T *src, M *self); [+0x28] = assignWithTake å®šä¹‰ï¼šT *(*assignWithTake)(T *dest, T *src, M *self); [+0x30] = getEnumTagSinglePayload å®šä¹‰ï¼šunsigned (*getEnumTagSinglePayload)(const T* enum, UINT_TYPE emptyCases, M *self); [+0x38] = storeEnumTagSinglePayload å®šä¹‰ï¼švoid (*storeEnumTagSinglePayload)(T* enum, UINT_TYPE whichCase, UINT_TYPE emptyCases, M *self); [+0x40] = size å®šä¹‰ï¼šSIZE_TYPE size; [+0x48] = stride å®šä¹‰ï¼šSIZE_TYPE stride; [+0x50~0x53] = flags å®šä¹‰ï¼šUINT_TYPE flags; [+0x54~0x57] = extraInhabitantCount å®šä¹‰ï¼šUINT_TYPE extraInhabitantCount; è¯´æ˜ SIZE_TYPE = StoredSize = size_t ? = int64 UINT_TYPE = unsigned = int32 Swfitä»£ç  swift-language/include/swift/ABI/ValueWitness.def at master Â· eaplatanios/swift-language /// T *(*initializeBufferWithCopyOfBuffer)(B *dest, B *src, M *self); /// Given an invalid buffer, initialize it as a copy of the /// object in the source buffer. FUNCTION_VALUE_WITNESS(initializeBufferWithCopyOfBuffer, InitializeBufferWithCopyOfBuffer, MUTABLE_VALUE_TYPE, (MUTABLE_BUFFER_TYPE, MUTABLE_BUFFER_TYPE, TYPE_TYPE)) BEGIN_VALUE_WITNESS_RANGE(ValueWitness, InitializeBufferWithCopyOfBuffer) BEGIN_VALUE_WITNESS_RANGE(RequiredValueWitness, InitializeBufferWithCopyOfBuffer) BEGIN_VALUE_WITNESS_RANGE(RequiredValueWitnessFunction, InitializeBufferWithCopyOfBuffer) /// void (*destroy)(T *object, witness_t *self); /// /// Given a valid object of this type, destroy it, leaving it as an /// invalid object. This is useful when generically destroying /// an object which has been allocated in-line, such as an array, /// struct, or tuple element. FUNCTION_VALUE_WITNESS(destroy, Destroy, VOID_TYPE, (MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// T *(*initializeWithCopy)(T *dest, T *src, M *self); /// /// Given an invalid object of this type, initialize it as a copy of /// the source object. Returns the dest object. FUNCTION_VALUE_WITNESS(initializeWithCopy, InitializeWithCopy, MUTABLE_VALUE_TYPE, (MUTABLE_VALUE_TYPE, MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// T *(*assignWithCopy)(T *dest, T *src, M *self); /// /// Given a valid object of this type, change it to be a copy of the /// source object. Returns the dest object. FUNCTION_VALUE_WITNESS(assignWithCopy, AssignWithCopy, MUTABLE_VALUE_TYPE, (MUTABLE_VALUE_TYPE, MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// T *(*initializeWithTake)(T *dest, T *src, M *self); /// /// Given an invalid object of this type, initialize it by taking /// the value of the source object. The source object becomes /// invalid. Returns the dest object. FUNCTION_VALUE_WITNESS(initializeWithTake, InitializeWithTake, MUTABLE_VALUE_TYPE, (MUTABLE_VALUE_TYPE, MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// T *(*assignWithTake)(T *dest, T *src, M *self); /// /// Given a valid object of this type, change it to be a copy of the /// source object. The source object becomes invalid. Returns the /// dest object. FUNCTION_VALUE_WITNESS(assignWithTake, AssignWithTake, MUTABLE_VALUE_TYPE, (MUTABLE_VALUE_TYPE, MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// unsigned (*getEnumTagSinglePayload)(const T* enum, UINT_TYPE emptyCases) /// Given an instance of valid single payload enum with a payload of this /// witness table's type (e.g Optional) , get the tag of the enum. FUNCTION_VALUE_WITNESS(getEnumTagSinglePayload, GetEnumTagSinglePayload, UINT_TYPE, (IMMUTABLE_VALUE_TYPE, UINT_TYPE, TYPE_TYPE)) /// void (*storeEnumTagSinglePayload)(T* enum, UINT_TYPE whichCase, /// UINT_TYPE emptyCases) /// Given uninitialized memory for an instance of a single payload enum with a /// payload of this witness table's type (e.g Optional), store the /// tag. FUNCTION_VALUE_WITNESS(storeEnumTagSinglePayload, StoreEnumTagSinglePayload, VOID_TYPE, (MUTABLE_VALUE_TYPE, UINT_TYPE, UINT_TYPE, TYPE_TYPE)) END_VALUE_WITNESS_RANGE(RequiredValueWitnessFunction, StoreEnumTagSinglePayload) /// SIZE_TYPE size; /// /// The required storage size of a single object of this type. DATA_VALUE_WITNESS(size, Size, SIZE_TYPE) BEGIN_VALUE_WITNESS_RANGE(TypeLayoutWitness, Size) BEGIN_VALUE_WITNESS_RANGE(RequiredTypeLayoutWitness, Size) /// SIZE_TYPE stride; /// /// The required size per element of an array of this type. It is at least /// one, even for zero-sized types, like the empty tuple. DATA_VALUE_WITNESS(stride, Stride, SIZE_TYPE) /// UINT_TYPE flags; /// /// The ValueWitnessAlignmentMask bits represent the required /// alignment of the first byte of an object of this type, expressed /// as a mask of the low bits that must not be set in the pointer. /// This representation can be easily converted to the 'alignof' /// result by merely adding 1, but it is more directly useful for /// performing dynamic structure layouts, and it grants an /// additional bit of precision in a compact field without needing /// to switch to an exponent representation. /// /// The ValueWitnessIsNonPOD bit is set if the type is not POD. /// /// The ValueWitnessIsNonInline bit is set if the type cannot be /// represented in a fixed-size buffer or if it is not bitwise takable. /// /// The ExtraInhabitantsMask bits represent the number of \"extra inhabitants\" /// of the bit representation of the value that do not form valid values of /// the type. /// /// The Enum_HasSpareBits bit is set if the type's binary representation /// has unused bits. /// /// The HasEnumWitnesses bit is set if the type is an enum type. DATA_VALUE_WITNESS(flags, Flags, UINT_TYPE) /// UINT_TYPE extraInhabitantCount; /// /// The number of extra inhabitants in the type. DATA_VALUE_WITNESS(extraInhabitantCount, ExtraInhabitantCount, UINT_TYPE) END_VALUE_WITNESS_RANGE(RequiredTypeLayoutWitness, ExtraInhabitantCount) END_VALUE_WITNESS_RANGE(RequiredValueWitness, ExtraInhabitantCount) END_VALUE_WITNESS_RANGE(TypeLayoutWitness, ExtraInhabitantCount) #endif /* WANT_REQUIRED_VALUE_WITNESSES */ #if WANT_ENUM_VALUE_WITNESSES // The following value witnesses are conditionally present if the witnessed // type is an enum. /// unsigned (*getEnumTag)(T *obj, M *self); /// /// Given a valid object of this enum type, extracts the tag value indicating /// which case of the enum is inhabited. Returned values are in the range /// [0..NumElements-1]. FUNCTION_VALUE_WITNESS(getEnumTag, GetEnumTag, INT_TYPE, (IMMUTABLE_VALUE_TYPE, TYPE_TYPE)) BEGIN_VALUE_WITNESS_RANGE(EnumValueWitness, GetEnumTag) /// void (*destructiveProjectEnumData)(T *obj, M *self); /// Given a valid object of this enum type, destructively extracts the /// associated payload. FUNCTION_VALUE_WITNESS(destructiveProjectEnumData, DestructiveProjectEnumData, VOID_TYPE, (MUTABLE_VALUE_TYPE, TYPE_TYPE)) /// void (*destructiveInjectEnumTag)(T *obj, unsigned tag, M *self); /// Given an enum case tag and a valid object of case's payload type, /// destructively inserts the tag into the payload. The given tag value /// must be in the range [-ElementsWithPayload..ElementsWithNoPayload-1]. FUNCTION_VALUE_WITNESS(destructiveInjectEnumTag, DestructiveInjectEnumTag, VOID_TYPE, (MUTABLE_VALUE_TYPE, UINT_TYPE, TYPE_TYPE)) END_VALUE_WITNESS_RANGE(EnumValueWitness, DestructiveInjectEnumTag) END_VALUE_WITNESS_RANGE(ValueWitness, DestructiveInjectEnumTag) Swiftçš„VWTå’ŒC++å¯¹åº”å…³ç³» Swift Value Witness Operation C++ equivalent initializeWithCopy copy constructor assignWithCopy copy assignment operator initializeWithTake move constructor, followed by a call to destructor on the source assignWithTake move assignment operator, followed by a call to destructor on the source destroy destructor size sizeof(T) minus trailing padding stride sizeof(T) flags among other information, contains alignment, i.e., alignof(T) ä¸¾ä¾‹ Builtin.NativeObjectçš„VWT Builtin.NativeObjectçš„VWTå†…å­˜å¸ƒå±€ [+0x00] = initializeBufferWithCopyOfBuffer name=\"swift::metadataimpl::BufferValueWitnesses, true, 8ul, 8ul, (swift::metadataimpl::FixedPacking)1>::initializeBufferWithCopyOfBuffer(swift::TargetValueBuffer*, swift::TargetValueBuffer*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl20BufferValueWitnessesINS0_14ValueWitnessesINS0_18SwiftRetainableBoxEEELb1ELm8ELm8ELNS0_12FixedPackingE1EE32initializeBufferWithCopyOfBufferEPNS_17TargetValueBufferINS_9InProcessEEESA_PKNS_14TargetMetadataIS8_EE\" [+0x08] = destroy name=\"swift::metadataimpl::ValueWitnesses::destroy(swift::OpaqueValue*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl14ValueWitnessesINS0_18SwiftRetainableBoxEE7destroyEPNS_11OpaqueValueEPKNS_14TargetMetadataINS_9InProcessEEE\" [+0x10] = initializeWithCopy name=\"swift::metadataimpl::ValueWitnesses::initializeWithCopy(swift::OpaqueValue*, swift::OpaqueValue*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl14ValueWitnessesINS0_18SwiftRetainableBoxEE18initializeWithCopyEPNS_11OpaqueValueES5_PKNS_14TargetMetadataINS_9InProcessEEE\" [+0x18] = assignWithCopy name=\"swift::metadataimpl::ValueWitnesses::assignWithCopy(swift::OpaqueValue*, swift::OpaqueValue*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl14ValueWitnessesINS0_18SwiftRetainableBoxEE14assignWithCopyEPNS_11OpaqueValueES5_PKNS_14TargetMetadataINS_9InProcessEEE\" [+0x20] = initializeWithTake name=\"swift::metadataimpl::ValueWitnesses::initializeWithTake(swift::OpaqueValue*, swift::OpaqueValue*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl14ValueWitnessesINS0_18SwiftRetainableBoxEE18initializeWithTakeEPNS_11OpaqueValueES5_PKNS_14TargetMetadataINS_9InProcessEEE\" [+0x28] = assignWithTake name=\"swift::metadataimpl::ValueWitnesses::assignWithTake(swift::OpaqueValue*, swift::OpaqueValue*, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl14ValueWitnessesINS0_18SwiftRetainableBoxEE14assignWithTakeEPNS_11OpaqueValueES5_PKNS_14TargetMetadataINS_9InProcessEEE\" [+0x30] = getEnumTagSinglePayload name=\"swift::metadataimpl::FixedSizeBufferValueWitnesses, true, 8ul, 8ul, true>::getEnumTagSinglePayload(swift::OpaqueValue const*, unsigned int, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl29FixedSizeBufferValueWitnessesINS0_14ValueWitnessesINS0_18SwiftRetainableBoxEEELb1ELm8ELm8ELb1EE23getEnumTagSinglePayloadEPKNS_11OpaqueValueEjPKNS_14TargetMetadataINS_9InProcessEEE\" [+0x38] = storeEnumTagSinglePayload name=\"swift::metadataimpl::FixedSizeBufferValueWitnesses, true, 8ul, 8ul, true>::storeEnumTagSinglePayload(swift::OpaqueValue*, unsigned int, unsigned int, swift::TargetMetadata const*)\" mangled=\"_ZN5swift12metadataimpl29FixedSizeBufferValueWitnessesINS0_14ValueWitnessesINS0_18SwiftRetainableBoxEEELb1ELm8ELm8ELb1EE25storeEnumTagSinglePayloadEPNS_11OpaqueValueEjjPKNS_14TargetMetadataINS_9InProcessEEE\" [+0x40] = int64 size 0x0000000000000008 [+0x48] = int64 stride 0x0000000000000008 [+0x50~0x53] = int32 flags 0x00010007 [+0x54~0x57] = int32 extraInhabitantCount 0x7fffffff crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-23 14:50:55 "},"swift_common/typemetadata/valuemetadata/structmetadata.html":{"url":"swift_common/typemetadata/valuemetadata/structmetadata.html","title":"StructMetadata","keywords":"","body":"StructMetadata StructMetadataçš„å†…å­˜å¸ƒå±€ å›¾ Swiftçš„StructMetadataå†…å­˜å¸ƒå±€å›¾ = Swift ValueMetadata Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„StructMetadataå†…å­˜å¸ƒå±€å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå®šä¹‰ æ–‡å­— Swiftçš„StructMetadataçš„å†…å­˜å¸ƒå±€ [-0x08] = ValueWitnessTable* vwt; [+0x00] = int64 kind // æ˜¯å›ºå®šçš„ï¼š0x200 [+0x08] = StructDescriptor* description StructDescriptor FieldDescriptor FieldRecord ä¸¾ä¾‹ ConcreteConfigPrimitiveBoxçš„StructDescriptor å†…å­˜å€¼ï¼š (lldb) x/16gw 0x000000010771431c 0x10771431c: 0x000000d1 0xffffffdc 0xffe75bcc 0xfd6669b4 0x10771432c: 0x00000000 0x00000001 0x00000004 0x00a2c760 0x10771433c: 0xffe75bd4 0x00010001 0x00000002 0x00000080 0x10771434c: 0x00000080 0x000a5870 0xfffffe78 0x000000c2 å¯¹åº”ç€IDAä¸­çš„æ±‡ç¼–ï¼š __constg_swiftt:0000000102DF831C ; nominal type descriptor for MainAppLibrary.ConcreteConfigPrimitiveBox __constg_swiftt:0000000102DF831C $s14MainAppLibrary26ConcreteConfigPrimitiveBoxVMn StructDescriptor -> StructDescriptorçš„ä¾‹å­ï¼šConcreteConfigPrimitiveBox struc : sizeof=0x1C == 0x000000010771431c == IDAçš„ 0x0000000102df831c [0x00~0x03] = Flags 0x000000d1 [0x04~0x07] = Parent 0xffffffdc stru_102DF82FC - . = 0x102DF82FC - (0x0000000102df831c + 0x4) = 0x102DF82FC - 0x0000000102df8320 = 0xFFFFFFDC [0x08~0x0B] = Name 0xffe75bcc aConcreteconfig - . aConcreteconfig == \"ConcreteConfigPrimitiveBox\" = 0x102C6DEF0 - (0x0000000102df831c + 0x8) = 0xFFE75BCC [0x0C~0x0F] = AccessFunction = AccessFunctionPtr 0xfd6669b4 $s14MainAppLibrary26ConcreteConfigPrimitiveBoxVMa - . = 0x10045ECDC - (0x0000000102df831c + 0xC) = 0xFD6669B4 [0x10~0x13] = FieldDescriptor == Fields 0x00000000 $s14MainAppLibrary26ConcreteConfigPrimitiveBoxVMn.FieldDescriptor - . = 0x0000000102df832c - (0x0000000102df831c + 0x10) = 0 [0x14~0x17] = NumFields 0x00000001 è¿™ä¸ªç»“æ„ä½“åªæœ‰ä¸€ä¸ªå­—æ®µ=å±æ€§property=åŸŸfield ï¼Ÿ å¥½åƒæ˜¯ï¼šfield offset vector length = 1 æ­¤å¤„æ˜¯æœ‰1ä¸ªfield offset vectorçš„ [0x18~0x1B] = FieldOffsetVectorOffset 0x00000004 The offset of the field offset vector for this struct's stored properties in its metadata æ­¤å¤„çš„field offset vectorçš„offsetæ˜¯4 crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:37:49 "},"swift_common/typemetadata/classmetadata/":{"url":"swift_common/typemetadata/classmetadata/","title":"ClassMetadata","keywords":"","body":"ClassMetadata crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:47:20 "},"swift_common/typemetadata/classmetadata/memory_layout/":{"url":"swift_common/typemetadata/classmetadata/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:33:30 "},"swift_common/typemetadata/classmetadata/memory_layout/figure.html":{"url":"swift_common/typemetadata/classmetadata/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„ClassMetadataçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ Swiftçš„ClassMetadataçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ = Swift ClassMetadata Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„ClassMetadataå†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå®šä¹‰ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:48:50 "},"swift_common/typemetadata/classmetadata/memory_layout/text.html":{"url":"swift_common/typemetadata/classmetadata/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"ClassMetadataçš„å†…å­˜å¸ƒå±€ æ¦‚è¿° ClassMetadata = Classçš„TypeMetadata Classçš„TypeMetadata [+0x00] = var kind: Int [+0x08] = var superClass: UnsafeMutablePointer [+0x10] = Int cacheData[2] [+0x20] = var data: Int [+0x28] = var classFlags: Int32 [+0x2C] = var instanceAddressPoint: UInt32 [+0x30] = var instanceSize: UInt32 [+0x34] = var instanceAlignmentMask: UInt16 [+0x36] = var reserved: UInt16 [+0x38] = var classSize: UInt32 [+0x3C] = var classAddressPoint: UInt32 [+0x40] = var typeDescriptor: UnsafeMutablePointer [+0x48] = var iVarDestroyer: UnsafeMutablePointer struct TargetClassDescriptor struct TargetClassDescriptor [+0x00] = var flags: UInt32 [+0x04] = var parent: TargetRelativeDirectPointer [+0x08] = var name: TargetRelativeDirectPointer [+0x0C] = var accessFunctionPointer: TargetRelativeDirectPointer [+0x10] = var fieldDescriptor: TargetRelativeDirectPointer [+0x14] = var superClassType: TargetRelativeDirectPointer [+0x18] = Int32 Union var ResilientMetadataBounds: RelativeDirectPointer var metadataNegativeSizeInWords: UInt32 [+0x1C] = Int32 Union var extraClassFlags: ExtraClassDescriptorFlags var metadataPositiveSizeInWords: UInt32 [+0x20] = var numImmediateMembers: UInt32 [+0x24] = var numFields: UInt32 [+0x28] = var fieldOffsetVectorOffset: UInt32 [+0x2C] = var Offset: UInt32 [+0x30] = var size: UInt32 [+0x34] = var firstVtableData: VTableBuffer è¯¦è§£ Swiftä¸­ç±»çš„ç»§æ‰¿å…³ç³» Swiftä¸­ç±»çš„ç»§æ‰¿å…³ç³» è¯¦è§£ TargetClassMetadataType == ClassMetadata = TargetClassMetadata> TargetClassMetadataObjCInterop = TargetClassMetadata> -> TargetAnyClassMetadataType ObjCInterop=true == å…¼å®¹ObjCç±» == æ”¯æŒObjective-Cç±»äº’æ“ä½œ TargetAnyClassMetadataObjCInterop ObjCInterop=false == ä¸å…¼å®¹ObjCç±» TargetAnyClassMetadata TargetAnyClassMetadataObjCInterop TargetAnyClassMetadata TargetClassMetadata TargetAnyClassMetadataVariant -> TargetAnyClassMetadata TargetHeapMetadata == HeapMetadata TargetMetadata æ¦‚è¿° ClassMetadata TargetClassMetadata TargetAnyClassMetadataObjCInterop TargetAnyClassMetadata TargetHeapMetadata TargetMetadata Swiftä¸­çš„ï¼šClassMetadata å­—æ®µå®šä¹‰ Swiftä¸­çš„ï¼šClassMetadata å­—æ®µå®šä¹‰ TargetMetadata var kind: Int åœ¨ocä¸­æ”¾çš„å°±æ˜¯isaï¼Œåœ¨swiftä¸­kindå¤§äº0x7FFè¡¨ç¤ºçš„å°±æ˜¯ç±» TargetHeapMetadata æ²¡å±æ€§=å­—æ®µ TargetAnyClassMetadata var superClass: UnsafeMutablePointer çˆ¶ç±»çš„Metadataï¼Œå¦‚æœæ˜¯nullè¯´æ˜æ˜¯æœ€é¡¶çº§çš„rootç±»äº† TargetAnyClassMetadataObjCInterop Int cacheData[2] ç¼“å­˜æ•°æ®ç”¨äºæŸäº›åŠ¨æ€æŸ¥æ‰¾ï¼Œå®ƒç”±è¿è¡Œæ—¶æ‹¥æœ‰ï¼Œé€šå¸¸éœ€è¦ä¸Objective-Cçš„ä½¿ç”¨è¿›è¡Œäº’æ“ä½œã€‚ï¼ˆè¯´åˆ°åº•å°±æ˜¯OCçš„ä¸œè¥¿ï¼‰ var data: Int é™¤äº†ç¼–è¯‘å™¨è®¾ç½®ä½ä½ä»¥è¡¨æ˜è¿™æ˜¯Swiftå…ƒç±»å‹ï¼ˆå› æ­¤å­˜åœ¨å¯¹åº”çš„ç±»å‹å…ƒæ•°æ®çš„å¤´ä¿¡æ¯ï¼‰å¤–ï¼Œè¿™ä¸ªdataé‡Œå­˜çš„æŒ‡é’ˆï¼Œç”¨äºè¡Œå¤–å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸é€æ˜çš„ï¼ˆåº”è¯¥ä¹Ÿæ˜¯OCçš„ï¼‰ TargetClassMetadata var classFlags: Int32 Swift-specific class flags var instanceAddressPoint: UInt32 The address point of instances of this type var instanceSize: UInt32 The required size of instances of this type.(å®ä¾‹å¯¹è±¡åœ¨å †å†…å­˜çš„å¤§å°) var instanceAlignmentMask: UInt16 The alignment mask of the address point of instances of this type. (æ ¹æ®è¿™ä¸ªmaskæ¥è·å–å†…å­˜ä¸­çš„å¯¹é½å¤§å°) var reserved: UInt16 Reserved for runtime use.ï¼ˆé¢„ç•™ç»™è¿è¡Œæ—¶ä½¿ç”¨ï¼‰ var classSize: UInt32 The total size of the class object, including prefix and suffix extents. var classAddressPoint: UInt32 The offset of the address point within the class object. var typeDescriptor: UnsafeMutablePointer ä¸€ä¸ªå¯¹ç±»å‹çš„è¶…è¡Œçš„swiftç‰¹å®šæè¿°ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªäººå·¥å­ç±»ï¼Œåˆ™ä¸ºnullã€‚ç›®å‰ä¸æä¾›åŠ¨æ€åˆ›å»ºéäººå·¥å­ç±»çš„æœºåˆ¶ã€‚ var iVarDestroyer: UnsafeMutablePointer é”€æ¯å®ä¾‹å˜é‡çš„å‡½æ•°ï¼Œç”¨äºåœ¨æ„é€ å‡½æ•°æ—©æœŸè¿”å›åè¿›è¡Œæ¸…ç†ã€‚å¦‚æœä¸ºnullï¼Œåˆ™ä¸ä¼šæ‰§è¡Œæ¸…ç†æ“ä½œï¼Œå¹¶ä¸”æ‰€æœ‰çš„ivarséƒ½å¿…é¡»æ˜¯ç®€å•çš„ã€‚ struct TargetClassDescriptor struct TargetClassDescriptor var flags: UInt32 å­˜å‚¨åœ¨ä»»ä½•ä¸Šä¸‹æ–‡æè¿°ç¬¦çš„ç¬¬ä¸€ä¸ªå…¬å…±æ ‡è®° var parent: TargetRelativeDirectPointer å¤ç”¨çš„RelativeDirectPointerè¿™ä¸ªç±»å‹ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œä½†çœ‹ä¸‹æ¥åŸç†ä¸€æ ·; çˆ¶çº§ä¸Šä¸‹æ–‡ï¼Œå¦‚æœæ˜¯é¡¶çº§ä¸Šä¸‹æ–‡åˆ™ä¸ºnull var name: TargetRelativeDirectPointer è·å–ç±»çš„åç§° var accessFunctionPointer: TargetRelativeDirectPointer è¿™é‡Œçš„å‡½æ•°ç±»å‹æ˜¯ä¸€ä¸ªæ›¿èº«ï¼Œéœ€è¦è°ƒç”¨getAccessFunction()æ‹¿åˆ°çœŸæ­£çš„å‡½æ•°æŒ‡é’ˆï¼ˆè¿™é‡Œæ²¡æœ‰å°è£…ï¼‰ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªMetadataAccessFunctionå…ƒæ•°æ®è®¿é—®å‡½æ•°çš„æŒ‡é’ˆçš„åŒ…è£…å™¨ç±»ï¼Œè¯¥å‡½æ•°æä¾›operator()é‡è½½ä»¥ä½¿ç”¨æ­£ç¡®çš„è°ƒç”¨çº¦å®šæ¥è°ƒç”¨å®ƒï¼ˆå¯å˜é•¿å‚æ•°ï¼‰ï¼Œæ„å¤–å‘ç°å‘½åé‡æ•´ä¼šè°ƒç”¨è¿™è¾¹çš„æ–¹æ³•ï¼ˆç›®å‰ä¸å¤ªäº†è§£è¿™å—å†…å®¹ï¼‰ã€‚ var fieldDescriptor: TargetRelativeDirectPointer ä¸€ä¸ªæŒ‡å‘ç±»å‹çš„å­—æ®µæè¿°ç¬¦çš„æŒ‡é’ˆ(å¦‚æœæœ‰çš„è¯)ã€‚ç±»å‹å­—æ®µçš„æè¿°ï¼Œå¯ä»¥ä»é‡Œé¢è·å–ç»“æ„ä½“çš„å±æ€§ã€‚ var superClassType: TargetRelativeDirectPointer The type of the superclass, expressed as a mangled type name that can refer to the generic arguments of the subclass type. Int32 Union (ä¸‹é¢ä¸¤ä¸ªå±æ€§åœ¨æºç ä¸­æ˜¯unionç±»å‹ï¼Œæ‰€ä»¥å–sizeå¤§çš„ç±»å‹ä½œä¸ºå±æ€§ï¼ˆè¿™é‡Œè²Œä¼¼ä¸€æ ·ï¼‰ï¼Œå…·ä½“è¿˜å¾—åˆ¤æ–­æ˜¯å¦have a resilient superclass) var ResilientMetadataBounds: RelativeDirectPointer æœ‰resilient superclassï¼Œç”¨ResilientMetadataBoundsï¼Œè¡¨ç¤ºå¯¹ä¿å­˜å…ƒæ•°æ®æ‰©å±•çš„ç¼“å­˜çš„å¼•ç”¨ var metadataNegativeSizeInWords: UInt32 æ²¡æœ‰resilient superclassä½¿ç”¨MetadataNegativeSizeInWordsï¼Œè¡¨ç¤ºè¯¥ç±»å…ƒæ•°æ®å¯¹è±¡çš„è´Ÿå¤§å°(ç”¨å­—èŠ‚è¡¨ç¤º) Int32 Union var extraClassFlags: ExtraClassDescriptorFlags æœ‰resilient superclassï¼Œç”¨ExtraClassFlagsï¼Œè¡¨ç¤ºä¸€ä¸ªObjective-Cå¼¹æ€§ç±»å­˜æ ¹çš„å­˜åœ¨ var metadataPositiveSizeInWords: UInt32 æ²¡æœ‰resilient superclassä½¿ç”¨MetadataPositiveSizeInWordsï¼Œè¡¨ç¤ºè¯¥ç±»å…ƒæ•°æ®å¯¹è±¡çš„æ­£å¤§å°(ç”¨å­—èŠ‚è¡¨ç¤º) var numImmediateMembers: UInt32 æ­¤ç±»æ·»åŠ åˆ°ç±»å…ƒæ•°æ®çš„å…¶ä»–æˆå‘˜çš„æ•°ç›®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ•°æ®å¯¹è¿è¡Œæ—¶æ˜¯ä¸é€æ˜çš„ï¼Œè€Œä¸æ˜¯åœ¨å…¶ä»–æˆå‘˜ä¸­å…¬å¼€;å®ƒå®é™…ä¸Šåªæ˜¯NumImmediateMembers sizeof(void)å­—èŠ‚çš„æ•°æ®ã€‚ è¿™äº›å­—èŠ‚æ˜¯æ·»åŠ åœ¨åœ°å€ç‚¹ä¹‹å‰è¿˜æ˜¯ä¹‹åï¼Œå–å†³äºareImmediateMembersNegative()æ–¹æ³•ã€‚ var numFields: UInt32 å±æ€§ä¸ªæ•°ï¼Œä¸åŒ…å«çˆ¶ç±»çš„ var fieldOffsetVectorOffset: UInt32 å­˜å‚¨è¿™ä¸ªç»“æ„çš„å­—æ®µåç§»å‘é‡çš„åç§»é‡ï¼ˆè®°å½•ä½ å±æ€§èµ·å§‹ä½ç½®çš„å¼€å§‹çš„ä¸€ä¸ªç›¸å¯¹äºmetadataçš„åç§»é‡ï¼Œå…·ä½“çœ‹metadataçš„getFieldOffsetsæ–¹æ³•ï¼‰ï¼Œå¦‚æœä¸º0ï¼Œè¯´æ˜ä½ æ²¡æœ‰å±æ€§ å¦‚æœè¿™ä¸ªç±»å«æœ‰ä¸€ä¸ªå¼¹æ€§çš„çˆ¶ç±»ï¼Œé‚£ä¹ˆä»ä»–çš„å¼¹æ€§çˆ¶ç±»çš„metaDataå¼€å§‹åç§» var Offset: UInt32 var size: UInt32 //VTableæ•°é‡ var firstVtableData: VTableBuffer //VTable crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:56:05 "},"swift_common/typemetadata/classmetadata/memory_layout/src.html":{"url":"swift_common/typemetadata/classmetadata/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:30:15 "},"swift_common/typemetadata/classmetadata/memory_layout/ida_def.html":{"url":"swift_common/typemetadata/classmetadata/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ struct ClassMetadata { __int64 kind; void *superClass; __int64 cacheData[2]; void *data; __int32 classFlags; __int32 instanceAddressPoint; __int32 instanceSize; __int16 instanceAlignmentMask; __int16 reserved; __int32 classSize; __int32 classAddressPoint; void *typeDescriptor; void *iVarDestroyer; }; crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:22:49 "},"swift_common/typemetadata/classmetadata/memory_layout/example.html":{"url":"swift_common/typemetadata/classmetadata/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ __DataStorage å…·ä½“è¯¦è§ï¼š ClassMetadata å†…å­˜å¸ƒå±€ å›¾ å¯¹åº”è°ƒè¯•ç»†èŠ‚ï¼š ClassMetadata (lldb) x/10xg 0x0000000207cb7d90 0x207cb7d90: 0x0000000207cb7d58 0x0000000207c47ed8 0x207cb7da0: 0x00000001c29c8490 0x0000805000000000 0x207cb7db0: 0x0000000281e95702 0x0000000000000002 0x207cb7dc0: 0x0000000700000041 0x00000010000000d0 0x207cb7dd0: 0x00000001b2009838 0x0000000000000000 (lldb) po 0x0000000207cb7d58 Foundation.__DataStorage (lldb) po 0x0000000207c47ed8 _TtCs12_SwiftObject (lldb) x/2xh 0x207cb7db8 0x207cb7db8: 0x0002 0x0000 (lldb) x/2xh 0x207cb7dc0 0x207cb7dc0: 0x0041 0x0000 (lldb) x/2xw 0x207cb7db8 0x207cb7db8: 0x00000002 0x00000000 (lldb) x/2xw 0x207cb7dc0 0x207cb7dc0: 0x00000041 0x00000007 (lldb) x/2xh 0x207cb7dc4 0x207cb7dc4: 0x0007 0x0000 (lldb) x/2xw 0x207cb7dc8 0x207cb7dc8: 0x000000d0 0x00000010 -> __DataStorageçš„Classçš„TypeMetadata [+0x00] = var kind: Int 0x0000000207cb7d58 Foundation.__DataStorage [+0x08] = var superClass: UnsafeMutablePointer 0x0000000207c47ed8 _TtCs12_SwiftObject [+0x10] = Int cacheData[2] 0x00000001c29c8490 0x0000805000000000 [+0x20] = var data: Int 0x0000000281e95702 [+0x28] = var classFlags: Int32 0x00000002 [+0x2C] = var instanceAddressPoint: UInt32 0x00000000 [+0x30] = var instanceSize: UInt32 0x00000041 [+0x34] = var instanceAlignmentMask: UInt16 0x0007 [+0x36] = var reserved: UInt16 0x0000 [+0x38] = var classSize: UInt32 0x000000d0 [+0x3C] = var classAddressPoint: UInt32 0x00000010 [+0x40] = var typeDescriptor: UnsafeMutablePointer 0x00000001b2009838 [+0x48] = var iVarDestroyer: UnsafeMutablePointer 0x0000000000000000 ä»¥åŠï¼š struct TargetClassDescriptor (lldb) x/8xg 0x00000001b2009838 0x1b2009838: 0xffffbc3480000050 0xfff49e10ffffffe8 0x1b2009848: 0x0000000000010464 0x0000001800000002 0x1b2009858: 0x000000060000000e 0x000000100000000a 0x1b2009868: 0x0000000100000008 0x00000001fff33690 (lldb) x/16xw 0x00000001b2009838 0x1b2009838: 0x80000050 0xffffbc34 0xffffffe8 0xfff49e10 0x1b2009848: 0x00010464 0x00000000 0x00000002 0x00000018 0x1b2009858: 0x0000000e 0x00000006 0x0000000a 0x00000010 0x1b2009868: 0x00000008 0x00000001 0xfff33690 0x00000001 -> Foundation.__DataStorage TypeDescriptor == struct TargetClassDescriptor [+0x00] = var flags: UInt32 0x80000050 [+0x04] = var parent: TargetRelativeDirectPointer 0xffffbc34 [+0x08] = var name: TargetRelativeDirectPointer 0xffffffe8 [+0x0C] = var accessFunctionPointer: TargetRelativeDirectPointer 0xfff49e10 [+0x10] = var fieldDescriptor: TargetRelativeDirectPointer 0x00010464 [+0x14] = var superClassType: TargetRelativeDirectPointer 0x00000000 [+0x18] = Int32 Union var ResilientMetadataBounds: RelativeDirectPointer var metadataNegativeSizeInWords: UInt32 ä¼°è®¡æ˜¯ï¼š0x00000002 [+0x1C] = Int32 Union var extraClassFlags: ExtraClassDescriptorFlags var metadataPositiveSizeInWords: UInt32 æš‚ä¸ç¡®å®šæ˜¯å“ªä¸ª æ­¤å¤„å€¼ï¼š0x00000018 [+0x20] = var numImmediateMembers: UInt32 0x0000000e [+0x24] = var numFields: UInt32 0x00000006 [+0x28] = var fieldOffsetVectorOffset: UInt32 0x0000000a [+0x2C] = var Offset: UInt32 0x00000010 [+0x30] = var size: UInt32 0x00000008 [+0x34] = var firstVtableData: VTableBuffer 0x00000001 crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:01:32 "},"swift_common/metadatakind.html":{"url":"swift_common/metadatakind.html","title":"MetadataKind","keywords":"","body":"MetadataKind = Metadataçš„type Swiftä¸­Metadataçš„Typeçš„å®šä¹‰ æ ¸å¿ƒä»£ç  const unsigned MetadataKindIsNonType = 0x400; const unsigned MetadataKindIsNonHeap = 0x200; const unsigned MetadataKindIsRuntimePrivate = 0x100; LastEnumerated = 0x7FF, NOMINALTYPEMETADATAKIND(Class, 0) NOMINALTYPEMETADATAKIND(Struct, 0 | MetadataKindIsNonHeap) NOMINALTYPEMETADATAKIND(Enum, 1 | MetadataKindIsNonHeap) NOMINALTYPEMETADATAKIND(Optional, 2 | MetadataKindIsNonHeap) METADATAKIND(ForeignClass, 3 | MetadataKindIsNonHeap) METADATAKIND(Opaque, 0 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(Tuple, 1 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(Function, 2 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(Existential, 3 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(Metatype, 4 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(ObjCClassWrapper, 5 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(ExistentialMetatype, 6 | MetadataKindIsRuntimePrivate | MetadataKindIsNonHeap) METADATAKIND(HeapLocalVariable, 0 | MetadataKindIsNonType) METADATAKIND(HeapGenericLocalVariable, 0 | MetadataKindIsNonType | MetadataKindIsRuntimePrivate) METADATAKIND(ErrorObject, 1 | MetadataKindIsNonType | MetadataKindIsRuntimePrivate) è¡¨æ ¼ åç§° æšä¸¾å€¼ è¯´æ˜ Class 0x0 ç±» Struct 0x200 ç»“æ„ä½“ Enum 0x201 æšä¸¾ Optional 0x202 å¯é€‰ç±»å‹ ForeignClass 0x203 å¤–éƒ¨ç±»ï¼Œæ¯”å¦‚CoreFoundationä¸­çš„ç±» Opaque 0x300 åœ¨å…ƒæ•°æ®ç³»ç»Ÿä¸­ä¸å…¬å¼€å…¶å€¼çš„ç±»å‹ Tuple 0x301 å…ƒç¥–ç±»å‹ Function 0x302 A monomorphic function Existential 0x303 An existential type Metatype 0x304 A metatype ObjCClassWrapper 0x305 An ObjC class wrapper ExistentialMetatype 0x306 An existential metatype HeapLocalVariable 0x400 ä½¿ç”¨é™æ€ç”Ÿæˆçš„å…ƒæ•°æ®çš„å †åˆ†é…çš„å±€éƒ¨å˜é‡ HeapGenericLocalVariable 0x500 ä½¿ç”¨è¿è¡Œæ—¶å®ä¾‹åŒ–çš„å…ƒæ•°æ®çš„å †åˆ†é…çš„å±€éƒ¨å˜é‡ ErrorObject 0x501 swiftåŸç”Ÿçš„é”™è¯¯ç±»å‹ LastEnumerated 0x7FF æœ€å¤§çš„éisaæŒ‡é’ˆå…ƒæ•°æ®ç±»å‹å€¼ ğŸ”½ ä¸‹é¢æ˜¯é€šç”¨å…¨å±€å®šä¹‰ MetadataKindIsNonType 0x400 MetadataKindIsNonHeap 0x200 MetadataKindIsNonHeap 0x200 LastEnumerated 0x7FF crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:12:10 "},"swift_common/valuebuffer.html":{"url":"swift_common/valuebuffer.html","title":"ValueBuffer","keywords":"","body":"ValueBuffer crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:30:05 "},"common_type/":{"url":"common_type/","title":"å¸¸ç”¨ç±»å‹","keywords":"","body":"å¸¸ç”¨ç±»å‹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:52 "},"common_type/array/":{"url":"common_type/array/","title":"Arrayæ•°ç»„","keywords":"","body":"Arrayæ•°ç»„ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:33:13 "},"common_type/array/memory_layout/":{"url":"common_type/array/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:26:12 "},"common_type/array/memory_layout/figure.html":{"url":"common_type/array/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„Arrayçš„å†…å­˜å¸ƒå±€å›¾ Swiftçš„Arrayçš„å†…å­˜å¸ƒå±€å›¾ = Swift Array Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„Arrayå†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå†…å®¹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:28:03 "},"common_type/array/memory_layout/text.html":{"url":"common_type/array/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"æ–‡å­— Arrayçš„å†…å­˜å¸ƒå±€=å­—æ®µ=å±æ€§ [+0x00] = HeapMetadata* metadata [+0x08] = int64 refCount [+0x10] = int64 count [+0x08] = int64 _capacityAndFlags [+0x20] = AnyObject* firstElementAddress crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:24:24 "},"common_type/array/memory_layout/src.html":{"url":"common_type/array/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:12 "},"common_type/array/memory_layout/ida_def.html":{"url":"common_type/array/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:49 "},"common_type/array/memory_layout/example.html":{"url":"common_type/array/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ Stringçš„Array (lldb) x/10gx 0x0000000280c2e2c0 0x280c2e2c0: 0x00000001efe3c008 0x0000000000000003 0x280c2e2d0: 0x0000000000000002 0x0000000000000004 0x280c2e2e0: 0x0000656e6f687069 0xe600000000000000 0x280c2e2f0: 0x0000000069626d73 0xe400000000000000 0x280c2e300: 0x00000001efdf52d0 0x7fffffff7fffffff (lldb) po 0x00000001efe3c008 _TtGCs23_ContiguousArrayStorageSS_$ (lldb) p/c 0x0000656e6f687069 (long) iphone\\0\\0 (lldb) p/c 0x0000000069626d73 (int) smbi -> Arrayçš„å†…å­˜å¸ƒå±€=å­—æ®µ HeapMetadata* metadata 0x00000001efe3c008 _TtGCs23_ContiguousArrayStorageSS_$ Stringçš„Array int64 refCount 0x0000000000000003 int64 count 0x0000000000000002 int64 _capacityAndFlags 0x0000000000000004 ç¬¬ä¸€ä¸ª = [0x280c2e2e0] 0x0000656e6f687069 0xe600000000000000 \"iphone\" ç¬¬äºŒä¸ª = [0x280c2e2f0] 0x0000000069626d73 0xe400000000000000 \"smbi\" crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 10:25:29 "},"common_type/bool/":{"url":"common_type/bool/","title":"Boolå¸ƒå°”","keywords":"","body":"Boolå¸ƒå°” crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:29:42 "},"common_type/struct/":{"url":"common_type/struct/","title":"Dataæ•°æ®","keywords":"","body":"Structç»“æ„ä½“ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:38 "},"common_type/data/memory_layout/":{"url":"common_type/data/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"Dataæ•°æ®çš„å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:42:22 "},"common_type/data/memory_layout/figure.html":{"url":"common_type/data/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„Dataæ•°æ®çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ Swiftçš„Dataæ•°æ®çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ = Swift Data Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„Dataå†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå†…å®¹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:41:58 "},"common_type/data/memory_layout/text.html":{"url":"common_type/data/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"æ–‡å­— æ¦‚è¿° Swiftçš„Dataï¼ˆå¯¹äº64ä½ï¼Œæš‚å¿½ç•¥32ä½ï¼‰ çš„å†…å­˜å¸ƒå±€ æ ¹æ®æ•°æ®å­—èŠ‚ä¸ªæ•°å¤šå°‘åˆ†ç±» count=0 empty = ç©ºæ•°æ® 0 == 0 inline == struct InlineData var bytes: Buffer @usableFromInline typealias Buffer = (UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8) //len //enum var length: UInt8 14 slice == struct InlineSlice var slice: Range var storage: __DataStorage 2^32 large == struct LargeSlice var slice: RangeReference var range: Range var storage: __DataStorage __DataStorage class __DataStorage { var isa: objc_class* // NULL for pure Swift class var refCount: UInt64 var _bytes: UnsafeMutableRawPointer? var _length: UInt64 var _capacity: UInt64 var _offset: UInt64 var _deallocator: ((UnsafeMutableRawPointer, Int64) -> Void)? var _needToZero: Bool } == class __DataStorage [+0x00] = objc_class* isa [+0x08] = int64 refCount [+0x10] = void* _bytes [+0x18] = int64 _length [+0x20] = int64 _capacity [+0x28] = int64 _offset [+0x30] = function_pointer* _deallocator å‡½æ•°å®šä¹‰ï¼š((UnsafeMutableRawPointer, Int64) -> Void)? [+0x38] = Bool _needToZero è¯¦è§£ Swiftçš„Data åˆ†4ç±» ç©ºæ•°æ®ï¼šempty inline == struct InlineData å­—æ®µ var bytes: Buffer var length: UInt8 è¯´æ˜ bytesçš„Bufferçš„å­—èŠ‚=ä¸ªæ•° 64ä½æ¶æ„ï¼šä¸è¶…è¿‡14ï¼Œå³ @usableFromInline typealias Buffer = (UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8, UInt8) //len //enum 32ä½æ¶æ„ï¼šä¸è¶…è¿‡6ï¼Œå³ @usableFromInline typealias Buffer = (UInt8, UInt8, UInt8, UInt8, UInt8, UInt8) //len //enum slice == struct InlineSlice å­—æ®µ var slice: Range var storage: __DataStorage è¯´æ˜ InlineDataçš„ï¼ˆ64bitçš„ï¼‰14ä¸ª large == struct LargeSlice å­—æ®µ var slice: RangeReference var range: Range var storage: __DataStorage è¯´æ˜ a single wordä¸ªæ•°=2^64ï¼Ÿ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:42:27 "},"common_type/data/memory_layout/src.html":{"url":"common_type/data/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:35:57 "},"common_type/data/memory_layout/ida_def.html":{"url":"common_type/data/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ struct Swift_DataStorage struct Swift_DataStorage { void *isa; __int64 refCount; void *_bytes; __int64 _length; __int64 _capacity; __int64 _offset; void *_deallocator; bool _needToZero; }; struct SwiftData_InlineSlice struct SwiftData_InlineSlice { __int32 slice; Swift_DataStorage *storage; }; crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:45:35 "},"common_type/data/memory_layout/example.html":{"url":"common_type/data/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ __DataStorage è¯¦è§ï¼š Dataæ•°æ® å†…å­˜å¸ƒå±€ å›¾ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:43:31 "},"common_type/dict/":{"url":"common_type/dict/","title":"Dictionaryå­—å…¸","keywords":"","body":"Dictionaryå­—å…¸ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:35:12 "},"common_type/dict/memory_layout/":{"url":"common_type/dict/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:24 "},"common_type/dict/memory_layout/figure.html":{"url":"common_type/dict/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ç»“æ„å›¾ Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ç»“æ„å›¾ åœ¨çº¿æµè§ˆ Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ æœ¬åœ°æŸ¥çœ‹ å®Œæ•´å›¾ æ ¸å¿ƒå†…å®¹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:27:46 "},"common_type/dict/memory_layout/text.html":{"url":"common_type/dict/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ æ–‡å­— Swiftçš„Dictionaryå†…å­˜å¸ƒå±€ = å­—æ®µ = å±æ€§ [+0x00] = Metadata* type [+0x08] = Int refCount __RawDictionaryStorage [+0x10] = var _count: Int [+0x18] = var _capacity: Int [+0x20] = Int [+0x20~0x20] = var _scale: Int8 [+0x21~0x21] = var _reservedScale: Int8 [+0x22~0x23] = var _extra: Int16 [+0x24~0x27] = var _age: Int32 [+0x28] = var _seed: Int [+0x30] = var _rawKeys: UnsafeMutableRawPointer æŒ‡å‘Key=é”®çš„æ•°ç»„åˆ—è¡¨ [+0x38] = var _rawValues: UnsafeMutableRawPointer æŒ‡å‘Value=å€¼çš„æ•°ç»„åˆ—è¡¨ [+0x38] = int _metadata æŒ‡å®šäº†å“ªå‡ ä¸ªindexå…ƒç´ æ˜¯æœ‰æ•ˆæ•°æ® crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:28:14 "},"common_type/dict/memory_layout/src.html":{"url":"common_type/dict/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:32:46 "},"common_type/dict/memory_layout/ida_def.html":{"url":"common_type/dict/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:32:16 "},"common_type/dict/memory_layout/example.html":{"url":"common_type/dict/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ ä¸¾ä¾‹1ï¼šç®€å•dict Swiftçš„Dictå€¼ï¼š { 2282 = 0; 4902 = 1; 5074 = 1; } å¯¹åº”çš„ä¾‹å­ï¼Œå·²ç»æ”¾åˆ°äº†å†…å­˜å¸ƒå±€å›¾ä¸­äº†ï¼Œè¯¦è§ï¼š Dictionaryå­—å…¸çš„å†…å­˜å¸ƒå±€å›¾ æ­¤å¤„åªé¢å¤–è´´å‡ºï¼š ç›¸å…³è°ƒè¯•å†…å®¹ (lldb) po 0x000000028173c680 { 2282 = 0; 4902 = 1; 5074 = 1; } -> (lldb) x/8xg 0x000000028173c680 0x28173c680: 0x0000000121881e78 0x0000000000000003 0x28173c690: 0x0000000000000003 0x0000000000000003 0x28173c6a0: 0x1fd62ad000000002 0x000000028173c680 0x28173c6b0: 0x000000028173c6c8 0x000000028173c708 (lldb) x/20xg 0x000000028173c680 0x28173c680: 0x0000000121881e78 0x0000000000000003 0x28173c690: 0x0000000000000003 0x0000000000000003 0x28173c6a0: 0x1fd62ad000000002 0x000000028173c680 0x28173c6b0: 0x000000028173c6c8 0x000000028173c708 0x28173c6c0: 0xfffffffffffffffd 0x0000000032303934 0x28173c6d0: 0xe400000000000000 0x00000002006b11e0 0x28173c6e0: 0x00000002006c4de0 0x0000000032383232 0x28173c6f0: 0xe400000000000000 0x0000000034373035 0x28173c700: 0xe400000000000000 0x0000000000000031 0x28173c710: 0xe100000000000000 0x000000010b615b20 å¯ä»¥ç»§ç»­äº†ï¼š 0xd = 0b 1101 æœ‰æ•ˆindex 0 2 3 -> (lldb) x/40xg 0x000000028173c680 0x28173c680: 0x0000000121881e78 0x0000000000000003 0x28173c690: 0x0000000000000003 0x0000000000000003 0x28173c6a0: 0x1fd62ad000000002 0x000000028173c680 0x28173c6b0: 0x000000028173c6c8 0x000000028173c708 0x28173c6c0: 0xfffffffffffffffd 0x0000000032303934 0x28173c6d0: 0xe400000000000000 0x00000002006b11e0 0x28173c6e0: 0x00000002006c4de0 0x0000000032383232 0x28173c6f0: 0xe400000000000000 0x0000000034373035 0x28173c700: 0xe400000000000000 0x0000000000000031 0x28173c710: 0xe100000000000000 0x000000010b615b20 0x28173c720: 0x000000028220fae0 0x0000000000000030 0x28173c730: 0xe100000000000000 0x0000000000000031 0x28173c740: 0xe100000000000000 0x0000000280231180 0x28173c750: 0x0000000000000000 0x0000000000000000 0x28173c760: 0x0000000000000000 0x0000000000000000 0x28173c770: 0x0000000000000000 0x0000000000000000 0x28173c780: 0x0000000000000000 0x0000000000000000 0x28173c790: 0x0000000000000000 0x0000000000000000 0x28173c7a0: 0x0000000000000000 0x0000000000000000 0x28173c7b0: 0x0000000000000000 0x0000000000000000 (lldb) (lldb) x/30xg 0x000000028173c680 0x28173c680: 0x0000000121881e78 0x0000000000000003 0x28173c690: 0x0000000000000003 0x0000000000000003 0x28173c6a0: 0x1fd62ad000000002 0x000000028173c680 0x28173c6b0: 0x000000028173c6c8 0x000000028173c708 0x28173c6c0: 0xfffffffffffffffd 0x0000000032303934 0x28173c6d0: 0xe400000000000000 0x00000002006b11e0 0x28173c6e0: 0x00000002006c4de0 0x0000000032383232 0x28173c6f0: 0xe400000000000000 0x0000000034373035 0x28173c700: 0xe400000000000000 0x0000000000000031 0x28173c710: 0xe100000000000000 0x000000010b615b20 0x28173c720: 0x000000028220fae0 0x0000000000000030 0x28173c730: 0xe100000000000000 0x0000000000000031 0x28173c740: 0xe100000000000000 0x0000000280231180 0x28173c750: 0x0000000000000000 0x0000000000000000 0x28173c760: 0x0000000000000000 0x0000000000000000 -> (lldb) po 0x0000000121881e78 _TtGCs18_DictionaryStorageSSSS_$ (lldb) p/c 0x0000000032303934 (int) 4902 (lldb) p/c 0x0000000032383232 (int) 2282 (lldb) p/c 0x0000000034373035 (int) 5074 (lldb) p/c 0x0000000000000031 (int) 1\\0\\0\\0 (lldb) p/c 0x0000000000000030 (int) 0\\0\\0\\0 (lldb) x/2xw 0x28173c6a0 0x28173c6a0: 0x00000002 0x1fd62ad0 (lldb) x/4xh 0x28173c6a0 0x28173c6a0: 0x0002 0x0000 0x2ad0 0x1fd6 (lldb) x/8xb 0x28173c6a0 0x28173c6a0: 0x02 0x00 0x00 0x00 0xd0 0x2a 0xd6 0x1f (lldb) p/d 0x1fd62ad0 (int) 534129360 ä¸¾ä¾‹2ï¼šå¤æ‚dict - keyæ˜¯Stringï¼Œvalueæ˜¯AnyPrimitive è°ƒè¯•åˆ°å¤æ‚dictï¼š (lldb) reg r x0 x1 x2 x8 x0 = 0x000000011100b200 x1 = 0x00000001031145b0 WhatsApp`$s10LeafFilterVN x2 = 0x0000000103114658 WhatsApp`LeafFilter_related_1030B4658 x8 = 0x00000001006409a8 WhatsApp`sub_1005E09A8 (lldb) po 0x000000011100b200 4580225536 (lldb) x/6xg 0x000000011100b200 0x11100b200: 0x000000010fe175c8 0x0000000000000003 0x11100b210: 0x0000000000000007 0x000000000000000c 0x11100b220: 0xf3473a6200000004 0x000000011100b200 (lldb) po 0x000000010fe175c8 _TtGCs18_DictionaryStorageSSOVO14MainAppLibrary9OfflineAB8UserInfoP10$102e672c012AnyPrimitive_$ -> æ­¤å¤„æ˜¯ä¸ªDictionaryï¼Œvalueå…ƒç´ æ˜¯ AnyPrimitive MainAppLibrary.OfflineAB.UserInfo çš„ AnyPrimitive æŸ¥çœ‹å†…å­˜å€¼ï¼š (lldb) x/80xg 0x000000011100b200 0x11100b200: 0x000000010fe175c8 0x0000000000000003 0x11100b210: 0x0000000000000007 0x000000000000000c 0x11100b220: 0xf3473a6200000004 0x000000011100b200 0x11100b230: 0x000000011100b248 0x000000011100b348 0x11100b240: 0xffffffffffff9299 0x6d726f6674616c70 0x11100b250: 0xe800000000000000 0x00000001e84fab78 0x11100b260: 0x00000001e84fab78 0x00000001e84fab78 0x11100b270: 0x00000001e84fab78 0x695f656369766564 0x11100b280: 0xe900000000000064 0x69737265765f736f 0x11100b290: 0xea00000000006e6f 0x00000001e84fab78 0x11100b2a0: 0x00000001e84fab78 0x00000001e84fab78 0x11100b2b0: 0x00000001e84fab78 0x6c6975625f707061 0x11100b2c0: 0xe900000000000064 0x00000001e84fab78 0x11100b2d0: 0x00000001e84fab78 0x6e5f656369766564 0x11100b2e0: 0xeb00000000656d61 0x00000001e84fab78 0x11100b2f0: 0x00000001e84fab78 0x00000001e84fab78 0x11100b300: 0x00000001e84fab78 0x5f657361656c6572 0x11100b310: 0xef6c656e6e616863 0x00000001e84fab78 0x11100b320: 0x00000001e84fab78 0x00000001e84fab78 0x11100b330: 0x00000001e84fab78 0x737265765f707061 0x11100b340: 0xeb000000006e6f69 0x0000656e6f687069 0x11100b350: 0xe600000000000000 0x000000010fe17468 0x11100b360: 0x000000010fe16950 0x000000010fe169f8 0x11100b370: 0x00000001e84fab01 0x00000001e84fab78 0x11100b380: 0x00000001e84fab78 0x00000001e84fab78 0x11100b390: 0x00000001e84fab78 0x00000001e84fab78 0x11100b3a0: 0x00000001e84fab78 0x00000001e84fab78 0x11100b3b0: 0x00000001e84fab78 0x00000001e84fab78 0x11100b3c0: 0x00000001e84fab78 0x00000001e84fab78 0x11100b3d0: 0x00000001e84fab78 0xc000000000000024 0x11100b3e0: 0x40000002820700c0 0x00000002820700c0 0x11100b3f0: 0x000000010fe16950 0x000000010fe169f8 0x11100b400: 0x00000001e84fab01 0x000000014164cccd 0x11100b410: 0xc00000000000000a 0x40000002835413a0 0x11100b420: 0x000000010fe17798 0x000000010fe17840 0x11100b430: 0x00000001e84fab00 0x00000001e84fab78 0x11100b440: 0x00000001e84fab78 0x00000001e84fab78 0x11100b450: 0x00000001e84fab78 0x00000001e84fab78 0x11100b460: 0x00000001e84fab78 0x00000001e84fab78 0x11100b470: 0x00000001e84fab78 0x00000001e84fab78 -> (lldb) p/c 0x6d726f6674616c70 (long) platform (lldb) p/c 0x695f656369766564 (long) device_i (lldb) p/c 0xe900000000000064 (unsigned long) d\\0\\0\\0\\0\\0\\0\\xe9 (lldb) p/c 0x69737265765f736f (long) os_versi (lldb) p/c 0xea00000000006e6f (unsigned long) on\\0\\0\\0\\0\\0\\xea (lldb) p/c 0x6c6975625f707061 (long) app_buil (lldb) p/c 0x64 (int) d\\0\\0\\0 (lldb) p/c 0x6e5f656369766564 (long) device_n (lldb) p/c 0x00000000656d61 (int) ame\\0 (lldb) p/c 0x5f657361656c6572 (long) release_ (lldb) p/c 0xef6c656e6e616863 (unsigned long) channel\\xef (lldb) p/c 0x737265765f707061 (long) app_vers (lldb) p/c 0xeb000000006e6f69 (unsigned long) ion\\0\\0\\0\\0\\xeb keys: platform device_id os_version app_build device_name release_channel app_version iphone å’Œï¼š (lldb) p/c 0x0000656e6f687069 (long) iphone\\0\\0 (lldb) x/s \"0x40000002820700c0 + 0x20\" 0x2820700e0: \"5E8-8164-1AEA05E45CD9\" (lldb) po 0x00000002820700c0 2DE85147-8D62-45E8-8164-1AEA05E45CD9 ... values: iphone 2DE85147-8D62-45E8-8164-1AEA05E45CD9 æ³¨ï¼šSwiftçš„Shared=Bridgedçš„String ... crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:27:14 "},"common_type/enum/":{"url":"common_type/enum/","title":"Enumæšä¸¾","keywords":"","body":"Enumæšä¸¾ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:29:07 "},"common_type/int/":{"url":"common_type/int/","title":"Intæ•´å‹","keywords":"","body":"Intæ•´å‹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:32:26 "},"common_type/set/":{"url":"common_type/set/","title":"Seté›†åˆ","keywords":"","body":"Seté›†åˆ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:30:32 "},"common_type/set/memory_layout/":{"url":"common_type/set/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:33:40 "},"common_type/set/memory_layout/figure.html":{"url":"common_type/set/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„Setçš„å†…å­˜å¸ƒå±€å›¾ Swiftçš„Setçš„å†…å­˜å¸ƒå±€å›¾ = Swift Set Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„Setçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå†…å®¹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:57:04 "},"common_type/set/memory_layout/text.html":{"url":"common_type/set/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"æ–‡å­— æ¦‚è¿° Swiftçš„Seté›†åˆçš„å†…å­˜å¸ƒå±€=å­—æ®µ=å±æ€§ [+0x00] = Metadata* type [+0x08] = int64 refCount [+0x10] = int64 _count [+0x18] = int64 _capacity [+0x20] = Int64 [+0x20~0x20] = int8 _scale [+0x21~0x21] = int8 _reservedScale [+0x22~0x23] = int16 _extra [+0x24~0x27] = int32 _age [+0x28] = int64 _seed [+0x30] = void* _rawElements [+0x38] = int64 _metadata è¯¦è§£ Swiftçš„Seté›†åˆçš„å†…å­˜å¸ƒå±€=å­—æ®µ=å±æ€§ [+0x00] = Metadata* type [+0x08] = Int refCount __RawSetStorageç±»å‹ [+0x10] = var _count: Int [+0x18] = var _capacity: Int [+0x20] = Int [+0x20~0x20] = var _scale: Int8 [+0x21~0x21] = var _reservedScale: Int8 [+0x22~0x23] = var _extra: Int16 [+0x24~0x27] = var _age: Int32 [+0x28] = var _seed: Int å¾€å¾€æ˜¯ == å½“å‰SetæŒ‡é’ˆ [+0x30] = var _rawElements: UnsafeMutableRawPointer æŒ‡å‘çœŸæ­£æ•°æ®çš„å¼€å§‹çš„åœ°å€ == realDataAddress [+0x38] = var _metadata: UnsafeMutableRawPointer == flagï¼šå“ªäº›ç»„æ•°æ®æ˜¯æœ‰æ•ˆæ•°æ® ï¼ˆæ ¹æ®countå»maskåçš„ï¼‰æœ€åä¸€äº›bitä½ä¸­çš„1ï¼Œå†³å®šäº†å¯¹åº”ä½ç½®ï¼ˆå¯¹åº”ç»„ï¼‰æ•°æ®æ˜¯æœ‰æ•ˆæ•°æ® å¯ä»¥å†™æˆ validElementIndexMask count 2 ... ä¸¾ä¾‹ 0xfffffffffffffff9 æ³¨ï¼šæ­¤å¤„count=2 maskåçš„å€¼ï¼šåªéœ€è¦æœ€å1ä¸ªbyte=8ä¸ªbitçš„å€¼ 0xfffffffffffffffe & 0xFF = 0x09 = 0b 0000 1001 = bit0ã€bit3ï¼ˆçš„ä½ç½®æ˜¯1ï¼‰ = index0ã€index3æ˜¯æœ‰æ•ˆæ•°æ® 0xfffffffffffffffe æ³¨ï¼šæ­¤å¤„count=1 ï¼ˆæ­¤æ—¶count å¯¹åº”å¦‚æœæœ‰maskçš„è¯ï¼Œå¯ä»¥ç†è§£ä¸ºï¼š validBitMask = 0x3 = 0b 11 maskåçš„å€¼ï¼šåªéœ€è¦æœ€å2ä½=2ä¸ªbit 0xfffffffffffffffe & 0x3 = 0x2 = 0b 10 = bit1ï¼ˆçš„ä½ç½®æ˜¯1ï¼‰ = index1 æ˜¯æœ‰æ•ˆæ•°æ® è¯´æ˜ï¼š æ­¤å¤„Intæ˜¯64bit==int64 Int8=8bit Int32=32bit crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:02:47 "},"common_type/set/memory_layout/src.html":{"url":"common_type/set/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  Set.swift swift/stdlib/public/core/Set.swift @frozen @_eagerMove public struct Set { @usableFromInline internal var _variant: _Variant /// Creates an empty set with preallocated space for at least the specified /// number of elements. /// /// Use this initializer to avoid intermediate reallocations of a set's /// storage buffer when you know how many elements you'll insert into the set /// after creation. /// /// - Parameter minimumCapacity: The minimum number of elements that the /// newly created set should be able to store without reallocating its /// storage buffer. public // FIXME(reserveCapacity): Should be inlinable init(minimumCapacity: Int) { _variant = _Variant(native: _NativeSet(capacity: minimumCapacity)) } /// Private initializer. @inlinable internal init(_native: __owned _NativeSet) { _variant = _Variant(native: _native) } #if _runtime(_ObjC) @inlinable internal init(_cocoa: __owned __CocoaSet) { _variant = _Variant(cocoa: _cocoa) } /// Private initializer used for bridging. /// /// Only use this initializer when both conditions are true: /// /// * it is statically known that the given `NSSet` is immutable; /// * `Element` is bridged verbatim to Objective-C (i.e., /// is a reference type). @inlinable public // SPI(Foundation) init(_immutableCocoaSet: __owned AnyObject) { _internalInvariant(_isBridgedVerbatimToObjectiveC(Element.self), \"Set can be backed by NSSet _variant only when the member type can be bridged verbatim to Objective-C\") self.init(_cocoa: __CocoaSet(_immutableCocoaSet)) } #endif } æ ¸å¿ƒå®šä¹‰æ˜¯ï¼š public struct Set { var _variant: _Variant BridgeStorage.swift swift/stdlib/public/core/BridgeStorage.swift import SwiftShims #if !$Embedded @frozen @usableFromInline internal struct _BridgeStorage { @usableFromInline internal typealias Native = NativeClass @usableFromInline internal typealias ObjC = AnyObject // rawValue is passed inout to _isUnique. Although its value // is unchanged, it must appear mutable to the optimizer. @usableFromInline internal var rawValue: Builtin.BridgeObject @inlinable @inline(__always) internal init(native: Native, isFlagged flag: Bool) { // Note: Some platforms provide more than one spare bit, but the minimum is // a single bit. _internalInvariant(_usesNativeSwiftReferenceCounting(NativeClass.self)) rawValue = _makeNativeBridgeObject( native, flag ? (1 as UInt) æ ¸å¿ƒå®šä¹‰ï¼š struct _BridgeStorage { var rawValue: Builtin.BridgeObject protocol BridgeStorage { associatedtype Native : AnyObject associatedtype ObjC : AnyObject init(native: Native, isFlagged: Bool) init(native: Native) init(objC: ObjC) mutating func isUniquelyReferencedNative() -> Bool mutating func isUniquelyReferencedUnflaggedNative() -> Bool var isNative: Bool {get} var isObjC: Bool {get} var nativeInstance: Native {get} var unflaggedNativeInstance: Native {get} var objCInstance: ObjC {get} } extension _BridgeStorage : BridgeStorage {} SetStorage.swift swift/stdlib/public/core/SetStorage.swift /// An instance of this class has all `Set` data tail-allocated. /// Enough bytes are allocated to hold the bitmap for marking valid entries, /// keys, and values. The data layout starts with the bitmap, followed by the /// keys, followed by the values. // NOTE: older runtimes called this class _RawSetStorage. The two // must coexist without a conflicting ObjC class name, so it was // renamed. The old name must not be used in the new runtime. @_fixed_layout @usableFromInline @_objc_non_lazy_realization internal class __RawSetStorage: __SwiftNativeNSSet { // NOTE: The precise layout of this type is relied on in the runtime to // provide a statically allocated empty singleton. See // stdlib/public/stubs/GlobalObjects.cpp for details. /// The current number of occupied entries in this set. @usableFromInline @nonobjc internal final var _count: Int /// The maximum number of elements that can be inserted into this set without /// exceeding the hash table's maximum load factor. @usableFromInline @nonobjc internal final var _capacity: Int /// The scale of this set. The number of buckets is 2 raised to the /// power of `scale`. @usableFromInline @nonobjc internal final var _scale: Int8 /// The scale corresponding to the highest `reserveCapacity(_:)` call so far, /// or 0 if there were none. This may be used later to allow removals to /// resize storage. /// /// FIXME: Shrink storage on deletion @usableFromInline @nonobjc internal final var _reservedScale: Int8 // Currently unused, set to zero. @nonobjc internal final var _extra: Int16 /// A mutation count, enabling stricter index validation. @usableFromInline @nonobjc internal final var _age: Int32 /// The hash seed used to hash elements in this set instance. @usableFromInline internal final var _seed: Int /// A raw pointer to the start of the tail-allocated hash buffer holding set /// members. @usableFromInline @nonobjc internal final var _rawElements: UnsafeMutableRawPointer // This type is made with allocWithTailElems, so no init is ever called. // But we still need to have an init to satisfy the compiler. @nonobjc internal init(_doNotCallMe: ()) { _internalInvariantFailure(\"This class cannot be directly initialized\") } @inlinable @nonobjc internal final var _bucketCount: Int { @inline(__always) get { return 1 & { @inline(__always) get { let address = Builtin.projectTailElems(self, _HashTable.Word.self) return UnsafeMutablePointer(address) } } // The _HashTable struct contains pointers into tail-allocated storage, so // this is unsafe and needs `_fixLifetime` calls in the caller. @inlinable @nonobjc internal final var _hashTable: _HashTable { @inline(__always) get { return _HashTable(words: _metadata, bucketCount: _bucketCount) } } } å’Œ extension __RawSetStorage { /// The empty singleton that is used for every single Set that is created /// without any elements. The contents of the storage must never be mutated. @inlinable @nonobjc internal static var empty: __EmptySetSingleton { return Builtin.bridgeFromRawPointer( Builtin.addressof(&_swiftEmptySetSingleton)) } } Runtime.swift @_fixed_layout @usableFromInline @objc @_swift_native_objc_runtime_base(__SwiftNativeNSSetBase) internal class __SwiftNativeNSSet { @nonobjc internal init() {} @objc public init(coder: AnyObject) {} deinit {} } crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:07:48 "},"common_type/set/memory_layout/ida_def.html":{"url":"common_type/set/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ struct SwiftSet { void *type; __int64 refCount; __int64 _count; __int64 _capacity; __int8 _scale; __int8 _reservedScale; __int16 _extra; __int32 _age; __int64 _seed; __int64 _rawElements; __int64 _metadata; __int64 _firstElement; }; crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:09:36 "},"common_type/set/memory_layout/example.html":{"url":"common_type/set/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:27:16 "},"common_type/string/":{"url":"common_type/string/","title":"Stringå­—ç¬¦ä¸²","keywords":"","body":"Stringå­—ç¬¦ä¸² ç©ºé—´å ç”¨=å¤§å° ç©ºé—´å ç”¨ï¼š0x10å­—èŠ‚ = 16å­—èŠ‚ = 2ä¸ªint64 åˆ†ç±»=ç±»å‹ æ¦‚è¿° Swiftä¸­String Small String Large String ä¸‰ç±» Native çœŸæ­£åœ°å€realStrAddr = objectAddr + 0x20 = objectAddr + 32 = objectAddr + nativeBias Shared çœŸæ­£åœ°å€realStrAddr = objectAddr è¯´æ˜ å¯¹äºBridgeçš„å­—ç¬¦ä¸²ï¼šobjectAddr == NSStringçš„åœ°å€ å†…å­˜å¸ƒå±€ä¿å­˜çš„æ•°æ®ï¼Œæ˜¯NSStringä¸­çš„æ•°æ® Foreign çœŸæ­£åœ°å€realStrAddr = objectAddr è¯¦è§£ Swiftä¸­String Small String Large String åˆ†3ç±» native Native strings have tail-allocated storage, which begins at an offset of nativeBias from the storage object's address. String literals, which reside in the constant section, are encoded as their start address minus nativeBias, unifying code paths for both literals (\"immortal native\") and native strings. Native Strings are always managed by the Swift runtime. shared Shared strings do not have tail-allocated storage, but can provide access upon query to contiguous UTF-8 code units. Lazily-bridged NSStrings capable of providing access to contiguous ASCII/UTF-8 set the ObjC bit. Accessing shared string's pointer should always be behind a resilience barrier, permitting future evolution. foreign Foreign strings cannot provide access to contiguous UTF-8. Currently, this only encompasses lazily-bridged NSStrings that cannot be treated as \"shared\". Such strings may provide access to contiguous UTF-16, or may be discontiguous in storage. Accessing foreign strings should remain behind a resilience barrier for future evolution. Other foreign forms are reserved for the future. å…¶ä»–è¯´æ˜ å¯¹äºSharedå’Œforeign always created and accessed behind a resilience barrier, providing flexibility for the future. crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:53 "},"common_type/string/memory_layout/":{"url":"common_type/string/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:27:09 "},"common_type/string/memory_layout/figure.html":{"url":"common_type/string/memory_layout/figure.html","title":"å›¾","keywords":"","body":"Swiftçš„Stringå­—ç¬¦ä¸²çš„å†…å­˜å¸ƒå±€å›¾ Swiftçš„Stringå­—ç¬¦ä¸²çš„å†…å­˜å¸ƒå±€å›¾ = Swift String Memory Layout åœ¨çº¿é¢„è§ˆ Swiftçš„Stringå†…å­˜å¸ƒå±€ç»“æ„å›¾| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾ ç¦»çº¿æŸ¥çœ‹ æ ¸å¿ƒå†…å®¹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:51:21 "},"common_type/string/memory_layout/text.html":{"url":"common_type/string/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"æ–‡å­— æ¦‚è¿° Swiftä¸­Large String Native çœŸæ­£å­—ç¬¦ä¸²çš„åœ°å€=objectAddr+0x20 Shared/Foreign çœŸæ­£å­—ç¬¦ä¸²çš„åœ°å€=objectAddr è¯¦è§£ Swiftçš„String(64ä½) é€šç”¨ï¼ˆSmall Stringå’ŒLarge Stringéƒ½æœ‰ï¼‰ discriminator å…³äºåç§°å’Œ ä½ç½® == leading nibble == top nibble = 64bitçš„æœ€é¡¶éƒ¨çš„4ä¸ªbitï¼šb63:b60 == [bit63 ~ bit60] æ³¨ï¼šnibble=åŠä¸ªå­—èŠ‚ = 4bit åç§° ï¼ˆæ­¤å¤„æœ‰ä¸ªä¸“é—¨çš„åå­—ï¼‰discriminator = è¾¨åˆ«å™¨ï¼šç”¨äºåŒºåˆ†å­—ç¬¦ä¸²çš„å…·ä½“ç±»å‹ å…¶å®å«åšï¼šString type æ›´åŠ å®¹æ˜“ç†è§£ æ‰€ä»¥ä»£ç å’Œæ³¨é‡Šä¸­ä¸‹é¢çš„åç§°æ˜¯ä¸€ä¸ªæ„æ€ï¼š b63:b60 = discriminator = leading nibble == top nibble å…·ä½“å­—æ®µå’Œå«ä¹‰ b63 = isImmortal Should the Swift runtime skip ARC Small strings are just values, always immortal Large strings can sometimes be immortal, e.g. literals b62 = (large) isBridged / (small) isASCII For large strings, this means lazily-bridged NSString: perform ObjC ARC Small strings repurpose this as a dedicated bit to remember ASCII-ness b61 = isSmall Dedicated bit to denote small strings b60 = isForeign = isSlow cannot provide access to contiguous UTF-8 å®Œæ•´çš„æ˜ å°„è¡¨ = ä¸åŒå­—æ®µçš„ç»„åˆï¼Œè¡¨ç¤ºä¸åŒç±»å‹å­—ç¬¦ä¸² Small String [+0x00-0x0E] = 8+7ä¸ªå­—èŠ‚ =15ä¸ªå­—èŠ‚ = 64+56ä½ = 120ä½ : realString [+0xF] = ç¬¬16ä¸ªå­—èŠ‚=å…±8ä½: discriminator + count byte15çš„[b4:b7] = discriminator byte15çš„[b0:b3] = count Large String [+0x00-0x07 ] = 8ä¸ªå­—èŠ‚ = 64ä½ : flag b63 = ASCII = isASCII b62 = NFC = isNFC b61 = native = isNativelyStored b60 = tail = isTailAllocated b59 = UTF8 = isForeignUTF8 b58:48 = reserved b47:0 = count [+0x08-0x0F] = 8ä¸ªå­—èŠ‚ = 64ä½ : discriminator + objectAddr b63:b60 = discriminator è¯¦è§ä¸Šè¿°è§£é‡Šï¼šb63 = isImmortalã€b62 = (large) isBridged / (small) isASCIIã€b61 = isSmallã€b60 = isForeign = isSlow b60:b0 = objectAddr realStrAddr = objectAddr + nativeBias = objectAddr + 32 = objectAddr + 0x20 crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:33:43 "},"common_type/string/memory_layout/src.html":{"url":"common_type/string/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  StringObject.swift StringObject.swift swift/stdlib/public/core/StringObject.swift at main Â· apple/swift (github.com) extension _StringObject { @inlinable @inline(__always) internal init(_ small: _SmallString) { // Small strings are encoded as _StringObjects in reverse byte order // on big-endian platforms. This is to match the discriminator to the // spare bits (the most significant nibble) in a pointer. let word1 = small.rawBits.0.littleEndian let word2 = small.rawBits.1.littleEndian #if _pointerBitWidth(_64) // On 64-bit, we copy the raw bits (to host byte order). self.init(rawValue: (word1, word2)) #elseif _pointerBitWidth(_32) // On 32-bit, we need to unpack the small string. let smallStringDiscriminatorAndCount: UInt64 = 0xFF00_0000_0000_0000 let leadingFour = Int(truncatingIfNeeded: word1) let nextFour = UInt(truncatingIfNeeded: word1 &>> 32) let smallDiscriminatorAndCount = word2 & smallStringDiscriminatorAndCount let trailingTwo = UInt16(truncatingIfNeeded: word2) self.init( count: leadingFour, variant: .immortal(nextFour), discriminator: smallDiscriminatorAndCount, flags: trailingTwo) #else #error(\"Unknown platform\") #endif _internalInvariant(isSmall) } @inlinable internal static func getSmallCount(fromRaw x: UInt64) -> Int { #if os(Android) && arch(arm64) return Int(truncatingIfNeeded: (x & 0x000F_0000_0000_0000) &>> 48) #else return Int(truncatingIfNeeded: (x & 0x0F00_0000_0000_0000) &>> 56) #endif } @inlinable @inline(__always) internal var smallCount: Int { _internalInvariant(isSmall) return _StringObject.getSmallCount(fromRaw: discriminatedObjectRawBits) } @inlinable internal static func getSmallIsASCII(fromRaw x: UInt64) -> Bool { #if os(Android) && arch(arm64) return x & 0x0040_0000_0000_0000 != 0 #else return x & 0x4000_0000_0000_0000 != 0 #endif } @inlinable @inline(__always) internal var smallIsASCII: Bool { _internalInvariant(isSmall) return _StringObject.getSmallIsASCII(fromRaw: discriminatedObjectRawBits) } @inlinable @inline(__always) internal init(empty:()) { // Canonical empty pattern: small zero-length string #if _pointerBitWidth(_64) self._countAndFlagsBits = 0 self._object = Builtin.valueToBridgeObject(Nibbles.emptyString._value) #elseif _pointerBitWidth(_32) self.init( count: 0, variant: .immortal(0), discriminator: Nibbles.emptyString, flags: 0) #else #error(\"Unknown platform\") #endif _internalInvariant(self.smallCount == 0) _invariantCheck() } } StringBridge.swift swift/stdlib/public/core/StringBridge.swift extension String { @_spi(Foundation) public init(_cocoaString: AnyObject) { self._guts = _bridgeCocoaString(_cocoaString) } } -> @usableFromInline @_effects(releasenone) // @opaque internal func _bridgeCocoaString(_ cocoaString: _CocoaString) -> _StringGuts { switch _KnownCocoaString(cocoaString) { case .storage: return _unsafeUncheckedDowncast( cocoaString, to: __StringStorage.self).asString._guts case .shared: return _unsafeUncheckedDowncast( cocoaString, to: __SharedStringStorage.self).asString._guts #if _pointerBitWidth(_64) case .tagged: // Foundation should be taking care of tagged pointer strings before they // reach here, so the only ones reaching this point should be back deployed, // which will never have tagged pointer strings that aren't small, hence // the force unwrap here. return _StringGuts(_SmallString(taggedCocoa: cocoaString)!) #if arch(arm64) case .constantTagged: let taggedContents = getConstantTaggedCocoaContents(cocoaString)! return _StringGuts( cocoa: taggedContents.untaggedCocoa, providesFastUTF8: false, //TODO: if contentsPtr is UTF8 compatible, use it isASCII: true, length: taggedContents.utf16Length ) #endif #endif case .cocoa: // \"Copy\" it into a value to be sure nobody will modify behind // our backs. In practice, when value is already immutable, this // just does a retain. // // TODO: Only in certain circumstances should we emit this call: // 1) If it's immutable, just retain it. // 2) If it's mutable with no associated information, then a copy must // happen; might as well eagerly bridge it in. // 3) If it's mutable with associated information, must make the call let immutableCopy = _stdlib_binary_CFStringCreateCopy(cocoaString) #if _pointerBitWidth(_64) if _isObjCTaggedPointer(immutableCopy) { // Copying a tagged pointer can produce a tagged pointer, but only if it's // small enough to definitely fit in a _SmallString return _StringGuts( _SmallString(taggedCocoa: immutableCopy).unsafelyUnwrapped ) } #endif let (fastUTF8, isASCII): (Bool, Bool) switch _getCocoaStringPointer(immutableCopy) { case .ascii(_): (fastUTF8, isASCII) = (true, true) case .utf8(_): (fastUTF8, isASCII) = (true, false) default: (fastUTF8, isASCII) = (false, false) } let length = _stdlib_binary_CFStringGetLength(immutableCopy) return _StringGuts( cocoa: immutableCopy, providesFastUTF8: fastUTF8, isASCII: isASCII, length: length) } } crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:49 "},"common_type/string/memory_layout/ida_def.html":{"url":"common_type/string/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ åŠ åˆ°IDAä¸­çš„å®šä¹‰ï¼š struct SwiftString { __int64 flagsAndCount; void *objAddr; }; crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:52:10 "},"common_type/string/memory_layout/example.html":{"url":"common_type/string/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ Small String \"control\" å¯„å­˜å™¨ä¸­ï¼š (lldb) reg r x0 x1 sp x0 = 0x006c6f72746e6f63 x1 = 0xe700000000000000 å†…å­˜ä¸­ï¼š (lldb) po 0x0000000281a4cea0 MainAppLibrary.OfflineAB.BucketInfo (lldb) x/6xg 0x0000000281a4cea0 0x281a4cea0: 0x000000010415b460 0x0000000000000003 0x281a4ceb0: 0x006c6f72746e6f63 0xe700000000000000 0x281a4cec0: 0x0000000000002710 0x0000000281a4c930 (lldb) p/c 0x006c6f72746e6f63 (long) control\\0 ->å­—ç¬¦ä¸²æœ¬èº« = realString ï¼š 0xe700000000000000 0x006c6f72746e6f63 -> (lldb) p/c 0x006c6f72746e6f63 (unsigned long) control\\0 ->å­—ç¬¦ä¸²æ˜¯ï¼š\"control\" ç¬¬15ä¸ªå­—èŠ‚=8ä½ï¼Œåˆ†2éƒ¨åˆ†ï¼š æœ€é«˜4ä½=discriminator 0xe = 0b 1110 b63 = isImmortal -> 1 isImmortal=True b62 = (large) isBridged / (small) isASCII -> 1 Small Stringï¼šASCII=True b61 = isSmall -> 1 æ˜¯Small string b60 = isForeign = isSlow -> 0 isForeign=False æœ€ä½4ä½=count 0x7 å­—ç¬¦ä¸²é•¿åº¦æ˜¯ï¼š7 = 7ä¸ªå­—ç¬¦ å¯¹åº”ç€ï¼šcontrolå­—ç¬¦ä¸²çš„é•¿åº¦=7 Large String Large String - Native \"ios_prod_latam_tos_reg_universe\" (lldb) po 0x00000002800f5e00 MainAppLibrary.OfflineAB.UniverseInfo (lldb) x/6gx 0x00000002800f5e00 0x2800f5e00: 0x0000000105d3c398 0x0000000200000003 0x2800f5e10: 0xd00000000000001f 0x8000000105110930 0x2800f5e20: 0x6469725f72657375 0xe800000000000000 æ ¹æ®å®šä¹‰ï¼š MainAppLibrary.OfflineAB.UniverseInfo [+0x10~0x18] = name ç±»å‹ï¼šSwiftçš„Large Stringï¼ˆçœŸæ­£å­—ç¬¦ä¸²åœ°å€æ˜¯ï¼šnameå€¼+0x20ï¼‰ æ­¤å¤„å€¼ï¼š [+0x10~0x18] = name 0x2800f5e10: 0xd00000000000001f 0x8000000105110930 -ã€‹çœŸæ­£å­—ç¬¦ä¸²åœ°å€æ˜¯ï¼š 0x8000000105110930 + 0x20 = 0x8000000105110950 (lldb) x/s 0x8000000105110950 0x105110950: \"ios_prod_latam_tos_reg_universe\" é¢å¤–è¯´æ˜ ï¼ˆ1ï¼‰å¦‚æœä¸åŠ 0x20ï¼Œåˆ™çœ‹åˆ°çš„å­—ç¬¦ä¸²æ˜¯åˆ«çš„ï¼ˆé”™ä½åçš„ï¼‰å€¼ï¼š (lldb) x/s 0x8000000105110930 0x105110930: \"os_reg_experiment\" ï¼ˆ2ï¼‰å»æ‰æœ€å¼€å§‹çš„0x8ï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨x/sçœ‹åˆ°å­—ç¬¦ä¸²çš„: (lldb) x/s 0x0000000105110930 0x105110930: \"os_reg_experiment\" (lldb) x/s 0x0000000105110950 0x105110950: \"ios_prod_latam_tos_reg_universe\" ç±»ä¼¼çš„ï¼šå»æ‰0x8å‰ç¼€ï¼Œå¯ä»¥ç”¨poæŸ¥çœ‹å‡ºå­—ç¬¦ä¸²çš„å€¼ï¼š (lldb) po (char*)0x0000000105110950 \"ios_prod_latam_tos_reg_universe\" ï¼ˆ3ï¼‰ä¸è®ºæ˜¯å¦åŠ 0x20ï¼Œç›´æ¥poæŸ¥çœ‹ï¼Œåˆ™éƒ½æ˜¯ï¼ˆå¼‚å¸¸çš„ï¼Œä¸æ˜¯æˆ‘ä»¬è¦çš„ï¼‰æ—¶é—´ç±»å‹çš„å€¼ï¼š (lldb) po 0x8000000105110930 2001-01-01 00:00:00 +0000 (lldb) po 0x8000000105110950 2001-01-01 00:00:00 +0000 (lldb) po (char*)0x8000000105110950 2001-01-01 00:00:00 +0000 åè®°ï¼š å¦å¤–æŸæ¬¡å»poï¼Œå´è¿å¼‚å¸¸çš„æ—¶é—´ç±»å‹çš„å€¼éƒ½çœ‹ä¸åˆ°ï¼Œè€Œæ˜¯ï¼šå°±æ˜¯æ•°å­—ï¼š (lldb) reg r x0 x1 x0 = 0x000000000000007c x1 = 0xe100000000000000 (lldb) reg r x20 sp x20 = 0x000000016d658c20 sp = 0x000000016d658c20 (lldb) x/8gx 0x000000016d658c20 0x16d658c20: 0xd000000000000021 0x80000001051946f0 0x16d658c30: 0x0000000000000002 0x00000002833c1140 0x16d658c40: 0x0000000105da1628 0x0000000105dbbcd0 0x16d658c50: 0x00000002833c1140 0x00000002828d0780 (lldb) po 0x80000001051946f0 9223372041235285744 è€Œæ¢x/så­—ç¬¦ä¸²æŸ¥çœ‹ï¼Œæ˜¯å¯ä»¥çœ‹å‡ºï¼š ï¼ˆè™½ç„¶æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯æ˜¯ï¼‰å­—ç¬¦ä¸²çš„å€¼çš„ (lldb) x/s 0x80000001051946f0 0x1051946f0: \"dummy_aa_offline_user_rid_ios\" å½“ç„¶ï¼ŒçœŸæ­£åœ°å€+0x20çš„å­—ç¬¦ä¸²ï¼š (lldb) p/x 0x80000001051946f0 + 0x20 (unsigned long) 0x8000000105194710 ->ä½†æ˜¯poä¹Ÿè¿˜æ˜¯çœ‹ä¸å‡º: (lldb) po 0x8000000105194710 9223372041235285776 åªèƒ½ç”¨å­—ç¬¦ä¸²æŸ¥çœ‹ï¼š (lldb) x/s 0x8000000105194710 0x105194710: \"dummy_aa_offline_rid_universe_ios\" Large String - Shared \"2.23.25.85\" æ­¤å¤„ï¼š 0xc00000000000000a 0x400000028143c6c0 å…¶ä¸­ï¼š Large String 0xc00000000000000a 0xC = 12 = 0b 1100 b63 = ASCII = isASCII True b62 = NFC = isNFC True b61 = native = isNativelyStored False b60 = tail = isTailAllocated False b59 = UTF8 = isForeignUTF8 False 0xa = 10 ï¼šå­—ç¬¦ä¸²é•¿åº¦æ˜¯10 0x400000028143c6c0 discriminator = 0x4 = 0b 0100 b63 = isImmortal False b62 = (large) isBridged / (small) isASCII True b61 = isSmall False b60 = isForeign = isSlow False objectAddr = 0x28143c6c0 -> Large String length = 10 flag isASCII = True isNFC = True isNativelyStored = False isTailAllocated = False isForeignUTF8 = False discriminator isImmortal = False isBridged = True isSmall = False isForeign == isSlow = False objectAddr = 0x28143c6c0 -> Swiftä¸­çš„å­—ç¬¦ä¸² æ˜¯bridgedæ¡¥æ¥çš„ å­—ç¬¦ä¸²åœ°å€æ˜¯ï¼š0x28143c6c0 å…¶ä»–ç»†èŠ‚ æ˜¯ASCIIçš„ æ˜¯NFCï¼ˆNormal Form Cï¼‰çš„ ä¸æ˜¯å°¾éƒ¨åˆ†é…çš„TailAllocated -> æ­¤å¤„å¯¹åº”ç€ï¼šä»ObjCçš„NSStringï¼š\"2.23.25.85\" (lldb) reg r x0 x0 = 0x000000028143c6c0 (lldb) po $x0 2.23.25.85 (lldb) po [$x0 class] __NSCFString è°ƒç”¨ libswiftFoundation.dylib static Swift.String._unconditionallyBridgeFromObjectiveC(Swift.Optional) -> Swift.String è€ŒBridgeæ¡¥æ¥è¿‡æ¥çš„ -> æ­¤å¤„ï¼šæƒ³è¦æŸ¥çœ‹å‡ºå­—ç¬¦ä¸²çš„å€¼ï¼š ï¼ˆæ–¹å¼1ï¼‰åŠ ä¸ŠNSStringå¼ºåˆ¶ç±»å‹è½¬æ¢å»æ‰“å°å­—ç¬¦ä¸² (lldb) po (NSString*)0x000000028143c6c0 2.23.25.85 ï¼ˆæ–¹å¼2ï¼‰è‡ªå·±æŸ¥çœ‹ObjCçš„NSStringçš„å†…å­˜å€¼ï¼Œæ‰‹åŠ¨æ‰“å°å‡ºå­—ç¬¦ä¸² æ­¤å¤„ï¼ˆNSStringç±»å‹çš„å­—ç¬¦ä¸²çš„ï¼‰å†…å­˜å€¼æ˜¯ï¼š (lldb) x/8xg 0x00000028143c6c0 0x28143c6c0: 0x000021a1efdfa941 0x000000030000078c 0x28143c6d0: 0x35322e33322e320a 0x000000000035382e 0x28143c6e0: 0x00004fcde1ddc6e0 0x0000000000000041 0x28143c6f0: 0x0000000000000000 0x0000000000000000 å…¶ä¸­æ ¸å¿ƒæ•°æ®æ˜¯ï¼š 0x28143c6d0: 0x35322e33322e320a 0x000000000035382e ->å¯ä»¥è°ƒè¯•æŸ¥çœ‹åˆ°å…·ä½“å­—ç¬¦ä¸²çš„å€¼å’Œé•¿åº¦ï¼š (lldb) p/c 0x35322e33322e320a (long) \\n2.23.25 (lldb) p/c 0x000000000035382e (int) .85\\0 (lldb) x/8xb 0x28143c6d0 0x28143c6d0: 0x0a 0x32 0x2e 0x32 0x33 0x2e 0x32 0x35 (lldb) x/8xb 0x28143c6d8 0x28143c6d8: 0x2e 0x38 0x35 0x00 0x00 0x00 0x00 0x00 (lldb) x/s 0x28143c6d0 0x28143c6d0: \"\\n2.23.25.85\" (lldb) x/s 0x28143c6d8 0x28143c6d8: \".85\" (lldb) p/d 0xa (int) 10 (lldb) x/s 0x28143c6d1 0x28143c6d1: \"2.23.25.85\" å³ï¼š å­—ç¬¦ä¸²ï¼š é•¿åº¦ï¼š10 å€¼ï¼š2.23.25.85 crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:12 "},"common_type/struct/memory_layout/":{"url":"common_type/struct/memory_layout/","title":"å†…å­˜å¸ƒå±€","keywords":"","body":"å†…å­˜å¸ƒå±€ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:25:57 "},"common_type/struct/memory_layout/figure.html":{"url":"common_type/struct/memory_layout/figure.html","title":"å›¾","keywords":"","body":"å›¾ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:35:07 "},"common_type/struct/memory_layout/text.html":{"url":"common_type/struct/memory_layout/text.html","title":"æ–‡å­—","keywords":"","body":"æ–‡å­— crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 16:53:50 "},"common_type/struct/memory_layout/src.html":{"url":"common_type/struct/memory_layout/src.html","title":"Swiftæºç ","keywords":"","body":"Swiftæºç  crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:34:28 "},"common_type/struct/memory_layout/ida_def.html":{"url":"common_type/struct/memory_layout/ida_def.html","title":"IDAå®šä¹‰","keywords":"","body":"IDAå®šä¹‰ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:28:05 "},"common_type/struct/memory_layout/example.html":{"url":"common_type/struct/memory_layout/example.html","title":"ä¸¾ä¾‹","keywords":"","body":"ä¸¾ä¾‹ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:26:37 "},"common_type/tuple/":{"url":"common_type/tuple/","title":"Tupleå…ƒç¥–","keywords":"","body":"Tupleå…ƒç¥– crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:31:47 "},"appendix/":{"url":"appendix/","title":"é™„å½•","keywords":"","body":"é™„å½• ä¸‹é¢åˆ—å‡ºç›¸å…³å‚è€ƒèµ„æ–™ã€‚ crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-22 09:33:24 "},"appendix/reference.html":{"url":"appendix/reference.html","title":"å‚è€ƒèµ„æ–™","keywords":"","body":"å‚è€ƒèµ„æ–™ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šDictionaryå­—å…¸çš„å†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šæ‰¾Swiftçš„Dictionaryå­—å…¸çš„æµ‹è¯•æ•°æ® ã€æ•´ç†ã€‘iOSé€†å‘ï¼šå»ç”»Swiftçš„Dictionaryå­—å…¸çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€æœªè§£å†³ã€‘iOSé€†å‘WhatsAppï¼šgenWAABOfflineAssignSha256_10039E294 ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šSwiftä¸­Stringå­—ç¬¦ä¸²çš„å†…éƒ¨ç»“æ„å’Œé€»è¾‘ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šç ”ç©¶_unconditionallyBridgeFromObjectiveCåçš„SwiftStringçš„å€¼çš„é€»è¾‘å’Œå«ä¹‰ ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šString._unconditionallyBridgeFromObjectiveC ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šVWT=ValueWitnessTable=å€¼è§è¯è¡¨ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šIDAä¼˜åŒ–æ’å…¥ValueWitnessTableç»“æ„ä½“å®šä¹‰ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šIDAä¸­è‡ªå®šä¹‰ç»“æ„ä½“ä¸­åŠ ä¸Šbitä½çš„å®šä¹‰ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šBuiltin.NativeObjectçš„VWT ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šDataæ•°æ®çš„å†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šDataçš„InlineSliceå†…å­˜å¸ƒå±€ä¸¾ä¾‹ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šç”»Swiftçš„Dataæ•°æ®çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼šIDAä¸­æ·»åŠ Swiftçš„Dataç›¸å…³å®šä¹‰ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šç”»ClassMetadataçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€æ•´ç†ã€‘iOSé€†å‘ï¼šå»ç”»Swiftçš„ValueMetadataå’ŒVWTçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šClassMetadataçš„å®šä¹‰å’Œå†…å­˜å¸ƒå±€ ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼š__DataStorageçš„ClassMetadataå†…å­˜å¸ƒå±€å€¼ä¸¾ä¾‹ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šMetadataçš„typeå³å…ƒæ•°æ®çš„ç±»å‹å®šä¹‰ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šValueMetadataçš„å®šä¹‰å’Œå†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šIDAä¸­åŠ ä¸Šå®šä¹‰ï¼šValueMetadata ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šStructMetadataçš„å­—æ®µå®šä¹‰å’Œå†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šSwiftä¸­æœ‰å‡ ç§Metadata ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šTypeMetadata=Type Metadata ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šIDAä¸­æ·»åŠ ClassMetadataçš„å®šä¹‰ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šArrayæ•°ç»„çš„å†…å­˜å¸ƒå±€ ã€æ•´ç†ã€‘iOSé€†å‘ï¼šå»ç”»Swiftçš„Arrayæ•°ç»„çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šStructMetadataçš„å­—æ®µå®šä¹‰å’Œå†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šStructDescriptor ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šFieldDescriptor ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šç”»StructMetadataçš„å†…å­˜å¸ƒå±€å›¾ ã€æ•´ç†ã€‘iOSé€†å‘ï¼šå»ç”»Swiftçš„Stringå­—ç¬¦ä¸²çš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€å·²è§£å†³ã€‘iOSé€†å‘ï¼šSeté›†åˆçš„å†…å­˜å¸ƒå±€ä¸­å¦‚ä½•åˆ¤æ–­å“ªç»„æ•°æ®æ˜¯æœ‰æ•ˆçš„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šSeté›†åˆçš„å†…å­˜å¸ƒå±€ç»“æ„ ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šSeté›†åˆçš„_rawElementsä¹‹åçš„æ•°æ®çš„å­˜å‚¨é€»è¾‘ ã€æ•´ç†ã€‘iOSé€†å‘ï¼šå»ç”»Swiftçš„Seté›†åˆçš„å†…å­˜å¸ƒå±€ç»“æ„å›¾ ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼š__RawSetStorage ã€æœªè§£å†³ã€‘iOSé€†å‘Swiftï¼š__SwiftNativeNSSet ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šç»™IDAä¸­åŠ ä¸ŠSeté›†åˆçš„ç»“æ„ä½“å®šä¹‰SwiftSet ã€å·²è§£å†³ã€‘iOSé€†å‘Swiftï¼šSetä¸­çš„åç§»é‡0x38æ˜¯ä»€ä¹ˆå€¼ åˆæ¢Swiftåº•å±‚Metadata - æ˜é‡‘ swift-evolution/proposals/0247-contiguous-strings.md at main Â· apple/swift-evolution (github.com) swift/docs/CppInteroperability/CppInteroperabilityManifesto.md at main Â· apple/swift crifan.orgï¼Œä½¿ç”¨ç½²å4.0å›½é™…(CC BY 4.0)åè®®å‘å¸ƒ all right reservedï¼Œpowered by Gitbookæœ€åæ›´æ–°ï¼š 2024-02-24 17:10:45 "}}