
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>Unicorn部分核心代码 · CPU模拟利器：Unicorn</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 4.0.7">
        <meta name="author" content="Crifan Li <admin@crifan.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="reference.html" />
    
    
    <link rel="prev" href="unicorn_doc_refer.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"repo":"cpu_emulator_unicorn","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="http://www.crifan.org" target="_blank" class="custom-link">主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../unicorn_overview/">
            
                <a href="../unicorn_overview/">
            
                    
                        <b>1.2.</b>
                    
                    Unicorn概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../init/">
            
                <a href="../init/">
            
                    
                        <b>1.3.</b>
                    
                    初始化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../init/download_install.html">
            
                <a href="../init/download_install.html">
            
                    
                        <b>1.3.1.</b>
                    
                    下载安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../init/run_test_code.html">
            
                <a href="../init/run_test_code.html">
            
                    
                        <b>1.3.2.</b>
                    
                    运行测试代码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../how_use/">
            
                <a href="../how_use/">
            
                    
                        <b>1.4.</b>
                    
                    如何使用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../how_use/core_mind/">
            
                <a href="../how_use/core_mind/">
            
                    
                        <b>1.4.1.</b>
                    
                    概述Unicorn核心思路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../how_use/background/">
            
                <a href="../how_use/background/">
            
                    
                        <b>1.4.2.</b>
                    
                    背景知识
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../how_use/background/core_logic/">
            
                <a href="../how_use/background/core_logic/">
            
                    
                        <b>1.4.2.1.</b>
                    
                    程序运行的本质
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1.1" data-path="../how_use/background/core_logic/cpu_logic.html">
            
                <a href="../how_use/background/core_logic/cpu_logic.html">
            
                    
                        <b>1.4.2.1.1.</b>
                    
                    CPU的核心逻辑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.1.2" data-path="../how_use/background/core_logic/what_is_instruction.html">
            
                <a href="../how_use/background/core_logic/what_is_instruction.html">
            
                    
                        <b>1.4.2.1.2.</b>
                    
                    什么是指令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../how_use/background/mem_layout/">
            
                <a href="../how_use/background/mem_layout/">
            
                    
                        <b>1.4.2.2.</b>
                    
                    内存布局
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.2.1" data-path="../how_use/background/mem_layout/what_is.html">
            
                <a href="../how_use/background/mem_layout/what_is.html">
            
                    
                        <b>1.4.2.2.1.</b>
                    
                    什么是内存布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2.2" data-path="../how_use/background/mem_layout/mem_addr_scope.html">
            
                <a href="../how_use/background/mem_layout/mem_addr_scope.html">
            
                    
                        <b>1.4.2.2.2.</b>
                    
                    内存地址空间范围
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2.3" data-path="../how_use/background/mem_layout/typical_layout.html">
            
                <a href="../how_use/background/mem_layout/typical_layout.html">
            
                    
                        <b>1.4.2.2.3.</b>
                    
                    典型的内存布局
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../how_use/background/endian/">
            
                <a href="../how_use/background/endian/">
            
                    
                        <b>1.4.2.3.</b>
                    
                    字节序endian
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../how_use/before_run/">
            
                <a href="../how_use/before_run/">
            
                    
                        <b>1.4.3.</b>
                    
                    运行前
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../how_use/before_run/set_code/">
            
                <a href="../how_use/before_run/set_code/">
            
                    
                        <b>1.4.3.1.</b>
                    
                    设置代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../how_use/before_run/set_other/">
            
                <a href="../how_use/before_run/set_other/">
            
                    
                        <b>1.4.3.2.</b>
                    
                    设置其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.2.1" data-path="../how_use/before_run/set_other/func_para.html">
            
                <a href="../how_use/before_run/set_other/func_para.html">
            
                    
                        <b>1.4.3.2.1.</b>
                    
                    函数参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2.2" data-path="../how_use/before_run/set_other/related_data.html">
            
                <a href="../how_use/before_run/set_other/related_data.html">
            
                    
                        <b>1.4.3.2.2.</b>
                    
                    相关数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2.3" data-path="../how_use/before_run/set_other/stack.html">
            
                <a href="../how_use/before_run/set_other/stack.html">
            
                    
                        <b>1.4.3.2.3.</b>
                    
                    Stack栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2.4" data-path="../how_use/before_run/set_other/heap.html">
            
                <a href="../how_use/before_run/set_other/heap.html">
            
                    
                        <b>1.4.3.2.4.</b>
                    
                    Heap堆
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../how_use/in_running/">
            
                <a href="../how_use/in_running/">
            
                    
                        <b>1.4.4.</b>
                    
                    运行中
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="../how_use/in_running/start_running.html">
            
                <a href="../how_use/in_running/start_running.html">
            
                    
                        <b>1.4.4.1.</b>
                    
                    开始运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.2" data-path="../how_use/in_running/debug_logic/">
            
                <a href="../how_use/in_running/debug_logic/">
            
                    
                        <b>1.4.4.2.</b>
                    
                    调试逻辑
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.2.1" data-path="../how_use/in_running/debug_logic/hook/">
            
                <a href="../how_use/in_running/debug_logic/hook/">
            
                    
                        <b>1.4.4.2.1.</b>
                    
                    hook
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.2.1.1" data-path="../how_use/in_running/debug_logic/hook/hook_code/">
            
                <a href="../how_use/in_running/debug_logic/hook/hook_code/">
            
                    
                        <b>1.4.4.2.1.1.</b>
                    
                    hook代码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.2.1.1.1" data-path="../how_use/in_running/debug_logic/hook/hook_code/instruction.html">
            
                <a href="../how_use/in_running/debug_logic/hook/hook_code/instruction.html">
            
                    
                        <b>1.4.4.2.1.1.1.</b>
                    
                    hook指令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4.2.1.2" data-path="../how_use/in_running/debug_logic/hook/hook_mem.html">
            
                <a href="../how_use/in_running/debug_logic/hook/hook_mem.html">
            
                    
                        <b>1.4.4.2.1.2.</b>
                    
                    hook内存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.2.1.3" data-path="../how_use/in_running/debug_logic/hook/hook_exception.html">
            
                <a href="../how_use/in_running/debug_logic/hook/hook_exception.html">
            
                    
                        <b>1.4.4.2.1.3.</b>
                    
                    hook异常
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4.2.2" data-path="../how_use/in_running/debug_logic/log/">
            
                <a href="../how_use/in_running/debug_logic/log/">
            
                    
                        <b>1.4.4.2.2.</b>
                    
                    打印日志
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.2.2.1" data-path="../how_use/in_running/debug_logic/log/optimize_log.html">
            
                <a href="../how_use/in_running/debug_logic/log/optimize_log.html">
            
                    
                        <b>1.4.4.2.2.1.</b>
                    
                    优化日志输出
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4.2.3" data-path="../how_use/in_running/debug_logic/print_instruction/">
            
                <a href="../how_use/in_running/debug_logic/print_instruction/">
            
                    
                        <b>1.4.4.2.3.</b>
                    
                    查看当前指令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../how_use/after_run/">
            
                <a href="../how_use/after_run/">
            
                    
                        <b>1.4.5.</b>
                    
                    运行后
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../how_use/after_run/stop.html">
            
                <a href="../how_use/after_run/stop.html">
            
                    
                        <b>1.4.5.1.</b>
                    
                    停止运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../how_use/after_run/get_result.html">
            
                <a href="../how_use/after_run/get_result.html">
            
                    
                        <b>1.4.5.2.</b>
                    
                    获取结果
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../summary_note/">
            
                <a href="../summary_note/">
            
                    
                        <b>1.5.</b>
                    
                    经验和心得
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../summary_note/common_issue/">
            
                <a href="../summary_note/common_issue/">
            
                    
                        <b>1.5.1.</b>
                    
                    常见错误
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../summary_note/common_issue/uc_err_map/">
            
                <a href="../summary_note/common_issue/uc_err_map/">
            
                    
                        <b>1.5.1.1.</b>
                    
                    UC_ERR_MAP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1.1" data-path="../summary_note/common_issue/uc_err_map/batch_fix_uc_err_map.html">
            
                <a href="../summary_note/common_issue/uc_err_map/batch_fix_uc_err_map.html">
            
                    
                        <b>1.5.1.1.1.</b>
                    
                    批量解决UC_ERR_MAP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../summary_note/common_issue/uc_err_write_unmapped.html">
            
                <a href="../summary_note/common_issue/uc_err_write_unmapped.html">
            
                    
                        <b>1.5.1.2.</b>
                    
                    UC_ERR_WRITE_UNMAPPED
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../summary_note/manual_change_opcode.html">
            
                <a href="../summary_note/manual_change_opcode.html">
            
                    
                        <b>1.5.2.</b>
                    
                    手动修改指令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../summary_note/value_convert.html">
            
                <a href="../summary_note/value_convert.html">
            
                    
                        <b>1.5.3.</b>
                    
                    数值转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../summary_note/arm64_arm64e.html">
            
                <a href="../summary_note/arm64_arm64e.html">
            
                    
                        <b>1.5.4.</b>
                    
                    ARM64和arm64e
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../summary_note/call_other_func/">
            
                <a href="../summary_note/call_other_func/">
            
                    
                        <b>1.5.5.</b>
                    
                    调用其他子函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.5.1" data-path="../summary_note/call_other_func/emu_func_impl.html">
            
                <a href="../summary_note/call_other_func/emu_func_impl.html">
            
                    
                        <b>1.5.5.1.</b>
                    
                    模拟函数实现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../summary_note/other_use_unicorn.html">
            
                <a href="../summary_note/other_use_unicorn.html">
            
                    
                        <b>1.5.6.</b>
                    
                    用到Unicorn的
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../examples/">
            
                <a href="../examples/">
            
                    
                        <b>1.6.</b>
                    
                    实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../examples/example_akd_symbol2575.html">
            
                <a href="../examples/example_akd_symbol2575.html">
            
                    
                        <b>1.6.1.</b>
                    
                    模拟akd函数symbol2575
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../examples/other_unicorn_sample.html">
            
                <a href="../examples/other_unicorn_sample.html">
            
                    
                        <b>1.6.2.</b>
                    
                    其他示例代码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.7.</b>
                    
                    附录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="unicorn_doc_refer.html">
            
                <a href="unicorn_doc_refer.html">
            
                    
                        <b>1.7.1.</b>
                    
                    Unicorn文档和资料
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.2" data-path="unicorn_core_code.html">
            
                <a href="unicorn_core_code.html">
            
                    
                        <b>1.7.2.</b>
                    
                    Unicorn部分核心代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="reference.html">
            
                <a href="reference.html">
            
                    
                        <b>1.7.3.</b>
                    
                    参考资料
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Unicorn部分核心代码</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <html><head></head><body><h1 id="unicorn部分核心代码"><a name="unicorn部分核心代码" class="plugin-anchor" href="#unicorn部分核心代码"><i class="fa fa-link" aria-hidden="true"></i></a>Unicorn部分核心代码</h1>
<h2 id="unicornh"><a name="unicornh" class="plugin-anchor" href="#unicornh"><i class="fa fa-link" aria-hidden="true"></i></a>unicorn.h</h2>
<ul>
<li>unicorn.h<ul>
<li>unicorn/unicorn.h at master · unicorn-engine/unicorn · GitHub<ul>
<li><a href="https://github.com/unicorn-engine/unicorn/blob/master/include/unicorn/unicorn.h" target="_blank">https://github.com/unicorn-engine/unicorn/blob/master/include/unicorn/unicorn.h</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="arch架构"><a name="arch架构" class="plugin-anchor" href="#arch架构"><i class="fa fa-link" aria-hidden="true"></i></a>arch架构</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">// Architecture type</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_arch</span> <span class="token punctuation">{</span>
    UC_ARCH_ARM <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// ARM architecture (including Thumb, Thumb-2)</span>
    UC_ARCH_ARM64<span class="token punctuation">,</span>   <span class="token comment">// ARM-64, also called AArch64</span>
    UC_ARCH_MIPS<span class="token punctuation">,</span>    <span class="token comment">// Mips architecture</span>
    UC_ARCH_X86<span class="token punctuation">,</span>     <span class="token comment">// X86 architecture (including x86 &amp; x86-64)</span>
    UC_ARCH_PPC<span class="token punctuation">,</span>     <span class="token comment">// PowerPC architecture</span>
    UC_ARCH_SPARC<span class="token punctuation">,</span>   <span class="token comment">// Sparc architecture</span>
    UC_ARCH_M68K<span class="token punctuation">,</span>    <span class="token comment">// M68K architecture</span>
    UC_ARCH_RISCV<span class="token punctuation">,</span>   <span class="token comment">// RISCV architecture</span>
    UC_ARCH_S390X<span class="token punctuation">,</span>   <span class="token comment">// S390X architecture</span>
    UC_ARCH_TRICORE<span class="token punctuation">,</span> <span class="token comment">// TriCore architecture</span>
    UC_ARCH_MAX<span class="token punctuation">,</span>
<span class="token punctuation">}</span> uc_arch<span class="token punctuation">;</span>
</code></pre>
<h3 id="mode模式"><a name="mode模式" class="plugin-anchor" href="#mode模式"><i class="fa fa-link" aria-hidden="true"></i></a>mode模式</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">// Mode type</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_mode</span> <span class="token punctuation">{</span>
    UC_MODE_LITTLE_ENDIAN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token comment">// little-endian mode (default mode)</span>
    UC_MODE_BIG_ENDIAN <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// big-endian mode</span>

    <span class="token comment">// arm / arm64</span>
    UC_MODE_ARM <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token comment">// ARM mode</span>
    UC_MODE_THUMB <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// THUMB mode (including Thumb-2)</span>
    <span class="token comment">// Depreciated, use UC_ARM_CPU_* with uc_ctl instead.</span>
    UC_MODE_MCLASS <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">// ARM&apos;s Cortex-M series.</span>
    UC_MODE_V8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span>      <span class="token comment">// ARMv8 A32 encodings for ARM</span>
    UC_MODE_ARMBE8 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// Big-endian data and Little-endian code.</span>
                              <span class="token comment">// Legacy support for UC1 only.</span>

    <span class="token comment">// arm (32bit) cpu types</span>
    <span class="token comment">// Depreciated, use UC_ARM_CPU_* with uc_ctl instead.</span>
    UC_MODE_ARM926 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token comment">// ARM926 CPU type</span>
    UC_MODE_ARM946 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token comment">// ARM946 CPU type</span>
    UC_MODE_ARM1176 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">// ARM1176 CPU type</span>

    <span class="token comment">// mips</span>
    UC_MODE_MICRO <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span>    <span class="token comment">// MicroMips mode (currently unsupported)</span>
    UC_MODE_MIPS3 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">// Mips III ISA (currently unsupported)</span>
    UC_MODE_MIPS32R6 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// Mips32r6 ISA (currently unsupported)</span>
    UC_MODE_MIPS32 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>   <span class="token comment">// Mips32 ISA</span>
    UC_MODE_MIPS64 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span>   <span class="token comment">// Mips64 ISA</span>

    <span class="token comment">// x86 / x64</span>
    UC_MODE_16 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 16-bit mode</span>
    UC_MODE_32 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 32-bit mode</span>
    UC_MODE_64 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 64-bit mode</span>

    <span class="token comment">// ppc</span>
    UC_MODE_PPC32 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 32-bit mode</span>
    UC_MODE_PPC64 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 64-bit mode (currently unsupported)</span>
    UC_MODE_QPX <span class="token operator">=</span>
        <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Quad Processing eXtensions mode (currently unsupported)</span>

    <span class="token comment">// sparc</span>
    UC_MODE_SPARC32 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 32-bit mode</span>
    UC_MODE_SPARC64 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 64-bit mode</span>
    UC_MODE_V9 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span>      <span class="token comment">// SparcV9 mode (currently unsupported)</span>

    <span class="token comment">// riscv</span>
    UC_MODE_RISCV32 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 32-bit mode</span>
    UC_MODE_RISCV64 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 64-bit mode</span>

    <span class="token comment">// m68k</span>
<span class="token punctuation">}</span> uc_mode<span class="token punctuation">;</span>
</code></pre>
<h3 id="错误类型"><a name="错误类型" class="plugin-anchor" href="#错误类型"><i class="fa fa-link" aria-hidden="true"></i></a>错误类型</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">// All type of errors encountered by Unicorn API.</span>
<span class="token comment">// These are values returned by uc_errno()</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_err</span> <span class="token punctuation">{</span>
    UC_ERR_OK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment">// No error: everything was fine</span>
    UC_ERR_NOMEM<span class="token punctuation">,</span>          <span class="token comment">// Out-Of-Memory error: uc_open(), uc_emulate()</span>
    UC_ERR_ARCH<span class="token punctuation">,</span>           <span class="token comment">// Unsupported architecture: uc_open()</span>
    UC_ERR_HANDLE<span class="token punctuation">,</span>         <span class="token comment">// Invalid handle</span>
    UC_ERR_MODE<span class="token punctuation">,</span>           <span class="token comment">// Invalid/unsupported mode: uc_open()</span>
    UC_ERR_VERSION<span class="token punctuation">,</span>        <span class="token comment">// Unsupported version (bindings)</span>
    UC_ERR_READ_UNMAPPED<span class="token punctuation">,</span>  <span class="token comment">// Quit emulation due to READ on unmapped memory:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_WRITE_UNMAPPED<span class="token punctuation">,</span> <span class="token comment">// Quit emulation due to WRITE on unmapped memory:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_FETCH_UNMAPPED<span class="token punctuation">,</span> <span class="token comment">// Quit emulation due to FETCH on unmapped memory:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_HOOK<span class="token punctuation">,</span>           <span class="token comment">// Invalid hook type: uc_hook_add()</span>
    UC_ERR_INSN_INVALID<span class="token punctuation">,</span>   <span class="token comment">// Quit emulation due to invalid instruction:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_MAP<span class="token punctuation">,</span>            <span class="token comment">// Invalid memory mapping: uc_mem_map()</span>
    UC_ERR_WRITE_PROT<span class="token punctuation">,</span>     <span class="token comment">// Quit emulation due to UC_MEM_WRITE_PROT violation:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_READ_PROT<span class="token punctuation">,</span>      <span class="token comment">// Quit emulation due to UC_MEM_READ_PROT violation:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_FETCH_PROT<span class="token punctuation">,</span>     <span class="token comment">// Quit emulation due to UC_MEM_FETCH_PROT violation:</span>
                           <span class="token comment">// uc_emu_start()</span>
    UC_ERR_ARG<span class="token punctuation">,</span> <span class="token comment">// Inavalid argument provided to uc_xxx function (See specific</span>
                <span class="token comment">// function API)</span>
    UC_ERR_READ_UNALIGNED<span class="token punctuation">,</span>  <span class="token comment">// Unaligned read</span>
    UC_ERR_WRITE_UNALIGNED<span class="token punctuation">,</span> <span class="token comment">// Unaligned write</span>
    UC_ERR_FETCH_UNALIGNED<span class="token punctuation">,</span> <span class="token comment">// Unaligned fetch</span>
    UC_ERR_HOOK_EXIST<span class="token punctuation">,</span>      <span class="token comment">// hook for this event already existed</span>
    UC_ERR_RESOURCE<span class="token punctuation">,</span>        <span class="token comment">// Insufficient resource: uc_emu_start()</span>
    UC_ERR_EXCEPTION<span class="token punctuation">,</span>       <span class="token comment">// Unhandled CPU exception</span>
<span class="token punctuation">}</span> uc_err<span class="token punctuation">;</span>
</code></pre>
<h3 id="hook类型"><a name="hook类型" class="plugin-anchor" href="#hook类型"><i class="fa fa-link" aria-hidden="true"></i></a>hook类型</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">// All type of hooks for uc_hook_add() API.</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_hook_type</span> <span class="token punctuation">{</span>
    <span class="token comment">// Hook all interrupt/syscall events</span>
    UC_HOOK_INTR <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook a particular instruction - only a very small subset of instructions</span>
    <span class="token comment">// supported here</span>
    UC_HOOK_INSN <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook a range of code</span>
    UC_HOOK_CODE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook basic blocks</span>
    UC_HOOK_BLOCK <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for memory read on unmapped memory</span>
    UC_HOOK_MEM_READ_UNMAPPED <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for invalid memory write events</span>
    UC_HOOK_MEM_WRITE_UNMAPPED <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for invalid memory fetch for execution events</span>
    UC_HOOK_MEM_FETCH_UNMAPPED <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for memory read on read-protected memory</span>
    UC_HOOK_MEM_READ_PROT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for memory write on write-protected memory</span>
    UC_HOOK_MEM_WRITE_PROT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook for memory fetch on non-executable memory</span>
    UC_HOOK_MEM_FETCH_PROT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook memory read events.</span>
    UC_HOOK_MEM_READ <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook memory write events.</span>
    UC_HOOK_MEM_WRITE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">11</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook memory fetch for execution events</span>
    UC_HOOK_MEM_FETCH <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook memory read events, but only successful access.</span>
    <span class="token comment">// The callback will be triggered after successful read.</span>
    UC_HOOK_MEM_READ_AFTER <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook invalid instructions exceptions.</span>
    UC_HOOK_INSN_INVALID <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook on new edge generation. Could be useful in program analysis.</span>
    <span class="token comment">//</span>
    <span class="token comment">// NOTE: This is different from UC_HOOK_BLOCK in 2 ways:</span>
    <span class="token comment">//       1. The hook is called before executing code.</span>
    <span class="token comment">//       2. The hook is only called when generation is triggered.</span>
    UC_HOOK_EDGE_GENERATED <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token comment">// Hook on specific tcg op code. The usage of this hook is similar to</span>
    <span class="token comment">// UC_HOOK_INSN.</span>
    UC_HOOK_TCG_OPCODE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> uc_hook_type<span class="token punctuation">;</span>
</code></pre>
<h2 id="unicornpy"><a name="unicornpy" class="plugin-anchor" href="#unicornpy"><i class="fa fa-link" aria-hidden="true"></i></a>unicorn.py</h2>
<ul>
<li>unicorn.py<ul>
<li>unicorn/unicorn.py at master · unicorn-engine/unicorn · GitHub<ul>
<li><a href="https://github.com/unicorn-engine/unicorn/blob/master/bindings/python/unicorn/unicorn.py" target="_blank">https://github.com/unicorn-engine/unicorn/blob/master/bindings/python/unicorn/unicorn.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="主要函数"><a name="主要函数" class="plugin-anchor" href="#主要函数"><i class="fa fa-link" aria-hidden="true"></i></a>主要函数</h3>
<pre class="language-"><code class="lang-c"><span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_version&quot;</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">)</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_arch_supported&quot;</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_bool<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_open&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>uc_engine<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_close&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_strerror&quot;</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_char_p<span class="token punctuation">,</span> ucerr<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_errno&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_reg_read&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_reg_write&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_read&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_char<span class="token punctuation">)</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_write&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_char<span class="token punctuation">)</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_emu_start&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_emu_stop&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_hook_del&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> uc_hook_h<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mmio_map&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_map&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_map_ptr&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_unmap&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_protect&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_query&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_alloc&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>uc_context<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_free&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_save&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> uc_context<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_restore&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> uc_context<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_size&quot;</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token class-name">c_size_t</span><span class="token punctuation">,</span> uc_engine<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_reg_read&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_context<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_reg_write&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_context<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_context_free&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_context<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_mem_regions&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>_uc_mem_region<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">https</span><span class="token expression"><span class="token operator">:</span></span><span class="token comment">//bugs.python.org/issue42880</span></span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_hook_add&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span><span class="token function">POINTER</span><span class="token punctuation">(</span>uc_hook_h<span class="token punctuation">)</span><span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_void_p<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">)</span>
<span class="token function">_setup_prototype</span><span class="token punctuation">(</span>_uc<span class="token punctuation">,</span> <span class="token string">&quot;uc_ctl&quot;</span><span class="token punctuation">,</span> ucerr<span class="token punctuation">,</span> uc_engine<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">)</span>
</code></pre>
<h2 id="ucprivh"><a name="ucprivh" class="plugin-anchor" href="#ucprivh"><i class="fa fa-link" aria-hidden="true"></i></a>uc_priv.h</h2>
<ul>
<li>uc_priv.h<ul>
<li>unicorn/uc_priv.h at master · unicorn-engine/unicorn · GitHub<ul>
<li><a href="https://github.com/unicorn-engine/unicorn/blob/master/include/uc_priv.h" target="_blank">https://github.com/unicorn-engine/unicorn/blob/master/include/uc_priv.h</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="hook的结构体"><a name="hook的结构体" class="plugin-anchor" href="#hook的结构体"><i class="fa fa-link" aria-hidden="true"></i></a>hook的结构体</h3>
<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">hook</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> type<span class="token punctuation">;</span>       <span class="token comment">// UC_HOOK_*</span>
    <span class="token keyword">int</span> insn<span class="token punctuation">;</span>       <span class="token comment">// instruction for HOOK_INSN</span>
    <span class="token keyword">int</span> refs<span class="token punctuation">;</span>       <span class="token comment">// reference count to free hook stored in multiple lists</span>
    <span class="token keyword">int</span> op<span class="token punctuation">;</span>         <span class="token comment">// opcode for HOOK_TCG_OPCODE</span>
    <span class="token keyword">int</span> op_flags<span class="token punctuation">;</span>   <span class="token comment">// opcode flags for HOOK_TCG_OPCODE</span>
    bool to_delete<span class="token punctuation">;</span> <span class="token comment">// set to true when the hook is deleted by the user. The</span>
                    <span class="token comment">// destruction of the hook is delayed.</span>
    <span class="token class-name">uint64_t</span> begin<span class="token punctuation">,</span> end<span class="token punctuation">;</span> <span class="token comment">// only trigger if PC or memory access is in this</span>
                         <span class="token comment">// address (depends on hook type)</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>callback<span class="token punctuation">;</span>      <span class="token comment">// a uc_cb_* type</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>user_data<span class="token punctuation">;</span>
    GHashTable <span class="token operator">*</span>hooked_regions<span class="token punctuation">;</span> <span class="token comment">// The regions this hook instrumented on</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="hook列表"><a name="hook列表" class="plugin-anchor" href="#hook列表"><i class="fa fa-link" aria-hidden="true"></i></a>hook列表</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">// hook list offsets</span>
<span class="token comment">//</span>
<span class="token comment">// The lowest 6 bits are used for hook type index while the others</span>
<span class="token comment">// are used for hook flags.</span>
<span class="token comment">//</span>
<span class="token comment">// mirrors the order of uc_hook_type from include/unicorn/unicorn.h</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_hook_idx</span> <span class="token punctuation">{</span>
    UC_HOOK_INTR_IDX<span class="token punctuation">,</span>
    UC_HOOK_INSN_IDX<span class="token punctuation">,</span>
    UC_HOOK_CODE_IDX<span class="token punctuation">,</span>
    UC_HOOK_BLOCK_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_READ_UNMAPPED_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_WRITE_UNMAPPED_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_FETCH_UNMAPPED_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_READ_PROT_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_WRITE_PROT_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_FETCH_PROT_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_READ_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_WRITE_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_FETCH_IDX<span class="token punctuation">,</span>
    UC_HOOK_MEM_READ_AFTER_IDX<span class="token punctuation">,</span>
    UC_HOOK_INSN_INVALID_IDX<span class="token punctuation">,</span>
    UC_HOOK_EDGE_GENERATED_IDX<span class="token punctuation">,</span>
    UC_HOOK_TCG_OPCODE_IDX<span class="token punctuation">,</span>

    UC_HOOK_MAX<span class="token punctuation">,</span>
<span class="token punctuation">}</span> uc_hook_idx<span class="token punctuation">;</span>
</code></pre>
<h3 id="unicorn对象的结构体"><a name="unicorn对象的结构体" class="plugin-anchor" href="#unicorn对象的结构体"><i class="fa fa-link" aria-hidden="true"></i></a>unicorn对象的结构体</h3>
<pre class="language-"><code class="lang-c"><span class="token keyword">struct</span> <span class="token class-name">uc_struct</span> <span class="token punctuation">{</span>
    uc_arch arch<span class="token punctuation">;</span>
    uc_mode mode<span class="token punctuation">;</span>
    uc_err errnum<span class="token punctuation">;</span> <span class="token comment">// qemu/cpu-exec.c</span>
    AddressSpace address_space_memory<span class="token punctuation">;</span>
    AddressSpace address_space_io<span class="token punctuation">;</span>
    <span class="token class-name">query_t</span> query<span class="token punctuation">;</span>
    <span class="token class-name">reg_read_t</span> reg_read<span class="token punctuation">;</span>
    <span class="token class-name">reg_write_t</span> reg_write<span class="token punctuation">;</span>
    <span class="token class-name">reg_reset_t</span> reg_reset<span class="token punctuation">;</span>

    <span class="token class-name">uc_write_mem_t</span> write_mem<span class="token punctuation">;</span>
    <span class="token class-name">uc_read_mem_t</span> read_mem<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_void_t</span> release<span class="token punctuation">;</span>  <span class="token comment">// release resource when uc_close()</span>
    <span class="token class-name">uc_args_uc_u64_t</span> set_pc<span class="token punctuation">;</span> <span class="token comment">// set PC for tracecode</span>
    <span class="token class-name">uc_get_pc_t</span> get_pc<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_int_t</span>
        stop_interrupt<span class="token punctuation">;</span> <span class="token comment">// check if the interrupt should stop emulation</span>
    <span class="token class-name">uc_memory_map_io_t</span> memory_map_io<span class="token punctuation">;</span>

    <span class="token class-name">uc_args_uc_t</span> init_arch<span class="token punctuation">,</span> cpu_exec_init_all<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_int_uc_t</span> vm_start<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_uc_long_t</span> tcg_exec_init<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_uc_ram_size_t</span> memory_map<span class="token punctuation">;</span>
    <span class="token class-name">uc_args_uc_ram_size_ptr_t</span> memory_map_ptr<span class="token punctuation">;</span>
    <span class="token class-name">uc_mem_unmap_t</span> memory_unmap<span class="token punctuation">;</span>
    <span class="token class-name">uc_readonly_mem_t</span> readonly_mem<span class="token punctuation">;</span>
    <span class="token class-name">uc_mem_redirect_t</span> mem_redirect<span class="token punctuation">;</span>
    uc_cpus_init cpus_init<span class="token punctuation">;</span>
    uc_target_page_init target_page<span class="token punctuation">;</span>
    uc_softfloat_initialize softfloat_initialize<span class="token punctuation">;</span>
    uc_tcg_flush_tlb tcg_flush_tlb<span class="token punctuation">;</span>
    <span class="token class-name">uc_invalidate_tb_t</span> uc_invalidate_tb<span class="token punctuation">;</span>
    <span class="token class-name">uc_gen_tb_t</span> uc_gen_tb<span class="token punctuation">;</span>
    <span class="token class-name">uc_tb_flush_t</span> tb_flush<span class="token punctuation">;</span>
    <span class="token class-name">uc_add_inline_hook_t</span> add_inline_hook<span class="token punctuation">;</span>
    <span class="token class-name">uc_del_inline_hook_t</span> del_inline_hook<span class="token punctuation">;</span>

    <span class="token class-name">uc_context_size_t</span> context_size<span class="token punctuation">;</span>
    <span class="token class-name">uc_context_save_t</span> context_save<span class="token punctuation">;</span>
    <span class="token class-name">uc_context_restore_t</span> context_restore<span class="token punctuation">;</span>

    <span class="token comment">/*  only 1 cpu in unicorn,
        do not need current_cpu to handle current running cpu. */</span>
    CPUState <span class="token operator">*</span>cpu<span class="token punctuation">;</span>

    uc_insn_hook_validate insn_hook_validate<span class="token punctuation">;</span>
    <span class="token class-name">uc_opcode_hook_validate_t</span> opcode_hook_invalidate<span class="token punctuation">;</span>

    MemoryRegion <span class="token operator">*</span>system_memory<span class="token punctuation">;</span>    <span class="token comment">// qemu/exec.c</span>
    MemoryRegion <span class="token operator">*</span>system_io<span class="token punctuation">;</span>        <span class="token comment">// qemu/exec.c</span>
    MemoryRegion io_mem_unassigned<span class="token punctuation">;</span> <span class="token comment">// qemu/exec.c</span>
    RAMList ram_list<span class="token punctuation">;</span>               <span class="token comment">// qemu/exec.c</span>
    <span class="token comment">/* qemu/exec.c */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> alloc_hint<span class="token punctuation">;</span>
    <span class="token comment">/* qemu/exec-vary.c */</span>
    TargetPageBits <span class="token operator">*</span>init_target_page<span class="token punctuation">;</span>
    <span class="token keyword">int</span> target_bits<span class="token punctuation">;</span> <span class="token comment">// User defined page bits by uc_ctl</span>
    <span class="token keyword">int</span> cpu_model<span class="token punctuation">;</span>
    BounceBuffer bounce<span class="token punctuation">;</span>                <span class="token comment">// qemu/cpu-exec.c</span>
    <span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> exit_request<span class="token punctuation">;</span> <span class="token comment">// qemu/cpu-exec.c</span>
    <span class="token comment">/* qemu/accel/tcg/cpu-exec-common.c */</span>
    <span class="token comment">/* always be true after call tcg_exec_init(). */</span>
    bool tcg_allowed<span class="token punctuation">;</span>
    <span class="token comment">/* This is a multi-level map on the virtual address space.
       The bottom level has pointers to PageDesc.  */</span>
    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>l1_map<span class="token punctuation">;</span> <span class="token comment">// qemu/accel/tcg/translate-all.c</span>
    <span class="token class-name">size_t</span> l1_map_size<span class="token punctuation">;</span>
    <span class="token comment">/* qemu/accel/tcg/translate-all.c */</span>
    <span class="token keyword">int</span> v_l1_size<span class="token punctuation">;</span>
    <span class="token keyword">int</span> v_l1_shift<span class="token punctuation">;</span>
    <span class="token keyword">int</span> v_l2_levels<span class="token punctuation">;</span>
    <span class="token comment">/* code generation context */</span>
    TCGContext <span class="token operator">*</span>tcg_ctx<span class="token punctuation">;</span>
    <span class="token comment">/* memory.c */</span>
    <span class="token function">QTAILQ_HEAD</span><span class="token punctuation">(</span>memory_listeners<span class="token punctuation">,</span> MemoryListener<span class="token punctuation">)</span> memory_listeners<span class="token punctuation">;</span>
    <span class="token function">QTAILQ_HEAD</span><span class="token punctuation">(</span><span class="token punctuation">,</span> AddressSpace<span class="token punctuation">)</span> address_spaces<span class="token punctuation">;</span>
    GHashTable <span class="token operator">*</span>flat_views<span class="token punctuation">;</span>
    bool memory_region_update_pending<span class="token punctuation">;</span>

    <span class="token comment">// linked lists containing hooks per type</span>
    <span class="token keyword">struct</span> <span class="token class-name">list</span> hook<span class="token punctuation">[</span>UC_HOOK_MAX<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">list</span> hooks_to_del<span class="token punctuation">;</span>
    <span class="token keyword">int</span> hooks_count<span class="token punctuation">[</span>UC_HOOK_MAX<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// hook to count number of instructions for uc_emu_start()</span>
    uc_hook count_hook<span class="token punctuation">;</span>

    <span class="token class-name">size_t</span> emu_counter<span class="token punctuation">;</span> <span class="token comment">// current counter of uc_emu_start()</span>
    <span class="token class-name">size_t</span> emu_count<span class="token punctuation">;</span>   <span class="token comment">// save counter of uc_emu_start()</span>

    <span class="token keyword">int</span> size_recur_mem<span class="token punctuation">;</span> <span class="token comment">// size for mem access when in a recursive call</span>

    bool init_tcg<span class="token punctuation">;</span>       <span class="token comment">// already initialized local TCGv variables?</span>
    bool stop_request<span class="token punctuation">;</span>   <span class="token comment">// request to immediately stop emulation - for</span>
                         <span class="token comment">// uc_emu_stop()</span>
    bool quit_request<span class="token punctuation">;</span>   <span class="token comment">// request to quit the current TB, but continue to</span>
                         <span class="token comment">// emulate - for uc_mem_protect()</span>
    bool emulation_done<span class="token punctuation">;</span> <span class="token comment">// emulation is done by uc_emu_start()</span>
    bool timed_out<span class="token punctuation">;</span>      <span class="token comment">// emulation timed out, that can retrieve via</span>
                         <span class="token comment">// uc_query(UC_QUERY_TIMEOUT)</span>
    QemuThread timer<span class="token punctuation">;</span>    <span class="token comment">// timer for emulation timeout</span>
    <span class="token class-name">uint64_t</span> timeout<span class="token punctuation">;</span>    <span class="token comment">// timeout for uc_emu_start()</span>

    <span class="token class-name">uint64_t</span> invalid_addr<span class="token punctuation">;</span> <span class="token comment">// invalid address to be accessed</span>
    <span class="token keyword">int</span> invalid_error<span class="token punctuation">;</span>     <span class="token comment">// invalid memory code: 1 = READ, 2 = WRITE, 3 = CODE</span>

    <span class="token keyword">int</span> use_exits<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> exits<span class="token punctuation">[</span>UC_MAX_NESTED_LEVEL<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// When multiple exits is not enabled.</span>
    GTree <span class="token operator">*</span>ctl_exits<span class="token punctuation">;</span> <span class="token comment">// addresses where emulation stops (@until param of</span>
                      <span class="token comment">// uc_emu_start()) Also see UC_CTL_USE_EXITS for more</span>
                      <span class="token comment">// details.</span>

    <span class="token keyword">int</span> thumb<span class="token punctuation">;</span> <span class="token comment">// thumb mode for ARM</span>
    MemoryRegion <span class="token operator">*</span><span class="token operator">*</span>mapped_blocks<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> mapped_block_count<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> mapped_block_cache_index<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>qemu_thread_data<span class="token punctuation">;</span> <span class="token comment">// to support cross compile to Windows</span>
                            <span class="token comment">// (qemu-thread-win32.c)</span>
    <span class="token class-name">uint32_t</span> target_page_size<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> target_page_align<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> qemu_host_page_size<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> qemu_real_host_page_size<span class="token punctuation">;</span>
    <span class="token keyword">int</span> qemu_icache_linesize<span class="token punctuation">;</span>
    <span class="token comment">/* ARCH_REGS_STORAGE_SIZE */</span>
    <span class="token keyword">int</span> cpu_context_size<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> next_pc<span class="token punctuation">;</span> <span class="token comment">// save next PC for some special cases</span>
    bool hook_insert<span class="token punctuation">;</span> <span class="token comment">// insert new hook at begin of the hook list (append by</span>
                      <span class="token comment">// default)</span>
    bool first_tb<span class="token punctuation">;</span> <span class="token comment">// is this the first Translation-Block ever generated since</span>
                   <span class="token comment">// uc_emu_start()?</span>
    bool no_exit_request<span class="token punctuation">;</span> <span class="token comment">// Disable check_exit_request temporarily. A</span>
                          <span class="token comment">// workaround to treat the IT block as a whole block.</span>
    bool init_done<span class="token punctuation">;</span>       <span class="token comment">// Whether the initialization is done.</span>

    sigjmp_buf jmp_bufs<span class="token punctuation">[</span>UC_MAX_NESTED_LEVEL<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// To support nested uc_emu_start</span>
    <span class="token keyword">int</span> nested_level<span class="token punctuation">;</span>                         <span class="token comment">// Current nested_level</span>

    <span class="token keyword">struct</span> <span class="token class-name">TranslationBlock</span> <span class="token operator">*</span>last_tb<span class="token punctuation">;</span> <span class="token comment">// The real last tb we executed.</span>

    FlatView <span class="token operator">*</span>empty_view<span class="token punctuation">;</span> <span class="token comment">// Static function variable moved from flatviews_init</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="arm64h"><a name="arm64h" class="plugin-anchor" href="#arm64h"><i class="fa fa-link" aria-hidden="true"></i></a>arm64.h</h2>
<ul>
<li>arm64.h<ul>
<li>unicorn/arm64.h at master · unicorn-engine/unicorn · GitHub<ul>
<li><a href="https://github.com/unicorn-engine/unicorn/blob/master/include/unicorn/arm64.h" target="_blank">https://github.com/unicorn-engine/unicorn/blob/master/include/unicorn/arm64.h</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="arm64寄存器"><a name="arm64寄存器" class="plugin-anchor" href="#arm64寄存器"><i class="fa fa-link" aria-hidden="true"></i></a>arm64寄存器</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">//&gt; ARM64 registers</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_arm64_reg</span> <span class="token punctuation">{</span>
    UC_ARM64_REG_INVALID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>

    UC_ARM64_REG_X29<span class="token punctuation">,</span>
    UC_ARM64_REG_X30<span class="token punctuation">,</span>
    UC_ARM64_REG_NZCV<span class="token punctuation">,</span>
    UC_ARM64_REG_SP<span class="token punctuation">,</span>
    UC_ARM64_REG_WSP<span class="token punctuation">,</span>
    UC_ARM64_REG_WZR<span class="token punctuation">,</span>
    UC_ARM64_REG_XZR<span class="token punctuation">,</span>
    UC_ARM64_REG_B0<span class="token punctuation">,</span>
    UC_ARM64_REG_B1<span class="token punctuation">,</span>
    UC_ARM64_REG_B2<span class="token punctuation">,</span>
    UC_ARM64_REG_B3<span class="token punctuation">,</span>
    UC_ARM64_REG_B4<span class="token punctuation">,</span>
    UC_ARM64_REG_B5<span class="token punctuation">,</span>
    UC_ARM64_REG_B6<span class="token punctuation">,</span>
    UC_ARM64_REG_B7<span class="token punctuation">,</span>
    UC_ARM64_REG_B8<span class="token punctuation">,</span>
    UC_ARM64_REG_B9<span class="token punctuation">,</span>
    UC_ARM64_REG_B10<span class="token punctuation">,</span>
    UC_ARM64_REG_B11<span class="token punctuation">,</span>
    UC_ARM64_REG_B12<span class="token punctuation">,</span>
    UC_ARM64_REG_B13<span class="token punctuation">,</span>
    UC_ARM64_REG_B14<span class="token punctuation">,</span>
    UC_ARM64_REG_B15<span class="token punctuation">,</span>
    UC_ARM64_REG_B16<span class="token punctuation">,</span>
    UC_ARM64_REG_B17<span class="token punctuation">,</span>
    UC_ARM64_REG_B18<span class="token punctuation">,</span>
    UC_ARM64_REG_B19<span class="token punctuation">,</span>
    UC_ARM64_REG_B20<span class="token punctuation">,</span>
    UC_ARM64_REG_B21<span class="token punctuation">,</span>
    UC_ARM64_REG_B22<span class="token punctuation">,</span>
    UC_ARM64_REG_B23<span class="token punctuation">,</span>
    UC_ARM64_REG_B24<span class="token punctuation">,</span>
    UC_ARM64_REG_B25<span class="token punctuation">,</span>
    UC_ARM64_REG_B26<span class="token punctuation">,</span>
    UC_ARM64_REG_B27<span class="token punctuation">,</span>
    UC_ARM64_REG_B28<span class="token punctuation">,</span>
    UC_ARM64_REG_B29<span class="token punctuation">,</span>
    UC_ARM64_REG_B30<span class="token punctuation">,</span>
    UC_ARM64_REG_B31<span class="token punctuation">,</span>
    UC_ARM64_REG_D0<span class="token punctuation">,</span>
    UC_ARM64_REG_D1<span class="token punctuation">,</span>
    UC_ARM64_REG_D2<span class="token punctuation">,</span>
    UC_ARM64_REG_D3<span class="token punctuation">,</span>
    UC_ARM64_REG_D4<span class="token punctuation">,</span>
    UC_ARM64_REG_D5<span class="token punctuation">,</span>
    UC_ARM64_REG_D6<span class="token punctuation">,</span>
    UC_ARM64_REG_D7<span class="token punctuation">,</span>
    UC_ARM64_REG_D8<span class="token punctuation">,</span>
    UC_ARM64_REG_D9<span class="token punctuation">,</span>
    UC_ARM64_REG_D10<span class="token punctuation">,</span>
    UC_ARM64_REG_D11<span class="token punctuation">,</span>
    UC_ARM64_REG_D12<span class="token punctuation">,</span>
    UC_ARM64_REG_D13<span class="token punctuation">,</span>
    UC_ARM64_REG_D14<span class="token punctuation">,</span>
    UC_ARM64_REG_D15<span class="token punctuation">,</span>
    UC_ARM64_REG_D16<span class="token punctuation">,</span>
    UC_ARM64_REG_D17<span class="token punctuation">,</span>
    UC_ARM64_REG_D18<span class="token punctuation">,</span>
    UC_ARM64_REG_D19<span class="token punctuation">,</span>
    UC_ARM64_REG_D20<span class="token punctuation">,</span>
    UC_ARM64_REG_D21<span class="token punctuation">,</span>
    UC_ARM64_REG_D22<span class="token punctuation">,</span>
    UC_ARM64_REG_D23<span class="token punctuation">,</span>
    UC_ARM64_REG_D24<span class="token punctuation">,</span>
    UC_ARM64_REG_D25<span class="token punctuation">,</span>
    UC_ARM64_REG_D26<span class="token punctuation">,</span>
    UC_ARM64_REG_D27<span class="token punctuation">,</span>
    UC_ARM64_REG_D28<span class="token punctuation">,</span>
    UC_ARM64_REG_D29<span class="token punctuation">,</span>
    UC_ARM64_REG_D30<span class="token punctuation">,</span>
    UC_ARM64_REG_D31<span class="token punctuation">,</span>
    UC_ARM64_REG_H0<span class="token punctuation">,</span>
    UC_ARM64_REG_H1<span class="token punctuation">,</span>
    UC_ARM64_REG_H2<span class="token punctuation">,</span>
    UC_ARM64_REG_H3<span class="token punctuation">,</span>
    UC_ARM64_REG_H4<span class="token punctuation">,</span>
    UC_ARM64_REG_H5<span class="token punctuation">,</span>
    UC_ARM64_REG_H6<span class="token punctuation">,</span>
    UC_ARM64_REG_H7<span class="token punctuation">,</span>
    UC_ARM64_REG_H8<span class="token punctuation">,</span>
    UC_ARM64_REG_H9<span class="token punctuation">,</span>
    UC_ARM64_REG_H10<span class="token punctuation">,</span>
    UC_ARM64_REG_H11<span class="token punctuation">,</span>
    UC_ARM64_REG_H12<span class="token punctuation">,</span>
    UC_ARM64_REG_H13<span class="token punctuation">,</span>
    UC_ARM64_REG_H14<span class="token punctuation">,</span>
    UC_ARM64_REG_H15<span class="token punctuation">,</span>
    UC_ARM64_REG_H16<span class="token punctuation">,</span>
    UC_ARM64_REG_H17<span class="token punctuation">,</span>
    UC_ARM64_REG_H18<span class="token punctuation">,</span>
    UC_ARM64_REG_H19<span class="token punctuation">,</span>
    UC_ARM64_REG_H20<span class="token punctuation">,</span>
    UC_ARM64_REG_H21<span class="token punctuation">,</span>
    UC_ARM64_REG_H22<span class="token punctuation">,</span>
    UC_ARM64_REG_H23<span class="token punctuation">,</span>
    UC_ARM64_REG_H24<span class="token punctuation">,</span>
    UC_ARM64_REG_H25<span class="token punctuation">,</span>
    UC_ARM64_REG_H26<span class="token punctuation">,</span>
    UC_ARM64_REG_H27<span class="token punctuation">,</span>
    UC_ARM64_REG_H28<span class="token punctuation">,</span>
    UC_ARM64_REG_H29<span class="token punctuation">,</span>
    UC_ARM64_REG_H30<span class="token punctuation">,</span>
    UC_ARM64_REG_H31<span class="token punctuation">,</span>
    UC_ARM64_REG_Q0<span class="token punctuation">,</span>
    UC_ARM64_REG_Q1<span class="token punctuation">,</span>
    UC_ARM64_REG_Q2<span class="token punctuation">,</span>
    UC_ARM64_REG_Q3<span class="token punctuation">,</span>
    UC_ARM64_REG_Q4<span class="token punctuation">,</span>
    UC_ARM64_REG_Q5<span class="token punctuation">,</span>
    UC_ARM64_REG_Q6<span class="token punctuation">,</span>
    UC_ARM64_REG_Q7<span class="token punctuation">,</span>
    UC_ARM64_REG_Q8<span class="token punctuation">,</span>
    UC_ARM64_REG_Q9<span class="token punctuation">,</span>
    UC_ARM64_REG_Q10<span class="token punctuation">,</span>
    UC_ARM64_REG_Q11<span class="token punctuation">,</span>
    UC_ARM64_REG_Q12<span class="token punctuation">,</span>
    UC_ARM64_REG_Q13<span class="token punctuation">,</span>
    UC_ARM64_REG_Q14<span class="token punctuation">,</span>
    UC_ARM64_REG_Q15<span class="token punctuation">,</span>
    UC_ARM64_REG_Q16<span class="token punctuation">,</span>
    UC_ARM64_REG_Q17<span class="token punctuation">,</span>
    UC_ARM64_REG_Q18<span class="token punctuation">,</span>
    UC_ARM64_REG_Q19<span class="token punctuation">,</span>
    UC_ARM64_REG_Q20<span class="token punctuation">,</span>
    UC_ARM64_REG_Q21<span class="token punctuation">,</span>
    UC_ARM64_REG_Q22<span class="token punctuation">,</span>
    UC_ARM64_REG_Q23<span class="token punctuation">,</span>
    UC_ARM64_REG_Q24<span class="token punctuation">,</span>
    UC_ARM64_REG_Q25<span class="token punctuation">,</span>
    UC_ARM64_REG_Q26<span class="token punctuation">,</span>
    UC_ARM64_REG_Q27<span class="token punctuation">,</span>
    UC_ARM64_REG_Q28<span class="token punctuation">,</span>
    UC_ARM64_REG_Q29<span class="token punctuation">,</span>
    UC_ARM64_REG_Q30<span class="token punctuation">,</span>
    UC_ARM64_REG_Q31<span class="token punctuation">,</span>
    UC_ARM64_REG_S0<span class="token punctuation">,</span>
    UC_ARM64_REG_S1<span class="token punctuation">,</span>
    UC_ARM64_REG_S2<span class="token punctuation">,</span>
    UC_ARM64_REG_S3<span class="token punctuation">,</span>
    UC_ARM64_REG_S4<span class="token punctuation">,</span>
    UC_ARM64_REG_S5<span class="token punctuation">,</span>
    UC_ARM64_REG_S6<span class="token punctuation">,</span>
    UC_ARM64_REG_S7<span class="token punctuation">,</span>
    UC_ARM64_REG_S8<span class="token punctuation">,</span>
    UC_ARM64_REG_S9<span class="token punctuation">,</span>
    UC_ARM64_REG_S10<span class="token punctuation">,</span>
    UC_ARM64_REG_S11<span class="token punctuation">,</span>
    UC_ARM64_REG_S12<span class="token punctuation">,</span>
    UC_ARM64_REG_S13<span class="token punctuation">,</span>
    UC_ARM64_REG_S14<span class="token punctuation">,</span>
    UC_ARM64_REG_S15<span class="token punctuation">,</span>
    UC_ARM64_REG_S16<span class="token punctuation">,</span>
    UC_ARM64_REG_S17<span class="token punctuation">,</span>
    UC_ARM64_REG_S18<span class="token punctuation">,</span>
    UC_ARM64_REG_S19<span class="token punctuation">,</span>
    UC_ARM64_REG_S20<span class="token punctuation">,</span>
    UC_ARM64_REG_S21<span class="token punctuation">,</span>
    UC_ARM64_REG_S22<span class="token punctuation">,</span>
    UC_ARM64_REG_S23<span class="token punctuation">,</span>
    UC_ARM64_REG_S24<span class="token punctuation">,</span>
    UC_ARM64_REG_S25<span class="token punctuation">,</span>
    UC_ARM64_REG_S26<span class="token punctuation">,</span>
    UC_ARM64_REG_S27<span class="token punctuation">,</span>
    UC_ARM64_REG_S28<span class="token punctuation">,</span>
    UC_ARM64_REG_S29<span class="token punctuation">,</span>
    UC_ARM64_REG_S30<span class="token punctuation">,</span>
    UC_ARM64_REG_S31<span class="token punctuation">,</span>
    UC_ARM64_REG_W0<span class="token punctuation">,</span>
    UC_ARM64_REG_W1<span class="token punctuation">,</span>
    UC_ARM64_REG_W2<span class="token punctuation">,</span>
    UC_ARM64_REG_W3<span class="token punctuation">,</span>
    UC_ARM64_REG_W4<span class="token punctuation">,</span>
    UC_ARM64_REG_W5<span class="token punctuation">,</span>
    UC_ARM64_REG_W6<span class="token punctuation">,</span>
    UC_ARM64_REG_W7<span class="token punctuation">,</span>
    UC_ARM64_REG_W8<span class="token punctuation">,</span>
    UC_ARM64_REG_W9<span class="token punctuation">,</span>
    UC_ARM64_REG_W10<span class="token punctuation">,</span>
    UC_ARM64_REG_W11<span class="token punctuation">,</span>
    UC_ARM64_REG_W12<span class="token punctuation">,</span>
    UC_ARM64_REG_W13<span class="token punctuation">,</span>
    UC_ARM64_REG_W14<span class="token punctuation">,</span>
    UC_ARM64_REG_W15<span class="token punctuation">,</span>
    UC_ARM64_REG_W16<span class="token punctuation">,</span>
    UC_ARM64_REG_W17<span class="token punctuation">,</span>
    UC_ARM64_REG_W18<span class="token punctuation">,</span>
    UC_ARM64_REG_W19<span class="token punctuation">,</span>
    UC_ARM64_REG_W20<span class="token punctuation">,</span>
    UC_ARM64_REG_W21<span class="token punctuation">,</span>
    UC_ARM64_REG_W22<span class="token punctuation">,</span>
    UC_ARM64_REG_W23<span class="token punctuation">,</span>
    UC_ARM64_REG_W24<span class="token punctuation">,</span>
    UC_ARM64_REG_W25<span class="token punctuation">,</span>
    UC_ARM64_REG_W26<span class="token punctuation">,</span>
    UC_ARM64_REG_W27<span class="token punctuation">,</span>
    UC_ARM64_REG_W28<span class="token punctuation">,</span>
    UC_ARM64_REG_W29<span class="token punctuation">,</span>
    UC_ARM64_REG_W30<span class="token punctuation">,</span>
    UC_ARM64_REG_X0<span class="token punctuation">,</span>
    UC_ARM64_REG_X1<span class="token punctuation">,</span>
    UC_ARM64_REG_X2<span class="token punctuation">,</span>
    UC_ARM64_REG_X3<span class="token punctuation">,</span>
    UC_ARM64_REG_X4<span class="token punctuation">,</span>
    UC_ARM64_REG_X5<span class="token punctuation">,</span>
    UC_ARM64_REG_X6<span class="token punctuation">,</span>
    UC_ARM64_REG_X7<span class="token punctuation">,</span>
    UC_ARM64_REG_X8<span class="token punctuation">,</span>
    UC_ARM64_REG_X9<span class="token punctuation">,</span>
    UC_ARM64_REG_X10<span class="token punctuation">,</span>
    UC_ARM64_REG_X11<span class="token punctuation">,</span>
    UC_ARM64_REG_X12<span class="token punctuation">,</span>
    UC_ARM64_REG_X13<span class="token punctuation">,</span>
    UC_ARM64_REG_X14<span class="token punctuation">,</span>
    UC_ARM64_REG_X15<span class="token punctuation">,</span>
    UC_ARM64_REG_X16<span class="token punctuation">,</span>
    UC_ARM64_REG_X17<span class="token punctuation">,</span>
    UC_ARM64_REG_X18<span class="token punctuation">,</span>
    UC_ARM64_REG_X19<span class="token punctuation">,</span>
    UC_ARM64_REG_X20<span class="token punctuation">,</span>
    UC_ARM64_REG_X21<span class="token punctuation">,</span>
    UC_ARM64_REG_X22<span class="token punctuation">,</span>
    UC_ARM64_REG_X23<span class="token punctuation">,</span>
    UC_ARM64_REG_X24<span class="token punctuation">,</span>
    UC_ARM64_REG_X25<span class="token punctuation">,</span>
    UC_ARM64_REG_X26<span class="token punctuation">,</span>
    UC_ARM64_REG_X27<span class="token punctuation">,</span>
    UC_ARM64_REG_X28<span class="token punctuation">,</span>

    UC_ARM64_REG_V0<span class="token punctuation">,</span>
    UC_ARM64_REG_V1<span class="token punctuation">,</span>
    UC_ARM64_REG_V2<span class="token punctuation">,</span>
    UC_ARM64_REG_V3<span class="token punctuation">,</span>
    UC_ARM64_REG_V4<span class="token punctuation">,</span>
    UC_ARM64_REG_V5<span class="token punctuation">,</span>
    UC_ARM64_REG_V6<span class="token punctuation">,</span>
    UC_ARM64_REG_V7<span class="token punctuation">,</span>
    UC_ARM64_REG_V8<span class="token punctuation">,</span>
    UC_ARM64_REG_V9<span class="token punctuation">,</span>
    UC_ARM64_REG_V10<span class="token punctuation">,</span>
    UC_ARM64_REG_V11<span class="token punctuation">,</span>
    UC_ARM64_REG_V12<span class="token punctuation">,</span>
    UC_ARM64_REG_V13<span class="token punctuation">,</span>
    UC_ARM64_REG_V14<span class="token punctuation">,</span>
    UC_ARM64_REG_V15<span class="token punctuation">,</span>
    UC_ARM64_REG_V16<span class="token punctuation">,</span>
    UC_ARM64_REG_V17<span class="token punctuation">,</span>
    UC_ARM64_REG_V18<span class="token punctuation">,</span>
    UC_ARM64_REG_V19<span class="token punctuation">,</span>
    UC_ARM64_REG_V20<span class="token punctuation">,</span>
    UC_ARM64_REG_V21<span class="token punctuation">,</span>
    UC_ARM64_REG_V22<span class="token punctuation">,</span>
    UC_ARM64_REG_V23<span class="token punctuation">,</span>
    UC_ARM64_REG_V24<span class="token punctuation">,</span>
    UC_ARM64_REG_V25<span class="token punctuation">,</span>
    UC_ARM64_REG_V26<span class="token punctuation">,</span>
    UC_ARM64_REG_V27<span class="token punctuation">,</span>
    UC_ARM64_REG_V28<span class="token punctuation">,</span>
    UC_ARM64_REG_V29<span class="token punctuation">,</span>
    UC_ARM64_REG_V30<span class="token punctuation">,</span>
    UC_ARM64_REG_V31<span class="token punctuation">,</span>

    <span class="token comment">//&gt; pseudo registers</span>
    UC_ARM64_REG_PC<span class="token punctuation">,</span> <span class="token comment">// program counter register</span>

    UC_ARM64_REG_CPACR_EL1<span class="token punctuation">,</span>

    <span class="token comment">//&gt; thread registers, depreciated, use UC_ARM64_REG_CP_REG instead</span>
    UC_ARM64_REG_TPIDR_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_TPIDRRO_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_TPIDR_EL1<span class="token punctuation">,</span>

    UC_ARM64_REG_PSTATE<span class="token punctuation">,</span>

    <span class="token comment">//&gt; exception link registers, depreciated, use UC_ARM64_REG_CP_REG instead</span>
    UC_ARM64_REG_ELR_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_ELR_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_ELR_EL2<span class="token punctuation">,</span>
    UC_ARM64_REG_ELR_EL3<span class="token punctuation">,</span>

    <span class="token comment">//&gt; stack pointers registers, depreciated, use UC_ARM64_REG_CP_REG instead</span>
    UC_ARM64_REG_SP_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_SP_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_SP_EL2<span class="token punctuation">,</span>
    UC_ARM64_REG_SP_EL3<span class="token punctuation">,</span>

    <span class="token comment">//&gt; other CP15 registers, depreciated, use UC_ARM64_REG_CP_REG instead</span>
    UC_ARM64_REG_TTBR0_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_TTBR1_EL1<span class="token punctuation">,</span>

    UC_ARM64_REG_ESR_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_ESR_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_ESR_EL2<span class="token punctuation">,</span>
    UC_ARM64_REG_ESR_EL3<span class="token punctuation">,</span>

    UC_ARM64_REG_FAR_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_FAR_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_FAR_EL2<span class="token punctuation">,</span>
    UC_ARM64_REG_FAR_EL3<span class="token punctuation">,</span>

    UC_ARM64_REG_PAR_EL1<span class="token punctuation">,</span>

    UC_ARM64_REG_MAIR_EL1<span class="token punctuation">,</span>

    UC_ARM64_REG_VBAR_EL0<span class="token punctuation">,</span>
    UC_ARM64_REG_VBAR_EL1<span class="token punctuation">,</span>
    UC_ARM64_REG_VBAR_EL2<span class="token punctuation">,</span>
    UC_ARM64_REG_VBAR_EL3<span class="token punctuation">,</span>

    UC_ARM64_REG_CP_REG<span class="token punctuation">,</span>

    <span class="token comment">//&gt; floating point control and status registers</span>
    UC_ARM64_REG_FPCR<span class="token punctuation">,</span>
    UC_ARM64_REG_FPSR<span class="token punctuation">,</span>

    UC_ARM64_REG_ENDING<span class="token punctuation">,</span> <span class="token comment">// &lt;-- mark the end of the list of registers</span>

    <span class="token comment">//&gt; alias registers</span>

    UC_ARM64_REG_IP0 <span class="token operator">=</span> UC_ARM64_REG_X16<span class="token punctuation">,</span>
    UC_ARM64_REG_IP1 <span class="token operator">=</span> UC_ARM64_REG_X17<span class="token punctuation">,</span>
    UC_ARM64_REG_FP <span class="token operator">=</span> UC_ARM64_REG_X29<span class="token punctuation">,</span>
    UC_ARM64_REG_LR <span class="token operator">=</span> UC_ARM64_REG_X30<span class="token punctuation">,</span>
<span class="token punctuation">}</span> uc_arm64_reg<span class="token punctuation">;</span>
</code></pre>
<h3 id="arm64指令（支持hook的指令）"><a name="arm64指令（支持hook的指令）" class="plugin-anchor" href="#arm64指令（支持hook的指令）"><i class="fa fa-link" aria-hidden="true"></i></a>arm64指令（支持hook的指令）</h3>
<pre class="language-"><code class="lang-c"><span class="token comment">//&gt; ARM64 instructions</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_arm64_insn</span> <span class="token punctuation">{</span>
    UC_ARM64_INS_INVALID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>

    UC_ARM64_INS_MRS<span class="token punctuation">,</span>
    UC_ARM64_INS_MSR<span class="token punctuation">,</span>
    UC_ARM64_INS_SYS<span class="token punctuation">,</span>
    UC_ARM64_INS_SYSL<span class="token punctuation">,</span>

    UC_ARM64_INS_ENDING
<span class="token punctuation">}</span> uc_arm64_insn<span class="token punctuation">;</span>
</code></pre>
<h2 id="unicorn相关错误"><a name="unicorn相关错误" class="plugin-anchor" href="#unicorn相关错误"><i class="fa fa-link" aria-hidden="true"></i></a>Unicorn相关错误</h2>
<ul>
<li><a href="https://www.jianshu.com/p/e6a7b30c1e89" target="_blank">unicorn - 简书 (jianshu.com) </a></li>
</ul>
<pre class="language-"><code class="lang-c"><span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token class-name">uc_err</span> <span class="token punctuation">{</span>
    UC_ERR_OK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token comment">// 无错误</span>
    UC_ERR_NOMEM<span class="token punctuation">,</span>      <span class="token comment">// 内存不足: uc_open(), uc_emulate()</span>
    UC_ERR_ARCH<span class="token punctuation">,</span>     <span class="token comment">// 不支持的架构: uc_open()</span>
    UC_ERR_HANDLE<span class="token punctuation">,</span>   <span class="token comment">// 不可用句柄</span>
    UC_ERR_MODE<span class="token punctuation">,</span>     <span class="token comment">// 不可用/不支持架构: uc_open()</span>
    UC_ERR_VERSION<span class="token punctuation">,</span>  <span class="token comment">// 不支持版本 (中间件)</span>
    UC_ERR_READ_UNMAPPED<span class="token punctuation">,</span> <span class="token comment">// 由于在未映射的内存上读取而退出模拟: uc_emu_start()</span>
    UC_ERR_WRITE_UNMAPPED<span class="token punctuation">,</span> <span class="token comment">// 由于在未映射的内存上写入而退出模拟: uc_emu_start()</span>
    UC_ERR_FETCH_UNMAPPED<span class="token punctuation">,</span> <span class="token comment">// 由于在未映射的内存中获取数据而退出模拟: uc_emu_start()</span>
    UC_ERR_HOOK<span class="token punctuation">,</span>    <span class="token comment">// 无效的hook类型: uc_hook_add()</span>
    UC_ERR_INSN_INVALID<span class="token punctuation">,</span> <span class="token comment">// 由于指令无效而退出模拟: uc_emu_start()</span>
    UC_ERR_MAP<span class="token punctuation">,</span> <span class="token comment">// 无效的内存映射: uc_mem_map()</span>
    UC_ERR_WRITE_PROT<span class="token punctuation">,</span> <span class="token comment">// 由于UC_MEM_WRITE_PROT冲突而停止模拟: uc_emu_start()</span>
    UC_ERR_READ_PROT<span class="token punctuation">,</span> <span class="token comment">// 由于UC_MEM_READ_PROT冲突而停止模拟: uc_emu_start()</span>
    UC_ERR_FETCH_PROT<span class="token punctuation">,</span> <span class="token comment">// 由于UC_MEM_FETCH_PROT冲突而停止模拟: uc_emu_start()</span>
    UC_ERR_ARG<span class="token punctuation">,</span>     <span class="token comment">// 提供给uc_xxx函数的无效参数</span>
    UC_ERR_READ_UNALIGNED<span class="token punctuation">,</span>  <span class="token comment">// 未对齐读取</span>
    UC_ERR_WRITE_UNALIGNED<span class="token punctuation">,</span>  <span class="token comment">// 未对齐写入</span>
    UC_ERR_FETCH_UNALIGNED<span class="token punctuation">,</span>  <span class="token comment">// 未对齐的提取</span>
    UC_ERR_HOOK_EXIST<span class="token punctuation">,</span>  <span class="token comment">// 此事件的钩子已经存在</span>
    UC_ERR_RESOURCE<span class="token punctuation">,</span>    <span class="token comment">// 资源不足: uc_emu_start()</span>
    UC_ERR_EXCEPTION<span class="token punctuation">,</span> <span class="token comment">// 未处理的CPU异常</span>
    UC_ERR_TIMEOUT <span class="token comment">// 模拟超时</span>
<span class="token punctuation">}</span> uc_err<span class="token punctuation">;</span>
</code></pre>
<ul>
<li><a href="https://rev.ng/gitlab/angr/unicorn/raw/dca32a875e14e35403c62c82c7c15f46c5ef450c/uc.c" target="_blank">https://rev.ng/gitlab/angr/unicorn/raw/dca32a875e14e35403c62c82c7c15f46c5ef450c/uc.c</a></li>
</ul>
<pre class="language-"><code class="lang-c">UNICORN_EXPORT
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">uc_strerror</span><span class="token punctuation">(</span>uc_err code<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Unknown error code&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_OK<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;OK (UC_ERR_OK)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_NOMEM<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;No memory available or memory not present (UC_ERR_NOMEM)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_ARCH<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid/unsupported architecture (UC_ERR_ARCH)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_HANDLE<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid handle (UC_ERR_HANDLE)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_MODE<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid mode (UC_ERR_MODE)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_VERSION<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Different API version between core &amp; binding (UC_ERR_VERSION)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_READ_UNMAPPED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid memory read (UC_ERR_READ_UNMAPPED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_WRITE_UNMAPPED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid memory write (UC_ERR_WRITE_UNMAPPED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_FETCH_UNMAPPED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid memory fetch (UC_ERR_FETCH_UNMAPPED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_HOOK<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid hook type (UC_ERR_HOOK)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_INSN_INVALID<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid instruction (UC_ERR_INSN_INVALID)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_MAP<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid memory mapping (UC_ERR_MAP)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_WRITE_PROT<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Write to write-protected memory (UC_ERR_WRITE_PROT)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_READ_PROT<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Read from non-readable memory (UC_ERR_READ_PROT)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_FETCH_PROT<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Fetch from non-executable memory (UC_ERR_FETCH_PROT)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_ARG<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Invalid argument (UC_ERR_ARG)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_READ_UNALIGNED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Read from unaligned memory (UC_ERR_READ_UNALIGNED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_WRITE_UNALIGNED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Write to unaligned memory (UC_ERR_WRITE_UNALIGNED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_FETCH_UNALIGNED<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Fetch from unaligned memory (UC_ERR_FETCH_UNALIGNED)&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UC_ERR_RESOURCE<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Insufficient resource (UC_ERR_RESOURCE)&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<footer class="page-footer"><span class="copyright">crifan.org，使用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">署名4.0国际(CC BY 4.0)协议</a>发布 all right reserved，powered by Gitbook</span><span class="footer-modification">最后更新：
2023-05-31 22:25:47
</span></footer></body></html>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="unicorn_doc_refer.html" class="navigation navigation-prev " aria-label="Previous page: Unicorn文档和资料">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="reference.html" class="navigation navigation-next " aria-label="Next page: 参考资料">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Unicorn部分核心代码","level":"1.7.2","depth":2,"next":{"title":"参考资料","level":"1.7.3","depth":2,"path":"appendix/reference.md","ref":"appendix/reference.md","articles":[]},"previous":{"title":"Unicorn文档和资料","level":"1.7.1","depth":2,"path":"appendix/unicorn_doc_refer.md","ref":"appendix/unicorn_doc_refer.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-comscore","anchors","expandable-menu","-lunr","-search","search-plus","disqus","-highlight","prism","prism-themes","github-buttons","-splitter","splitter-nosessionbutcookie","-sharing","sharing-plus","tbfed-pagefooter","donate","sitemap-general","copy-code-button","callouts","toolbar-button"],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"crifan.org，使用<a href='https://creativecommons.org/licenses/by/4.0/deed.zh'>署名4.0国际(CC BY 4.0)协议</a>发布","modify_label":"最后更新：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"disqus":{"useIdentifier":false,"shortName":"crifan"},"callouts":{"showTypeInHeader":false},"toolbar-button":{"label":"下载PDF","url":"https://book.crifan.org/books/cpu_emulator_unicorn/pdf/cpu_emulator_unicorn.pdf","icon":"fa-file-pdf-o"},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"donate":{"title":"","button":"打赏","wechat":"https://www.crifan.org/files/res/crifan_com/crifan_wechat_pay.jpg","alipay":"https://www.crifan.org/files/res/crifan_com/crifan_alipay_pay.jpg","wechatText":"微信打赏给Crifan","alipayText":"支付宝打赏给Crifan"},"sitemap-general":{"prefix":"https://book.crifan.org/books/cpu_emulator_unicorn/website/"},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"splitter-nosessionbutcookie":{},"prism-themes":{},"github-buttons":{"buttons":[{"repo":"cpu_emulator_unicorn","user":"crifan","type":"star","count":true,"size":"small"},{"user":"crifan","type":"follow","width":"120","count":false,"size":"small"}]},"expandable-menu":{},"copy-code-button":{},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","line","linkedin","messenger","pocket","qq","qzone","stumbleupon","twitter","viber","vk","weibo","whatsapp"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"search-plus":{}},"theme":"default","author":"Crifan Li <admin@crifan.com>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"CPU模拟利器：Unicorn","language":"zh-hans","links":{"sidebar":{"主页":"http://www.crifan.org"}},"gitbook":"*","description":"介绍如何用Unicorn去模拟CPU去执行函数的二进制代码而得到结果。先给出Unicorn的概览；再介绍如何初始Unicorn，包括下载和安装以及运行测试代码确保环境无误。接着详细介绍如何使用Unicorn，yo尤其是概述Unicorn核心思路，接着介绍背景知识，包括程序运行的本质，涉及到CPU的核心逻辑和搞懂什么是指令；以及内存布局相关内容，包括什么是内存布局、内存地址空间范围、典型的内存布局；以及字节序endian。接着介绍运行前的准备，包括设置代码和其他内容。其他内容包含函数参数、相关数据、Stack栈、heap堆；接着介绍运行中的内容，包括如何开始运行，如何调试逻辑，主要是hook，包括hook代码和指令、hook内存、hook异常等内容；以及打印日志，包括优化日志输出。然后是运行后的内容，包括停止运行的逻辑，以及获取结果。接着整理了大量的经验和心得，包括常见的错误，比如UC_ERR_MAP、UC_ERR_WRITE_UNMAPPED等，其中涉及到br间接跳转去混淆相关内容；其他心得还包括手动修改指令、内存读取和写入时的数值转换、如何调用其他子函数、以及具体的模拟malloc、free、vm_deallocate等具体函数实现；以及用到Unicorn的showcase。然后加上一些实际案例，比如模拟akd函数symbol2575和其他一些示例代码；最后附录整理一些Unicorn文档和资料以及Unicorn的部分核心代码。最后贴出引用资料。"},"file":{"path":"appendix/unicorn_core_code.md","mtime":"2023-05-31T14:25:47.203Z","type":"markdown"},"gitbook":{"version":"4.0.7","time":"2023-09-01T15:54:54.247Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-menu/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter-nosessionbutcookie/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toolbar-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

